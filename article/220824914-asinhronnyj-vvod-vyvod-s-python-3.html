
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Ранее в Python было мало отличных вариантов для асинхронного программирования. Новая поддержка Async I/O, наконец, обеспечивает первоклассную поддержку, которая включает в себя как высокоуровневые API, так и стандартную поддержку, которая нацелена на объединение нескольких сторонних решений (Twisted, Gevent, Tornado, asyncore и т.д.)....">
<meta property="og:description" content="Ранее в Python было мало отличных вариантов для асинхронного программирования. Новая поддержка Async I/O, наконец, обеспечивает первоклассную поддержку, которая включает в себя как высокоуровневые API, так и стандартную поддержку, которая нацелена на объединение нескольких сторонних решений (Twisted, Gevent, Tornado, asyncore и т.д.)....">
<meta name="twitter:description" content="Ранее в Python было мало отличных вариантов для асинхронного программирования. Новая поддержка Async I/O, наконец, обеспечивает первоклассную поддержку, которая включает в себя как высокоуровневые API, так и стандартную поддержку, которая нацелена на объединение нескольких сторонних решений (Twisted, Gevent, Tornado, asyncore и т.д.)....">
<meta property="aiturec:description" content="Ранее в Python было мало отличных вариантов для асинхронного программирования. Новая поддержка Async I/O, наконец, обеспечивает первоклассную поддержку, которая включает в себя как высокоуровневые API, так и стандартную поддержку, которая нацелена на объединение нескольких сторонних решений (Twisted, Gevent, Tornado, asyncore и т.д.)....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html" title="Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io" title="Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/654345654.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html" class="tm-user-info__username" title="
А. Кузнецов" aria-label="
А. Кузнецов">
А. Кузнецов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Асинхронный ввод-вывод с Python 3...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Python" href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3" class="tm-article-snippet__hubs-item-link"><span>Python</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
    <meta itemprop="headline name" content="Асинхронный ввод-вывод с Python 3... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Ранее в Python было мало отличных вариантов для асинхронного программирования. Новая поддержка Async I/O, наконец, обеспечивает первоклассную поддержку, которая включает в себя как высокоуровневые API, так и стандартную поддержку, которая нацелена на объединение нескольких сторонних решений (Twisted, Gevent, Tornado, asyncore и т.д.)....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Ранее в Python было мало отличных вариантов для асинхронного программирования. Новая поддержка Async I/O, наконец, обеспечивает первоклассную поддержку, которая включает в себя как высокоуровневые API, так и стандартную поддержку, которая нацелена на объединение нескольких сторонних решений (Twisted, Gevent, Tornado, asyncore и т.д.)....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этом руководстве вы познакомитесь с возможностями асинхронного ввода-вывода, представленными в Python 3.4 и улучшенными в Python 3.5 и 3.6. </p><p>Ранее в Python было мало отличных вариантов для асинхронного программирования. Новая поддержка Async I/O, наконец, обеспечивает первоклассную поддержку, которая включает в себя как высокоуровневые API, так и стандартную поддержку, которая нацелена на объединение нескольких сторонних решений (Twisted, Gevent, Tornado, asyncore и т.д.).</p><p>Важно понимать, что изучение асинхронного ввода-вывода Python не является тривиальным из-за быстрой итерации, области действия и необходимости обеспечить путь миграции к существующим асинхронным средам. Я сосредоточусь на последних и самых простых, чтобы немного упростить.</p><p>Есть много движущихся частей, которые интересным образом взаимодействуют через границы потоков, границы процессов и удаленные машины. Существуют отличия и ограничения для конкретной платформы. Давайте разбираться. </p><h2>Pluggable Event Loops</h2><p>Основной концепцией асинхронного ввода-вывода является цикл обработки событий. В программе может быть несколько циклов событий. Каждый поток будет иметь не более одного активного цикла обработки событий. Цикл обработки событий предоставляет следующие возможности:</p><ul><li>Регистрация, выполнение и отмена отложенных вызовов (с таймаутами).</li> <li>Создание клиентских и серверных транспортов для различных видов связи.</li> <li>Запуск подпроцессов и связанных транспортов для связи с внешней программой.</li> <li>Делегирование дорогостоящих вызовов функций в пул потоков. </li> </ul><h2>Быстрый пример</h2><p>Вот небольшой пример, который запускает две подпрограммы и вызывает функцию с задержкой. Он показывает, как использовать цикл обработки событий для усиления вашей программы:</p><pre class="brush: python noskimlinks noskimwords">import asyncioasync def foo(delay):    for i in range(10):        print(i)        await asyncio.sleep(delay)def stopper(loop):    loop.stop()loop = asyncio.get_event_loop()# Schedule a call to foo()loop.create_task(foo(0.5))loop.create_task(foo(1))loop.call_later(12, stopper, loop)# Block until loop.stop() is called()loop.run_forever()loop.close()</pre><p>Класс <code class="inline">AbstractEventLoop</code> предоставляет базовый контракт для циклов событий. Есть много вещей, которые должен поддерживать цикл обработки событий:</p><ul><li>Планирование функций и подпрограмм для выполнения</li> <li>Создание фьючеров и задач</li> <li>Управление TCP-серверами</li> <li>Обработка сигналов (в Unix)</li> <li>Работа с пайпами и подпроцессами</li> </ul><p>Вот методы, связанные с выполнением и остановкой события, а также планирование функций и подпрограмм:</p><pre class="brush: python noskimlinks noskimwords">class AbstractEventLoop:    """Abstract event loop."""    # Running and stopping the event loop.    def run_forever(self):        """Run the event loop until stop() is called."""        raise NotImplementedError    def run_until_complete(self, future):        """Run the event loop until a Future is done.        Return the Future"s result, or raise its exception.        """        raise NotImplementedError    def stop(self):        """Stop the event loop as soon as reasonable.        Exactly how soon that is may depend on the implementation, but        no more I/O callbacks should be scheduled.        """        raise NotImplementedError    def is_running(self):        """Return whether the event loop is currently running."""        raise NotImplementedError    def is_closed(self):        """Returns True if the event loop was closed."""        raise NotImplementedError    def close(self):        """Close the loop.        The loop should not be running.        This is idempotent and irreversible.        No other methods should be called after this one.        """        raise NotImplementedError    def shutdown_asyncgens(self):        """Shutdown all active asynchronous generators."""        raise NotImplementedError    # Methods scheduling callbacks.  All these return Handles.    def _timer_handle_cancelled(self, handle):        """Notification that a TimerHandle has been cancelled."""        raise NotImplementedError    def call_soon(self, callback, *args):        return self.call_later(0, callback, *args)    def call_later(self, delay, callback, *args):        raise NotImplementedError    def call_at(self, when, callback, *args):        raise NotImplementedError    def time(self):        raise NotImplementedError    def create_future(self):        raise NotImplementedError    # Method scheduling a coroutine object: create a task.    def create_task(self, coro):        raise NotImplementedError    # Methods for interacting with threads.    def call_soon_threadsafe(self, callback, *args):        raise NotImplementedError    def run_in_executor(self, executor, func, *args):        raise NotImplementedError    def set_default_executor(self, executor):        raise NotImplementedError</pre><h3>Подключение нового цикла событий</h3><p>Asyncio разработан для поддержки нескольких реализаций циклов событий, которые придерживаются его API. Ключевым является класс <code class="inline">EventLoopPolicy</code>, который настраивает asyncio и позволяет контролировать каждый аспект цикла событий. Вот пример пользовательского цикла обработки событий, под названием <code class="inline">uvloop</code>, основанного на libuv, который должен быть намного быстрее, чем альтернативы (я сам не тестировал его):</p><pre class="brush: python noskimlinks noskimwords">import asyncioimport uvloopasyncio.set_event_loop_policy(uvloop.EventLoopPolicy())</pre><p>Вот и все. Теперь, когда вы используете какую-либо функцию <code class="inline">asyncio</code></p><h2>Сопрограммы, фьючеры и задачи</h2><p>Сопрограмма - это загруженный термин. Это функция, которая выполняется асинхронно, и объект, который необходимо запланировать. Вы определяете их, добавляя ключевое слово <code class="inline">async</code> перед определением:</p><pre class="brush: python noskimlinks noskimwords">import asyncioasync def cool_coroutine():    return "So cool..."</pre><p>Если вы вызываете такую функцию, она не запускается. Вместо этого он возвращает объект сопрограммы, и если вы не запланируете его выполнение, вы также получите предупреждение:</p><pre class="brush: python noskimlinks noskimwords">c = cool_coroutine()print(c)Output:&lt;coroutine object cool_coroutine at 0x108a862b0&gt;sys:1: RuntimeWarning: coroutine "cool_coroutine" was never awaitedProcess finished with exit code 0</pre><p>Чтобы фактически выполнить сопрограмму, нам нужен цикл обработки событий:</p><pre class="brush: python noskimlinks noskimwords">r = loop.run_until_complete(c)loop.close()print(r)Output:So cool...</pre><p>Это прямое планирование. Вы также можете построить цепочку сопрограмм. Обратите внимание, что вы должны вызывать <code class="inline">await</code> при вызове сопрограмм:</p><pre class="brush: python noskimlinks noskimwords">import asyncioasync def compute(x, y):    print("Compute %s + %s ..." % (x, y))    await asyncio.sleep(1.0)    return x + yasync def print_sum(x, y):    result = await compute(x, y)    print("%s + %s = %s" % (x, y, result))loop = asyncio.get_event_loop()loop.run_until_complete(print_sum(1, 2))loop.close()</pre><p>Класс asyncio Future аналогичен классу <span>concurrent.future.Future</span>. Он не является потоко-безопасным и поддерживает следующие функции:</p><ul><li>добавление и удаление готовых обратных вызовов</li> <li>отмена</li> <li>настройка результатов и исключений</li> </ul><p>Вот как использовать future с циклом событий. Сопрограмма <code class="inline">take_your_time()</code> принимает future и устанавливает его результат после сна на секунду.</p><p>Функция <code class="inline">sure_future()</code> планирует сопрограмму, а <code class="inline">wait_until_complete()</code> ожидает выполнения future. За кулисами она добавляет готовый обратный вызов в future.</p><pre class="brush: python noskimlinks noskimwords">import asyncioasync def take_your_time(future):    await asyncio.sleep(1)    future.set_result(42)loop = asyncio.get_event_loop()future = asyncio.Future()asyncio.ensure_future(take_your_time(future))loop.run_until_complete(future)print(future.result())loop.close()</pre><p>Это довольно громоздко. Asyncio предлагает задачи, чтобы сделать работу с фьючерами и сопрограммами более приятной. Задача - это подкласс Future, который оборачивает сопрограмму и которую можно отменить. </p><p>Сопрограмма не должна принимать явное future и устанавливать его результат или исключение. Вот как выполнить те же операции с задачей:</p><pre class="brush: python noskimlinks noskimwords">import asyncioasync def take_your_time():    await asyncio.sleep(1)    return 42loop = asyncio.get_event_loop()task = loop.create_task(take_your_time())loop.run_until_complete(task)print(task.result())loop.close()</pre><h2>Транспорты, протоколы и потоки</h2><p>Транспорт - это абстракция канала связи. Транспорт всегда поддерживает определенный протокол. Asyncio предоставляет встроенные реализации для TCP, UDP, SSL и каналов подпроцесса.</p><p>Если вы знакомы с сетевым программированием на основе сокетов, вы будете чувствовать себя как дома с транспортными средствами и протоколами. С Asyncio вы получаете асинхронное сетевое программирование стандартным способом. Давайте посмотрим на печально известный эхо-сервер и клиент («привет мир» сетей). </p><p>Во-первых, клиент echo реализует класс <code class="inline">EchoClient</code>, производный от <code class="inline">asyncio.Protocol</code>. Он сохраняет свой цикл обработки событий и сообщение, которое он отправит на сервер при подключении. </p><p>В обратном вызове <code class="inline">connection_made()</code> записывает свое сообщение в транспорт. В методе <code class="inline">data_received()</code> он просто печатает ответ сервера, а в методе <code class="inline">connection_lost()</code> останавливает цикл обработки событий. При передаче экземпляра класса <code class="inline">EchoClient</code> в метод цикла <code class="inline">create_connection()</code> результатом является сопрограмма, которую цикл выполняет, пока не завершится. </p><pre class="brush: python noskimlinks noskimwords">import asyncioclass EchoClient(asyncio.Protocol):    def __init__(self, message, loop):        self.message = message        self.loop = loop    def connection_made(self, transport):        transport.write(self.message.encode())        print("Data sent: {!r}".format(self.message))    def data_received(self, data):        print("Data received: {!r}".format(data.decode()))    def connection_lost(self, exc):        print("The server closed the connection")        print("Stop the event loop")        self.loop.stop()loop = asyncio.get_event_loop()message = "Hello World!"coro = loop.create_connection(lambda: EchoClient(message, loop),                              "127.0.0.1", 8888)loop.run_until_complete(coro)loop.run_forever()loop.close()  </pre><p>Сервер аналогичен, за исключением того, что он работает вечно, ожидая подключения клиентов. После отправки эхо-ответа он также закрывает соединение с клиентом и готов к подключению следующего клиента. </p><p>Новый экземпляр <code class="inline">EchoServer</code> создается для каждого соединения, поэтому даже если несколько клиентов подключаются одновременно, не возникнет проблемы конфликтов с атрибутом <code class="inline">transport</code>.</p><pre class="brush: python noskimlinks noskimwords">import asyncioclass EchoServer(asyncio.Protocol):    def connection_made(self, transport):        peername = transport.get_extra_info("peername")        print("Connection from {}".format(peername))        self.transport = transport    def data_received(self, data):        message = data.decode()        print("Data received: {!r}".format(message))        print("Send: {!r}".format(message))        self.transport.write(data)        print("Close the client socket")        self.transport.close()loop = asyncio.get_event_loop()# Each client connection will create a new protocol instancecoro = loop.create_server(EchoServer, "127.0.0.1", 8888)server = loop.run_until_complete(coro)print("Serving on {}".format(server.sockets[0].getsockname()))loop.run_forever()</pre><p>Вот результат после подключения двух клиентов:</p><pre class="brush: bash noskimlinks noskimwords">Serving on ("127.0.0.1", 8888)Connection from ("127.0.0.1", 53248)Data received: "Hello World!"Send: "Hello World!"Close the client socketConnection from ("127.0.0.1", 53351)Data received: "Hello World!"Send: "Hello World!"Close the client socket</pre><p>Потоки предоставляют высокоуровневый API, который основан на сопрограммах и предоставляет абстракции Reader и Writer. Протоколы и транспорты скрыты, нет необходимости определять ваши собственные классы и нет обратных вызовов. Вы просто ждете такие события, как соединение и полученные данные. </p><p>Клиент вызывает функцию <code class="inline">open_connection()</code>, которая возвращает объекты чтения и записи, использованные естественным образом. Чтобы закрыть соединение, он закрывает писателя. </p><pre class="brush: python noskimlinks noskimwords">import asyncioasync def tcp_echo_client(message, loop):    reader, writer = await asyncio.open_connection(        "127.0.0.1",         8888,         loop=loop)    print("Send: %r" % message)    writer.write(message.encode())    data = await reader.read(100)    print("Received: %r" % data.decode())    print("Close the socket")    writer.close()message = "Hello World!"loop = asyncio.get_event_loop()loop.run_until_complete(tcp_echo_client(message, loop))loop.close()</pre><p>Сервер также значительно упрощен.</p><pre class="brush: python noskimlinks noskimwords">import asyncioasync def handle_echo(reader, writer):    data = await reader.read(100)    message = data.decode()    addr = writer.get_extra_info("peername")    print("Received %r from %r" % (message, addr))    print("Send: %r" % message)    writer.write(data)    await writer.drain()    print("Close the client socket")    writer.close()loop = asyncio.get_event_loop()coro = asyncio.start_server(handle_echo,                             "127.0.0.1",                             8888,                             loop=loop)server = loop.run_until_complete(coro)print("Serving on {}".format(server.sockets[0].getsockname()))loop.run_forever()</pre><h2>Работа с подпроцессами</h2><p>Asyncio также охватывает взаимодействия с подпроцессами. Следующая программа запускает другой процесс Python и выполняет код «import this». Это одно из знаменитых пасхальных яиц Python, на котором напечатано «Zen of Python». Проверьте вывод ниже. </p><p>Процесс Python запускается в сопрограмме <code class="inline">zen()</code> с помощью функции <code class="inline">create_subprocess_exec()</code> и связывает стандартный вывод с каналом. Затем он перебирает стандартные выходные строки построчно, используя <code class="inline">await</code>, чтобы дать возможность другим процессам или сопрограммам выполнить их, если вывод еще не готов. </p><p>Обратите внимание, что в Windows вы должны установить цикл обработки событий в <code class="inline">ProactorEventLoop</code>, потому что стандартный <code class="inline">SelectorEventLoop</code> не поддерживает каналы. </p><pre class="brush: python noskimlinks noskimwords">import asyncio.subprocessimport sysasync def zen():    code = "import this"    create = asyncio.create_subprocess_exec(        sys.executable,         "-c",         code,        stdout=asyncio.subprocess.PIPE)    proc = await create    data = await proc.stdout.readline()    while data:        line = data.decode("ascii").rstrip()        print(line)        data = await proc.stdout.readline()    await proc.wait()if sys.platform == "win32":    loop = asyncio.ProactorEventLoop()    asyncio.set_event_loop(loop)else:    loop = asyncio.get_event_loop()loop.run_until_complete(zen())Output:The Zen of Python, by Tim PetersBeautiful is better than ugly.Explicit is better than implicit.Simple is better than complex.Complex is better than complicated.Flat is better than nested.Sparse is better than dense.Readability counts.Special cases aren"t special enough to break the rules.Although practicality beats purity.Errors should never pass silently.Unless explicitly silenced.In the face of ambiguity, refuse the temptation to guess.There should be one-- and preferably only one --obvious way todo it.Although that way may not be obvious at first unless you"reDutch.Now is better than never.Although never is often better than *right* now.If the implementation is hard to explain, it"s a bad idea.If the implementation is easy to explain, it may be a good idea.Namespaces are one honking great idea -- let"s do more of those!</pre><h2>Заключение</h2><p>Не стесняйтесь и проверьте, что у нас есть для продажи и для изучения <span>на рынке</span>, а так же не стесняйтесь задавать любые вопросы, используя канал ниже.<br></p><p>Asyncio в Python - это комплексная среда для асинхронного программирования. Она имеет огромную область применения и поддерживает как низкоуровневые, так и высокоуровневые API. Она все еще относительно молода и не очень хорошо понята сообществом. </p><p>Я уверен, что со временем появятся лучшие практики, и появится больше примеров, которые упростят использование этой мощной библиотеки.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Python" href="https://norma-studio.github.io/article/220824914-asinhronnyj-vvod-vyvod-s-python-3" class="tm-article-body__tags-item-link">Python</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
44338</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
579</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
