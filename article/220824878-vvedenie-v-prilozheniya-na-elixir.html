
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В моих предыдущих статьях мы обсуждали различные термины Elixir и писали много кода. Однако мы не обсуждали, как структурировать и упорядочить ваш код, чтобы его было легко поддерживать и релизить. ...">
<meta property="og:description" content="В моих предыдущих статьях мы обсуждали различные термины Elixir и писали много кода. Однако мы не обсуждали, как структурировать и упорядочить ваш код, чтобы его было легко поддерживать и релизить. ...">
<meta name="twitter:description" content="В моих предыдущих статьях мы обсуждали различные термины Elixir и писали много кода. Однако мы не обсуждали, как структурировать и упорядочить ваш код, чтобы его было легко поддерживать и релизить. ...">
<meta property="aiturec:description" content="В моих предыдущих статьях мы обсуждали различные термины Elixir и писали много кода. Однако мы не обсуждали, как структурировать и упорядочить ваш код, чтобы его было легко поддерживать и релизить. ...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1463/profiles/19974/profileImage/AAEAAQAAAAAAAAPnAAAAJGMwZGE5NzIzLTAxM2UtNDVjNi04YTI5LTU5NDg2Nzk2MjMwZg.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1463/profiles/19974/profileImage/AAEAAQAAAAAAAAPnAAAAJGMwZGE5NzIzLTAxM2UtNDVjNi04YTI5LTU5NDg2Nzk2MjMwZg.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1463/profiles/19974/profileImage/AAEAAQAAAAAAAAPnAAAAJGMwZGE5NzIzLTAxM2UtNDVjNi04YTI5LTU5NDg2Nzk2MjMwZg.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1463/profiles/19974/profileImage/AAEAAQAAAAAAAAPnAAAAJGMwZGE5NzIzLTAxM2UtNDVjNi04YTI5LTU5NDg2Nzk2MjMwZg.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1463/profiles/19974/profileImage/AAEAAQAAAAAAAAPnAAAAJGMwZGE5NzIzLTAxM2UtNDVjNi04YTI5LTU5NDg2Nzk2MjMwZg.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html" title="Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io" title="Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/54332343.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html" class="tm-user-info__username" title="
В. Бухтеев" aria-label="
В. Бухтеев">
В. Бухтеев</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Введение в приложения на Elixir...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Elixir" href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir" class="tm-article-snippet__hubs-item-link"><span>Elixir</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1463/profiles/19974/profileImage/AAEAAQAAAAAAAAPnAAAAJGMwZGE5NzIzLTAxM2UtNDVjNi04YTI5LTU5NDg2Nzk2MjMwZg.jpg">
    <meta itemprop="headline name" content="Введение в приложения на Elixir... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В моих предыдущих статьях мы обсуждали различные термины Elixir и писали много кода. Однако мы не обсуждали, как структурировать и упорядочить ваш код, чтобы его было легко поддерживать и релизить. ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В моих предыдущих статьях мы обсуждали различные термины Elixir и писали много кода. Однако мы не обсуждали, как структурировать и упорядочить ваш код, чтобы его было легко поддерживать и релизить. ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В моих предыдущих статьях мы обсуждали различные термины Elixir и писали много кода. Однако мы не обсуждали, как структурировать и упорядочить ваш код, чтобы его было легко поддерживать и релизить. </p><p><span>Приложения</span> очень распространены для Erlang и Elixir и используются для создания повторно используемых компонентов, которые ведут себя как автономные юниты. Одно приложение может иметь свое собственное дерево супервизоров и конфигурацию, и оно может полагаться на другие приложения, доступные либо локально, либо на каком-то удаленном сервере. В целом, работа с приложениями не такая сложная, и люди, которые пришли, скажем, из мира Ruby, найдут много знакомых концептов.</p><p>В этой статье вы узнаете, что такое приложения, как они могут быть созданы, как определять и устанавливать зависимости, и как предоставлять значения среды. В конце статьи мы сделаем некоторую практику и создадим веб-калькулятор. </p><p>В этой статье я буду использовать Elixir 1.5 (он был <span>выпущен пару месяцев назад</span>), но все объясненные концепции должны применяться и к версии 1.4.</p><h2>Приложения?</h2><p>Некоторые могут возразить, что термин "приложение" не очень подходит, потому что в Erlang и Elixir он фактически означает компонент или какой-то код, который имеет кучу зависимостей. Само приложение также может быть использовано в качестве зависимости. В мире Ruby мы бы назвали это "гемом".</p><p>В общем, приложения очень распространены в Elixir и позволяют создавать повторно используемые компоненты, а также обеспечивают легкое управление зависимостями. Они состоят из одного или нескольких модулей с нулевыми или более зависимостями и описываются файлом ресурсов приложения. Этот файл содержит информацию о имени, версии приложения, его модулях, зависимостях и некоторых других материалах. Вы можете создать файл ресурсов вручную, но гораздо проще сделать это с помощью инструмента mix, который также подготовит для вас правильную структуру папок. </p><p>Итак, давайте посмотрим, как мы можем создать новое приложение Elixir!</p><h2>Новое приложение</h2><p>Чтобы создать новое приложение, все, что вам нужно сделать, это запустить следующую команду:</p><pre class="brush: bash noskimlinks noskimwords">mix new app_name</pre><p>Мы также можем предоставить флаг <code class="inline">--sup</code> для создания пустого супервизора. Давайте создадим новое приложение <code class="inline">Sample</code>:</p><pre class="brush: bash noskimlinks noskimwords">mix new sample --sup</pre><p>Эта команда создаст каталог <em>sample</em> с несколькими файлами и папками внутри. Позвольте мне быстро ознакомить вас с ними:</p><ul><li> <em>config</em> содержит единственный файл <em>config.exs</em>, который, как вы можете догадаться, обеспечивает конфигурацию приложения. Первоначально он имеет некоторые полезные комментарии, но не имеет конфигурации. Кстати, обратите внимание, что конфигурация, представленная в этом файле, ограничивается только самим приложением. Если вы загружаете приложение как зависимость, его <em>config.exs</em> будет игнорироваться.</li> <li> <em>lib</em> — основная папка приложения, содержащая файл <em>sample.ex</em> и папку <em>sample</em> с файлом <em>application.ex</em>. <em>application.ex</em> определяет модуль обратного вызова с функцией <code class="inline">start/2</code>, которая создает пустой супервайзер.</li> <li> <em>test</em> — это папка, содержащая автоматические тесты для приложения. Мы не будем обсуждать тесты в этой статье.</li> <li> <em>mix.exs</em> — это файл, содержащий всю необходимую информацию о приложении. Здесь есть несколько функций. Внутри функции <code class="inline">project</code> вы указываете имя приложения (как атом), версию и среду. Функция <code class="inline">application</code> содержит информацию о зависимостях обратного вызова и рантайма. В нашем случае <code class="inline">Sample.Application</code> устанавливается как обратный вызов модуля приложения (который можно рассматривать как главную точку входа), и он должен определить функцию <code class="inline">start/2</code>. Как уже упоминалось выше, эта функция была создана для нас инструментом <code class="inline">mix</code>. Наконец, функция <code class="inline">deps</code> отображает зависимости сборки.</li> </ul><h3>Зависимости</h3><p>Очень важно различать зависимости рантайма и сборки. Зависимости сборки загружаются инструментом <code class="inline">mix</code> во время компиляции и в основном скомпилированы в ваше приложение. </p><p>Они могут быть получены из сервисов, например, GitHub или с сайта <span>hex.pm</span> — внешнего менеджера пакетов, который хранит тысячи компонентов для Elixir и Erlang. Зависимости рантайма запускаются до запуска приложения. Они уже собраны и доступны для нас.</p><p>Существует несколько способов указать зависимости  сборки в файле <em>mix.exs</em>. Если вы хотите использовать приложение с сайта hex.pm, просто скажите:</p><pre class="brush: erlang noskimlinks noskimwords">{:dependency_name, "~&gt; 0.0.1"}</pre><p>Первый аргумент — это всегда атом, представляющий имя приложения. Второй — это требование, которое вы хотите использовать, — оно анализируется <span>модулем Version</span>. В этом примере <code class="inline">~&gt;</code> означает, что мы хотим загрузить хотя бы версию <code class="inline">0.0.1</code> или выше, но менее <code class="inline">0,1.0</code>. Если мы объявляем  <code class="inline">~&gt; 1.0</code>, это означает, что мы хотели бы использовать версию, большую или равную <code class="inline">1.0</code>, но менее <code class="inline">2.0</code>. Существуют также операторы типа <code class="inline">==</code>,<code class="inline">&gt;</code>, <code class="inline">&lt;</code>,<code class="inline">&gt;=</code> и <code class="inline">&lt;=</code>.</p><p>Также возможно прямо указать параметры <code class="inline">:git</code> или <code class="inline">:path</code>:</p><pre class="brush: erlang noskimlinks noskimwords">{:gettext, git: "https://github.com/elixir-lang/gettext.git", tag: "0.1"}{:local_dependency, path: "path/to/local_dependency"}</pre><p>Существует также сокращение <code class="inline">:github</code>, которое позволяет нам предоставлять только имя владельца и репо:</p><pre class="brush: erlang noskimlinks noskimwords">{:gettext, github: "elixir-lang/gettext"}</pre><p>Чтобы загрузить и скомпилировать все зависимости, запустите:</p><pre class="brush: bash noskimlinks noskimwords">mix deps.get</pre><p>Эта команда установит клиент Hex, если у вас его нет, а затем проверит, нужно ли обновлять какие-либо из зависимостей. Например, вы можете указать <span>Poison</span> — решение для синтаксического анализа JSON как зависимость:</p><pre class="brush: erlang noskimlinks noskimwords">  defp deps do    [      {:poison, "~&gt; 3.1"}    ]  end</pre><p>Затем выполните:</p><pre class="brush: bash noskimlinks noskimwords">mix deps.get</pre><p>Вы увидите аналогичный результат:</p><pre class="brush: plain noskimlinks noskimwords">Running dependency resolution...Dependency resolution completed:  poison 3.1.0* Getting poison (Hex package)  Checking package (https://repo.hex.pm/tarballs/poison-3.1.0.tar)  Fetched package</pre><p>Poison теперь скомпилирован и доступен на вашем ПК. Более того, файл <em>mix.lock</em> будет создан автоматически. Этот файл предоставляет точные версии зависимостей, которые будут использоваться при загрузке приложения. </p><p>Чтобы узнать больше о зависимостях, выполните следующую команду:</p><pre class="brush: bash noskimlinks noskimwords">mix help deps</pre><h3>Поведение</h3><p>Приложения - это поведение, как и <span>GenServer</span> и <span>супервизоры</span>, о которых мы говорили в предыдущих статьях. Как я уже упоминал выше, мы предоставляем модуль обратного вызова внутри файла <em>mix.exs</em> следующим образом:</p><pre class="brush: erlang noskimlinks noskimwords">  def application do    [      mod: {Sample.Application, []}    ]  end</pre><p><code class="inline">Sample.Application</code> — это имя модуля, тогда как <code class="inline">[]</code> может содержать список аргументов для передачи в <span>функцию</span> <code class="inline"><span>start/2</span></code>. Функция <code class="inline">start/2</code> должна быть реализована для правильной загрузки приложения.</p><p><em>application.ex</em> содержит модуль обратного вызова, который выглядит так:</p><pre class="brush: erlang noskimlinks noskimwords">defmodule Sample.Application do  use Application  def start(_type, _args) do    children = [    ]    opts = [strategy: :one_for_one, name: Sample.Supervisor]    Supervisor.start_link(children, opts)  endend</pre><p>Функция <code class="inline">start/2</code> должна либо возвращать <code class="inline">{:ok, pid}</code> (с необязательным состоянием в качестве третьего элемента), либо <code class="inline">{:error, reason}</code>.</p><p>Еще одна вещь, о которой стоит упомянуть, заключается в том, что на самом деле, приложениям вообще не нужен модуль обратного вызова. Это означает, что функция application внутри файла <em>mix.exs</em> может стать минималистичной:</p><pre class="brush: erlang noskimlinks noskimwords">def application do    []end</pre><p>Такие приложения называются <em>библиотечными приложениями</em>. У них нет никакого дерева супервизоров, но их все еще можно использовать в качестве зависимостей для других приложений. Одним из примеров библиотечных приложений будет Poison, который мы указали как зависимость в предыдущем разделе.</p><h3>Запуск приложения</h3><p>Самый простой способ запустить приложение — запустить следующую команду:</p><pre class="brush: bash noskimlinks noskimwords">iex -S mix</pre><p>Вы увидите результат, похожий на этот:</p><pre class="brush: plain noskimlinks noskimwords">Compiling 2 files (.ex)Generated sample app</pre><p>В папке <em>sample</em> будет создан каталог <em>_build</em>. Он будет содержать файлы <em>.beam</em>, а также некоторые другие файлы и папки.</p><p>Если вы не хотите запускать оболочку Elixir, необходимо запустить другой вариант:</p><pre class="brush: bash noskimlinks noskimwords">mix run</pre><p>Проблема, однако, в том, что приложение остановится, как только функция <code class="inline">start</code> завершит свою работу. Поэтому вы можете предоставить ключ <code class="inline">--no-halt</code>, чтобы приложение работало столько, сколько необходимо:</p><pre class="brush: bash noskimlinks noskimwords">mix run --no-halt</pre><p>То же самое можно сделать с помощью команды <code class="inline">elixir</code>:</p><pre class="brush: bash noskimlinks noskimwords">elixir -S mix run --no-halt</pre><p>Обратите внимание, однако, что приложение остановится, как только вы закроете терминал, в котором эта команда была выполнена. Этого можно избежать, запустив приложение в отдельном режиме: </p><pre class="brush: plain noskimlinks noskimwords">elixir -S mix run --no-halt --detached</pre><h2>Окружение приложения</h2><p>Иногда вам может потребоваться, чтобы пользователь приложения установил некоторый параметр до того, как приложение действительно загрузилось. Это полезно, когда, например, пользователь должен иметь возможность контролировать, какой порт должен прослушивать веб-сервер. Такие параметры могут быть указаны в среде приложения, которая представляет собой простое хранилище ключей для хранения в памяти. </p><p>Чтобы прочитать некоторый параметр, используйте <span>функцию</span> <code class="inline"><span>fetch_env/2</span></code>, которая принимает приложение и ключ:</p><pre class="brush: erlang noskimlinks noskimwords">Application.fetch_env(:sample, :some_key) </pre><p>Если ключ не найден, возвращается атом <code class="inline">:error</code>. Также есть функция <code class="inline">fetch_env!/2</code>, которая вызывает ошибку, <code class="inline">get_env/3</code>, которая может предоставлять значение по умолчанию.</p><p>Чтобы сохранить параметр, используйте <code class="inline"><span>put_env/4</span></code>:</p><pre class="brush: erlang noskimlinks noskimwords">Application.put_env(:sample, :key, :value)</pre><p>Четвертое значение содержит параметры и не является обязательным.</p><p>Наконец, чтобы удалить ключ, используйте <span>функцию</span> <code class="inline"><span>delete_env/3</span></code>:</p><pre class="brush: plain noskimlinks noskimwords">Application.delete_env(:sample, :key)</pre><p>Как мы предоставляем значение для среды при запуске приложения? Такие параметры задаются с помощью ключа <code class="inline">--erl</code> следующим образом:</p><pre class="brush: bash noskimlinks noskimwords">iex --erl "-sample key value" -S mix</pre><p>Затем вы можете легко получить значение:</p><pre class="brush: erlang noskimlinks noskimwords">Application.get_env :sample, :key # =&gt; :value</pre><p>Что делать, если пользователь забывает указать параметр при запуске приложения? Ну, скорее всего, нам нужно предоставить значение по умолчанию для таких случаев. Есть два возможных места, где вы можете сделать это: внутри <em>config.exs</em> или внутри файла <em>mix.exs</em>.</p><p>Первый вариант является предпочтительным, потому что <em>config.exs</em> — это файл, который на самом деле предназначен для хранения различных параметров конфигурации. Если ваше приложение имеет множество параметров среды, вы обязательно должны придерживаться <em>config.exs</em>:</p><pre class="brush: erlang noskimlinks noskimwords">use Mix.Configconfig :sample, key: :value</pre><p>Однако для более мелкого приложения вполне нормально указывать значения среды непосредственно в <em>mix.exs</em>, настраивая функцию application:</p><pre class="brush: erlang noskimlinks noskimwords">  def application do    [      extra_applications: [:logger],      mod: {Sample.Application, []},      env: [ # &lt;====        key: :value      ]    ]  end</pre><h2>Пример: создание веб-сервера CalcServer</h2><p>Хорошо, чтобы увидеть приложения в действии, давайте изменим пример, который уже обсуждался в моих статьях о <span>GenServer</span> и <span>Supervisors</span>. Это простой калькулятор, который позволяет пользователям выполнять различные математические операции и легко получать результат. </p><p>Я хочу сделать этот калькулятор веб-сайтом, чтобы мы могли отправлять POST-запросы для выполнения вычислений и GET-запрос для получения результата.</p><p>Создайте новый файл <em>lib/calc_server.ex</em> со следующим содержимым:</p><pre class="brush: erlang noskimlinks noskimwords">defmodule Sample.CalcServer do  use GenServer  def start_link(initial_value) do    GenServer.start_link(__MODULE__, initial_value, name: __MODULE__)  end  def init(initial_value) when is_number(initial_value) do    {:ok, initial_value}  end  def init(_) do    {:stop, "The value must be an integer!"}  end  def add(number) do    GenServer.cast(__MODULE__, {:add, number})  end  def result do    GenServer.call(__MODULE__, :result)  end  def handle_call(:result, _, state) do    {:reply, state, state}  end  def handle_cast(operation, state) do    case operation do      {:add, number} -&gt; {:noreply, state + number}      _ -&gt; {:stop, "Not implemented", state}    end  end  def terminate(_reason, _state) do    IO.puts "The server terminated"  endend</pre><p>Мы добавим поддержку операции <code class="inline">add</code>. Все остальные математические операции могут быть введены таким же образом, поэтому я не буду перечислять их здесь, чтобы сделать код более компактным.</p><p><code class="inline">CalcServer</code> использует <code class="inline">GenServer</code>, поэтому мы автоматически получаем <code class="inline">child_spec</code> и можем запустить его из функции обратного вызова следующим образом:</p><pre class="brush: erlang noskimlinks noskimwords">  def start(_type, _args) do    children = [      {Sample.CalcServer, 0}    ]    opts = [strategy: :one_for_one, name: Sample.Supervisor]    Supervisor.start_link(children, opts)  end</pre><p><code class="inline">0</code> вот исходный результат. Он должен быть числом, иначе <code class="inline">CalcServer</code> немедленно прервется.</p><p>Теперь вопрос в том, как мы добавляем поддержку веба? Для этого нам понадобятся две сторонние зависимости: <span>Plug</span>, который будет действовать как библиотека абстракции, и <span>Cowboy</span>, который будет действовать как реальный веб-сервер. Конечно, нам нужно указать эти зависимости внутри файла <em>mix.exs</em>:</p><pre class="brush: erlang noskimlinks noskimwords">  defp deps do    [      {:cowboy, "~&gt; 1.1"},      {:plug, "~&gt; 1.4"}    ]  end</pre><p>Теперь мы можем запустить приложение Plug под нашим собственным деревом супервайзеров. Подкорректируйте функцию start следующим образом:</p><pre class="brush: erlang noskimlinks noskimwords">  def start(_type, _args) do    children = [      Plug.Adapters.Cowboy.child_spec(        :http, Sample.Router, [], [port: Application.fetch_env!(:sample, :port)]      ),      {Sample.CalcServer, 0}    ]    # ...  end</pre><p>Здесь мы предоставляем <code class="inline">child_spec</code> и устанавливаем <code class="inline">Sample.Router</code> для ответа на запросы. Этот модуль будет создан через мгновение. Однако мне не нравится, что номер порта жестко зашит, что не очень удобно. Я могу настроить его при запуске приложения, поэтому давайте вместо этого сохраним его в среде:</p><pre class="brush: erlang noskimlinks noskimwords">Plug.Adapters.Cowboy.child_spec(  :http, Sample.Router, [], [port: Application.fetch_env!(:sample, :port)])</pre><p>Теперь укажите значение порта по умолчанию в файле <em>config.exs</em>:</p><pre class="brush: erlang noskimlinks noskimwords">config :sample, port: 8088</pre><p>Великолепно! </p><p>Как насчет маршрутизатора? Создайте новый файл <em>lib/router.ex</em> со следующим содержимым:</p><pre class="brush: erlang noskimlinks noskimwords">defmodule Sample.Router do  use Plug.Router  plug :match  plug :dispatchend</pre><p>Теперь нам нужно определить пару маршрутов для выполнения добавления и получения результата:</p><pre class="brush: erlang noskimlinks noskimwords">  get "/result" do    conn |&gt; ok(to_string(Sample.CalcServer.result))  end  post "/add" do    fetch_number(conn) |&gt; Sample.CalcServer.add    conn |&gt; ok  end</pre><p>Мы используем макросы <code class="inline">get</code> и <code class="inline">post</code> для определения маршрутов <code class="inline">/result</code> и <code class="inline">/add</code>. Эти макросы установят для нас объект <code class="inline">conn</code>. </p><p><code class="inline">ok</code> и <code class="inline">fetch_number</code> являются приватными функциями, определяемыми следующим образом:</p><pre class="brush: erlang noskimlinks noskimwords">  defp fetch_number(conn) do    Plug.Conn.fetch_query_params(conn).params["number"] |&gt;    String.to_integer  end  defp ok(conn, data \ "OK") do    send_resp conn, 200, data  end</pre><p><span><code class="inline">fetch_query_params/2</code></span> возвращает объект со всеми параметрами запроса. Нас интересует только тот номер, который отправляет нам пользователь. Все параметры изначально являются строками, поэтому нам нужно преобразовать их в целое число.</p><p><span><code class="inline">send_resp/3</code></span> отправляет ответ клиенту с предоставленным кодом состояния и телом. Мы не будем проверять здесь ошибки, поэтому код всегда будет <code class="inline">200</code>, что означает, что все в порядке.</p><p>И это все! Теперь вы можете запустить приложение любым из перечисленных выше способов (например, набрав <code class="inline">iex -S mix</code>) и использовать инструмент <code class="inline">curl</code> для выполнения запросов:</p><pre class="brush: bash noskimlinks noskimwords">curl https://localhost:8088/result# =&gt; 0curl http://localhost:8088/add?number=1 -X POST# =&gt; OKcurl http://localhost:8088/result# =&gt; 1</pre><h2>Заключение</h2><p>В этой статье мы обсудили приложения Elixir и их назначение. Вы узнали, как создавать приложения, предоставлять различные типы информации и перечислять зависимости внутри файла <em>mix.exs</em>. Вы также видели, как сохранить конфигурацию внутри среды приложения и узнали несколько способов запуска приложения. Наконец, мы видели приложения в действии и создали простой веб-калькулятор.</p><p>Не забывайте, что на сайте <span>hex.pm</span> представлено множество сотен сторонних приложений, готовых для использования в ваших проектах, поэтому обязательно просмотрите каталог и выберите подходящее вам решение! </p><p>Надеюсь, вы нашли эту статью полезной и интересной. Я благодарю вас за то, что оставались со мной! Еще увидимся.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Elixir" href="https://norma-studio.github.io/article/220824878-vvedenie-v-prilozheniya-na-elixir" class="tm-article-body__tags-item-link">Elixir</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
30873</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
578</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
