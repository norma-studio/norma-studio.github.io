
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Виртуальная машина Java, или сокращенно JVM, поддерживает многопоточность. Любой процесс, на котором вы работаете, может создавать разумное количество потоков для асинхронного выполнения нескольких задач. Однако написание кода, который может сделать это оптимальным и безошибочным способом, может быть чрезвычайно трудным. На протяжении многих лет Ja...">
<meta property="og:description" content="Виртуальная машина Java, или сокращенно JVM, поддерживает многопоточность. Любой процесс, на котором вы работаете, может создавать разумное количество потоков для асинхронного выполнения нескольких задач. Однако написание кода, который может сделать это оптимальным и безошибочным способом, может быть чрезвычайно трудным. На протяжении многих лет Ja...">
<meta name="twitter:description" content="Виртуальная машина Java, или сокращенно JVM, поддерживает многопоточность. Любой процесс, на котором вы работаете, может создавать разумное количество потоков для асинхронного выполнения нескольких задач. Однако написание кода, который может сделать это оптимальным и безошибочным способом, может быть чрезвычайно трудным. На протяжении многих лет Ja...">
<meta property="aiturec:description" content="Виртуальная машина Java, или сокращенно JVM, поддерживает многопоточность. Любой процесс, на котором вы работаете, может создавать разумное количество потоков для асинхронного выполнения нескольких задач. Однако написание кода, который может сделать это оптимальным и безошибочным способом, может быть чрезвычайно трудным. На протяжении многих лет Ja...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/362/posts/29304/preview_image/picKotlin.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/362/posts/29304/preview_image/picKotlin.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/362/posts/29304/preview_image/picKotlin.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/362/posts/29304/preview_image/picKotlin.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/362/posts/29304/preview_image/picKotlin.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html" title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io" title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/45343254534.jpg" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html" class="tm-user-info__username" title="
С. Баранов" aria-label="
С. Баранов">
С. Баранов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami" class="tm-article-snippet__hubs-item-link"><span>Android SDK</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/362/posts/29304/preview_image/picKotlin.jpg">
    <meta itemprop="headline name" content="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Виртуальная машина Java, или сокращенно JVM, поддерживает многопоточность. Любой процесс, на котором вы работаете, может создавать разумное количество потоков для асинхронного выполнения нескольких задач. Однако написание кода, который может сделать это оптимальным и безошибочным способом, может быть чрезвычайно трудным. На протяжении многих лет Ja...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Виртуальная машина Java, или сокращенно JVM, поддерживает многопоточность. Любой процесс, на котором вы работаете, может создавать разумное количество потоков для асинхронного выполнения нескольких задач. Однако написание кода, который может сделать это оптимальным и безошибочным способом, может быть чрезвычайно трудным. На протяжении многих лет Ja...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Виртуальная машина Java, или сокращенно JVM, поддерживает многопоточность. Любой процесс, на котором вы работаете, может создавать разумное количество потоков для асинхронного выполнения нескольких задач. Однако написание кода, который может сделать это оптимальным и безошибочным способом, может быть чрезвычайно трудным. На протяжении многих лет Java, другие языки JVM и множество сторонних библиотек пытались предложить креативные и элегантные подходы для решения этой проблемы.<br></p><p>Например, в Java 5 была представлена среда executor, которая позволяет вам отделить детали управления потоками от вашей бизнес-логики. Java 8 предлагает параллельные потоки, которые можно легко использовать с лямбда-выражениями. RxJava привносит реактивные расширения в Java, позволяя вам писать очень краткий и читаемый асинхронный код.</p><p>Kotlin поддерживает почти все эти подходы и предлагает несколько своих. В этом уроке я покажу вам, как вы можете использовать их в приложениях для Android.<br></p><h2>Предпосылки</h2><p>Чтобы следовать этому уроку, вам понадобится:<br></p><ul><li> <span>Android Studio</span> 2.3.3 или выше</li> <li> <span>Плагин Kotlin</span> 1.1.51 или выше</li> <li>базовое понимание потоков Java</li> </ul><p>Если вам неудобно работать с лямбда-выражениями и интерфейсами SAM, я предлагаю вам также прочитать следующее руководство, прежде чем продолжить:</p><ul class="roundup-block__contents posts--half-width roundup-block--list"><li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/362/posts/29304/preview_image/picKotlin.jpg" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Android SDK</div> <div class="roundup-block__content-title">Совет: пишите более чистый код с Kotlin SAM Conversions</div> <div class="roundup-block__author">Ашраф Хатхибелагал</div></span></li></ul><p><span class="sectionnum">Вы также можете изучить все тонкости языка Kotlin в нашей серии <span>Kotlin From Scratch</span>.</span></p><ul class="roundup-block__contents posts--half-width roundup-block--card"><li class="roundup-block__content posts__post"><article><header><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1499/posts/29366/preview_image/kotlin.jpg" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"></span><span></span></header><div class="posts__post-teaser">Kotlin является бесплатным и с открытым исходным кодом, и делает кодирование для Android еще более увлекательным. В этом уроке мы рассмотрим обнуляемость, циклы и условия в Kotlin.</div> <footer class="posts__post-details"><div class="posts__post-teaser-overlay"></div> <div class="posts__post-publication-meta"> <img sizes="76px" class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1499/profiles/20007/profileImage/bg.png" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"><div class="posts__post-details__info"> <address class="posts__post-author"><span>Чике Мгбемена </span></address> <time class="posts__post-publication-date" datetime="2017-08-16 12:45:38 UTC">16 Aug 2017</time></div> </div> <div class="posts__post-primary-category topic-code"><span>Котлин</span></div></footer></article></li> <li class="roundup-block__content posts__post"><article><header><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1499/posts/29479/preview_image/kotlin.jpg" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"></span><span></span></header><div class="posts__post-teaser">Узнайте о функциях верхнего уровня, лямбда-выражениях, анонимных функциях, локальных функциях, инфиксных функциях и функциях-членах в Kotlin.</div> <footer class="posts__post-details"><div class="posts__post-teaser-overlay"></div> <div class="posts__post-publication-meta"> <img sizes="76px" class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1499/profiles/20007/profileImage/bg.png" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"><div class="posts__post-details__info"> <address class="posts__post-author"><span>Чике Мгбемена </span></address> <time class="posts__post-publication-date" datetime="2017-09-12 14:00:00 UTC">12 Sep 2017</time></div> </div> <div class="posts__post-primary-category topic-code"><span>Котлин</span></div></footer></article></li> </ul><h2> 1. Создание потоков</h2><p>Обычно экземпляры классов, которые реализуют интерфейс <code class="inline">Runnable</code>, используются для создания потоков в Kotlin. Поскольку интерфейс <code class="inline">Runnable</code> имеет только один метод, метод <code class="inline">run()</code>, вы можете использовать функцию преобразования SAM Kotlin для создания новых потоков с минимальным стандартным кодом.<br></p><p>Вот как вы можете использовать функцию <code class="inline">thread()</code>, которая является частью стандартной библиотеки Kotlin, для быстрого создания и запуска нового потока:</p><pre class="brush: scala noskimlinks noskimwords">thread {    // some long running operation}</pre><p>Вышеуказанный подход подходит только тогда, когда вам нужно порождать поток или два. Если параллелизм является важной частью бизнес-логики вашего приложения и вам нужно большое количество потоков, лучше использовать пулы потоков со службой исполнителя. </p><p>Например, следующий код использует метод <code class="inline">newFixedThreadPool()</code> класса <code class="inline">Executors</code> для создания пула потоков, содержащего восемь многократно используемых потоков, и выполняет с ним большое количество фоновых операций:</p><pre class="brush: scala noskimlinks noskimwords">val myService:ExecutorService = Executors.newFixedThreadPool(8)var i = 0while (i &lt; items.size) {  // items may be a large array    val item = items[i]    myService.submit {        processItem(item) // a long running operation    }    i += 1}</pre><p>На первый взгляд это может быть неочевидно, но в приведенном выше коде аргумент метода <code class="inline">submit()</code> службы executor на самом деле является объектом <code class="inline">Runnable</code>.<br></p><h2> 2. Получение результатов из потоков</h2><p>Фоновые задачи, созданные с использованием интерфейса <code class="inline">Runnable</code>, не могут возвращать результаты напрямую. Если вы хотите получать результаты от своих потоков, вы должны использовать вместо этого интерфейс <code class="inline">Callable</code>, который также является интерфейсом SAM.</p><p>Когда вы передаете объект <code class="inline">Callable</code> методу <code class="inline">submit()</code> службы executor, вы получаете объект <code class="inline">Future</code>. Как следует из его названия, объект <code class="inline">Future</code> будет содержать результат <code class="inline">Callable</code> в какой-то момент в будущем, когда служба исполнителя закончит его запуск. Чтобы получить реальный результат от объекта <code class="inline">Future</code>, все, что вам нужно сделать, это вызвать его метод <code class="inline">get()</code>, но будьте осторожны, ваш поток заблокируется, если вы вызовете его преждевременно.</p><p>В следующем примере кода показано, как создать объект <code class="inline">Callable</code>, который возвращает <code class="inline">Future</code> типа <code class="inline">String</code>, запустить его и распечатать его результат:</p><pre class="brush: scala noskimlinks noskimwords">val myService:ExecutorService = Executors.newFixedThreadPool(2)val result = myService.submit(Callable&lt;String&gt; {    // some background operation that generates    // a string})// Other operations// Print resultLog.d(TAG, result.get())</pre><h2> 3. Синхронизация потоков</h2><p>В отличие от Java, Kotlin не имеет ключевого слова <code class="inline">synchronized</code>. Следовательно, для синхронизации нескольких фоновых операций вы должны использовать аннотацию <code class="inline">@Synchronized</code> или встроенную функцию стандартной библиотеки <code class="inline">synchronized()</code>. Аннотация может синхронизировать весь метод, и функция работает с блоком операторов.</p><pre class="brush: scala noskimlinks noskimwords">// a synchronized function@Synchronized fun myFunction() {}fun myOtherFunction() {    // a synchronized block    synchronized(this) {    }}</pre><p>И аннотация <code class="inline">@Synchronized</code>, и функция <code class="inline">synchronized()</code> используют концепцию блокировки монитора. </p><p>Если вы еще не знаете, с каждым объектом в JVM связан монитор. На данный момент вы можете рассматривать монитор как особый токен, который поток может получить или заблокировать для получения монопольного доступа к объекту. Как только монитор объекта заблокирован, другим потокам, которые хотят работать с объектом, придется ждать, пока монитор снова не будет разблокирован.</p><p>В то время как аннотация <code class="inline">@Synchronized</code> блокирует монитор объекта, которому принадлежит связанный метод, функция <code class="inline">synchronized()</code> может заблокировать монитор любого объекта, переданного ему в качестве аргумента.</p><h2> 4. Понимание корутин</h2><p>Через <span>экспериментальную библиотеку</span> Kotlin предлагает альтернативный подход для достижения параллелизма: сопрограммы. Сопрограммы намного легче, чем потоки, и ими намного легче управлять.<br></p><p>В мобильных многопоточных приложениях потоки обычно используются для таких операций, как получение информации из Интернета или запрос к базам данных. Такие операции не требуют больших вычислений, и потоки проводят большую часть своей жизни в заблокированном состоянии, просто ожидая поступления данных откуда-то еще. Как вы, вероятно, можете сказать, это не очень эффективный способ использования процессора.<br></p><p>Сопрограммы предназначены для использования вместо потоков для таких операций. Самое важное, что вам нужно понять о сопрограммах, - это то, что они могут быть приостановлены. Другими словами, вместо блокировки они могут просто остановиться, когда это необходимо, и беспрепятственно продолжить позже. Это приводит к гораздо лучшему использованию процессора. Действительно, с хорошо продуманными сопрограммами вы можете без труда запускать десятки фоновых операций.</p><p>Чтобы иметь возможность использовать сопрограммы в своем проекте Android Studio, убедитесь, что вы добавили следующую <code class="inline">compile</code> зависимость в файл <strong>build.gradle</strong> модуля <code class="inline">app</code>:</p><pre class="brush: groovy noskimlinks noskimwords">compile "org.jetbrains.kotlinx:kotlinx-coroutines-android:0.19.3"</pre><h2> 5. Создание функций приостановки</h2><p>Сопрограмма может быть приостановлена только с помощью функции приостановки. Поэтому большинство сопрограмм имеют внутри себя вызовы хотя бы одной такой функции.</p><p>Чтобы создать функцию приостановки, все, что вам нужно сделать, это добавить модификатор <code class="inline">suspend</code> к обычной функции. Вот типичная функция приостановки, выполняющая HTTP-запрос GET с использованием библиотеки <span>khttp</span>:</p><pre class="brush: scala noskimlinks noskimwords">suspend fun fetchWebsiteContents(url: String):String {    return khttp.get(url).text}</pre><p>Обратите внимание, что функция приостановки может быть вызвана только сопрограммой или другой функцией приостановки. Если вы попытаетесь вызвать его из другого места, ваш код не сможет скомпилироваться.</p><h2> 6. Создание сопрограмм</h2><p>Когда дело доходит до создания новой сопрограммы, в стандартной библиотеке Kotlin достаточно билдеров сопрограмм, чтобы вы почувствовали себя избалованными выбором. Простейшим компилятором сопрограмм, который вы можете использовать, является функция <code class="inline">launch()</code>, и, как и большинство других компиляторов сопрограмм, он ожидает приостановившуюся лямбду, которая является ничем иным, как анонимной функцией приостановки. Таким образом, эта лямбда становится тем сопрограммой.</p><p>Следующий код создает сопрограмму, которая выполняет два последовательных вызова функции приостановки, которую мы создали на предыдущем шаге:</p><pre class="brush: actionscript3 noskimlinks noskimwords">val job1 = launch {    val website1 = fetchWebsiteContents("https://code.tutsplus.com")    val website2 = fetchWebsiteContents("https://design.tutsplus.com")}</pre><p>Возвращаемым значением функции <code class="inline">launch()</code> является объект <code class="inline">Job</code>, который можно использовать для управления сопрограммой. Например, вы можете вызвать его метод <code class="inline">join()</code>, чтобы дождаться завершения сопрограммы. Точно так же вы можете вызвать его метод <code class="inline">cancel()</code>, чтобы немедленно отменить сопрограмму.</p><p>Использование функции <code class="inline">launch()</code> очень похоже на создание нового потока с объектом <code class="inline">Runnable</code>, главным образом потому, что вы не можете вернуть из него никакого значения. Если вы хотите иметь возможность вернуть значение из вашей сопрограммы, вы должны создать его с помощью функции <code class="inline">async()</code>.</p><p>Функция <code class="inline">async()</code> возвращает объект <code class="inline">Deferred</code>, который, как и объект <code class="inline">Job</code>, позволяет вам управлять сопрограммой. Однако это также позволяет вам использовать функцию <code class="inline">await()</code> для ожидания результата сопрограммы без блокировки текущего потока.</p><p>Например, рассмотрим следующие сопрограммы, которые используют функцию приостановки <code class="inline">fetchWebsiteContents()</code> и возвращают длины содержимого двух разных адресов веб-страниц:</p><pre class="brush: actionscript3 noskimlinks noskimwords">val jobForLength1 = async {    fetchWebsiteContents("https://webdesign.tutsplus.com").length}val jobForLength2 = async {    fetchWebsiteContents("https://photography.tutsplus.com").length}</pre><p>С помощью приведенного выше кода обе сопрограммы запустятся немедленно и будут работать параллельно.</p><p>Если вы теперь хотите использовать возвращенные длины, вы должны вызвать метод <code class="inline">await()</code> для обоих объектов <code class="inline">Deferred</code>. Однако, поскольку метод <code class="inline">await()</code> тоже является функцией приостановки, вы должны убедиться, что вызываете его из другой сопрограммы.</p><p>В следующем коде показано, как вычислить сумму двух длин, используя новую сопрограмму, созданную с помощью функции <code class="inline">launch()</code>:</p><pre class="brush: actionscript3 noskimlinks noskimwords">launch {    val sum = jobForLength1.await() + jobForLength2.await()    println("Downloaded $sum bytes!")}</pre><h2> 7. Использование сопрограмм в потоке пользовательского интерфейса</h2><p>Сопрограммы используют внутренние фоновые потоки, поэтому по умолчанию они не запускаются в потоке пользовательского интерфейса приложения Android. Следовательно, если вы попытаетесь изменить содержимое пользовательского интерфейса вашего приложения из сопрограммы, вы столкнетесь с ошибкой во время выполнения. К счастью, запустить сопрограмму в потоке пользовательского интерфейса довольно просто: вам просто нужно передать объект <code class="inline">UI</code> в качестве аргумента вашему билдеру сопрограмм.</p><p>Например, вот как вы можете переписать последнюю сопрограмму для отображения суммы внутри виджета <code class="inline">TextView</code>:</p><pre class="brush: actionscript3 noskimlinks noskimwords">launch(UI) {    val sum = jobForLength1.await() + jobForLength2.await()    myTextView.text = "Downloaded $sum bytes!"}</pre><p>Приведенный выше код на первый взгляд может показаться обыденным, но посмотрите еще раз. Он не только может ожидать завершения двух фоновых операций без использования обратных вызовов, но и может делать это в потоке пользовательского интерфейса приложения, не блокируя его!</p><p>Возможность ожидания в потоке пользовательского интерфейса, не замедляя работу пользовательского интерфейса и не вызывая ошибку Application Not Responding, часто называемую ANR, упрощает множество других сложных задач. </p><p>Например, с помощью функции suspend <code class="inline">delay()</code>, которая является неблокирующим эквивалентом метода <code class="inline">Thread.sleep()</code>, теперь вы можете создавать анимации с помощью циклов. Чтобы помочь вам начать, вот пример сопрограммы, который увеличивает координату x виджета <code class="inline">TextView</code> каждые 400 мс, создавая эффект, похожий на выделение:</p><pre class="brush: scala noskimlinks noskimwords">launch(UI) {        while(myTextView.x &lt; 800) {        myTextView.x += 10        delay(400)    }}</pre><h2>Заключение</h2><p>При разработке приложений для Android крайне важно выполнять длительные операции в фоновых потоках. В этом руководстве вы узнали о нескольких подходах, которые вы можете использовать для создания и управления такими потоками в Kotlin. Вы также узнали, как использовать все еще экспериментальную функцию сопрограмм для ожидания внутри потоков, не блокируя их.</p><p>Чтобы узнать больше о сопрограммах, вы можете обратиться к официальной документации. И пока вы здесь, посмотрите некоторые другие наши посты о разработке Kotlin и Android!</p><ul class="roundup-block__contents posts--half-width roundup-block--list"><li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/769/posts/27397/preview_image/spirit-firebase@2x.jpg" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Android SDK</div> <div class="roundup-block__content-title">Как создать приложение для Android-чата с помощью Firebase</div> <div class="roundup-block__author">Ашраф Хатхибелагал</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1499/posts/27845/preview_image/image_post.png" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Android SDK</div> <div class="roundup-block__content-title">Отправка данных с помощью HTTP-клиента Retrofit 2 для Android</div> <div class="roundup-block__author">Чике Мгбемена </div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/769/posts/28345/preview_image/Getting-Started-RxJava-2.0-for-Android.jpg" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Android SDK</div> <div class="roundup-block__content-title">Начните с RxJava 2 для Android</div> <div class="roundup-block__author">Джессика Торнсби</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/369/posts/27846/preview_image/java-or-kotlin-for-android-dev.jpg" alt="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." title="Параллелизм и корутины в КотлинеKotlin From Scratch: null, циклы и условияKotlin с нуля: больше веселья с функциями..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Android SDK</div> <div class="roundup-block__content-title">Java против Kotlin: стоит ли использовать Kotlin для разработки под Android?</div> <div class="roundup-block__author">Джессика Торнсби</div></span></li> </ul><p></p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article/220824869-parallelizm-i-korutiny-v-kotlinekotlin-from-scratch-null-tsikly-i-usloviyakotlin-s-nulya-bolshe-veselya-s-funktsiyami" class="tm-article-body__tags-item-link">Android SDK</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
44685</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
670</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
