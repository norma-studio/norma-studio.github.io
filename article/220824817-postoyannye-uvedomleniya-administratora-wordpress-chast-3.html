
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Добро пожаловать в нашу серию, посвященную постоянным уведомлениям администратора WordPress. Теперь мы находимся в хорошем положении, чтобы иметь возможность расширять функциональность уведомлений администратора и контролировать, когда они появляются на странице....">
<meta property="og:description" content="Добро пожаловать в нашу серию, посвященную постоянным уведомлениям администратора WordPress. Теперь мы находимся в хорошем положении, чтобы иметь возможность расширять функциональность уведомлений администратора и контролировать, когда они появляются на странице....">
<meta name="twitter:description" content="Добро пожаловать в нашу серию, посвященную постоянным уведомлениям администратора WordPress. Теперь мы находимся в хорошем положении, чтобы иметь возможность расширять функциональность уведомлений администратора и контролировать, когда они появляются на странице....">
<meta property="aiturec:description" content="Добро пожаловать в нашу серию, посвященную постоянным уведомлениям администратора WordPress. Теперь мы находимся в хорошем положении, чтобы иметь возможность расширять функциональность уведомлений администратора и контролировать, когда они появляются на странице....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.1.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.1.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.1.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.1.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.1.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html" title="Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io" title="Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533gfdsgf.jpg" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html" class="tm-user-info__username" title="
А. Лукичев" aria-label="
А. Лукичев">
А. Лукичев</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Постоянные уведомления-администратора WordPress: Часть 3...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3" class="tm-article-snippet__hubs-item-link"><span>WordPress</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.1.png">
    <meta itemprop="headline name" content="Постоянные уведомления-администратора WordPress: Часть 3... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Добро пожаловать в нашу серию, посвященную постоянным уведомлениям администратора WordPress. Теперь мы находимся в хорошем положении, чтобы иметь возможность расширять функциональность уведомлений администратора и контролировать, когда они появляются на странице....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Добро пожаловать в нашу серию, посвященную постоянным уведомлениям администратора WordPress. Теперь мы находимся в хорошем положении, чтобы иметь возможность расширять функциональность уведомлений администратора и контролировать, когда они появляются на странице....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Добро пожаловать в нашу серию, посвященную постоянным уведомлениям администратора WordPress. Теперь мы находимся в хорошем положении, чтобы иметь возможность расширять функциональность уведомлений администратора и контролировать, <em>когда</em> они появляются на странице.<br></p><p>После этого мы перейдем к постоянным уведомлениям администратора и посмотрим, как можно удостовериться, что они отклонены таким образом, что не появятся снова, после перезагрузки страниц администрирования. </p><p>Это особенно важно, поскольку пользовательские уведомления администратора, реализованные в плагинах и темах, действительно полезны, когда вы можете навсегда отклонить их. Недостаточно просто добавить класс CSS <code class="inline">is-dismissible</code>.<br></p><h2>Контроль появления уведомлений администратора<br></h2><p>До сих пор все уведомления администратора были отображены сразу после загрузки страницы. Могут быть моменты, когда это неудобно, и вы хотите, чтобы уведомление администратора отображалось <em>после</em> того, как было инициировано определенное событие.</p><p>Что, если мы хотим, чтобы пользовательское уведомление администратора отображалось на странице параметров плагина, которую мы создали ранее, но <em>только</em> после нажатия кнопки <strong>Save Changes</strong>?<br></p><p>Мы уже знаем из второй части, как ограничить уведомление администратора на странице параметров плагина. Давайте выясним, как мы можем заставить его появляться после сохранения параметров плагина.<br></p><p>Начните с комментирования вызова функции <code class="inline">add_action</code> для <code class="inline">plugin_admin_notice</code>. Затем добавьте четвертый вызов <code class="inline">add_action</code> в <code class="inline">init</code> следующим образом:</p><pre class="brush: php noskimlinks noskimwords">add_action( "admin_notices", array( $this, "conditional_plugin_admin_notice" ) );</pre><p>Всякий раз, когда параметры плагина сохраняются, значение <code class="inline">settings-updated</code>, равное <code class="inline">true</code>, добавляется в супер-глобальную переменную массива <code class="inline">$_GET</code>. Мы можем использовать это, чтобы определить, нужно ли нам отображать наше уведомление администратора.<br></p><p>Добавьте новый метод <code class="inline">conditional_plugin_admin_notice</code> в <code class="inline">Gwyer_Admin_Notices</code>, который выводит значение <code class="inline">$_GET</code> на экран.</p><pre class="brush: php noskimlinks noskimwords">/*** Output an admin notice on the plugin options page when settings have been saved.*/public function conditional_plugin_admin_notice() {  echo "&lt;pre&gt;";  print_r($_GET);  echo "&lt;/pre&gt;";}</pre><p>Когда страница параметров плагина загружается нормально, мы не видим значения, установленные для settings-updated.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.1.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Теперь введите текст в поле <strong>Enter some text</strong> и нажмите <strong>Save Changes</strong>. На этот раз мы видим, что <code class="inline">settings-updated</code> установлен в <code class="inline">true</code>, и мы можем его использовать.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.2.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Замените <code class="inline">conditional_plugin_admin_notice</code> на:</p><pre class="brush: php noskimlinks noskimwords">/*** Output an admin notice on the plugin options page when settings have been saved.*/public function conditional_plugin_admin_notice() {          $whitelist_admin_pages = array( "settings_page_admin-notices/plugin-options" );  $admin_page = get_current_screen();  $current_user = wp_get_current_user();  if( in_array( $admin_page-&gt;base, $whitelist_admin_pages ) &amp;&amp; isset( $_GET[ "settings-updated" ] ) &amp;&amp;  $_GET[ "settings-updated" ] ):    ?&gt;    &lt;div class="notice notice-success is-dismissible"&gt;&lt;p&gt;Plugin options just saved. &lt;strong&gt;&lt;?php echo $current_user-&gt;display_name; ?&gt;&lt;/strong&gt;, you"re just so awesome!&lt;/p&gt;&lt;/div&gt;    &lt;?php  endif;}</pre><p>К настоящему моменту этот код должен выглядеть вам знакомым. Тем не менее, было добавлено несколько новых моментов. Во-первых, условное выражение было расширено для проверки наличия <code class="inline">settings-update</code>. Теперь уведомление администратора будет отображаться только в том случае, если мы находимся на странице параметров плагина, <em>и</em> если значение <code class="inline">settings-updated</code> установлено в <code class="inline">true</code>.</p><p>Кроме того, выводится отображаемое имя текущего пользователя, чтобы сделать уведомление администратора немного более личным.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.3.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Функция <code class="inline"><span>wp_get_current_user()</span></code> возвращает информацию о текущем залогиненном пользователе. Этот объект хранится в <code class="inline">$current_user</code> и содержит такие данные, как электронная почта пользователя, идентификатор, имя, фамилия и отображаемое имя, которое может нам понадобиться.<br></p><p>Наконец, для дополнительного блеска мы предотвратили показ уведомления администратора по умолчанию, поэтому наше пользовательское уведомление является единственным, видимым для пользователя. Для этого мы просто добавили одну строку кода в <code class="inline">conditional_plugin_admin_notice()</code> для вывода CSS, чтобы скрыть нежелательное уведомление администратора.</p><pre class="brush: php noskimlinks noskimwords">echo "&lt;style&gt;#setting-error-settings_updated { display: none; }&lt;/style&gt;";</pre><p>Окончательный результат сохранения параметров плагина показан ниже.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.4.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Хотя это отлично подходит для демонстрационных целей, лучшим (и более чистым) способом было бы вместо этого добавить стили в отдельную таблицу стилей и подключать их только на странице параметров плагина.<br></p><p>Наше специальное уведомление администратора может быть расширено еще больше несколькими способами. Одной из возможностей может быть сохранение журнала, который записывал текущую дату/время вместе с информацией о пользователе каждый раз, когда были сохранены параметры плагина.</p><p>Или как насчет того, чтобы получать уведомление администратора о том, сколько раз параметры плагина были сохранены в этот день, неделю, месяц и т. д.? Я уверен, что вы можете придумать еще примеры!<br></p><h2>Эффективное отклонение постоянных уведомлений администратора<br></h2><p>Настало время запачкать руки и копнуть код более глубоко, поскольку мы обращаем наше внимание на отклонение постоянных уведомлений администратора. До сих пор единственным способом сделать это, который мы видели, является добавление CSS-класса <code class="inline">.is-dismiable</code> в наш контейнер для уведомлений. Это отклоняет уведомление администратора для текущей страницы, но такой подход почти не используется на практике, поскольку уведомление появляется снова при перезагрузке страницы администратора.<br></p><p>Итак, как мы можем это исправить? Мы рассмотрим несколько разных способов отклонения постоянных уведомлений администратора, в том числе:<br></p><ul><li>Одноразовое уведомление администратора, которое исчезает после одного показа.</li> <li>Счетчик уведомлений администратора, который исчезает после определенного количества просмотров.</li> <li>Прикрепленное уведомление администратора, которое остается отклоненным при обновлении страницы.</li> <li>Удаление пользовательским действием (уведомление администратора удалено после завершения определенного действия).</li> </ul><p>Прежде чем приступить к реализации каждого из этих примеров, убедитесь, что все вызовы <code class="inline">add_action()</code> в <code class="inline">Gwyer_Admin_Notices::init()</code> были закомментированы. Затем добавьте новый файл <code class="inline">dismissible-admin-notices.php</code> в папку плагина <code class="inline">admin_notices</code>. Откройте этот новый файл и добавьте объявление нового класса:</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpclass Gwyer_Dismissible_Admin_Notices {    /**    * Register hooks.    */    public function init() {        // add_action() calls will go here...    }}$gwyer_dismissible_admin_notices = new Gwyer_Dismissible_Admin_Notices();$gwyer_dismissible_admin_notices-&gt;init();</pre><p>В <code class="inline">admin_notices.php</code> добавьте еще один вызов <code class="inline">require_once()</code> для импорта нового класса:</p><pre class="brush: php noskimlinks noskimwords">require_once(dirname(__FILE__) . "/dismissible-admin-notices.php" );</pre><p>Класс <code class="inline">Gwyer_Dismissible_Admin_Notices</code> будет содержать весь код, связанный с отклонением постоянных уведомлений администратора.<br></p><h2>Одноразовое уведомление администратора<br></h2><p>Первый метод, который мы рассмотрим, это как показывать уведомление администратора только один раз, чтобы оно не появлялось после перезагрузки страницы. Вы можете использовать этот метод для уведомления пользователя, когда только что был активирован плагин или тема.<br></p><p>Давайте сделаем это для нашего плагина Admin Notes. Мы начнем с регистрации <span>временной опции WordPress</span> при активации плагина, срок действия которой истекает почти сразу.<br></p><p>В классе <code class="inline">Gwyer_Dismissible_Admin_Notices</code> добавьте вызов <code class="inline">register_activation_hook()</code>:</p><pre class="brush: php noskimlinks noskimwords">register_activation_hook(  plugin_dir_path( __FILE__ ) . "admin-notices.php", array( $this, "set_admin_notice_transient" ) );</pre><p>Для функции <code class="inline">register_activation_hook()</code> требуется указать путь к основному файлу плагина, но в данный момент мы находимся в <code class="inline">demissible-admin-notices.php</code>. Таким образом, мы не можем просто использовать магическую константу PHP <code class="inline">__FILE__</code>, которую мы использовали ранее, поскольку это всегда указывает на текущий файл PHP.</p><p>Вместо этого мы должны сами создать путь к основному файлу плагина, используя <code class="inline">plugin_dir_path( __FILE__ ) . "admin-notices.php"</code>.<br></p><p>Когда активируется плагин Admin Notices, он будет запускать код, добавленный в метод класса <code class="inline">set_admin_notice_transient</code>, который мы определим далее.</p><pre class="brush: php noskimlinks noskimwords">public function set_admin_notice_transient() {  set_transient( "admin-notice-transient", true, 5 );}</pre><p>Этот метод создает новую временную опцию под названием <code class="inline">"admin-notice-transient"</code> со значением <code class="inline">true</code>, которая истекает через пять секунд.<br></p><p>Давайте использовать эту временную опцию, отображая уведомление администратора по условию: если мы находимся на правильной странице администратора, и наша временная опция все еще существует.<br></p><p>Добавьте новый вызов <code class="inline">add_action()</code> в <code class="inline">init()</code>.</p><pre class="brush: php noskimlinks noskimwords">add_action( "admin_notices", array( &amp;$this, "display_admin_notice" ) );</pre><p>Затем добавьте функцию обратного вызова <code class="inline">display_admin_notice</code> как новый метод класса:</p><pre class="brush: php noskimlinks noskimwords">    public function display_admin_notice() {        $current_user = wp_get_current_user();        $whitelist_admin_pages = array( "plugins" );        $admin_page = get_current_screen();        if( in_array( $admin_page-&gt;base, $whitelist_admin_pages ) &amp;&amp; get_transient( "admin-notice-transient" ) ) :            ?&gt;            &lt;div class="updated notice"&gt;                &lt;p&gt;The &lt;strong&gt;Admin Notices&lt;/strong&gt; plugin was just activated. Thanks for your support &lt;?php echo $current_user-&gt;display_name; ?&gt;!&lt;/p&gt;            &lt;/div&gt;            &lt;?php            delete_transient( "admin-notice-transient" );                    endif;    }</pre><p>Как и в предыдущих примерах, уведомление администратора отображается только в том случае, если мы находимся на определенной странице, в этом случае - на главной странице плагинов администратора. Но у нас есть дополнительное условие, что <code class="inline">"admin-notice-transient"</code> также должно существовать, иначе уведомление администратора не будет отображаться.<br></p><p>После того, как выдается уведомление администратора, временная опция сразу же удаляется, даже если мы изначально установили ее время жизни в пять секунд. Это гарантирует, что уведомление больше не будет показано. Это могло бы произойти, если бы пользователь попытался обновить страницу плагинов очень быстро. Но, сознательно удаляя временную опцию, мы можем быть уверены, что этого никогда не случится.<br></p><p>Чтобы проверить код, который мы только что добавили, перейдите на главную страницу плагинов и деактивируйте, а затем снова активируйте плагин Admin Notices.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.5.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Ключевым моментом здесь является временная опция <code class="inline">"admin-notice-transient"</code>. Без нее уведомление администратора будет появляться каждый раз, когда загружается страница плагинов (после активации плагина), чего мы не хотим.<br></p><h2>Счетчик уведомлений администратора<br></h2><p>Следующий пример - это уведомление администратора, которое отображается только определенное количество раз, после чего оно более не выводится. Кроме того, на этот раз оно не будет ограничено какой-либо конкретной страницей администратора.<br></p><p>Прежде чем начать, в классе <code class="inline">Gwyer_Dismissible_Admin_Notices</code> закомментируйте вызовы функций <code class="inline">register_activation_hook()</code> и <code class="inline">add_action()</code>. Теперь давайте создадим простое уведомление администратора, которое мы вскоре расширим.</p><p>Добавьте новый вызов <code class="inline">add_action()</code> в <code class="inline">init()</code>:</p><pre class="brush: php noskimlinks noskimwords">add_action( "admin_notices", array( &amp;$this, "display_admin_notice_counter" ) );</pre><p>Затем выполните функцию обратного вызова <code class="inline">display_admin_notice_counter()</code>:</p><pre class="brush: php noskimlinks noskimwords">public function display_admin_notice_counter() {    ?&gt;    &lt;div class="updated notice"&gt;        &lt;p&gt;Counter admin notice.&lt;/p&gt;    &lt;/div&gt;    &lt;?php}</pre><p>Это отобразит стандартное уведомление администратора, которое появится на каждой странице администратора WordPress.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.6.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Давайте подумаем о том, что нам нужно сделать. Наше уведомление администратора должно отображаться определенное количество раз, и каждый раз, когда оно появляется, внутренний счетчик увеличивается на единицу. После достижения предела счетчика уведомление администратора не должно появляться снова.<br></p><p>Мы хотим, чтобы уведомление администратора отображалось на любой странице администратора, поэтому значение счетчика должно сохраняться между загрузками страниц. Один из лучших способов сделать это - использовать опцию в базе данных для хранения значения счетчика.<br></p><p>Добавьте для счетчика свойство класса, чтобы хранить предельное значение счетчика:</p><pre class="brush: php noskimlinks noskimwords">public $counter_limit = 5;</pre><p>Оно будет использовано в ближайшее время, чтобы определить, сколько раз появляется уведомление администратора. Внутри <code class="inline">display_admin_notice_counter()</code> обновите код следующим образом:</p><pre class="brush: php noskimlinks noskimwords">    public function display_admin_notice_counter() {        $counter = get_option( "admin_notice_counter", 1 );        ?&gt;        &lt;div class="notice notice-info"&gt;            &lt;p&gt;This admin notice has been displayed &lt;?php echo $counter; ?&gt; time(s).&lt;/p&gt;        &lt;/div&gt;        &lt;?php        update_option( "admin_notice_counter", ++$counter );    }</pre><p>Перед отображением уведомления администратора мы получаем опцию счетчика, и значение по умолчанию возвращается, если она еще не существует. После того, как уведомление администратора выводится, опция счетчика увеличивается на единицу и обновляется. Если она не существует, будет создана новая опция для сохранения текущего значения.</p><p>Мы также обновили класс CSS, чтобы уведомление администратора стало информационным.<br></p><p>Попробуйте посещать различные страницы администратора, и вы увидите, что счетчик каждый раз увеличивается.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.7.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Код <code class="inline">++$counter</code> является примером оператора <span>префиксный инкремент</span>. Он добавляет значение в <code class="inline">$counter</code> <em>до</em> его сохранения в базе данных. Если бы мы использовали оператор постфиксный инкремент (т. е. <code class="inline">$counter++</code>), тогда значение <code class="inline">$counter</code> было бы сначала сохранено, а <em>затем</em> увеличено, что нам не подходит.<br></p><p>Давайте теперь задействуем <code class="inline">$counter_limit</code>, чтобы уведомление администратора не появлялось слишком много раз. Добавьте это в <code class="inline">display_admin_notice_counter()</code> под объявлением <code class="inline">$counter</code>:</p><pre class="brush: php noskimlinks noskimwords">if( $counter &gt; $this-&gt;counter_limit ) {    return;}</pre><p>Теперь, когда уведомление администратора отобразилось пять раз, его не будет видно на последующих страницах администрирования. Однако, было бы неплохо отобразить сообщение, когда уведомление администратора выведется в последний раз, чтобы пользователь знал, что оно больше не появится. Расширьте условное выражение и добавьте дополнительное сообщение:</p><pre class="brush: php noskimlinks noskimwords">    public function display_admin_notice_counter() {        $counter = get_option( "admin_notice_counter", 1 );        if( $counter &gt; $this-&gt;counter_limit ) {            return;        } else if( $counter == $this-&gt;counter_limit ) {            $extra_message = " It"s time to say goodbye now.";        }        ?&gt;        &lt;div class="notice notice-info"&gt;            &lt;p&gt;This admin notice has been displayed &lt;?php echo $counter; ?&gt; time(s).&lt;?php echo $extra_message; ?&gt;&lt;/p&gt;        &lt;/div&gt;        &lt;?php        update_option( "admin_notice_counter", ++$counter );    }</pre><p>Тем не менее, вы не увидите сообщение, если вы уже превысили лимит счетчика. Вы можете временно решить эту проблему, увеличив переменную <code class="inline">$counter_limit</code>.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.8.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Для целей тестирования было бы лучше иметь возможность сбрасывать счетчик. Если вы знаете, как редактировать базу данных, вы можете войти и изменить нашу опцию напрямую, но это может стать утомительным, если придется делать так несколько раз. Итак, давайте реализуем собственную функцию сброса.<br></p><p>Сначала измените <code class="inline">$counter_limit</code> на <code class="inline">5</code> и добавьте новое свойство класса:</p><pre class="brush: php noskimlinks noskimwords">public $counter_reset = false;</pre><p>Затем внутри <code class="inline">init()</code> замените</p><pre class="brush: php noskimlinks noskimwords">add_action( "admin_notices", array( &amp;$this, "display_admin_notice_counter" ) );</pre><p>на</p><pre class="brush: php noskimlinks noskimwords">$this-&gt;reset_counter_check();</pre><p>Функция сброса должна либо показать наш счетчик уведомлений администратора, либо удалить опцию <code class="inline">admin_notice_counter</code> из базы данных, и вместо этого отобразить уведомление администратора типа Предупреждение.</p><pre class="brush: php noskimlinks noskimwords">    public function reset_counter_check() {        if( !$this-&gt;counter_reset ) {            add_action( "admin_notices", array( &amp;$this, "display_admin_notice_counter" ) );        } else {            delete_option( "admin_notice_counter" );            ?&gt;            &lt;div class="notice notice-warning"&gt;                &lt;p&gt;Admin notice counter has been reset! Change &lt;code&gt;$counter_reset&lt;/code&gt; to &lt;code&gt;false&lt;/code&gt; to start the admin notice counter again.&lt;/p&gt;            &lt;/div&gt;            &lt;?php            }    }</pre><p>Чтобы использовать новую функцию сброса, просто измените <code class="inline">$counter_reset</code> на <code class="inline">true</code> и загрузите любую страницу администратора.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.9.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Затем снова измените его на <code class="inline">false</code>.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1527/posts/30136/image/3.10.png" alt="Постоянные уведомления администратора WordPress: Часть 3..." title="Постоянные уведомления администратора WordPress: Часть 3..." width="50" height="50"></figure><p>Примечание. Этот метод может быть легко использован для отображения уведомления администратора только один раз, как это было в предыдущем примере, но настроить его немного сложнее. Это зависит от ваших требований.</p><p>Если все, что вам когда-либо понадобится, это одноразовое уведомление администратора, то предыдущий метод, скорее всего, удовлетворит ваши потребности и будет быстрее реализован. Но метод счетчика более гибкий, и настроив его один раз, вы будете с такой же легкостью использовать его в ваших собственных проектах.<br></p><h2>Заключение<br></h2><p>Мы рассмотрели довольно много материала в третьей части этой серии уроков. Мы увидели, как управлять выводом уведомлений администратора, чтобы они не появлялись всегда, как только страница администрирования загрузилась. Это полезно во многих отношениях, но наш пример показал, как отображать пользовательское уведомление администратора после сохранения параметров плагина.<br></p><p>Затем мы перешли к двум различным примерам отклонения постоянных уведомлений администратора. Это даст вам большую гибкость в том, как вы показываете пользователю уведомления администратора. В следующей и последней части этой серии уроков мы рассмотрим еще несколько способов отклонения постоянных уведомлений администратора.</p><p>И, для развлечения, мы создадим собственные пользовательские типы уведомлений и добавим иконки.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article/220824817-postoyannye-uvedomleniya-administratora-wordpress-chast-3" class="tm-article-body__tags-item-link">WordPress</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
37229</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
644</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
