
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этой статье мы рассмотрим сервис Auth0, который обеспечивает аутентификацию и авторизацию в качестве службы. Auth0 позволяет мгновенно настраивать основные функции проверки подлинности и авторизации для ваших приложений....">
<meta property="og:description" content="В этой статье мы рассмотрим сервис Auth0, который обеспечивает аутентификацию и авторизацию в качестве службы. Auth0 позволяет мгновенно настраивать основные функции проверки подлинности и авторизации для ваших приложений....">
<meta name="twitter:description" content="В этой статье мы рассмотрим сервис Auth0, который обеспечивает аутентификацию и авторизацию в качестве службы. Auth0 позволяет мгновенно настраивать основные функции проверки подлинности и авторизации для ваших приложений....">
<meta property="aiturec:description" content="В этой статье мы рассмотрим сервис Auth0, который обеспечивает аутентификацию и авторизацию в качестве службы. Auth0 позволяет мгновенно настраивать основные функции проверки подлинности и авторизации для ваших приложений....">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=400/net/uploads/2013/07/oauth-retina-preview.jpg">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=400/net/uploads/2013/07/oauth-retina-preview.jpg">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=400/net/uploads/2013/07/oauth-retina-preview.jpg">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=400/net/uploads/2013/07/oauth-retina-preview.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=400/net/uploads/2013/07/oauth-retina-preview.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html" title="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io" title="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/653463654.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html" class="tm-user-info__username" title="
С. Салин" aria-label="
С. Салин">
С. Салин</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="PHP" href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos" class="tm-article-snippet__hubs-item-link"><span>PHP</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=400/net/uploads/2013/07/oauth-retina-preview.jpg">
    <meta itemprop="headline name" content="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этой статье мы рассмотрим сервис Auth0, который обеспечивает аутентификацию и авторизацию в качестве службы. Auth0 позволяет мгновенно настраивать основные функции проверки подлинности и авторизации для ваших приложений....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этой статье мы рассмотрим сервис Auth0, который обеспечивает аутентификацию и авторизацию в качестве службы. Auth0 позволяет мгновенно настраивать основные функции проверки подлинности и авторизации для ваших приложений....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этой статье мы рассмотрим сервис Auth0, который обеспечивает аутентификацию и авторизацию в качестве службы. Auth0 позволяет мгновенно настраивать основные функции проверки подлинности и авторизации для ваших приложений.</p><h2>Что такое Auth0?</h2><p>Auth0 - это аутентификация как служебный инструмент, который упрощает реализацию функций, связанных с проверкой подлинности на вашем сайте. Если вы создали приложение и хотите просто передать функции аутентификации и авторизации, такой сервис, как Auth0, вы должны рассмотреть.</p><p>Позвольте мне кратко изложить, что Auth0 может предложить:</p><ul><li>единый вход в систему</li> <li>многофакторная аутентификация</li> <li>вход в систему без пароля</li> <li>Управление пользователями</li> <li>и многое другое</li> </ul><p>В этой статье мы рассмотрим несколько методов единого входа, которые вы можете реализовать в своих веб-приложениях, чтобы использовать функции аутентификации, предоставляемые службой Auth0.</p><p>В первой половине статьи мы рассмотрим, как настроить базовую функцию аутентификации в веб-приложении на стороне сервера. Во второй половине я объясню, как вы можете защитить свои пользовательские API, установив авторизацию OAuth с помощью службы Auth0.</p><h2>Интеграция аутентификации на стороне сервера</h2><p>В этом разделе мы рассмотрим, как можно быстро настроить базовую аутентификацию для серверных веб-приложений с использованием Auth0. Фактически команда Auth0 уже предоставляет удобный пример GitHub, который демонстрирует основные примеры, поэтому мы будем использовать это вместо того, чтобы изобретать колесо.</p><p>Прежде чем двигаться вперед, обязательно установите Composer, поскольку он будет использоваться для установки фактических SDK Auth0 с использованием файла <code class="inline">composer.json</code>. Кроме того, если вы хотите следовать вместе с примерами в этой статье, продолжайте и получите бесплатную учетную запись с Auth0.</p><h3>Настройка проекта</h3><p>Давайте двигаться вперед и захватим копию образцов проекта.</p><pre class="brush: bash noskimlinks noskimwords">git clone https://github.com/auth0-samples/auth0-php-web-app.git .</pre><p>Для установки зависимостей выполните команду <code class="inline">composer install</code>.</p><pre class="brush: bash noskimlinks noskimwords">cd 00-Starter-Seedcomposer install</pre><p>Согласно файлу <strong>composer.json</strong>, он должен был установить пакеты <code class="inline">vlucas/phpdotenv</code> и <code class="inline">auth0/auth0-php</code>.</p><pre class="brush: javascript noskimlinks noskimwords">{    "name": "auth0/basic-webapp-sample",    "description": "Basic sample for securing a WebApp with Auth0",    "require": {         "vlucas/phpdotenv": "2.4.0",         "auth0/auth0-php": "~5.0"    },    "license": "MIT",    "authors": [        {            "name": "Martin Gontovnikas",            "email": "martin@gon.to"        },        {            "name": "Germán Lena",            "email": "german.lena@gmail.com"        }    ]}</pre><p>Библиотека <code class="inline">vlucas/phpdotenv</code> используется для инициализации переменных среды из файла .<strong>env</strong>. Таким образом, он позволяет отделить конфигурацию от кода, который изменяется между средами.</p><p>С другой стороны, пакет <code class="inline">auth0/auth0-php</code> является тем, который поможет нам настроить авторизацию в нашем приложении.</p><p>Далее, давайте настроим конфигурацию нашего приложения в файле .<strong>env</strong>. Идем дальше и создаем файл .<strong>env</strong>, копируя его из файла <strong>.env.example</strong>.</p><pre class="brush: bash noskimlinks noskimwords">cp .env.example .env</pre><p>Он содержит значения конфигурации, которые будут использоваться библиотекой Auth0.</p><pre class="brush: plain noskimlinks noskimwords">AUTH0_CLIENT_ID={CLIENT_ID}AUTH0_DOMAIN={DOMAIN_NAME}AUTH0_CLIENT_SECRET={CLIENT_SECRET}AUTH0_CALLBACK_URL={CALLBACK_URL}AUTH0_AUDIENCE=</pre><p>Вы должны найти большинство настроек в разделе <strong>Приложения&gt; Стандартное приложение&gt; Настройки</strong> на панели управления Auth0. Обратите внимание, что я использую приложение по умолчанию, созданное системой. Конечно, вы можете пойти и создать новое приложение, если хотите это сделать.</p><p><code class="inline">AUTH0_CALLBACK_URL</code> - это URL вашего приложения, в котором Auth0 будет перенаправлять пользователей после входа в систему и выхода из системы. Значение, заданное в этом поле, должно быть настроено в разделе «<code class="inline">Разрешенные обратные вызовы</code>» в настройках приложения на панели управления Auth0.</p><p>Вы найдете три основных файла, реализующих большую часть логики аутентификации.</p><ul><li> <strong>index.php</strong>: Это основная страница, на которой отображается кнопка входа или выхода из системы на основе состояния пользователя.</li> <li> <strong>login.php</strong>: этот скрипт будет инициирован, когда вы нажмете кнопку входа в систему, и перенаправит пользователей на интерфейс входа Auth0 для входа. После входа в систему они будут перенаправлены обратно на <code class="inline">AUTH0_CALLBACK_URL</code>.</li> <li> <strong>logout.php</strong>: этот скрипт будет инициирован, когда вы нажмете кнопку выхода из системы, и перенаправит пользователей на Auth0 в фоновом режиме, выйдет из системы и вернет их обратно на <code class="inline">AUTH0_CALLBACK_URL</code>.</li> </ul><h3>Файлы проекта</h3><p>Давайте быстро рассмотрим каждый файл в стартовом проекте.</p><h4>Login-Script</h4><p>Мы начнем с файла <strong>login.php</strong>.</p><pre class="brush: php noskimlinks noskimwords">&lt;?phprequire __DIR__ . "/vendor/autoload.php";require __DIR__ . "/dotenv-loader.php";use Auth0\SDK\Auth0;$domain        = getenv("AUTH0_DOMAIN");$client_id     = getenv("AUTH0_CLIENT_ID");$client_secret = getenv("AUTH0_CLIENT_SECRET");$redirect_uri  = getenv("AUTH0_CALLBACK_URL");$audience      = getenv("AUTH0_AUDIENCE");if($audience == ""){$audience = "https://" . $domain . "/userinfo";}$auth0 = new Auth0([  "domain" =&gt; $domain,  "client_id" =&gt; $client_id,  "client_secret" =&gt; $client_secret,  "redirect_uri" =&gt; $redirect_uri,  "audience" =&gt; $audience,  "scope" =&gt; "openid profile",  "persist_id_token" =&gt; true,  "persist_access_token" =&gt; true,  "persist_refresh_token" =&gt; true,]);$auth0-&gt;login();</pre><p>Вначале мы включили автозагрузчики, которые отвечают за загрузку классов, связанных с переменной Auth0 и средой. После этого мы инициализируем конфигурационные переменные из файла .<strong>env</strong>, используя функцию <code class="inline">getenv</code>.</p><p>Затем мы создаем экземпляр объекта Auth0 и вызываем метод входа, который перенаправляет пользователей на Auth0 для входа. После входа в систему пользователи будут перенаправлены на наш сайт.</p><p>Вы можете войти в систему, используя свои социальные учетные записи, такие как Facebook, Google и т. д., Или создать новую учетную запись при входе в систему. В любом случае Auth0 создаст записи для новых пользователей на своем конце. Вы можете включить различные социальные входы в разделе <strong>«Подключения»&gt; «Социальные»</strong> на панели управления Auth0. Кроме того, вы можете проверить список пользователей, которые вошли в систему, используя Auth0 на панели управления Auth0 в разделе <strong>«Пользователи»</strong>.</p><h4>Сценарий выхода </h4><p>Затем давайте быстро взглянем на файл <strong>logout.php</strong>.</p><pre class="brush: php noskimlinks noskimwords">&lt;?phprequire __DIR__ . "/vendor/autoload.php";require __DIR__ . "/dotenv-loader.php";use Auth0\SDK\Auth0;$domain        = getenv("AUTH0_DOMAIN");$client_id     = getenv("AUTH0_CLIENT_ID");$client_secret = getenv("AUTH0_CLIENT_SECRET");$redirect_uri  = getenv("AUTH0_CALLBACK_URL");$audience      = getenv("AUTH0_AUDIENCE");if($audience == ""){    $audience = "https://" . $domain . "/userinfo";}$auth0 = new Auth0([  "domain" =&gt; $domain,  "client_id" =&gt; $client_id,  "client_secret" =&gt; $client_secret,  "redirect_uri" =&gt; $redirect_uri,  "audience" =&gt; $audience,  "scope" =&gt; "openid profile",  "persist_id_token" =&gt; true,  "persist_refresh_token" =&gt; true,]);$auth0-&gt;logout();$return_to = "https://" . $_SERVER["HTTP_HOST"];$logout_url = sprintf("http://%s/v2/logout?client_id=%s&amp;returnTo=%s", $domain, $client_id, $return_to);header("Location: " . $logout_url);die();</pre><p>Это работает почти так же, как и файл <strong>login.php</strong>, за исключением того, что он будет вызываться, когда пользователи выходят из системы. <code class="inline">logout</code> метода вызывается для истечения сеанса пользователя в вашем приложении. После этого пользователь будет перенаправлен на Auth0, чтобы служба была проинформирована о активности выхода пользователя. Наконец, пользователь будет перенаправлен обратно в ваше приложение.</p><h4>Индексный файл</h4><p>Наконец, давайте рассмотрим файл <strong>index.php</strong>, который является точкой входа нашего приложения.</p><pre class="brush: php noskimlinks noskimwords">&lt;?php  // Require composer autoloader  require __DIR__ . "/vendor/autoload.php";  require __DIR__ . "/dotenv-loader.php";  use Auth0\SDK\Auth0;  $domain        = getenv("AUTH0_DOMAIN");  $client_id     = getenv("AUTH0_CLIENT_ID");  $client_secret = getenv("AUTH0_CLIENT_SECRET");  $redirect_uri  = getenv("AUTH0_CALLBACK_URL");  $audience      = getenv("AUTH0_AUDIENCE");  if($audience == ""){    $audience = "https://" . $domain . "/userinfo";  }  $auth0 = new Auth0([    "domain" =&gt; $domain,    "client_id" =&gt; $client_id,    "client_secret" =&gt; $client_secret,    "redirect_uri" =&gt; $redirect_uri,    "audience" =&gt; $audience,    "scope" =&gt; "openid profile",    "persist_id_token" =&gt; true,    "persist_access_token" =&gt; true,    "persist_refresh_token" =&gt; true,  ]);  $userInfo = $auth0-&gt;getUser();?&gt;&lt;html&gt;    &lt;head&gt;        &lt;script src="http://code.jquery.com/jquery-3.1.0.min.js" type="text/javascript"&gt;&lt;/script&gt;        &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;        &lt;!-- font awesome from BootstrapCDN --&gt;        &lt;link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"&gt;        &lt;link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet"&gt;        &lt;link href="public/app.css" rel="stylesheet"&gt;    &lt;/head&gt;    &lt;body class="home"&gt;        &lt;div class="container"&gt;            &lt;div class="login-page clearfix"&gt;              &lt;?php if(!$userInfo): ?&gt;              &lt;div class="login-box auth0-box before"&gt;                &lt;img src="https://i.cloudup.com/StzWWrY34s.png" /&gt;                &lt;h3&gt;Auth0 Example&lt;/h3&gt;                &lt;p&gt;Zero friction identity infrastructure, built for developers&lt;/p&gt;                &lt;a class="btn btn-primary btn-lg btn-login btn-block" href="login.php"&gt;Sign In&lt;/a&gt;              &lt;/div&gt;              &lt;?php else: ?&gt;              &lt;div class="logged-in-box auth0-box logged-in"&gt;                &lt;h1 id="logo"&gt;&lt;img src="//cdn.auth0.com/samples/auth0_logo_final_blue_RGB.png" /&gt;&lt;/h1&gt;                &lt;img class="avatar" src="&lt;?php echo $userInfo["picture"] ?&gt;"/&gt;                &lt;h2&gt;Welcome &lt;span class="nickname"&gt;&lt;?php echo $userInfo["nickname"] ?&gt;&lt;/span&gt;&lt;/h2&gt;                &lt;a class="btn btn-warning btn-logout" href="/logout.php"&gt;Logout&lt;/a&gt;              &lt;/div&gt;              &lt;?php endif ?&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/body&gt;&lt;/html&gt;</pre><p>Здесь мы использовали метод <code class="inline">getUse</code>r объекта <code class="inline">$auth0</code>, чтобы узнать, есть ли какой-либо активный сеанс. Если активного сеанса нет, мы отобразим ссылку «<strong>Вход</strong>», которая приведет пользователя к <strong>login.php</strong> и инициирует поток входа. С другой стороны, мы приветствуем пользователя и показываем ссылку «<strong>Выход</strong>», если пользователь уже вошел в систему.<br></p><p>Таким образом, это была реализация базового потока аутентификации для серверных приложений.</p><h2>Защитите свои пользовательские API с помощью OAuth2</h2><p>В этом разделе мы рассмотрим, как вы можете защитить свои пользовательские API, выполнив поток предоставления кода авторизации OAuth2. Надеюсь, вы знакомы со стандартным потоком предоставления кода авторизации, так как мы не будем вдаваться в подробности этого. Ознакомьтесь с некоторыми нашими другими сообщениями здесь, на Envato Tuts +, если вы хотите ускориться с OAuth2.</p><ul class="roundup-block__contents posts--half-width roundup-block--card"><li class="roundup-block__content posts__post"><article><header><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=400/net/uploads/2013/07/oauth-retina-preview.jpg" alt="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." title="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." width="50" height="50"></span><span></span></header><div class="posts__post-teaser"> В мире, где доминируют социальные сети, трудно встретить клиентское приложение, которое вы использовали для доступа к ограниченным ресурсам для некоторых других ...</div> <footer class="posts__post-details"><div class="posts__post-teaser-overlay"></div> <div class="posts__post-publication-meta"> <img sizes="76px" class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/388/profiles/1988/profileImage/pic%20copy.jpg" alt="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." title="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." width="50" height="50"><div class="posts__post-details__info"> <address class="posts__post-author"><span>Agraj Mangal</span></address> <time class="posts__post-publication-date" datetime="2013-07-12 23:08:53 UTC">12 Июль 2012</time></div> </div> <div class="posts__post-primary-category topic-code"><span>Веб-разработка</span></div></footer></article></li> <li class="roundup-block__content posts__post"><article><header><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1203/posts/25713/preview_image/7df3h38zabcvjylnyfe3.jpeg" alt="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." title="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." width="50" height="50"></span><span></span></header><div class="posts__post-teaser">В этом уроке вы узнаете, как использовать Twitter API 1.1 и OAuth 2.0 для аутентификации пользователей вашего приложения и публикации тестового твита.</div> <footer class="posts__post-details"><div class="posts__post-teaser-overlay"></div> <div class="posts__post-publication-meta"> <img sizes="76px" class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1203/profiles/19715/profileImage/IMG_1633_square_400.jpg" alt="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." title="Аутентификация и авторизация с использованием Auth0 в PHPOAuth 2.0 - The Good, The Bad &amp; The UglyКак проверить подлиннос..." width="50" height="50"><div class="posts__post-details__info"> <address class="posts__post-author"><span>Anton Bagaiev</span></address> <time class="posts__post-publication-date" datetime="2016-04-29 12:00:17 UTC">29 апреля 2016</time></div> </div> <div class="posts__post-primary-category topic-code"><span>PHP</span></div></footer></article></li> </ul><p>Вместо этого мы сразу же погрузимся в реальную реализацию. Идем дальше и создаем файл <strong>auth_code_grant_example.php</strong> со следующим содержимым.</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpsession_start();if (!isset($_GET["code"])) {    // Check if we need to show the "Sign In" link    $params = array (      "audience" =&gt; "{AUDIENCE}",      "scope" =&gt; "profile",      "response_type" =&gt; "code",      "client_id" =&gt; "{CLIENT_ID}",      "state" =&gt; "SomeRandomString",      "redirect_uri" =&gt; "{CALLBACK_URL}"    );    $_SESSION["oauth2state"]=$params["state"];    $str_params = "";    foreach($params as $key=&gt;$value) {      $str_params .= $key . "=" . urlencode($value) . "&amp;";    }    ?&gt;    &lt;a href="https://{AUTH0_DOMAIN}/authorize?&lt;?php echo $str_params;?&gt;"&gt;      Sign In    &lt;/a&gt;&lt;?php} elseif (empty($_GET["state"]) || (isset($_SESSION["oauth2state"]) &amp;&amp; $_GET["state"] !== $_SESSION["oauth2state"])) {    // If the "state" var is present in the $_GET, let"s validate it    if (isset($_SESSION["oauth2state"])) {        unset($_SESSION["oauth2state"]);    }        exit("Invalid state");} elseif(isset($_GET["code"]) &amp;&amp; !empty($_GET["code"])) {    // If the auth "code" is present in the $_GET    // let"s exchange it for the access token    $params = array (      "grant_type" =&gt; "authorization_code",      "client_id" =&gt; "{CLIENT_ID}",      "client_secret" =&gt; "{CLIENT_SECRET}",      "code" =&gt; $_GET["code"],      "redirect_uri" =&gt; "{CALLBACK_URL}"    );    $str_params = "";    foreach($params as $key=&gt;$value) {      $str_params .= $key . "=" . urlencode($value) . "&amp;";    }    $curl = curl_init();    curl_setopt_array($curl, array(      CURLOPT_URL =&gt; "https://{AUTH0_DOMAIN}/oauth/token",      CURLOPT_RETURNTRANSFER =&gt; true,      CURLOPT_CUSTOMREQUEST =&gt; "POST",      CURLOPT_POSTFIELDS =&gt; $str_params    ));    $curl_response = curl_exec($curl);    $curl_error = curl_error($curl);    curl_close($curl);    if ($curl_error) {      echo "Error in the CURL response:" . $curl_error;    } else {      $arr_json_data = json_decode($curl_response);      if (isset($arr_json_data-&gt;access_token)) {        $access_token = $arr_json_data-&gt;access_token;        $curl = curl_init();        curl_setopt_array($curl, array(          CURLOPT_URL =&gt; "http://{YOUR_API_DOMAIN}/demo_api_server.php",          CURLOPT_RETURNTRANSFER =&gt; true,          CURLOPT_CUSTOMREQUEST =&gt; "GET",          CURLOPT_HTTPHEADER =&gt; array(            "Authorization: Bearer {$access_token}"          )        ));        $curl_response = curl_exec($curl);        $curl_error = curl_error($curl);        curl_close($curl);        if ($curl_error) {          echo "Error in the CURL response from DEMO API:" . $curl_error;        } else {          echo "Demo API Response:" . $curl_response;        }      } else {        echo "Invalid response, no access token was found.";      }    }}</pre><p>Давайте посмотрим, как работает этот код!</p><h3>Давайте посмотрим, как работает этот код!</h3><p>Сначала мы подготовили ссылку, которая отправляет пользователя на сервер Auth0, чтобы начать поток авторизации.</p><pre class="brush: php noskimlinks noskimwords">// Check if we need to show the "Sign In" link$params = array (  "audience" =&gt; "{AUDIENCE}",  "scope" =&gt; "profile",  "response_type" =&gt; "code",  "client_id" =&gt; "{CLIENT_ID}",  "state" =&gt; "{SOME_RANDOM_STRING}",  "redirect_uri" =&gt; "{CALLBACK_URL}");$_SESSION["oauth2state"]=$params["state"];$str_params = "";foreach($params as $key=&gt;$value) {  $str_params .= $key . "=" . urlencode($value) . "&amp;";}?&gt;&lt;a href="https://{AUTH0_DOMAIN}/authorize?&lt;?php echo $str_params;?&gt;"&gt;  Sign In&lt;/a&gt;</pre><p>Пожалуйста, замените <code class="inline">{AUDIENCE}</code>, <code class="inline">{CLIENT_ID}</code> и <code class="inline">{CALLBACK_URL}</code> на значения, соответствующие вашему приложению. Параметр <code class="inline">{AUDIENCE}</code> должен быть заменен значением поля <strong>Идентификатор</strong>, найденным в <strong>API&gt; {YOUR API APPLICATION}&gt; Настройки</strong> на панели управления Auth0.</p><p><strong>{SOME_RANDOM_STRING}</strong> следует заменить уникальным значением, которое трудно угадать. Эта строка используется для предотвращения атак CSRF. Кроме того, не забудьте заменить <code class="inline">{AUTH0_DOMAIN}</code> своим доменным именем, как мы обсуждали ранее.</p><h3>Получение маркера доступа</h3><p>Когда пользователь нажимает на ссылку «<strong>Вход</strong>», они будут отправлены на сервер Auth0 для аутентификации. После аутентификации им будет предложено разрешить приложению доступ к вашему профилю. После авторизации пользователь будет перенаправлен обратно в ваше приложение с <code class="inline">кодом </code>в качестве параметра <code class="inline">$ _GET</code>.</p><p>Затем мы можем обменять этот <code class="inline">код</code>, чтобы получить токен доступа.</p><pre class="brush: php noskimlinks noskimwords">// If the auth "code" is present in the $_GET// let"s exchange it for the access token$params = array (  "grant_type" =&gt; "authorization_code",  "client_id" =&gt; "{CLIENT_ID}",  "client_secret" =&gt; "{CLIENT_SECRET}",  "code" =&gt; $_GET["code"],  "redirect_uri" =&gt; "{CALLBACK_URL}");$str_params = "";foreach($params as $key=&gt;$value) {  $str_params .= $key . "=" . urlencode($value) . "&amp;";}$curl = curl_init();$curl_response = curl_exec($curl);curl_setopt_array($curl, array(  CURLOPT_URL =&gt; "https://{AUTH0_DOMAIN}/oauth/token",  CURLOPT_RETURNTRANSFER =&gt; true,  CURLOPT_CUSTOMREQUEST =&gt; "POST",  CURLOPT_POSTFIELDS =&gt; $str_params));</pre><p>Как вы можете видеть, для получения маркера доступа требуется один вызов CURL. </p><h3>Вызов конечной точки пользовательского API</h3><p>После того, как у вас есть токен доступа, вы можете вызвать свою конечную точку API, включив ее в заголовок.</p><pre class="brush: php noskimlinks noskimwords">$access_token = $arr_json_data-&gt;access_token;$curl = curl_init();curl_setopt_array($curl, array(  CURLOPT_URL =&gt; "http://{YOUR_API_DOMAIN}/demo_api_server.php",  CURLOPT_RETURNTRANSFER =&gt; true,  CURLOPT_CUSTOMREQUEST =&gt; "GET",  CURLOPT_HTTPHEADER =&gt; array(    "Authorization: Bearer {$access_token}"  )));$curl_response = curl_exec($curl);$curl_error = curl_error($curl);curl_close($curl);if ($curl_error) {  echo "Error in the CURL response from DEMO API:" . $curl_error;} else {  echo "Demo API Response:" . $curl_response;}</pre><h3>Конечная точка API с защитой Auth0</h3><p>Файл фиктивного файла API <strong>demo_api_server.php</strong> может выглядеть примерно так:</p><pre class="brush: php noskimlinks noskimwords">&lt;?php// Require composer autoloaderrequire __DIR__ . "/vendor/autoload.php";use Auth0\SDK\JWTVerifier;try {  $verifier = new JWTVerifier([    "supported_algs" =&gt; ["{HASHING_ALGORITHM}"],    "valid_audiences" =&gt; ["{AUDIENCE}"],    "authorized_iss" =&gt; ["{DOMAIN}"]  ]);  $access_token = getBearerToken();  $token_info = $verifier-&gt;verifyAndDecode($access_token);  echo json_encode(array("date"=&gt;"API Resource Data!!"));}catch(\Auth0\SDK\Exception\CoreException $e) {  throw $e;  echo json_encode(array("error"=&gt;$e-&gt;getMessage()));}function getAuthorizationHeader() {    $headers = null;    if (isset($_SERVER["Authorization"])) {        $headers = trim($_SERVER["Authorization"]);    }    else if (isset($_SERVER["HTTP_AUTHORIZATION"])) { //Nginx or fast CGI        $headers = trim($_SERVER["HTTP_AUTHORIZATION"]);    } elseif (function_exists("apache_request_headers")) {        $requestHeaders = apache_request_headers();        // Server-side fix for bug in old Android versions (a nice side-effect of this fix means we don"t care about capitalization for Authorization)        $requestHeaders = array_combine(array_map("ucwords", array_keys($requestHeaders)), array_values($requestHeaders));        //print_r($requestHeaders);        if (isset($requestHeaders["Authorization"])) {            $headers = trim($requestHeaders["Authorization"]);        }    }    return $headers;}function getBearerToken() {    $headers = getAuthorizationHeader();    // HEADER: Get the access token from the header    if (!empty($headers)) {        if (preg_match("/Bearer\s(\S+)/", $headers, $matches)) {            return $matches[1];        }    }    return null;}</pre><p>Давайте быстро рассмотрим важные части этого кода.</p><h3>Проверка маркера доступа</h3><p>Вы обязаны проверять токен доступа, прежде чем предоставлять доступ к защищенному ресурсу. И это именно то, что мы сделали в следующем фрагменте. Мы использовали класс утилиты <code class="inline">JWTVerifier</code> для проверки токена доступа.</p><pre class="brush: php noskimlinks noskimwords">try {  $verifier = new JWTVerifier([    "supported_algs" =&gt; ["{SIGNING_ALGORITHM}"],    "valid_audiences" =&gt; ["{AUDIENCE}"],    "authorized_iss" =&gt; ["{DOMAIN}"]  ]);  $access_token = getBearerToken();  $token_info = $verifier-&gt;verifyAndDecode($access_token);  echo json_encode(array("date"=&gt;"API Resource Data!!"));}catch(\Auth0\SDK\Exception\CoreException $e) {  throw $e;  echo json_encode(array("error"=&gt;$e-&gt;getMessage()));}</pre><p><code class="inline">{SIGNING_ALGORITHM}</code> следует заменить значением поля <strong>Signing Algorithm</strong>, найденным в <strong>API&gt; {YOUR API APPLICATION}&gt; Settings</strong>.</p><p>Таким образом, вы можете защитить свои пользовательские API, если хотите использовать поток OAuth2 в службе Auth0.<br></p><h2>Заключение</h2><p>Сегодня мы прошли через службу Auth0, которая обеспечивает аутентификацию и авторизацию в качестве службы. После введения службы Auth0 мы рассмотрели несколько практических примеров, чтобы продемонстрировать, как вы могли бы интегрировать их с вашими PHP-приложениями.</p><p>Пожалуйста, не стесняйтесь размещать свои предложения и запросы, используя приведенный ниже канал!</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="PHP" href="https://norma-studio.github.io/article/220824761-autentifikatsiya-i-avtorizatsiya-s-ispolzovaniem-auth0-v-phpoauth-20--the-good-the-bad-and-the-uglykak-proverit-podlinnos" class="tm-article-body__tags-item-link">PHP</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
34960</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
479</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
