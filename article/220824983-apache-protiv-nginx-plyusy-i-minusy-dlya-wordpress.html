
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Требования к производительности WordPress могут варьироваться в зависимости от проектов, но одна вещь, безусловно, остается неизменной - она должна быть быстрой. ...">
<meta property="og:description" content="Требования к производительности WordPress могут варьироваться в зависимости от проектов, но одна вещь, безусловно, остается неизменной - она должна быть быстрой. ...">
<meta name="twitter:description" content="Требования к производительности WordPress могут варьироваться в зависимости от проектов, но одна вещь, безусловно, остается неизменной - она должна быть быстрой. ...">
<meta property="aiturec:description" content="Требования к производительности WordPress могут варьироваться в зависимости от проектов, но одна вещь, безусловно, остается неизменной - она должна быть быстрой. ...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1160/posts/28540/image/149204501883689.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1160/posts/28540/image/149204501883689.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1160/posts/28540/image/149204501883689.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1160/posts/28540/image/149204501883689.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1160/posts/28540/image/149204501883689.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html" title="Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io" title="Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/31231313312.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html" class="tm-user-info__username" title="
Д. Грунин" aria-label="
Д. Грунин">
Д. Грунин</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Apache против Nginx: плюсы и минусы для WordPress...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress" class="tm-article-snippet__hubs-item-link"><span>WordPress</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1160/posts/28540/image/149204501883689.png">
    <meta itemprop="headline name" content="Apache против Nginx: плюсы и минусы для WordPress... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Требования к производительности WordPress могут варьироваться в зависимости от проектов, но одна вещь, безусловно, остается неизменной - она должна быть быстрой. ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Требования к производительности WordPress могут варьироваться в зависимости от проектов, но одна вещь, безусловно, остается неизменной - она должна быть быстрой. ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Требования к производительности WordPress могут варьироваться в зависимости от проектов, но одна вещь, безусловно, остается неизменной - она должна быть <em>быстрой</em>. </p><p>Другое требование, которое само собой разумеется, производительность должна быть <em>экономичной</em>, поэтому у нас не может быть ресурсоемких решений. Решения должны быть скромными, средними и <em>надежными</em> и полностью максимизировать доход на вашем сайте, расходы на хостинг должны быть сведены к минимуму.</p><p>Если вы ожидаете получить большой трафик, конфигурация веб-сервера, в которой вы используете WordPress, напрямую влияет на производительность вашего сайта, что влияет на время загрузки и стабильность. </p><p>При выборе веб-сервера у вас есть несколько вариантов; Apache, Nginx, IIS, Caddy и Lighttpd - все популярные проекты. Мы рассмотрим Apache и Nginx в этом руководстве.</p><p>По оценкам, из всего Интернета в совокупности Apache Server и Nginx вместе составляют 50% всего веб-трафика. </p><p>Если вы новичок в этой теме, возможно, вас смущают две, казалось бы, идентичные цели программного обеспечения - для обслуживания веб-сайтов. Я надеюсь уточнить ниже, как эти два отличаются друг от друга и как использовать их преимущества. </p><p>Apache и Nginx - очень хорошо зарекомендовавшие себя проекты, и у них обоих есть свои причины для того, чтобы достичь такой же цели, как и для вашего сайта WordPress. Однако, когда мы смотрим глубже в своих проектах, есть большая разница в том, как соединения обрабатываются каждым сервером. </p><h2>Отличия </h2><p>Основное различие заключается в том, как обрабатываются соединения.</p><p>Проще говоря, Apache использует разветвленное <em>многопоточное</em> решение или <em>keep-alive</em>, которое поддерживает соединение для каждого пользователя.</p><p>С другой стороны, Nginx использует <em>неблокирующий цикл событий</em>, который объединяет соединения, работающие асинхронно через рабочие процессы.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1160/posts/28540/image/149204501883689.png" alt="Apache против Nginx: плюсы и минусы для WordPress..." title="Apache против Nginx: плюсы и минусы для WordPress..." width="50" height="50"></figure><p>Из-за этой архитектуры результатом является однопоточный процесс nginx, и для обработки каждого нового соединения не создаются дополнительные процессы. Таким образом, даже при высокой нагрузке, CPU и оперативная память не очень сильно расходуются при таком подходе.</p><p>Помимо архитектуры, есть также некоторые незначительные различия и нюансы между ними в конфигурации, и мы рассмотрим их более подробно позже в этом руководстве. </p><p>Во-первых, давайте посмотрим на два проекта и сделаем четкий обзор.</p><h2>Apache</h2><ul><li>Начатый в 1995 году <span>Робертом Маккулом</span>, выпускником Университета штата Иллинойс, постоянно развивается под управлением <span>Apache Software Foundation</span> с 1999 года.</li> <li>Наиболее широко используется в Интернете с 1996 года (по умолчанию для многих хостов, например, пользователей <span>cPanel</span>).</li> <li>Использует <span>широко расширяемую систему загрузки динамического модуля</span>.</li> <li>Использует файл <code class="inline">.htaccess</code> для перезаписи URL.</li> <li>Использует файл <code class="inline">httpd.conf</code> для <span>конфигурации сервера</span> с синтаксисом типа XML.</li> </ul><p>WordPress работает с Apache довольно хорошо прямо из коробки, необходим PHP-модуль, такой как <code class="inline">mod_php</code>, но больше ничего не нужно. </p><p>Apache очень гибкий и имеет множество модулей. Обычно <code class="inline">mod_rewrite</code> используется для преобразования URL-адресов для интерпретации URL-адресов, таких как <code class="inline">category.php?Id=4</code> в <code class="inline">/categories/4</code>.</p><h2>Nginx</h2><ul><li>Начатый в 2002 году российским инженером-программистом <span>Игорем Сысоевым</span> в качестве решения <span>проблемы C10k</span> - задача для веб-серверов для обработки 10 000 одновременных подключений. </li> <li>Выпущен публично в 2004 году, поставив цель в качестве асинхронной, неблокирующей, управляемой событиями архитектуры.</li> <li>Легкая работа на минимальном аппаратном обеспечении обеспечивает отличную производительность статического контента.</li> <li>Высокая чувствительность при большой нагрузке.</li> <li>Использует конфигурационный файл <code class="inline">nginx.conf</code> с синтаксисом JS-типа с фигурной скобкой.</li> <li>Расширяемость со <span>сторонними модулям</span>и.</li> </ul><p>Будучи преемником Apache, Nginx имеет преимущество в понимании ошибок и проблем производительности параллелизма, которые могут произойти благодаря его очень быстрой асинхронной схеме цикла событий.</p><p>Для статического контента это работает очень быстро. Что касается динамического контента, например PHP, Nginx не имеет возможности обрабатывать это с помощью модуля, как это делает Apache. Но это не помеха, поскольку для достижения этого используется FastCGI. Это <span>очень хорошо работает</span> в сочетании с пулами соединений <span>php fpm</span> и memcache.</p><h2>Требования WordPress</h2><ul><li>PHP 7&gt; </li> <li>MySQL 5.6 или Maria DB 10.0&gt;</li> <li>Mod_rewrite (при использовании Apache)</li> <li>SSL (если используется)</li> </ul><p>Оба Apache и Nginx поддерживают <span>php fpm</span>. Это менеджер FastCGI, <strong>f</strong>orked <strong>p</strong>rocess <strong>m</strong>anager для PHP, который может использоваться для обеспечения очень быстрого времени отклика. Выполняясь как демон на сервере, он будет инициализировать процессы, как только они потребуются. </p><h3>Настройка PHP FPM с помощью Apache</h3><p>Пользователи Ubuntu и Debian могут устанавливать необходимые пакеты с помощью aptitude через:</p><pre class="brush: bash noskimlinks noskimwords">sudo apt-get -y install libapache2-mod-fastcgi php7.0-fpm php7.0</pre><p>Теперь включите модуль в apache:</p><pre class="brush: bash noskimlinks noskimwords">a2enmod actions fastcgi alias</pre><p>Затем в файле конфигурации <code class="inline">/etc/apache2/conf-available/php7.0-fpm.conf</code> добавьте следующее:<br></p><pre class="brush: xml noskimlinks noskimwords">&lt;IfModule mod_fastcgi.c&gt;    AddHandler php7-fcgi .php    Action php7-fcgi /php7-fcgi    Alias /php7-fcgi /usr/lib/cgi-bin/php7-fcgi    FastCgiExternalServer /usr/lib/cgi-bin/php7-fcgi -socket /var/run/php/php7.0-fpm.sock -pass-header Authorization&lt;/IfModule&gt;</pre><p>Кроме того, в вашем VirtualHost для WordPress (путь по умолчанию <code class="inline">/etc/apache2/sites-available/000-default.con</code>f) добавьте следующее:</p><pre class="brush: xml noskimlinks noskimwords">&lt;Directory /usr/lib/cgi-bin&gt;    Require all granted&lt;/Directory&gt;&lt;IfModule mod_fastcgi.c&gt;    SetHandler php7-fcgi .php    Action php7-fcgi /php7-fcgi virtual    Alias /php7-fcgi /usr/lib/cgi-bin/php7-fcgi    FastCgiExternalServer /usr/lib/cgi-bin/php7-fcgi -socket /var/run/php/php7.0-fpm.sock -pass-header Authorization&lt;/IfModule&gt;</pre><p>Теперь перезапустите apache, и готово</p><pre class="brush: plain noskimlinks noskimwords">systemctl restart apache2.service</pre><p>Создайте файл с содержимым вида <code class="inline">&lt;? php phpinfo (); ?&gt;</code> и откройте его в своем браузере. Теперь PHP будет работать с FPM. </p><p>Теперь проверьте свой блог WordPress. Обратили внимание на разницу?</p><h3>Настройка PHP FPM с Nginx<br></h3><p>Пользователи Ubuntu и Debian могут установить пакет следующим образом:</p><pre class="brush: bash noskimlinks noskimwords">apt-get -y install php7.0-fpm</pre><p>Теперь в вашем файле конфигурации (по умолчанию /etc/nginx/sites-available/default) в блоке сервера вам необходимо добавить конфигурацию FastCGI следующим образом:</p><pre class="brush: plain noskimlinks noskimwords">server {... location / {    # use try files to try and serve the file    try_files $uri $uri/ =404; }  # PHP FPM Configuration location ~ \.php$ {    include snippets/fastcgi-php.conf;    # Connect via socket    fastcgi_pass unix:/run/php/php7.0-fpm.sock; }  # deny apache .htaccess requests location ~ /\.ht {  deny all; } ... }</pre><p>Здесь мы используем <span>фрагмент</span> из Nginx, чтобы установить параметры cgi и передать fastcgi соединение сокета. </p><p>Затем убедитесь, что вы установили <code class="inline">cgi.fix_pathinfo = 0</code> в php ini, поскольку настройка по умолчанию нарушает конфигурацию. Измените <code class="inline">/etc/php/7.0/fpm/php.ini</code> и установите:</p><pre class="brush: plain noskimlinks noskimwords">[...]; cgi.fix_pathinfo provides *real* PATH_INFO/PATH_TRANSLATED support for CGI.  PHP"s; previous behaviour was to set PATH_TRANSLATED to SCRIPT_FILENAME, and to not grok; what PATH_INFO is.  For more information on PATH_INFO, see the cgi specs.  Setting; this to 1 will cause PHP CGI to fix its paths to conform to the spec.  A setting; of zero causes PHP to behave as before.  Default is 1.  You should fix your scripts; to use SCRIPT_FILENAME rather than PATH_TRANSLATED.; https://php.net/cgi.fix-pathinfocgi.fix_pathinfo=0[...]</pre><p>Теперь вы можете сохранить файл и перезагрузить PHP FPM. Сделайте это через:</p><pre class="brush: plain noskimlinks noskimwords">service php7.0-fpm reload</pre><p>Наконец, мы можем проверить <code class="inline">&lt;? phpinfo (); ?&gt;</code> в своем браузере, чтобы подтвердить, что сервер теперь использует PHP FPM с Nginx.</p><h3>Выполнение mod_rewrite в Nginx</h3><p>Nginx не использует файл <code class="inline">.htaccess</code>, а для перезаписи URL он использует гораздо более простой подход.</p><p>Чтобы ваш блог WordPress работал с Nginx, просто добавьте следующее к части <code class="inline">try_files</code> вашей конфигурации Nginx:</p><pre class="brush: plain noskimlinks noskimwords">location / {    index index.php index.html index.htm;    try_files $uri $uri/ /index.php?q=$uri&amp;$args;}</pre><p>Если вы используете каталог для своего блога WordPress, задайте следующее:</p><pre class="brush: plain noskimlinks noskimwords">location /wordpress/ {    try_files $uri $uri/ /index.php?q=$uri&amp;$args;}</pre><p>Перезапустите Nginx, и у вас будет работать перезапись URL.</p><pre class="brush: bash noskimlinks noskimwords">$ service nginx restart</pre><h2>Оптимальные настройки</h2><p>У вас есть много вариантов оптимизации WordPress посредством кеширования на сервере с помощью memcache, varnish, а также на уровне приложения WordPress с помощью плагинов, которые легко позволят вам получить доступ к этому. </p><p>Однако то, что предлагает Nginx, - отличное решение для обслуживания статического контента веб-сайта с его надежным и быстрым <span>статическим кешем содержимого</span>.</p><h3>Кэш статического содержимого</h3><p>Nginx очень быстро работает в качестве кеша статического содержимого, и именно там его использование действительно впечатляет в WordPress и сообщениях в блогах с большим количеством изображений. Вы можете обслуживать свои CSS, JS и изображения через сервер Nginx, работающий именно для этих нужд. </p><p>Лучше всегда делать это в <span>домене без файлов cookie</span>, чтобы контент был действительно кэширован браузером (поскольку cookie не кэшируются), поэтому использование субдомена, такого как <code class="inline">images.myblog.com</code> или <code class="inline">static.myblog.com</code>, будет идеально.</p><p>Блок местоположения для этой конфигурации статических субдоменов будет выглядеть так:</p><pre class="brush: plain noskimlinks noskimwords">    location ~* ^.+\.(?:css|cur|js|jpe?g|gif|htc|ico|png|html|xml|otf|ttf|eot|woff|svg)$ {        access_log off;        expires 30d;        tcp_nodelay off;        ## Set the OS file cache.        open_file_cache max=3000 inactive=120s;        open_file_cache_valid 45s;        open_file_cache_min_uses 2;        open_file_cache_errors off;    }</pre><p>Используя <code class="inline">open_file_cache</code>, мы включаем кеширование для наших статических медиафайлов. Мы указываем максимальное количество файлов для кэширования и как долго их следует хранить с помощью <code class="inline">open_file_cache max=3000 inactive=120s;</code></p><p>Если вы хотите настроить кеширование по всему проекту, просто добавьте следующие четыре строки в свои конфигурации nginx.conf:</p><pre class="brush: plain noskimlinks noskimwords">open_file_cache          max=10000 inactive=5m;open_file_cache_valid    2m;open_file_cache_min_uses 1;open_file_cache_errors   on;</pre><p><strong>Важно</strong>: <code class="inline">open_file_cache_errors</code> будет кэшировать фактические ошибки 404, поэтому лучше отключить это, если вы используете балансировщик нагрузки.</p><h3>Пулы подключения PHP-FPM</h3><p>Можно использовать разные пулы для вашего блога WordPress, и вы можете аккуратно распределять ресурсы для каждого сайта - даже при необходимости использовать разных пользователей и группы для каждого пула. Конфигурация очень гибкая. </p><p>Вы можете настроить несколько конфигураций, например:</p><pre class="brush: plain noskimlinks noskimwords">/etc/php-fpm.d/family-site.conf/etc/php-fpm.d/travel-blog.conf/etc/php-fpm.d/cooking-recipes.conf</pre><p>В каждом из следующих вариантов мы можем установить множество конфигураций:</p><pre class="brush: plain noskimlinks noskimwords">[site]listen = 127.0.0.1:9000user = usergroup = websitesrequest_slowlog_timeout = 5sslowlog = /var/log/php-fpm/slowlog-site.loglisten.allowed_clients = 127.0.0.1pm = dynamicpm.max_children = 5pm.start_servers = 3pm.min_spare_servers = 2pm.max_spare_servers = 4pm.max_requests = 200listen.backlog = -1pm.status_path = /statusrequest_terminate_timeout = 120srlimit_files = 131072rlimit_core = unlimitedcatch_workers_output = yesenv[HOSTNAME] = $HOSTNAMEenv[TMP] = /tmpenv[TMPDIR] = /tmpenv[TEMP] = /tmp</pre><p>С помощью этого вы можете указать <span>параметры конфигурации</span> PHP-FPM, такие как <span>pm.max_children</span>, и вы также можете указать переменные окружения и установить здесь параметры имени пользователя и группы.</p><h2>Балансировщик нагрузки Nginx<br></h2><p>Если вы собираетесь получать много трафика, то вам, вероятно, захочется настроить балансировщик нагрузки для использования с настройкой php-fpm.</p><p>Обычно мы хотим запустить несколько бэкенд серверов на верхнем уровне, все из которых работают с зеркалами вашего блога, а затем еще один сервер, на котором работает nginx, который действует как <span>балансировщик нагрузки</span> и будет направлять нагрузку между потоками трафика. </p><p>Это означает, что вы можете использовать много серверов для одновременного доступа к вашему блогу, а конфигурация для этого относительно проста. </p><p>Примерная конфигурация будет выглядеть так. Сначала мы начинаем с модуля upstream:</p><pre class="brush: plain noskimlinks noskimwords">upstream backend  {  server backend1.example.com;  server backend2.example.com;  server backend3.example.com;}</pre><p>Здесь каждый backend1.example.com имеет собственную конфигурацию Nginx, зеркало того, как сайт был до того, как он имел балансировщик нагрузки. Nginx будет выбирать, какой сервер использовать для каждого запроса.<br></p><p>Если у одного из наших бэкендов есть более быстрый жесткий диск, например SSD, или географически ближе к вашей основной пользовательской базе, вы можете установить вес так:</p><pre class="brush: plain noskimlinks noskimwords">upstream backend  {  server backend1.example.com weight=1;  server backend2.example.com weight=2;  server backend3.example.com weight=4;}</pre><p>Кроме того, если вы считаете, что сервер может стать медленнее или вы беспокоитесь о тайм-аутах, то для этого тоже есть варианты конфигурации:</p><pre class="brush: plain noskimlinks noskimwords">upstream backend  {  server backend1.example.com max_fails=3  fail_timeout=15s;  server backend2.example.com weight=2;  server backend3.example.com weight=4;</pre><p>Теперь, с этой конфигурацией, после 3 сбоев или 15-секундного таймаута сервер больше не будет использоваться балансировщиком нагрузки. Если вы хотите вручную пометить сервер как неактивный, добавьте ключевое слово <code class="inline">down</code>  например так: <code class="inline">server backend3.example.com down;</code>.</p><p>Затем нам нужно передать это серверу через прокси-сервер, используя <code class="inline">backend</code> upstream, который мы только что определили ранее:<br></p><pre class="brush: plain noskimlinks noskimwords"> server {  location / {    proxy_pass  http://backend;  }}</pre><p>Теперь перезагрузите сервер с помощью <code class="inline">service nginx restart</code>,  и вы запускаете балансированную по нагрузке версию своего сайта! </p><p>Наконец, по этой теме, также для вашей справки приведено <span>руководство nginx</span> по обслуживанию статического содержимого и наилучшим параметрам конфигурации. Обратите внимание на использование <code class="inline">tcp_nopush</code> и <code class="inline">sendfile</code> для Mp3, например.</p><h2>Миграция Apache в Nginx</h2><p>Помимо чтения <span>руководства Nginx</span> и самостоятельного внесения изменений, вы можете использовать инструмент <span>apache2nginx</span> с открытым исходным кодом для перевода вашей конфигурации с Apache на Nginx.</p><p>Следуйте инструкциям по установке <span>apache2nginx README</span>, и после установки вы сможете перенести файлы конфигурации, просто выполнив:</p><pre class="brush: plain noskimlinks noskimwords">$ apache2nginx -f /etc/httpd/conf/httpd.conf</pre><p>Теперь вы можете проверить конфигурацию и попробовать ее в установке Nginx. Вы можете обнаружить, что перевод не был совершенным, но он даст вам основание для начала.</p><h2>Вывод</h2><p>Для скорости и производительности Nginx является очевидным выбором вместо Apache, но это не означает, что Apache не может обрабатывать некоторый трафик. Если вы планируете перейти на первую страницу Reddit в ближайшее время, вероятно, вам стоит взглянуть на получение более эффективного решения с Nginx и PHP-FPM.</p><p>Миграция вашего WordPress в Nginx не очень сложна, и конфигурация для Nginx, очень проста и удобна в доступе по сравнению с Apache. </p><p>Хотя там и нет модулей, подобных Apache, и вначале это может быть незнакомо, вы сможете найти им замену в большинстве случаев. Если нет, то в качестве резервного решения вы всегда можете <span>проксировать</span> старый сервер через ваш nginx для этой цели, если это необходимо.</p><p>Существует множество способов настройки обоих серверов, поэтому хорошее решение можно найти почти всегда, независимо от требований. На данный момент кажется, что Apache всегда будет выбором по умолчанию для широко доступного хостинга cPanel, благодаря инструменту настройки <span>EasyApache</span>, который поставляется вместе с ним. </p><p>В будущем, возможно, больше хостов примет инструменты Nginx cPanel, такие как <span>Engintron</span>, которые также предоставляют Nginx для cPanel. </p><p>На данный момент, если вы хотите переключиться на WordPress с поддержкой Nginx, вам нужно будет настроить Linux VPN на DigitalOcean, AWS или на другом хостинг-провайдере.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article/220824983-apache-protiv-nginx-plyusy-i-minusy-dlya-wordpress" class="tm-article-body__tags-item-link">WordPress</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
39436</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
511</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
