
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этом уроке вы узнаете о технологии Flux и о том, как она используется для обработки потока данных в приложениях на основе React. Мы начнем с изучения основ Flux и понимания азов разработки приложений на его основе, а затем мы будем немного применим на практике то, чему научились, создав простое приложение для виртуального кошелька....">
<meta property="og:description" content="В этом уроке вы узнаете о технологии Flux и о том, как она используется для обработки потока данных в приложениях на основе React. Мы начнем с изучения основ Flux и понимания азов разработки приложений на его основе, а затем мы будем немного применим на практике то, чему научились, создав простое приложение для виртуального кошелька....">
<meta name="twitter:description" content="В этом уроке вы узнаете о технологии Flux и о том, как она используется для обработки потока данных в приложениях на основе React. Мы начнем с изучения основ Flux и понимания азов разработки приложений на его основе, а затем мы будем немного применим на практике то, чему научились, создав простое приложение для виртуального кошелька....">
<meta property="aiturec:description" content="В этом уроке вы узнаете о технологии Flux и о том, как она используется для обработки потока данных в приложениях на основе React. Мы начнем с изучения основ Flux и понимания азов разработки приложений на его основе, а затем мы будем немного применим на практике то, чему научились, создав простое приложение для виртуального кошелька....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1750/posts/28906/final_image/app%20preview.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1750/posts/28906/final_image/app%20preview.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1750/posts/28906/final_image/app%20preview.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1750/posts/28906/final_image/app%20preview.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1750/posts/28906/final_image/app%20preview.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html" title="Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io" title="Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/54332343.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html" class="tm-user-info__username" title="
В. Бухтеев" aria-label="
В. Бухтеев">
В. Бухтеев</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Изучаем архитектуру Flux в React...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="React" href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react" class="tm-article-snippet__hubs-item-link"><span>React</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1750/posts/28906/final_image/app%20preview.jpg">
    <meta itemprop="headline name" content="Изучаем архитектуру Flux в React... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этом уроке вы узнаете о технологии Flux и о том, как она используется для обработки потока данных в приложениях на основе React. Мы начнем с изучения основ Flux и понимания азов разработки приложений на его основе, а затем мы будем немного применим на практике то, чему научились, создав простое приложение для виртуального кошелька....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этом уроке вы узнаете о технологии Flux и о том, как она используется для обработки потока данных в приложениях на основе React. Мы начнем с изучения основ Flux и понимания азов разработки приложений на его основе, а затем мы будем немного применим на практике то, чему научились, создав простое приложение для виртуального кошелька....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этом уроке вы узнаете о технологии <span>Flux</span> и о том, как она используется для обработки потока данных в приложениях на основе React. Мы начнем с изучения основ Flux и понимания азов разработки приложений на его основе, а затем мы будем немного применим на практике то, чему научились, создав простое приложение для виртуального кошелька.<br></p><p>Во время этого урока я предполагаю, что вы использовали React раньше, но не имеете опыта работы с Flux. Вы сможете усвоить что-то из этого урока, если у вас уже есть базовые основы Flux, и вы желаете погрузиться немного глубже.<br></p><p>Если вы совершенно не знакомы с разработкой Реакт, я рекомендую пройти курс «<span>Начало работы с React</span>» <span>Дэвида Иста</span>, здесь, в Envato Tuts +. Это фантастический курс, который позволит вам быстро разобраться в React.<br></p><h2>Что такое Flux?</h2><p>Flux - это в основном <em>концепция архитектуры приложений</em>, разработанная в Facebook, но тот же термин также относится и к библиотеке, представляющей официальную реализацию.<br></p><p>Facebook сделал Flux как попытку решить проблемы, вызванные шаблоном MVC в их массивной базе кода. Они боролись с проблемами, когда действия приводили к каскадным обновлениям, что приводило к непредсказуемым результатам и коду, который становилось трудно отлаживать. Это может показаться знакомым, если раньше вы использовали MVC фреймворки, так как большинство из них по сути очень похожи. Добавьте наблюдателей и двухстороннюю привязку данных к миксу, и получите настоящую головную боль.<br></p><p>Мой совет - избегать любых попыток найти общий язык между Flux и MVC.  Это врятли вам чем-то поможет, и даже наоборот еще больше запутает. Flux пытается решить все по-другому, и попытка сравнить его с другими шаблонами не поможет.</p><h2>Настройка проекта</h2><p>Если вы хотите следовать этой статье, сначала убедитесь, что у вас установлено необходимое программное обеспечение. Когда вы закончите, клонируйте ветку <code class="inline">boilerplate</code> из <span>GitHub репозитория</span>, который я подготовил для сопровождения этой статьи.<br></p><p>Ниже приведены требования к программному обеспечению и версии, которые я использовал на момент написания этой статьи:<br></p><ul><li>Git: 2.11</li> <li>Node.js: 6.9</li> <li>NPM: 3.10</li> <li>Yarn: 0,22</li> <li>Ваш редактор на выбор</li> </ul><p>Шаблон служит отправной точкой для предстоящего небольшого проекта, который мы будем создавать, небольшого приложения для виртуального кошелька. Он содержит конфигурацию Webpack для трансляции синтаксиса ES6 на простой JavaScript и WDS для обслуживания файлов. Он также имеет некоторые стили компонентов CSS, поэтому вы можете перейти сразу к работе.</p><p>Чтобы установить все необходимые зависимости, <code class="inline">cd</code> в каталог проекта и запустите <code class="inline">yarn</code>.</p><p>В следующем разделе вы будете настраивать основные компоненты приложения, прежде чем интегрировать Flux. Я не включил их в шаблон, так как считаю, что это создаст больше путаницы. Если вы не заинтересованы в создании приложения, вы можете пропустить эти шаги и перейти к следующему разделу.<br></p><h2>Настройка компонентов</h2><p>Начните с включения следующего кода внутри <code class="inline">js/index.js</code>, который служит точкой входа приложения:</p><pre class="brush: javascript noskimlinks noskimwords">import React from "react";import ReactDOM from "react-dom";import App from "./components/App";ReactDOM.render((&lt;App /&gt;), document.getElementById("app"));</pre><p>Для основного компонента <code class="inline">&lt;App/&gt;</code> создайте новый файл внутри <code class="inline">js/components</code> и назовите его <code class="inline">App.js</code>, и добавьте следующий код:</p><pre class="brush: javascript noskimlinks noskimwords">import React from "react";import AddNewItem from "./AddNewItem";import ItemsList from "./ItemsList";class App extends React.Component {    render() {  return (&lt;div className="container"&gt;&lt;h1 className="app-title"&gt;Flux Wallet&lt;/h1&gt;&lt;AddNewItem /&gt;&lt;ItemsList /&gt;&lt;/div&gt;);}}export default App;</pre><p>Компонент <code class="inline">&lt;App/&gt;</code> обертывает два других компонента: один для формы, ответственной за добавление новых элементов, а другой - за список элементов. Чтобы создать компонент <code class="inline">&lt;AddNewItem/&gt;</code>, создайте новый файл <code class="inline">AddNewItem.js</code> внутри <code class="inline">js/components</code> и добавьте этот код:</p><pre class="brush: javascript noskimlinks noskimwords">import React from "react";class AddNewItem extends React.Component {    // Set the initial state.    constructor(props) {super(props);this._getFreshItem = this._getFreshItem.bind(this);this.state = {item: this._getFreshItem()};}    // Return a fresh item._getFreshItem() {return {description: "",amount: ""};}    // Update the state._updateState(event) {let field = event.target.name;let value = event.target.value;// If the amount is changed and it"s not a float, return.if (value &amp;&amp; field === "amount" &amp;&amp; !value.match(/^[a-z0-9.\+\-]+$/g)) {return;}this.state.item[field] = value;this.setState({ item : this.state.item });}    // Add a new item._addNewItem(event) {// ...}render() {return (&lt;div&gt;&lt;h3 className="total-budget"&gt;$0&lt;/h3&gt;&lt;form className="form-inline add-item" onSubmit={this._addNewItem.bind(this)}&gt;&lt;input type="text" className="form-control description" name="description" value={this.state.item.description} placeholder="Description" onChange={this._updateState.bind(this)} /&gt;&lt;div className="input-group amount"&gt;&lt;div className="input-group-addon"&gt;$&lt;/div&gt;&lt;input type="text" className="form-control" name="amount" value={this.state.item.amount} placeholder="Amount" onChange={this._updateState.bind(this)} /&gt;&lt;/div&gt;    &lt;button type="submit" className="btn btn-primary add"&gt;Add&lt;/button&gt;&lt;/form&gt;&lt;/div&gt;)}}export default AddNewItem;</pre><p>Компонент связывает некоторую логику обновления состояния при обновлении полей формы, а также некоторую базовую проверку. Давайте закончим настройку компонентов, создав последний в файле <code class="inline">js/components/ItemsList.js</code> для списка элементов, используя этот код:</p><pre class="brush: javascript noskimlinks noskimwords">import React from "react";class ItemsList extends React.Component {    constructor(props) {super(props);this.state = {items: []};}render() {let noItemsMessage;// Show a friendly message instead if there are no items.if (!this.state.items.length) {noItemsMessage = (&lt;li className="no-items"&gt;Your wallet is new!&lt;/li&gt;);}return (&lt;ul className="items-list"&gt;{noItemsMessage}{this.state.items.map((itemDetails) =&gt; {let amountType = parseFloat(itemDetails.amount) &gt; 0 ? "positive" : "negative";return (&lt;li key={itemDetails.id}&gt;{itemDetails.description} &lt;span className={amountType}&gt;{itemDetails.amount}&lt;/span&gt;&lt;/li&gt;);})}&lt;/ul&gt;);}}export default ItemsList;</pre><p>Готово! Вы закончили настройку компонентов проекта. Большая часть состоит в том, что они также поставляются со свободным стилем.</p><p>Выполните <code class="inline">yarn start</code> и дождитесь, пока бандл не будет создан. Если вы откроете свой браузер на <code class="inline">localhost:8080</code>, вы увидите приложение без каких-либо функций.<br></p><p>Далее мы расскажем о том, что такое Flux, и как вы можете использовать его для добавления новых возможностей в свое приложение виртуального кошелька.<br></p><h2>Строительные блоки Flux<br></h2><p>На высоком уровне Flux разбивается на четыре основные части: действия, диспетчер, хранилища и отображения:<br></p><ul><li> <strong>Действия</strong> описывают действие, которое происходит в приложении.</li> <li> <strong>Диспетчер</strong> - это однопользовательский реестр обратных вызовов. Он действует как посредник, передавая действия всем хранилищам, которые подписались на него.<br></li> <li> <strong>Хранилища</strong> управляют состоянием и логикой, необходимой для его обновления для определенных частей приложения.<br></li> <li> Представления - это простые старые компоненты React.</li> </ul><p>В Flux все данные передаются в одном направлении:</p><ul><li> <strong>Действия</strong> передаются <strong>диспетчеру</strong>, удобные классы, называемые <strong>создателями действий</strong>.</li> <li> <strong>Диспетчер</strong> <em>отправляет</em> действия всем <strong>хранилищам</strong>, которые подписались на него.<br></li> <li>Наконец, если <strong>хранилища</strong> имеют отношение к конкретному действию, которое было получено, они обновляют свое состояние и сигнализируют <strong>представления</strong>, чтобы они могли перерисоваться.<br></li> </ul><p>Ниже представлено визуальное представление этого процесса.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1750/posts/28906/image/1-flux-unidirectional-data-flow.png" alt="Изучаем архитектуру Flux в React..." title="Изучаем архитектуру Flux в React..." width="50" height="50"></figure><h2>Действия</h2><p>Данные отправляются «по проводам» в одном направлении с использованием обычных объектов JavaScript, называемых действиями. Их задача - описать событие, которое имело место в приложении, и переносить новые данные в хранилища. Каждое действие должно иметь тип и необязательный ключ пейлоада, содержащий данные. Действие похоже на приведенное ниже:</p><pre class="brush: javascript noskimlinks noskimwords">{    actionType: "UPDATE_TITLE",payload: "This is a new title."}</pre><p>Тип действия должен быть представлен описательной и последовательной строкой в верхнем регистре, аналогичной общему соглашению определяющих констант. Они служат уникальными идентификаторами, которые хранилища будут использовать для определения действия и соответствующего ответа.</p><p>Общей практикой является определение всех типов действий в объекте констант и ссылка на этот объект вместо приложения для обеспечения согласованности. Наш виртуальный кошелек будет поддерживать только одно действие, которое добавляет элементы в список - как расходы, так и финансовые выгоды будут рассматриваться как один элемент, поэтому наш файл констант будет очень простым.<br></p><p>Создайте файл <code class="inline">index.js</code> в папке j<code class="inline">s/constants</code> и используйте следующий код для создания первого типа действия:</p><pre class="brush: javascript noskimlinks noskimwords">export default {    ADD_NEW_ITEM: "ADD_NEW_ITEM"}</pre><p>Действия передаются диспетчеру с помощью удобных классов-помощников, называемых <strong>создателями действий</strong>, которые обрабатывают простую задачу создания и отправки действия диспетчеру. Прежде чем создать создателя действия, давайте посмотрим, что делает диспетчер, и поймем его роль в архитектуре Flux.</p><h2>Диспетчер</h2><p>Диспетчер используется для координации связи между создателями действий и хранилищами. Вы можете использовать его для регистрации обратного вызова обработчика действий хранилища, а также для отправки действий в хранилища, которые подписались.</p><p>API-интерфейс диспетчера прост и в нем доступно всего пять методов:<br></p><ul><li> <code class="inline">register()</code>: регистрирует обратный вызов обработчика действия хранилища.</li> <li> <code class="inline">unregister()</code>: Отменить регистрацию обратного вызова у хранилища.<br></li> <li> <code class="inline">waitFor()</code>: Ожидает, что указанный обратный вызов (ы) запускается первым.<br></li> <li> <code class="inline">dispatch()</code>: Выполняет действие.<br></li> <li> <code class="inline">isDispatching()</code>: Проверяет, отправляет ли диспетчер какое-либо действие.<br></li> </ul><p>Наиболее важными являются <code class="inline">register()</code> и <code class="inline">dispatch()</code>, поскольку они используются для обработки большинства основных функций. Посмотрим, как они выглядят и что на самом деле происходит за кулисами.</p><pre class="brush: javascript noskimlinks noskimwords">let _callbacks = [];class Dispatcher {    // Register a store callback.register(callback) {let id = "callback_" + _callbacks.length;_callbacks[id] = callback;return id;}// Dispatch an action.dispatch(action) {for (var id in _callbacks) {_callbacks[id](action);}}}</pre><p>Метод <code class="inline">register(</code>) сохраняет все обратные вызовы в приватном массиве <code class="inline">_callbacks</code>, а <code class="inline">dispatch()</code> выполняет итерацию и вызывает каждый обратный вызов, сохраненный для принятого действия.</p><p>Для простоты мы не будем писать собственный диспетчер. Вместо этого мы будем использовать тот, который предоставляется в библиотеке от Facebook. Я рекомендую вам посмотреть репозиторий GitHub Facebook и посмотреть, как он реализован.</p><p>Внутри папки <code class="inline">js/dispatcher</code> создайте новый файл <code class="inline">index.js</code> и добавьте в него этот фрагмент кода:</p><pre class="brush: javascript noskimlinks noskimwords">import { Dispatcher } from "flux";export default new Dispatcher();</pre><p>Он импортирует диспетчера из библиотеки <code class="inline">flux</code>, которая была установлена раньше с помощью yarn , а затем экспортирует новый экземпляр.</p><p>Теперь, имея диспетчера, мы можем вернуться к действиям и настроить создателя действия нашего приложения. Внутри папки <code class="inline">js/actions</code> создайте новый файл <code class="inline">walletActions.js</code> и добавьте следующий код:</p><pre class="brush: javascript noskimlinks noskimwords">import Dispatcher from "../dispatcher";import ActionTypes from "../constants";class WalletActions {    addNewItem(item) {// Note: This is usually a good place to do API calls.Dispatcher.dispatch({actionType: ActionTypes.ADD_NEW_ITEM,payload: item });}}export default new WalletActions();</pre><p>Класс <code class="inline">WalletActions</code> предоставляет метод <code class="inline">addNewItem()</code>, который обрабатывает три основные задачи:</p><ul><li>Он получает <code class="inline">item</code> в качестве аргумента.</li> <li>Он использует диспетчера для отправки действия с типом действия <code class="inline">ADD_NEW_ITEM</code>, который мы уже создали ранее.<br></li> <li>Затем он отправляет полученный <code class="inline">item</code> в качестве пейлоада вместе с типом действия.<br></li> </ul><p>Прежде чем использовать этот создатель действия, давайте посмотрим, что такое хранилища и как они вписываются в наше Flux-приложение.<br></p><h2>Хранилища</h2><p>Я знаю, я сказал, что вы не должны сравнивать Flux с другими шаблонами, но хранилища Flux похожи на модели в MVC. Их роль заключается в обработке логики и хранении состояния для определенного компонента верхнего уровня в вашем приложении.<br></p><p>Все хранилища Flux должны определить метод обработчика действий, который затем будет зарегистрирован диспетчером. Эта функция обратного вызова в основном состоит из оператора switch для полученного типа действия. Если выполняется конкретный тип действия, он действует соответствующим образом и обновляет локальное состояние. Наконец, хранилище передает событие, чтобы сигнализировать представления об обновленном состоянии, чтобы они могли соответствующим образом его обновлять.<br></p><p>Чтобы транслировать события, хранилища должны расширять логику эмиттера событий. Существуют различные библиотеки эмиттеров событий, но наиболее распространенным решением является использование эмиттера событий Node. Для простого приложения, такого как виртуальный кошелек, нет необходимости в более чем одном хранилище.<br></p><p>Внутри папки <code class="inline">js/stores</code> создайте новый файл <code class="inline">walletStore.js</code> и добавьте следующий код для хранилища:</p><pre class="brush: javascript noskimlinks noskimwords">import { EventEmitter } from "events";import Dispatcher from "../dispatcher";import ActionTypes from "../constants";const CHANGE = "CHANGE";let _walletState = [];class WalletStore extends EventEmitter {    constructor() {super();// Registers action handler with the Dispatcher.Dispatcher.register(this._registerToActions.bind(this));}// Switches over the action"s type when an action is dispatched._registerToActions(action) {switch(action.actionType) {case ActionTypes.ADD_NEW_ITEM:this._addNewItem(action.payload);break;}}// Adds a new item to the list and emits a CHANGED event. _addNewItem(item) {item.id = _walletState.length;_walletState.push(item);this.emit(CHANGE);}// Returns the current store"s state.getAllItems() {return _walletState;}// Calculate the total budget.getTotalBudget() {let totalBudget = 0;_walletState.forEach((item) =&gt; {totalBudget += parseFloat(item.amount);});return totalBudget;}// Hooks a React component"s callback to the CHANGED event.addChangeListener(callback) {this.on(CHANGE, callback);}// Removes the listener from the CHANGED event.removeChangeListener(callback) {this.removeListener(CHANGE, callback);}}export default new WalletStore();</pre><p>Мы начинаем с импорта необходимых зависимостей, необходимых для хранилища, начиная с емиттера события Node, диспетчера, за которым следуют ActionTypes. Вы заметите, что под ними есть константа <code class="inline">CHANGE</code>, похожая на типы действий, о которых вы узнали ранее. </p><p>На самом деле это не одно и тоже, и их не следует путать. Это константа, используемая для триггера события, когда данные хранилища изменяются. Мы сохраним ее в этом файле, поскольку это не значение не используется в других частях приложения.</p><p>При инициализации класс <code class="inline">WalletStore</code> начинается с регистрации обратного вызова <code class="inline">_registerToAction()</code> в диспетчере. За кулисами этот обратный вызов будет добавлен в массив <code class="inline">_callbacks</code> диспетчера. </p><p>Метод имеет один оператор <code class="inline">switch</code> над типом действия, полученным от диспетчера при отправке действия. Если он соответствует типу действия <code class="inline">ADD_NEW_ITEM</code>, то затем запускается метод <code class="inline">_addNewItem()</code> и ему передается полученный пейлоад.</p><p>Функция <code class="inline">_addNewItem()</code> устанавливает <code class="inline">id</code> для элемента, добавляет его к списку существующих элементов и затем запускает событие <code class="inline">CHANGE</code>. Далее методы <code class="inline">getAllItems()</code> и <code class="inline">getTotalBudget()</code> являются базовыми геттерами, которые мы будем использовать для извлечения состояния текущего хранилища и общего бюджета.</p><p>Последние два метода <code class="inline">addChangeListener()</code> и <code class="inline">removeChangeListener()</code> будут использоваться для связывания компонентов React с <code class="inline">WalletStore</code>, чтобы они получали уведомление при изменении данных хранилища.<br></p><h2>Представления контроллеров</h2><p>Использование React позволяет разбить части приложения на различные компоненты. Мы можем их встраивать и построить интересные иерархии, которые формируют рабочие элементы на нашей странице.</p><p>В Flux компоненты, расположенные в верхней части цепочки, имеют тенденцию хранить большую часть логики, необходимой для создания действий и получения новых данных; Поэтому они называются представлениями контроллера. Эти представления напрямую подключаются к хранилищам и прослушивают события изменений, вызванные при обновлении хранилищ.<br></p><p>Когда это происходит, просмотры контроллера вызывают метод <code class="inline">setState</code>, который запускает метод <code class="inline">render()</code> для запуска и обновления представления и отправки данных дочерним компонентам через props. Затем React и Virtual DOM делают свою магию и максимально обновляют DOM.<br></p><p>Наше приложение достаточно простое и не соблюдает это правило. Однако в зависимости от сложности более крупные приложения иногда могут потребовать несколько представлений контроллера с вложенными подкомпонентами для основных частей приложения.<br></p><h2>Соберем все вместе</h2><p>Мы закончили рассмотрение основных частей Flux, но приложение виртуального кошелька еще не завершено. В этом последнем разделе мы рассмотрим весь поток от действий к представлениям и добавим недостающий код, необходимый для завершения однонаправленного потока данных Flux.<br></p><h3>Отправка действия</h3><p>Возвращаясь к компоненту <code class="inline">&lt;AddNewItem/&gt;</code>, теперь вы можете включить модуль <code class="inline">WalletActions</code> и использовать его для генерации нового действия в методе <code class="inline">_addNewItem()</code>.</p><pre class="brush: javascript noskimlinks noskimwords">import React from "react";import WalletActions from "../actions/walletActions";// …_addNewItem(event) {    event.preventDefault();this.state.item.description = this.state.item.description || "-";this.state.item.amount = this.state.item.amount || "0";WalletActions.addNewItem(this.state.item);this.setState({ item : this._getFreshItem() });}// ...</pre><p>Теперь, когда форма отправлена, отправляется действие, и все хранилища - в нашем случае - уведомляются о новых данных.</p><h3>Прослушивание изменений в хранилище</h3><p>В вашем <code class="inline">WalletStore</code>, в настоящий момент, когда элемент добавляется в список, его состояние изменяется, а событие <code class="inline">CHANGE</code> запускается, но его пока что еще никто не слушает. Давайте закроем цикл, добавив слушателя изменений внутри компонента <code class="inline">&lt;ItemsList/&gt;</code>.</p><pre class="brush: javascript noskimlinks noskimwords">import React from "react";import WalletStore from "../stores/walletStore";class ItemsList extends React.Component {    constructor(props) {super(props);this.state = {items: WalletStore.getAllItems()    };        this._onChange = this._onChange.bind(this);}_onChange() {this.setState({ items: WalletStore.getAllItems() });}componentWillMount() {WalletStore.addChangeListener(this._onChange);}componentWillUnmount() {WalletStore.removeChangeListener(this._onChange);}render() {        // ...    }}export default ItemsList;</pre><p>Обновленный компонент закрывает поток однонаправленных потоков Flux. Обратите внимание, что я пропустил включение метода <code class="inline">render()</code>, чтобы сохранить немного места. Давайте пройдем все шаг за шагом:</p><ul><li>Вверху включается модуль <code class="inline">WalletStore</code>.</li> <li>Исходное состояние обновляется, чтобы вместо этого использовать состояние хранилища.</li> <li>Новый метод <code class="inline">_onChange()</code> используется для обновления состояния новыми данными из хранилища.</li> <li>Используя хуки жизненного цикла React, обратный вызов <code class="inline">_onChange()</code> добавляется и удаляется в качестве обратного вызова прослушивателя изменений в хранилище.</li> </ul><h2>Заключение</h2><p>Мои поздравления! Вы закончили создание рабочего приложения для виртуального кошелька на базе Flux. Вы узнали, как все компоненты Flux взаимодействуют друг с другом и как вы можете использовать эту структуру для создания своих собственных приложений. <br></p><p>Когда вы почувствуете уверенность в своих навыках Flux, убедитесь, что вы также ознакомились и с другими реализациями Flux, такими как <span>Alt</span>, <span>Delorean</span>, <span>Flummox</span> или <span>Fluxxor</span> и посмотрите, какой из них вам больше подходит.<br></p><p>Дайте мне знать ваши мысли в комментариях ниже, я хотел бы узнать, что вы думаете о Flux или помочь, если у вас возникли трудности после этого учебника. Если вы хотите, вы также можете связаться со мной в Twitter <span>@hiskio</span>.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="React" href="https://norma-studio.github.io/article/220824926-izuchaem-arhitekturu-flux-v-react" class="tm-article-body__tags-item-link">React</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
34520</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
422</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
