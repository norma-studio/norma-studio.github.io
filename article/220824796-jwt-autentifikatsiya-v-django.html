
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="JWT - это закодированная строка JSON, которая передается в заголовках для аутентификации запросов. Обычно она создается путем хэширования данных JSON с помощью секретного ключа. Это означает, что серверу не нужно каждый раз запрашивать базу данных, чтобы получить пользователя, связанного с данным токеном....">
<meta property="og:description" content="JWT - это закодированная строка JSON, которая передается в заголовках для аутентификации запросов. Обычно она создается путем хэширования данных JSON с помощью секретного ключа. Это означает, что серверу не нужно каждый раз запрашивать базу данных, чтобы получить пользователя, связанного с данным токеном....">
<meta name="twitter:description" content="JWT - это закодированная строка JSON, которая передается в заголовках для аутентификации запросов. Обычно она создается путем хэширования данных JSON с помощью секретного ключа. Это означает, что серверу не нужно каждый раз запрашивать базу данных, чтобы получить пользователя, связанного с данным токеном....">
<meta property="aiturec:description" content="JWT - это закодированная строка JSON, которая передается в заголовках для аутентификации запросов. Обычно она создается путем хэширования данных JSON с помощью секретного ключа. Это означает, что серверу не нужно каждый раз запрашивать базу данных, чтобы получить пользователя, связанного с данным токеном....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/jwt-diagram.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/jwt-diagram.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/jwt-diagram.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/jwt-diagram.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/jwt-diagram.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html" title="JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io" title="JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533jghfdd.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html" class="tm-user-info__username" title="
Д. Слесарев" aria-label="
Д. Слесарев">
Д. Слесарев</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>JWT-Аутентификация в Django...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Python" href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django" class="tm-article-snippet__hubs-item-link"><span>Python</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/jwt-diagram.png">
    <meta itemprop="headline name" content="JWT-Аутентификация в Django... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="JWT - это закодированная строка JSON, которая передается в заголовках для аутентификации запросов. Обычно она создается путем хэширования данных JSON с помощью секретного ключа. Это означает, что серверу не нужно каждый раз запрашивать базу данных, чтобы получить пользователя, связанного с данным токеном....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">JWT - это закодированная строка JSON, которая передается в заголовках для аутентификации запросов. Обычно она создается путем хэширования данных JSON с помощью секретного ключа. Это означает, что серверу не нужно каждый раз запрашивать базу данных, чтобы получить пользователя, связанного с данным токеном....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этой статье содержится введение в JSON Web Tokens (JWT) и руководство как реализовать JWT-аутентификацию в Django.<br></p><h2>Что такое JWT?</h2><p>JWT - это закодированная строка JSON, которая передается в заголовках для аутентификации запросов. Обычно она создается путем хэширования данных JSON с помощью секретного ключа. Это означает, что серверу не нужно каждый раз запрашивать базу данных, чтобы получить пользователя, связанного с данным токеном.</p> <h2>Как работают веб-маркеры JSON</h2><p>Когда пользователь успешно выполняет вход в систему с использованием своих учетных данных, создается пользовательский токен JSON и сохраняется в локальном хранилище. Всякий раз, когда пользователь хочет получить доступ к защищенному URL-адресу, токен отправляется в заголовке запроса. Затем сервер проверяет правильность JWT в заголовке авторизации, и если он валидный, пользователю будет разрешен доступ.</p> <p>Содержимое заголовка обычно выглядит так:</p> <p><code class="inline">Authorization: Bearer eyJhbGciOiJIUzI1NiIsI <br></code></p><p>Ниже приведена диаграмма, показывающая этот процесс:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/jwt-diagram.png" alt="JWT Аутентификация в Django..." title="JWT Аутентификация в Django..." width="50" height="50"></figure><h2>Концепция аутентификации и авторизации</h2> <p>Аутентификация - это процесс идентификации зарегистрированного пользователя, а авторизация - это процесс определения того, имеет ли определенный пользователь право доступа к веб-ресурсу.</p><h2>Пример API</h2><p>В этом учебном пособии мы собираемся создать простую систему аутентификации пользователей в Django, используя JWT в качестве механизма аутентификации.</p> <h3>Требования</h3><ul><li>Джанго</li> <li>Python</li> </ul><p>Давайте начнем.</p><p>Создайте каталог, в котором вы будете содержать свой проект, а также виртуальную среду для установки зависимостей проекта.</p><pre class="brush: bash noskimlinks noskimwords">mkdir myprojectscd myprojectsvirtual venv</pre><p>Активируйте виртуальную среду:<br></p><pre class="brush: bash noskimlinks noskimwords">source venv/bin/activate</pre><p>Создайте проект Django.</p><pre class="brush: bash noskimlinks noskimwords">django-admin startproject django_auth</pre><p>Установите DRF и django-rest-framework-jwt, используя pip. <br></p><pre class="brush: bash noskimlinks noskimwords">pip install djangorestframeworkpip install djangorestframework-jwtpip install django</pre><p>Давайте продолжим и добавим DRF в список установленных приложений в файле <code class="inline">settings.py</code>.</p><h3>Настройка параметров JWT</h3> <p>Чтобы использовать JWT, нам нужно настроить разрешения django-rest-framework для принятия JSON Web Tokens.</p> <p>В файле <code class="inline">settings.py</code> добавьте следующие конфигурации:</p><pre class="brush: python noskimlinks noskimwords">REST_FRAMEWORK = {  "DEFAULT_AUTHENTICATION_CLASSES": (    "rest_framework_jwt.authentication.JSONWebTokenAuthentication",  ),}</pre> <p>Создайте новое приложение users, которое будет обрабатывать аутентификацию и управление пользователями.</p><pre class="brush: python noskimlinks noskimwords">cd django-authdjango-admin.py startapp users </pre> <p>Добавьте приложение users в список установленных приложений в файле <code class="inline">settings.py</code>.</p><h3>Настройка базы данных</h3> <p>Мы собираемся использовать базу данных PostgreSQL, потому что она более стабильна и надежна.</p><p>Создайте базу данных <code class="inline">auth</code> и назначьте пользователя.</p><p>Перейдите на учетную запись Postgres на вашем компьютере, набрав:</p> <pre class="brush: bash noskimlinks noskimwords">sudo su postgres</pre> <p>Зайдите в оболочку Postgres и создайте базу данных:</p><pre class="brush: bash noskimlinks noskimwords">psqlpostgres=# CREATE DATABASE auth;</pre><p>Создайте роль:</p><pre class="brush: bash noskimlinks noskimwords">postgres=# CREATE ROLE django_auth WITH LOGIN PASSWORD "asdfgh"; </pre><p>Предоставьте доступ к базе данных для пользователя:</p> <pre class="brush: bash noskimlinks noskimwords">postgres=# GRANT ALL PRIVILEGES ON DATABASE auth TO django_auth;</pre> <p>Установите пакет psycopg2, который позволит нам использовать настроенную нами базу данных:</p><pre class="brush: bash noskimlinks noskimwords">pip install psycopg2</pre> <p>Отредактируйте текущую базу данных SQLite и используйте базу данных Postgres.</p><pre class="brush: bash noskimlinks noskimwords">DATABASES = {    "default": {        "ENGINE": "django.db.backends.postgresql_psycopg2",        "NAME": "auth",        "USER": "django_auth",        "PASSWORD": "asdfgh",        "HOST": "localhost",        "PORT": "",    }}</pre> <h3>Создание моделей</h3> <p>Django поставляется со встроенной системой аутентификации, которая очень сложна, но иногда нам нужно внести коррективы, и, следовательно, нам нужно создать собственную систему аутентификации пользователей. Наша модель пользователя будет наследоваться от класса <code class="inline">AbstractBaseUser</code>, предоставляемого <code class="inline">django.contrib.auth.models</code>.</p> <p>В users/models.py мы начинаем с создания модели User для хранения деталей пользователя.</p><pre class="brush: python noskimlinks noskimwords"># users/models.pyfrom __future__ import unicode_literalsfrom django.db import modelsfrom django.utils import timezonefrom django.contrib.auth.models import (    AbstractBaseUser, PermissionsMixin)class User(AbstractBaseUser, PermissionsMixin):    """    An abstract base class implementing a fully featured User model with    admin-compliant permissions.    """    email = models.EmailField(max_length=40, unique=True)    first_name = models.CharField(max_length=30, blank=True)    last_name = models.CharField(max_length=30, blank=True)    is_active = models.BooleanField(default=True)    is_staff = models.BooleanField(default=False)    date_joined = models.DateTimeField(default=timezone.now)    objects = UserManager()    USERNAME_FIELD = "email"    REQUIRED_FIELDS = ["first_name", "last_name"]    def save(self, *args, **kwargs):        super(User, self).save(*args, **kwargs)        return self</pre> <p><code class="inline">REQUIRED_FIELDS</code> содержит все обязательные поля в вашей модели пользователя, кроме поля имени пользователя и пароля, поскольку эти поля всегда будут запрашиваться. <br></p><p><code class="inline">UserManager</code> - это класс, определяющий методы <code class="inline">create_user</code> и <code class="inline">createuperuser</code>. Этот класс должен предшествовать классу <code class="inline">AbstractBaseUser</code>, который мы определили выше. Давайте продолжим и определим это.</p><pre class="brush: python noskimlinks noskimwords">from django.contrib.auth.models import (    AbstractBaseUser, PermissionsMixin, BaseUserManager)class UserManager(BaseUserManager):    def _create_user(self, email, password, **extra_fields):        """        Creates and saves a User with the given email,and password.        """        if not email:            raise ValueError("The given email must be set")        try:            with transaction.atomic():                user = self.model(email=email, **extra_fields)                user.set_password(password)                user.save(using=self._db)                return user        except:            raise    def create_user(self, email, password=None, **extra_fields):        extra_fields.setdefault("is_staff", False)        extra_fields.setdefault("is_superuser", False)        return self._create_user(email, password, **extra_fields)    def create_superuser(self, email, password, **extra_fields):        extra_fields.setdefault("is_staff", True)        extra_fields.setdefault("is_superuser", True)        return self._create_user(email, password=password, **extra_fields)</pre> <h4>Миграции</h4> <p>Миграции предоставляют способ обновления вашей схемы базы данных каждый раз, когда ваши модели меняются, не теряя при этом данные.</p> <p>Создайте первоначальную миграцию для модели наших пользователей и выполните синхронизацию базы данных. <br></p><pre class="brush: bash noskimlinks noskimwords">python manage.py make migrations userspython manage.py migrate</pre><h4>Создание суперпользователя</h4><p>Создайте суперпользователя, выполнив следующую команду:</p> <pre class="brush: bash noskimlinks noskimwords">python manage.py createsuperuser</pre><h3>Создание новых пользователей</h3> <p>Давайте создадим ендпоинт, чтобы разрешить регистрацию новых пользователей. Мы начнем с сериализации полей модели пользователя. Сериализаторы предоставляют способ изменения данных в форме, которую легче понять, например, JSON или XML. Десериализация делает обратное, преобразуя данные в форму, которая может быть сохранена в базе данных.</p> <p>Создайте users/serializers.py и добавьте следующий код.</p><pre class="brush: python noskimlinks noskimwords"># users/serializers.pyfrom rest_framework import serializersfrom.models import Userclass UserSerializer(serializers.ModelSerializer):    date_joined = serializers.ReadOnlyField()    class Meta(object):        model = User        fields = ("id", "email", "first_name", "last_name",                  "date_joined", "password")        extra_kwargs = {"password": {"write_only": True}}</pre> <h4>CreateUserAPIView</h4> <p>Затем мы хотим создать представление, чтобы у клиента был URL-адрес для создания новых пользователей.</p> <p>В user.views.py добавьте следующее:</p><pre class="brush: python noskimlinks noskimwords"># users/views.pyclass CreateUserAPIView(APIView):    # Allow any user (authenticated or not) to access this url     permission_classes = (AllowAny,)    def post(self, request):        user = request.data        serializer = UserSerializer(data=user)        serializer.is_valid(raise_exception=True)        serializer.save()        return Response(serializer.data, status=status.HTTP_201_CREATED)</pre> <p>Мы устанавливаем <code class="inline">allow_classes</code> в <code class="inline">(AllowAny,)</code>, чтобы разрешить любому пользователю (прошедшему проверку подлинности или нет) доступ к этому URL-адресу.</p> <h4>Настройка URL-адресов</h4> <p>Создайте файл <code class="inline">users/urls.py</code> и добавьте URL-адрес в соответствие с созданным нами представлением. Также добавьте следующий код.</p><pre class="brush: python noskimlinks noskimwords"># users/urls.pyfrom django.conf.urls import url, patternsfrom .views import CreateUserAPIViewurlpatterns = [    url(r"^create/$", CreateUserAPIView.as_view()),]</pre> <p>Нам также нужно импортировать URL-адреса из приложения-пользователя в основной файл <code class="inline">django_auth/urls.py.</code> Так что делаем это и двигаемся дальше. Мы используем здесь функцию <code class="inline">include</code> , поэтому не забудьте ее импортировать.</p><pre class="brush: python noskimlinks noskimwords"># django_auth/urls.pyfrom django.conf.urls import url, includefrom django.contrib import adminurlpatterns = [    url(r"^admin/", admin.site.urls),    url(r"^user/", include("users.urls", namespace="users")),]</pre> <p>Теперь, когда мы закончили создание ендпоинта, давайте  протестируем его. Для тестов мы будем использовать Postman. Если вы не знакомы с Postman, это инструмент, который представляет дружественный графический интерфейс для построения запросов и чтения ответов.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/create.png" alt="JWT Аутентификация в Django..." title="JWT Аутентификация в Django..." width="50" height="50"></figure><p>Как вы можете видеть выше, ендпоинт работает так, как ожидалось.</p> <h3>Аутентификация пользователей</h3> <p>Мы будем использовать модуль Django-REST Framework JWT Python, который мы установили в начале этого руководства. Он добавляет поддержку JWT-аутентификации для приложений Django Rest Framework.</p> <p>Но сначала давайте определим некоторые параметры конфигурации для наших токенов и как они сгенерированы в файле settings.py.</p><pre class="brush: python noskimlinks noskimwords"># settings.pyimport datetimeJWT_AUTH = {    "JWT_VERIFY": True,    "JWT_VERIFY_EXPIRATION": True,    "JWT_EXPIRATION_DELTA": datetime.timedelta(seconds=3000),    "JWT_AUTH_HEADER_PREFIX": "Bearer",}</pre> <ul><li> <code class="inline">JWT_VERIFY</code>: он вызовет jwt.DecodeError, если секрет неправильный.</li> <li> <code class="inline">JWT_VERIFY_EXPIRATION</code>: Устанавливает истечение срока действия в True, то есть токены истекают через некоторое время. Время по умолчанию - пять минут.</li> <li> <code class="inline">JWT_AUTH_HEADER_PREFIX</code>: Префикс значения заголовка авторизации, который требуется отправить вместе с токеном. Мы установили его как <code class="inline">Bearer</code>, а по умолчанию - <code class="inline">JWT</code>.</li> </ul><p>В <code class="inline">users/views.py</code> добавьте следующий код.</p><pre class="brush: python noskimlinks noskimwords">@api_view(["POST"])@permission_classes([AllowAny, ])def authenticate_user(request):    try:        email = request.data["email"]        password = request.data["password"]        user = User.objects.get(email=email, password=password)        if user:            try:                payload = jwt_payload_handler(user)                token = jwt.encode(payload, settings.SECRET_KEY)                user_details = {}                user_details["name"] = "%s %s" % (                    user.first_name, user.last_name)                user_details["token"] = token                user_logged_in.send(sender=user.__class__,                                    request=request, user=user)                return Response(user_details, status=status.HTTP_200_OK)            except Exception as e:                raise e        else:            res = {                "error": "can not authenticate with the given credentials or the account has been deactivated"}            return Response(res, status=status.HTTP_403_FORBIDDEN)    except KeyError:        res = {"error": "please provide a email and a password"}        return Response(res)</pre> <p>В приведенном выше коде в окне входа в систему вводится имя пользователя и пароль, а затем создается токен с информацией пользователя, соответствующей переданным учетным данным, в качестве пейлоада и возвращается в браузер. Другие данные пользователя, такие как имя, также возвращаются в браузер вместе с токеном. Этот токен будет использоваться для аутентификации в будущих запросах.</p> <p>Классы разрешений устанавливаются в <code class="inline">allowAny</code>, поскольку любой пользователь может получить доступ к этому ендпоинту.</p> <p>Мы также сохраняем последнее время входа пользователя с этим кодом.</p><pre class="brush: python noskimlinks noskimwords">user_logged_in.send(sender=user.__class__,                                    request=request, user=user)</pre> <p>Каждый раз, когда пользователь хочет сделать запрос API, он должен отправить токен в заголовках Auth, чтобы аутентифицировать запрос.</p> <p>Давайте протестируем этот ендпоинт с помощью Postman. Откройте Postman и используйте запрос для аутентификации с одним из пользователей, которых вы создали ранее. Если попытка входа в систему выполнена успешно, ответ будет выглядеть следующим образом:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/token(1).png" alt="JWT Аутентификация в Django..." title="JWT Аутентификация в Django..." width="50" height="50"></figure><h4>Получение и обновление пользователей</h4><p>Пока пользователи могут зарегистрироваться и пройти проверку подлинности. Тем не менее, так же нужно предоставить способ получения и обновления этой информации. Давайте реализуем это.</p> <p>В файле <code class="inline">user.views.py</code> добавьте следующий код.</p><pre class="brush: python noskimlinks noskimwords">class UserRetrieveUpdateAPIView(RetrieveUpdateAPIView):    # Allow only authenticated users to access this url    permission_classes = (IsAuthenticated,)    serializer_class = UserSerializer    def get(self, request, *args, **kwargs):        # serializer to handle turning our `User` object into something that        # can be JSONified and sent to the client.        serializer = self.serializer_class(request.user)        return Response(serializer.data, status=status.HTTP_200_OK)    def put(self, request, *args, **kwargs):        serializer_data = request.data.get("user", {})        serializer = UserSerializer(            request.user, data=serializer_data, partial=True        )        serializer.is_valid(raise_exception=True)        serializer.save()        return Response(serializer.data, status=status.HTTP_200_OK)</pre> <p>Сначала мы определяем классы разрешений и устанавливаем <code class="inline">IsAuthenticated</code>, так как это защищенный URL-адрес, и к нему могут обращаться только прошедшие проверку подлинности пользователи. </p><p>Затем мы определяем метод <code class="inline">get</code> для получения сведений о пользователе. После получения сведений о пользователе аутентифицированный пользователь затем по желанию обновит свои данные.<br></p> <p>Обновите URL-адреса, чтобы определить ендпоинт следующим образом.</p><pre class="brush: python noskimlinks noskimwords">users/urls.pyfrom .views import CreateUserAPIView, UserRetrieveUpdateAPIViewurlpatterns = [        url(r"^update/$", UserRetrieveUpdateAPIView.as_view()),]</pre><p>Чтобы запрос был успешным, заголовки должны содержать  JWT токен, как показано ниже.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/update.png" alt="JWT Аутентификация в Django..." title="JWT Аутентификация в Django..." width="50" height="50"></figure><p>Если вы попытаетесь запросить ресурс без заголовка проверки подлинности, вы получите следующую ошибку.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/e1c6iexptiizbh3m0a2p_error.png" alt="JWT Аутентификация в Django..." title="JWT Аутентификация в Django..." width="50" height="50"></figure><p>Если пользователь не делает запросов дольше времени, указанного в <code class="inline">JWT_EXPIRATION_DELTA</code>, то токен истекает, и ему придется запросить другой токен. Это также показано ниже.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1885/posts/30460/image/expire.png" alt="JWT Аутентификация в Django..." title="JWT Аутентификация в Django..." width="50" height="50"></figure><h2>Заключение</h2> <p>В этом руководстве описано, что необходимо для успешного создания надежной системы аутентификации с помощью JSON Web Tokens.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Python" href="https://norma-studio.github.io/article/220824796-jwt-autentifikatsiya-v-django" class="tm-article-body__tags-item-link">Python</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
42017</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
713</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
