
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="JSON - один из самых популярных форматов сериализации. Он удобен для чтения, достаточно лаконичен и может быть легко проанализирован любым веб-приложением, использующим JavaScript. Go как современный язык программирования имеет первоклассную поддержку сериализации JSON в своей стандартной библиотеке. ...">
<meta property="og:description" content="JSON - один из самых популярных форматов сериализации. Он удобен для чтения, достаточно лаконичен и может быть легко проанализирован любым веб-приложением, использующим JavaScript. Go как современный язык программирования имеет первоклассную поддержку сериализации JSON в своей стандартной библиотеке. ...">
<meta name="twitter:description" content="JSON - один из самых популярных форматов сериализации. Он удобен для чтения, достаточно лаконичен и может быть легко проанализирован любым веб-приложением, использующим JavaScript. Go как современный язык программирования имеет первоклассную поддержку сериализации JSON в своей стандартной библиотеке. ...">
<meta property="aiturec:description" content="JSON - один из самых популярных форматов сериализации. Он удобен для чтения, достаточно лаконичен и может быть легко проанализирован любым веб-приложением, использующим JavaScript. Go как современный язык программирования имеет первоклассную поддержку сериализации JSON в своей стандартной библиотеке. ...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html" title="Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io" title="Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/e_09402063.jpg" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html" class="tm-user-info__username" title="
А. Карпов" aria-label="
А. Карпов">
А. Карпов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Сериализация JSON с Golang...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Go" href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang" class="tm-article-snippet__hubs-item-link"><span>Go</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
    <meta itemprop="headline name" content="Сериализация JSON с Golang... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="JSON - один из самых популярных форматов сериализации. Он удобен для чтения, достаточно лаконичен и может быть легко проанализирован любым веб-приложением, использующим JavaScript. Go как современный язык программирования имеет первоклассную поддержку сериализации JSON в своей стандартной библиотеке. ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">JSON - один из самых популярных форматов сериализации. Он удобен для чтения, достаточно лаконичен и может быть легко проанализирован любым веб-приложением, использующим JavaScript. Go как современный язык программирования имеет первоклассную поддержку сериализации JSON в своей стандартной библиотеке. ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<h2>Обзор</h2><p>JSON - один из самых популярных форматов сериализации. Он удобен для чтения, достаточно лаконичен и может быть легко проанализирован любым веб-приложением, использующим JavaScript. Go как современный язык программирования имеет первоклассную поддержку сериализации JSON в своей стандартной библиотеке. </p><p>Но есть и укромные уголки. В этом руководстве вы узнаете, как эффективно сериализовать и десериализовать произвольные, а также структурированные данные в/из JSON. Вы также узнаете, как работать с расширенными сценариями, такими как перечисления сериализации.</p><h2>Пакет JSON</h2><p>Go поддерживает несколько форматов сериализации в пакете кодирования своей стандартной библиотеки. Одним из них является популярный формат JSON. Вы сериализуете значения Golang, используя функцию Marshal(), в кусочек байтов. Вы десериализуете часть байтов в значение Golang, используя функцию Unmarshal(). Это так просто. Следующие термины эквивалентны в контексте этой статьи:</p><ul><li>Сериализация/Кодирование/Маршалинг</li> <li>Десериализация/Декодирование/Демаршаллизация</li> </ul><p>Я предпочитаю сериализацию, потому что она отражает тот факт, что вы преобразуете потенциально иерархическую структуру данных в/из потока байтов.</p><h3>Marshal</h3><p>Функция Marshal() может принимать что угодно, что в Go означает пустой интерфейс и возвращает часть байтов и ошибку. Вот ее сигнатура:</p><p><code class="inline">func Marshal(v interface{}) ([]byte, error)</code></p><p>Если Marshal() не сможет сериализовать входное значение, она вернет ненулевую ошибку. У Marshal() есть некоторые строгие ограничения (позже мы увидим, как их преодолеть с помощью пользовательских маршаллеров):</p><ul><li>Ключи карты должны быть строками.</li> <li>Значения карты должны иметь типы, сериализуемые пакетом json.</li> <li>Следующие типы не поддерживаются: Channel, complex и function.</li> <li>Циклические структуры данных не поддерживаются.</li> <li>Указатели будут закодированы (и позже декодированы) как значения, на которые они указывают (или «null», если указатель равен нулю).</li> </ul><h3>Unmarshal</h3><p>Функция Unmarshal() принимает фрагмент байта, который, как мы надеемся, представляет действительный JSON, и целевой интерфейс, который обычно является указателем на структуру или базовый тип. Он десериализует JSON в интерфейс универсальным способом. Если сериализация не удалась, он вернет ошибку. Вот сигнатура:</p><p><code class="inline">func Unmarshal(data []byte, v interface{}) error</code></p><h2>Сериализация простых типов</h2><p>Вы можете легко сериализовать простые типы, например, используя пакет json. Результатом будет не полноценный объект JSON, а простая строка. Здесь int 5 сериализуется в байтовый массив [53], который соответствует строке «5».</p><pre class="brush: csharp noskimlinks noskimwords">    // Serialize int    var x = 5    bytes, err := json.Marshal(x)    if err != nil {        fmt.Println("Can"t serislize", x)    }    fmt.Printf("%v =&gt; %v, "%v"\n", x, bytes, string(bytes))    // Deserialize int    var r int    err = json.Unmarshal(bytes, &amp;r)    if err != nil {        fmt.Println("Can"t deserislize", bytes)    }    fmt.Printf("%v =&gt; %v\n", bytes, r)    Output:- 5 =&gt; [53], "5"- [53] =&gt; 5</pre><p>Если вы попытаетесь сериализовать неподдерживаемые типы, такие как функция, вы получите ошибку:</p><pre class="brush: csharp noskimlinks noskimwords">    // Trying to serialize a function    foo := func() {        fmt.Println("foo() here")    }    bytes, err = json.Marshal(foo)    if err != nil {        fmt.Println(err)    }Output:json: unsupported type: func()</pre><h2>Сериализация произвольных данных с помощью карт</h2><p>Сила JSON в том, что он может очень хорошо представлять произвольные иерархические данные. Пакет JSON поддерживает его и использует общий пустой интерфейс (interface {}) для представления любой иерархии JSON. Вот пример десериализации и последующей сериализации двоичного дерева, где каждый узел имеет значение int и две ветви, левую и правую, которые могут содержать другой узел или быть нулевыми. <br></p><p>JSON null эквивалентен Go nil. Как видно из выходных данных, функция <code class="inline">json.Unmarshal()</code> успешно преобразовала большой двоичный объект JSON в структуру данных Go, состоящую из вложенной карты интерфейсов, и сохранила тип значения как int. Функция <code class="inline">json.Marshal()</code> успешно сериализовала полученный вложенный объект в то же представление JSON.</p><pre class="brush: csharp noskimlinks noskimwords">    // Arbitrary nested JSON    dd := `    {        "value": 3,        "left": {            "value": 1,            "left": null,            "right": {                "value": 2,                "left": null,                "right": null            }        },        "right": {            "value": 4,            "left": null,            "right": null         }    }`    var obj interface{}    err = json.Unmarshal([]byte(dd), &amp;obj)    if err != nil {        fmt.Println(err)    } else {        fmt.Println("--------\n", obj)    }    data, err = json.Marshal(obj)    if err != nil {        fmt.Println(err)    } else {        fmt.Println("--------\n", string(data))    }}Output:-------- map[right:map[value:4                left:&lt;nil&gt;                right:&lt;nil&gt;]      value:3      left:map[left:&lt;nil&gt;               right:map[value:2                         left:&lt;nil&gt;                         right:&lt;nil&gt;]               value:1]]-------- {"left":{      "left":null,      "right":{"left":null,"right":null,"value":2},      "value":1},  "right":{"left":null,           "right":null,           "value":4},  "value":3}</pre><p>Чтобы пройти общие карты интерфейсов, вам нужно использовать утверждения типа. Например:</p><pre class="brush: csharp noskimlinks noskimwords">func dump(obj interface{}) error {    if obj == nil {        fmt.Println("nil")        return nil    }    switch obj.(type) {    case bool:        fmt.Println(obj.(bool))    case int:        fmt.Println(obj.(int))    case float64:        fmt.Println(obj.(float64))    case string:        fmt.Println(obj.(string))    case map[string]interface{}:        for k, v := range(obj.(map[string]interface{})) {            fmt.Printf("%s: ", k)            err := dump(v)            if err != nil {                return err            }        }    default:        return errors.New(            fmt.Sprintf("Unsupported type: %v", obj))    }    return nil}</pre><h2>Сериализация структурированных данных</h2><p>Работа со структурированными данными часто является лучшим выбором. Go предоставляет отличную поддержку для сериализации JSON в/из структур через его теги <code class="inline">struct</code>. Давайте создадим <code class="inline">struct</code>, которая соответствует нашему дереву JSON и более умной функции <code class="inline">Dump()</code>, которая ее печатает:</p><pre class="brush: csharp noskimlinks noskimwords">type Tree struct {    value int    left *Tree    right *Tree}func (t *Tree) Dump(indent string) {    fmt.Println(indent + "value:", t.value)    fmt.Print(indent + "left: ")    if t.left == nil {        fmt.Println(nil)    } else {        fmt.Println()        t.left.Dump(indent + "  ")    }    fmt.Print(indent + "right: ")    if t.right == nil {        fmt.Println(nil)    } else {        fmt.Println()        t.right.Dump(indent + "  ")    }}</pre><p>Это здорово и намного чище, чем произвольный подход JSON. Но работает ли это? На самом деле, нет. Там нет ошибки, но наш объект дерева не заполняется JSON.</p><pre class="brush: csharp noskimlinks noskimwords">    jsonTree := `    {        "value": 3,        "left": {            "value": 1,            "left": null,            "right": {                "value": 2,                "left": null,                "right": null            }        },        "right": {            "value": 4,            "left": null,            "right": null         }    }`    var tree Tree    err = json.Unmarshal([]byte(dd), &amp;tree)    if err != nil {        fmt.Printf("- Can"t deserislize tree, error: %v\n", err)    } else {        tree.Dump("")    }Output:value: 0left: &lt;nil&gt;right: &lt;nil&gt;</pre><p>Проблема в том, что поля дерева являются приватными. Сериализация JSON работает только для открытых полей. Таким образом, мы можем сделать поля структуры общедоступными. Пакет json достаточно умен, чтобы прозрачно преобразовать строчные буквы «value», «left» и «right» в соответствующие им имена полей верхнего регистра.</p><pre class="brush: csharp noskimlinks noskimwords">type Tree struct {    Value int   `json:"value"`    Left  *Tree `json:"left"`    Right *Tree `json:"right"`}Output:value: 3left:   value: 1  left: &lt;nil&gt;  right:     value: 2    left: &lt;nil&gt;    right: &lt;nil&gt;right:   value: 4  left: &lt;nil&gt;  right: &lt;nil&gt;</pre><p>Пакет json будет автоматически игнорировать не отображенные поля в JSON, а также приватные поля в вашей <code class="inline">struct</code>. Но иногда вам может потребоваться отобразить определенные ключи в JSON на поле с другим именем в вашей <code class="inline">struct</code>. Вы можете использовать теги <code class="inline">struct</code> для этого. Например, предположим, что мы добавили еще одно поле с именем «label» в JSON, но нам нужно сопоставить его с полем «Tag» в нашей структуре. </p><pre class="brush: csharp noskimlinks noskimwords">type Tree struct {    Value int    Tag string    `json:"label"`    Left  *Tree    Right *Tree}func (t *Tree) Dump(indent string) {    fmt.Println(indent + "value:", t.Value)    if t.Tag != "" {        fmt.Println(indent + "tag:", t.Tag)    }    fmt.Print(indent + "left: ")    if t.Left == nil {        fmt.Println(nil)    } else {        fmt.Println()        t.Left.Dump(indent + "  ")    }    fmt.Print(indent + "right: ")    if t.Right == nil {        fmt.Println(nil)    } else {        fmt.Println()        t.Right.Dump(indent + "  ")    }}</pre><p>Вот новый JSON с корневым узлом дерева, помеченным как «root», правильно сериализованный в поле Tag и напечатанный в выходных данных:</p><pre class="brush: csharp noskimlinks noskimwords">    dd := `    {        "label": "root",        "value": 3,        "left": {            "value": 1,            "left": null,            "right": {                "value": 2,                "left": null,                "right": null            }        },        "right": {            "value": 4,            "left": null,            "right": null         }    }`    var tree Tree    err = json.Unmarshal([]byte(dd), &amp;tree)    if err != nil {        fmt.Printf("- Can"t deserislize tree, error: %v\n", err)    } else {        tree.Dump("")    }Output:value: 3tag: rootleft:   value: 1  left: &lt;nil&gt;  right:     value: 2    left: &lt;nil&gt;    right: &lt;nil&gt;right:   value: 4  left: &lt;nil&gt;  right: &lt;nil&gt;</pre><h2>Написание обычного упаковщика</h2><p>Вы часто захотите сериализовать объекты, которые не соответствуют строгим требованиям функции Marshal(). Например, вы можете захотеть сериализовать карту с помощью ключей int. В этих случаях вы можете написать собственный упаковщик/распаковщик, реализовав интерфейсы <code class="inline">Marshaler</code> и <code class="inline">Unmarshaler</code>. <br></p><p>Примечание о правописании. В Go принято называть интерфейс одним методом, добавляя суффикс «er» к имени метода. Таким образом, несмотря на то, что более распространенным написанием является «Marshaller» (с двойным L), имя интерфейса - просто «Marshaler» (один L).</p><p>Вот интерфейсы Marshaler и Unmarshaler:</p><pre class="brush: csharp noskimlinks noskimwords">type Marshaler interface {        MarshalJSON() ([]byte, error)}type Unmarshaler interface {        UnmarshalJSON([]byte) error}</pre><p>Вы должны создать тип при выполнении пользовательской сериализации, даже если вы хотите сериализовать встроенный тип или композицию встроенных типов, таких как <code class="inline">map[int]string</code>. Здесь я определяю тип с именем <code class="inline">IntStringMap</code> и реализую интерфейсы <code class="inline">Marshaler</code> и <code class="inline">Unmarshaler</code> для этого типа.</p><p>Метод <code class="inline">MarshalJSON()</code> создает <code class="inline">map[string]string</code>, преобразует каждый из своих собственных ключей int в строку и сериализует карту со строковыми ключами, используя стандартную функцию <code class="inline">json.Marshal()</code>.</p><pre class="brush: csharp noskimlinks noskimwords">type IntStringMap map[int]stringfunc (m *IntStringMap) MarshalJSON() ([]byte, error) {    ss := map[string]string{}    for k, v := range *m {        i := strconv.Itoa(k)        ss[i] = v    }    return json.Marshal(ss)}</pre><p>Метод UnmarshalJSON() делает прямо противоположное. Он десериализует массив байтов данных в <code class="inline">map[string]string</code>, а затем преобразует каждый строковый ключ в int и заполняет сам себя.</p><pre class="brush: csharp noskimlinks noskimwords">func (m *IntStringMap) UnmarshalJSON(data []byte ) error {    ss := map[string]string{}    err := json.Unmarshal(data, &amp;ss)    if err != nil {        return err    }    for k, v := range ss {        i, err := strconv.Atoi(k)        if err != nil {            return err        }        (*m)[i] = v    }    return nil}</pre><p>Вот как это использовать в программе:</p><pre class="brush: csharp noskimlinks noskimwords">    m := IntStringMap{4: "four", 5: "five"}    data, err := m.MarshalJSON()    if err != nil {        fmt.Println(err)    }    fmt.Println("IntStringMap to JSON: ", string(data))    m = IntStringMap{}    jsonString := []byte("{\"1\": \"one\", \"2\": \"two\"}")    m.UnmarshalJSON(jsonString)    fmt.Printf("IntStringMap from JSON: %v\n", m)    fmt.Println("m[1]:", m[1], "m[2]:", m[2])Output:IntStringMap to JSON:  {"4":"four","5":"five"}IntStringMap from JSON: map[2:two 1:one]m[1]: one m[2]: two</pre><h2>Сериализация Enums</h2><p>Перечисления Go могут быть довольно неприятными для сериализации. Идея написать статью о сериализации Go json возникла из-за вопроса, который мне спросил коллега о том, как сериализовать перечисления. Вот <code class="inline">enum</code> Go. Константы Zero и One равны целым числам 0 и 1.</p><pre class="brush: csharp noskimlinks noskimwords">type EnumType intconst (    Zero     EnumType = iota    One)</pre><p>Хотя вы можете думать, что это int, и во многих отношениях это так, вы не можете сериализовать его напрямую. Вы должны написать собственный маршалер/демаршалер. Это не проблема после последнего раздела. Следующие <code class="inline">MarshalJSON()</code> и <code class="inline">UnmarshalJSON()</code> будут сериализовать/десериализовать константы ZERO и ONE в/из соответствующих строк «Zero» и «One».</p><pre class="brush: csharp noskimlinks noskimwords">func (e *EnumType) UnmarshalJSON(data []byte) error {    var s string    err := json.Unmarshal(data, &amp;s)    if err != nil {        return err    }    value, ok := map[string]EnumType{"Zero": Zero, "One": One}[s]    if !ok {        return errors.New("Invalid EnumType value")    }    *e = value    return nil}func (e *EnumType) MarshalJSON() ([]byte, error) {    value, ok := map[EnumType]string{Zero: "Zero", One:"One"}[*e]    if !ok {        return nil, errors.New("Invalid EnumType value")    }    return json.Marshal(value)}</pre><p>Давайте попробуем встроить этот <code class="inline">EnumType</code> в <code class="inline">struct</code> и сериализовать его. Основная функция создает <code class="inline">EnumContainer</code> и инициализирует его с именем «Uno» и значением нашей константы <code class="inline">enum</code> <code class="inline">ONE</code>, которая равна int 1.</p><pre class="brush: csharp noskimlinks noskimwords">type EnumContainer struct {    Name                string    Value               EnumType}func main() {    x := One    ec := EnumContainer{        "Uno",        x,    }    s, err := json.Marshal(ec)    if err != nil {        fmt.Printf("fail!")    }    var ec2 EnumContainer    err = json.Unmarshal(s, &amp;ec2)    fmt.Println(ec2.Name, ":", ec2.Value)}Output:Uno : 0</pre><p>Ожидаемый результат - «Uno: 1», но вместо этого «Uno: 0». Что случилось? В коде упаковщика/распаковщика нет ошибки. Оказывается, вы не можете встраивать перечисления по значению, если хотите их сериализовать. Вы должны вставить указатель на перечисление. Вот модифицированная версия, где она работает как положено:</p><pre class="brush: csharp noskimlinks noskimwords">type EnumContainer struct {    Name                string    Value               *EnumType}func main() {    x := One    ec := EnumContainer{        "Uno",        &amp;x,    }    s, err := json.Marshal(ec)    if err != nil {        fmt.Printf("fail!")    }    var ec2 EnumContainer    err = json.Unmarshal(s, &amp;ec2)    fmt.Println(ec2.Name, ":", *ec2.Value)}Output:Uno : 1</pre><h2>Заключение</h2><p>Go предоставляет много опций для сериализации и десериализации JSON. Важно понять все входы и выходы пакета encoding/json, чтобы воспользоваться преимуществами. <br></p><p>В этом уроке вы получите всю мощь, в том числе и сериализацию неуловимых перечислений Go. <br></p><p>Иди и сериализуй некоторые объекты!</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Go" href="https://norma-studio.github.io/article/220824809-serializatsiya-json-s-golang" class="tm-article-body__tags-item-link">Go</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
39175</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
340</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
