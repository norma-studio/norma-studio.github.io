
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Single-Page Applications (SPAs) (* одностраничные приложения. Здесь и далее примеч. пер.) работают благодаря визуализации шаблонов на клиентской стороне. Это придает быстродействие опыту взаимодействия пользователя с приложением. Недавно компания Google объявила, что они осуществляют веб-скрейпинг и исполняют код JavaScript так же, как бы это делал...">
<meta property="og:description" content="Single-Page Applications (SPAs) (* одностраничные приложения. Здесь и далее примеч. пер.) работают благодаря визуализации шаблонов на клиентской стороне. Это придает быстродействие опыту взаимодействия пользователя с приложением. Недавно компания Google объявила, что они осуществляют веб-скрейпинг и исполняют код JavaScript так же, как бы это делал...">
<meta name="twitter:description" content="Single-Page Applications (SPAs) (* одностраничные приложения. Здесь и далее примеч. пер.) работают благодаря визуализации шаблонов на клиентской стороне. Это придает быстродействие опыту взаимодействия пользователя с приложением. Недавно компания Google объявила, что они осуществляют веб-скрейпинг и исполняют код JavaScript так же, как бы это делал...">
<meta property="aiturec:description" content="Single-Page Applications (SPAs) (* одностраничные приложения. Здесь и далее примеч. пер.) работают благодаря визуализации шаблонов на клиентской стороне. Это придает быстродействие опыту взаимодействия пользователя с приложением. Недавно компания Google объявила, что они осуществляют веб-скрейпинг и исполняют код JavaScript так же, как бы это делал...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.44.43%20AM.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.44.43%20AM.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.44.43%20AM.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.44.43%20AM.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.44.43%20AM.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html" title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io" title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/e_09402063.jpg" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html" class="tm-user-info__username" title="
А. Карпов" aria-label="
А. Карпов">
А. Карпов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Single Page Web Apps" href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs" class="tm-article-snippet__hubs-item-link"><span>Single Page Web Apps</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.44.43%20AM.png">
    <meta itemprop="headline name" content="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Single-Page Applications (SPAs) (* одностраничные приложения. Здесь и далее примеч. пер.) работают благодаря визуализации шаблонов на клиентской стороне. Это придает быстродействие опыту взаимодействия пользователя с приложением. Недавно компания Google объявила, что они осуществляют веб-скрейпинг и исполняют код JavaScript так же, как бы это делал...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Single-Page Applications (SPAs) (* одностраничные приложения. Здесь и далее примеч. пер.) работают благодаря визуализации шаблонов на клиентской стороне. Это придает быстродействие опыту взаимодействия пользователя с приложением. Недавно компания Google объявила, что они осуществляют веб-скрейпинг и исполняют код JavaScript так же, как бы это делал...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Single-Page Applications (SPAs) (* одностраничные приложения. Здесь и далее примеч. пер.) работают благодаря визуализации шаблонов на клиентской стороне. Это придает быстродействие опыту взаимодействия пользователя с приложением. Недавно <span>компания Google объявила, что они осуществляют веб-скрейпинг</span> и <span>исполняют код JavaScript так же, как бы это делал обычный пользователь</span>. В результате чего веб-скрейпинг (* вытягивание веб-данных из веб-страниц) сайтов, работающих благодаря фреймворкам для создания одностраничных приложений (Angular, Ember и Vue и т.д.), <span>осуществляется без наказаний со стороны Google</span>.</p><p>Помимо поисковых роботов для видимости вашего сайта также необходимы и другие веб-пауки, а именно роботы для осуществления шаринга подробного контента в социальных сетях. Они полагаются на мета-теги и до сих пор не учитывают код JavaScript.</p> <p>В этом руководстве мы создадим дополнительный модуль для размещения маршрута и воспроизведения шаблона для вашего сервера Express и Node.js, который вы можете использовать с большинством фреймворков для создания одностраничных приложений. Благодаря этому модулю ваш сайт сможет предоставить пользователям возможность осуществления шаринга подробного контента в Twitter, Facebook и Pinterest.</p> <h2>Предупреждаю</h2> <p>В данном руководстве речь идет только о веб-роботах, которые извлекают информацию для добавления в социальные сети. <em>Не пробуйте использовать эти приемы для веб-пауков поисковых систем.</em> Компании поисковых систем могут серьезно отреагировать на подобное поведение и посчитать его <span>спамом или обманом</span>, в результате чего рейтинг вашего сайта может быстро понизиться.</p> <p>Подобным образом при шаринге подробного контента в социальных сетях убедитесь, что вы представляете контент таким образом, что то, что видит пользователь, совпадает с тем, что читает веб-робот. При невыполнении этого условия на ваше приложение могут быть наложены ограничения со стороны сайтов социальных сетей.</p> <h2>Шаринг подробного контента в социальных сетях</h2> <p>Если вы опубликуете новую статью в Facebook и добавите URL (* Uniform Resource Locator - унифицированный указатель [местонахождения информационного] ресурса), то веб-робот Facebook прочитает HTML-код и будет в нем искать мета-теги для протокола <span>OpenGraph</span>. Ниже представлен пример для главной страницы Envato Tuts+ :</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.44.43%20AM.png" alt="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." width="50" height="50"></figure><p>При просмотре HTML-кода мы видим в теге <code class="inline">head</code> соответствующие теги для создания этого превью:</p> <pre class="brush: html noskimlinks noskimwords">&lt;meta content="Envato Tuts+" property="og:title"&gt;&lt;meta content="Envato Tuts+ teaches creative and technical skills across many topics to millions of people worldwide. We offer tutorials, articles, news and insights that help you take your knowledge to the next level." property="og:description"&gt;&lt;meta content="http://static.tutsplus.com/assets/favicon-8b86ba48e7f31535461f183680fe2ac9.png" property="og:image"&gt;</pre> <p>Pinterest использует тот же протокол (<span>OpenGraph</span>), что и Facebook. Поэтому их механизмы для шаринга контента работают довольно сходным образом.</p> <p>В Twitter концепция шаринга контента имеет название "карточка", и в Twitter есть несколько ее различных реализаций в зависимости от способа представления вашего контента. Ниже приведен пример карточки Twitter из GitHub:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%207.52.24%20AM.png" alt="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." width="50" height="50"></figure><p>А вот HTML - код для ее создания:</p> <pre class="brush: html noskimlinks noskimwords">&lt;meta content="@github" name="twitter:site"&gt;&lt;meta content="summary" name="twitter:card"&gt;&lt;meta content="NodeRedis/node_redis" name="twitter:title"&gt;&lt;meta content="redis client for node. Contribute to node_redis development by creating an account on GitHub." name="twitter:description"&gt;&lt;meta content="https://avatars1.githubusercontent.com/u/5845577?v=3&amp;amp;s=400" name="twitter:image:src"&gt;</pre> <p><em>Примечание: GitHub использует прием, подобный тому, что описывается в данном руководстве. Имеется небольшое отличие кода HTML в теге, атрибут name которого имеет значение <code class="inline">twitter:description</code>. Мне необходимо изменить название агента пользователя, как показано позже в этом руководстве, чтобы получить соответствующий мета-тег.</em></p> <h2>Препятствия при воспроизведении контента на стороне клиента</h2> <p>Добавление мета-тегов не представляет трудностей, если вас устраивает добавление только одного заголовка, описания или изображения в социальных сетях для целого сайта. Просто впишите значения мета-тегов прямо в <code class="inline">head </code>вашего HTML-документа. Однако, к счастью, вы создаете намного более сложный веб-сайт и хотите, чтобы публикуемый подробный контент в социальных сетях изменялся в зависимости от значения URL-адреса (который, наверняка, устанавливается при помощи <span>HTML5 History API</span> (* позволяет изменять URL веб-сайта без перезагрузки всей страницы), которым манипулирует ваш фреймворк).</p> <p>Вы сразу могли бы попробовать создать ваш шаблон и добавлять значения в мета-теги так же, как вы бы делали с любым другим контентом (* при помощи JavaScript). Поскольку на данный момент веб-пауки, извлекающие эту информацию, не выполняют код JavaScript, то при попытке опубликовать контент в социальных сетях в вашем шаблоне останутся прежние значения тегов вместо предполагаемых.</p> <p>Для того чтобы ваш сайт могли читать веб-пауки, мы создаем промежуточное ПО, которое определяет агент пользователя веб-робота, используемого социальной сетью для добавления контента, и затем создаем дополнительный маршрут, в ответ на запросы по которому веб-роботу будет преподнесен соответствующий контент. При этом не задействуется ваш фреймворк для SPA.</p> <h2>Промежуточное ПО для определения агента пользователя</h2> <p>Клиенты (роботы, веб-пауки, веб-браузеры) отправляют строку User Agent (UA) (* агент пользователя) в  заголовках HTTP каждого запроса. Предполагается, что благодаря этому можно будет определить тип программного обеспечения клиента. В то время как у веб-браузеров имеется огромное разнообразие строк UA, веб-боты более-менее стабильны в этом вопросе. Facebook, Twitter и Pinterest придают огласке строки UA своих веб-ботов из уважения к разработчикам.</p> <p>В Express значение строки UA содержится в объекте запроса <code class="inline">req </code>в свойстве<code class="inline"> user-agent.</code> Я использую регулярное выражение для идентификации различных веб-ботов, которым я хотел бы предоставить альтернативный контент. Мы поместим его в промежуточное ПО. Промежуточное ПО подобно маршрутам, однако для него не требуется путь или метод и в нем (обычно) запрос передается к другому промежуточному ПО или маршруту. В Express маршруты и промежуточное ПО выполняются последовательно, поэтому расположите следующий код выше любого другого маршрута в вашем приложении Express.</p> <pre class="brush: javascript noskimlinks noskimwords">app.use(function(req,res,next) {  var    ua = req.headers["user-agent"];  if (/^(facebookexternalhit)|(Twitterbot)|(Pinterest)/gi.test(ua)) {    console.log(ua," is a bot");  }  next();});</pre> <p>Вышеуказанное регулярное выражение осуществляет поиск символов “facebookexternalhit”, “Twitterbot” или “Pinterest” в начале строки UA. Если символы найдены, то значение строки UA выводится в консоль.</p> <p>Ниже приводится код всего сервера:</p> <pre class="brush: javascript noskimlinks noskimwords">var  express   = require("express"),  app       = express(),  server;app.use(function(req,res,next) {  var    ua = req.headers["user-agent"];  if (/^(facebookexternalhit)|(Twitterbot)|(Pinterest)/gi.test(ua)) {    console.log(ua," is a bot");  }   next();});app.get("/",function(req,res) {  res.send("Serve SPA");});server = app.listen(  8000,  function() {    console.log("Server started.");  });</pre> <h2>Тестирование вашего промежуточного ПО</h2> <p>В Chrome перейдите на ваш новый сервер (URL-адресом которого должен быть <code class="inline">http://localhost:8000/</code>). Откройте DevTools и включите ‘Device Mode’ (* режим устройства), кликнув по иконке смартфона в верхней левой части панели разработчика.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%209.00.24%20AM.png" alt="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." width="50" height="50"></figure><p>На панель инструментов устройства введите строку “Twitterbot/1.0” в поле для редактирования значения UA.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-08%20at%209.01.58%20AM.png" alt="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." width="50" height="50"></figure><p>Теперь перезагрузите страницу.</p> <p>В этот момент вы должны увидеть “Serve SPA” на странице, однако при просмотре результата в консоли вашего приложения Express вы должны увидеть:</p> <p><code class="inline">Twitterbot/1.0 is a bot</code></p> <h2>Альтернативная маршрутизация</h2> <p>Теперь, когда мы можем определять веб-ботов, давайте создадим альтернативный маршрут. В Express может использоваться множество маршрутизаторов, часто используемых для разделения маршрутизаторов в зависимости от пути. В нашем случае мы собираемся использовать маршрутизатор немного по-особенному. Маршрутизаторы представляют из себя по сути промежуточное ПО, поэтому они принимают объекты <code class="inline">req</code>, <code class="inline">res </code>и <code class="inline">next</code>, как и остальное промежуточное ПО. Идея здесь состоит в том, чтобы сгенерировать другой набор маршрутов с теми же путями.</p> <pre class="brush: javascript noskimlinks noskimwords">nonSPArouter = express.Router();nonSPArouter.get("/", function(req,res) {  res.send("Serve regular HTML with metatags");});</pre> <p>Наше промежуточное ПО также необходимо изменить. Вместо того, чтобы просто выводить сообщение о том, что клиент является веб-ботом, мы теперь будем пересылать запрос к следующему маршрутизатору и, что важно, передавать его далее при помощи вызова <code class="inline">next()</code> только если условие при проверке UA не выполнилось. Таким образом, если вкратце, то для веб-ботов имеется один маршрутизатор, а для всех остальных клиентов - стандартный маршрутизатор, который передает код одностраничного приложения.</p> <pre class="brush: javascript noskimlinks noskimwords">var  express   = require("express"),  app       = express(),    nonSPArouter                  = express.Router(),  server;nonSPArouter.get("/", function(req,res) {  res.send("Serve regular HTML with metatags");});app.use(function(req,res,next) {  var    ua = req.headers["user-agent"];  if (/^(facebookexternalhit)|(Twitterbot)|(Pinterest)/gi.test(ua)) {    console.log(ua," is a bot");    nonSPArouter(req,res,next);  } else {    next();  }});app.get("/",function(req,res) {  res.send("Serve SPA");});server = app.listen(  8000,  function() {    console.log("Server started.");  });</pre> <p>Если мы протестируем приложение по той же схеме, как и выше, то при указании значением UA строки <code class="inline">Twitterbot/1.0</code> браузер покажет при перезагрузке следующее:</p> <p><code class="inline">Serve regular HTML with metatags</code></p> <p>Тогда как при использовании стандартного UA Chrome вы увидите:</p> <p><code class="inline">Serve SPA</code></p> <h2>Мета-теги</h2> <p>Как мы рассматривали выше, добавление подробного контента в социальные сети осуществляется благодаря <code class="inline">мета-тегам</code> внутри заголовка вашего HTML-документа. Поскольку вы создаете одностраничное приложение, то, должно быть, у вас даже не установлен шаблонизатор. В этом руководстве мы будем использовать jade. Jade является довольно простым языком для написания шаблонов, в котором пробелы и табуляция играют роль и не требуется использование закрывающих тегов. Мы можем установить его при помощи команды:</p> <p><code class="inline">npm install jade</code></p> <p>В исходном коде нашего сервера добавьте ту строку перед строкой <code class="inline">app.listen.</code></p> <p><code class="inline">app.set("view engine", "jade");</code></p> <p>Теперь мы собираемся добавить информацию, которую хотели бы передавать только веб-боту. Мы изменим <code class="inline">nonSPArouter</code>. Поскольку мы установили механизм представления в методе set объекта app, метод <code class="inline">res.render</code> будет выполнять визуализацию шаблонов на jade.</p> <p>Давайте создадим небольшой jade-шаблон для представления информации веб-ботам, которые  осуществляют шаринг контента в социальных сетях.</p> <pre class="brush: plain noskimlinks noskimwords">doctype htmlhtml  head    title= title    meta(property="og:url"  name="twitter:url" content= url)    meta(property="og:title" name="twitter:title" content= title)    meta(property="og:description" name="twitter:description" content= descriptionText)    meta(property="og:image" content= imageUrl)    meta(property="og:type" content="article")    meta(name="twitter:card" content="summary")  body    h1= title    img(src= img alt= title)    p= descriptionText</pre> <p>Большую часть кода составляют <code class="inline">мета-теги</code>, однако вы можете также заметить, что я добавил информацию и в тело документа. На момент написания этого руководства считается, что все веб-боты для добавления контента в социальных сетях смотрят только на мета-теги. Однако добавление информации в отчасти читабельном для человека виде является установившейся практикой и делается на случай, если необходима будет проверка кода человеком через некоторое время.</p> <p>Сохраните шаблон в папку для <code class="inline">представлений </code>вашего приложения и назовите его <code class="inline">bot.jade</code>. Имя файла  без расширения (‘bot’) будет первым параметром метода res.render.</p> <p>Несмотря на то, что локальная разработка важна, вам необходимо будет поместить ваше приложение в его конечное местоположение для полноценной отладки ваших <code class="inline">мета-тегов</code>. Готовая к развертыванию версия нашего крошечного сервера выглядит следующим образом:</p> <pre class="brush: javascript noskimlinks noskimwords">var  express   = require("express"),  app       = express(),    nonSPArouter                  = express.Router(),  server;nonSPArouter.get("/", function(req,res) {  var    img   = "placeholder.png";      res.render("bot", {     img       : img,    url       : "https://bot-social-share.herokuapp.com/",    title     : "Bot Test",     descriptionText               : "This is designed to appeal to bots",    imageUrl  : "https://bot-social-share.herokuapp.com/"+img  });});app.use(function(req,res,next) {  var    ua = req.headers["user-agent"];  if (/^(facebookexternalhit)|(Twitterbot)|(Pinterest)/gi.test(ua)) {    console.log(ua," is a bot");    nonSPArouter(req,res,next);  } else {    next();  }});app.get("/",function(req,res) {  res.send("Serve SPA");});app.use("/",express.static(__dirname + "/static"));app.set("view engine", "jade");server = app.listen(  process.env.PORT || 8000,  function() {    console.log("Server started.");  });</pre> <p><em>Также обратите внимание на то, что я использую промежуточное ПО <code class="inline">express.static</code> для передачи изображений из папки<code class="inline"> /static</code>.</em></p> <h2>Отладка вашего приложения</h2> <p>Как только вы выполнили дистанционную инсталляцию вашего приложения на какой-то сервер для публичного доступа, вам необходимо убедиться, что ваши <code class="inline">мета-теги </code>работают как положено.</p> <p>Для начала вы можете протестировать при помощи инструмента <span>Facebook Debugger</span>. Введите ваш URL-адрес и нажмите <strong>"Fetch new scrape information"</strong> (* Получить новую информацию об URL).</p> <p>Вы должны увидеть нечто подобное:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-09%20at%203.08.07%20PM.png" alt="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." width="50" height="50"></figure><p>Далее вы можете перейти к тестированию вашей карточки Twitter при помощи инструмента <span>Twitter Card Validator.</span> Для использования этого инструмента вам необходимо будет войти в ваш аккаунт Twitter.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1197/posts/25530/attachment/Screen%20Shot%202015-12-09%20at%203.07.07%20PM.png" alt="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." title="Добавление возможности шаринга (публикации) контента в социальных сетях в одностраничном приложении Node.js..." width="50" height="50"></figure><p>Pinterest предоставляет <span>отладчик</span>, но этот пример не будет работать в том виде, в каком он сейчас, поскольку Pinterest позволяет использовать «подробные Пины» для всех URL-адресов, кроме URL-адреса вашей главной страницы.</p> <h2>Следующие шаги</h2> <p>В фактической реализации приложения вам необходимо будет справиться с интеграцией вашего источника данных и маршрутизации. Лучше всего будет посмотреть на маршруты, указанные в коде одностраничного приложения, и создать альтернативную версию для всего, чем, на ваш взгляд, пользователи могли бы поделиться. После настройки маршрутов для передачи контента, которым, скорее всего, пользователи захотят поделиться, добавьте <code class="inline">мета-теги</code> в ваш основной шаблон, которые будут выполнять роль запасного варианта в ситуации, когда кто-либо делится страницей, возможность добавления в социальных сети которой не предполагалась.</p> <p>Несмотря на то, что Pinterest, Facebook и Twitter составляют крупную долю рынка социальных сетей, у вас может возникнуть желание интегрироваться и с другими сервисами. Некоторые сервисы действительно публикуют названия своих веб-роботов для осуществления шаринга контента в социальных сетях, а некоторые могут и скрывать. Для определения агента пользователя вы можете использовать команду <code class="inline">console.log</code> и посмотреть на результат в консоли. Попробуйте сначала сделать это на сервере, не предназначенном для публикации вашего сайта для широких масс, поскольку при определении агента пользователя на высоконагруженных сайтах для этого может быть неподходящий момент. После этого вы можете изменить регулярное выражение в нашем промежуточном ПО, чтобы отследить и нового агента пользователя.</p> <p>Подробные публикации в социальных сетях могут быть отличным способом для привлечения посетителей на ваш необычный сайт, основой которого служит одностраничное приложения. Избирательно направляя веб-роботов к машиночитаемому контенту, вы можете передать им подходящую информацию.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Single Page Web Apps" href="https://norma-studio.github.io/article/220824357-dobavlenie-vozmozhnosti-sharinga-publikatsii-kontenta-v-sotsialnyh-setyah-v-odnostranichnom-prilozhenii-nodejs" class="tm-article-body__tags-item-link">Single Page Web Apps</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
36344</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
359</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
