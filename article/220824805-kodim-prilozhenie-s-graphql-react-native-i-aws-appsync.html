
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этом уроке, я покажу вам как создать и взаимодействовать с базой даных GraphQL, используя AWS AppSync и React Native. У этого приложения будет функционал для работы в реальном времени и без сети, что-то мы получим «из коробки» от AppSync. ...">
<meta property="og:description" content="В этом уроке, я покажу вам как создать и взаимодействовать с базой даных GraphQL, используя AWS AppSync и React Native. У этого приложения будет функционал для работы в реальном времени и без сети, что-то мы получим «из коробки» от AppSync. ...">
<meta name="twitter:description" content="В этом уроке, я покажу вам как создать и взаимодействовать с базой даных GraphQL, используя AWS AppSync и React Native. У этого приложения будет функционал для работы в реальном времени и без сети, что-то мы получим «из коробки» от AppSync. ...">
<meta property="aiturec:description" content="В этом уроке, я покажу вам как создать и взаимодействовать с базой даных GraphQL, используя AWS AppSync и React Native. У этого приложения будет функционал для работы в реальном времени и без сети, что-то мы получим «из коробки» от AppSync. ...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/2055/posts/30569/final_image/appsynccc.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/2055/posts/30569/final_image/appsynccc.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/2055/posts/30569/final_image/appsynccc.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/2055/posts/30569/final_image/appsynccc.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/2055/posts/30569/final_image/appsynccc.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html">
<link rel="canonical" href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html">
<meta property="og:url" content="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html" title="Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io" title="Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/ded38a8520cf75a955c11fc92a1a403e.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html" class="tm-user-info__username" title="
В. Самсонов" aria-label="
В. Самсонов">
В. Самсонов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Кодим приложение с GraphQL, React Native и AWS AppSync...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="React Native" href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync" class="tm-article-snippet__hubs-item-link"><span>React Native</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/2055/posts/30569/final_image/appsynccc.jpg">
    <meta itemprop="headline name" content="Кодим приложение с GraphQL, React Native и AWS AppSync... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этом уроке, я покажу вам как создать и взаимодействовать с базой даных GraphQL, используя AWS AppSync и React Native. У этого приложения будет функционал для работы в реальном времени и без сети, что-то мы получим «из коробки» от AppSync. ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этом уроке, я покажу вам как создать и взаимодействовать с базой даных GraphQL, используя AWS AppSync и React Native. У этого приложения будет функционал для работы в реальном времени и без сети, что-то мы получим «из коробки» от AppSync. ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этом уроке, я покажу вам как создать и взаимодействовать с базой даных GraphQL, используя AWS AppSync и React Native. У этого приложения будет функционал для работы в реальном времени и без сети, что-то мы получим «из коробки» от AppSync. <br></p><p>В предыдушей записи мы <span>настроили серверную чать нашего GraphQL, с помощью сервиса Amazon AppSync</span>. Посмотрете её, если вы ещë этого не сделали. Или, если хотите <span>Введение в GraphQL</span>, взгляните на другие материалы.</p><ul class="roundup-block__contents posts--half-width roundup-block--list"><li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/2055/posts/30511/preview_image/tutsplusimg.jpg" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"><div class="roundup-block__primary-category topic-code">GraphQL</div> <div class="roundup-block__content-title">Кодим приложение с GraphQL, React Native и AWS AppSync: Back-End (серверная часть)</div> <div class="roundup-block__author">Надир Дабит</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1199/posts/29271/preview_image/graphql.png" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"><div class="roundup-block__primary-category topic-code">JavaScript</div> <div class="roundup-block__content-title">Что такое GraphQL?</div> <div class="roundup-block__author">Гиги Сайфан</div></span></li> </ul><p>В этом материале мы завершим всё это, проведя сборку клиента React Native. Проект слишком сложный, чтобы показавать вам шаг за шагом, но я объясню архитектуру проекта и покажу вам ключевые части исходного кода.<br></p><h2>Обзор архитектуры приложениия и структуры папок</h2><p>У нашего приложения будет основная отправная точка, которая будет содержать представление с двумя вкладками. Одна из которых будет списком городов из нашей GraphQL базы, в другой будет поле ввода для нового города. Вкладка <strong>Cities</strong> будет навигатором, который позволит пользователю выбирать конкретный город.</p><p>Главный компонент мы положим в папку <strong>source</strong>, а остальные папки в каталог <strong>src</strong>, для хранения мутаций, запросов и подписок GraphQL.</p><p>А ещë у нас будет папка <strong>assets</strong> для хранения изображений.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/uploads/users/2055/posts/30569/image/structure4%20(1).jpg" class="lazy07" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"></figure><h2>Создание и настройка клиента React Native</h2><p>Для справки, взгляните на <span>окончательный код этого приложения в GitHub репозитории</span>, но я опишу некоторые шаги, предпринятые для создания приложения с нуля.</p><p>Сначала, мы создали новое приложеие React Native, используя <span>Expo</span>. </p><p>Как только мы установили зависимости в новоиспечённом проекте. Для работы GraphQL и AppSync, мы использовали следующие зависимости:</p><pre class="brush: plain noskimlinks noskimwords">aws-appsyncaws-appsync-reactgraphql-tagreact-apollouuid</pre><p>Также, мы использовали следующие зависимости для UI:</p><pre class="brush: javascript noskimlinks noskimwords">react-navigationreact-native-elementsreact-native-vector-icons</pre><p>Так же, была привязана одна установленная библиотека векторных значков Vector Icons:</p><pre class="brush: bash noskimlinks noskimwords">react-native link react-native vector-icons</pre><p>После установки наших зависимостей, мы скачали файл <strong>AppSync.js</strong> из консоли AppSync. В консоли нашего AppSync проекта, внизу мы выбираем <strong>React Native</strong> и нажали а оранжевую кнопку <strong>Download</strong>, чтобы скачать этот конфигурационный файл.<br></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/2055/posts/30511/image/config.jpg" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"><br></p><p>В этом конфигурационном файле клиента AppSync содержится информация, необходимая нам для создания нового клиента. </p><h2>Настройка Provider и Store</h2><p>Верхний уровень приложения — это то, где мы будем делать наши настройки, чтобы подключить API AppSync с помощью клиента React Native. Если ранее вы использовали Redux или React Apollo, то всё будет вам хорошо знакомо. Если нет, просто запомните, что любой дочерний элемент <code class="inline">Provider</code>, в нашем случае <code class="inline">ApolloProvider</code>, будет иметь доступ к предоставленной ему функциональности. </p><p>Следующий код — это наш новый файл <strong><span>App.js</span></strong>, который является основным компонентом, импортированным из нашего указателя <strong>index.js</strong>.</p><pre class="brush: rails noskimlinks noskimwords">import React from "react"import Tabs from "./src/Tabs"import AWSAppSyncClient from "aws-appsync";import { Rehydrated } from "aws-appsync-react";import { ApolloProvider } from "react-apollo";import appSyncConfig from "./aws-exports";const client = new AWSAppSyncClient({  url: appSyncConfig.graphqlEndpoint,  region: appSyncConfig.region,  auth: {    type: appSyncConfig.authType,    apiKey: appSyncConfig.apiKey,  }});const WithProvider = () =&gt; (  &lt;ApolloProvider client={client}&gt;    &lt;Rehydrated&gt;      &lt;Tabs /&gt;    &lt;/Rehydrated&gt;  &lt;/ApolloProvider&gt;);export default WithProvider</pre><p>В этом файле, мы настраиваем нового клиента AppSync, используя комбинацию из конструктора <code class="inline">AWSAppSyncClient</code> из <code class="inline">aws-appsync</code> и параметров в нашем <strong>aws-exports.js</strong> файле, который предоставляет GraphQL API URL, регион, тип авторизации и ключ авторизации API.</p><p>Затем заворачиваем наш главный указатель – файл <strong>Tabs.js</strong>, который будет содержать нашу вкладку навигации, в <code class="inline">ApolloProvider</code> и передаём клиенту AppSync, в качестве поддержки клиента. Также обернём компонент <code class="inline">Tabs</code> в компонент <code class="inline">Rehydrated</code>, который импортируем из <code class="inline">aws-appsync-react</code>. Это позволит убедиться, что мы прочли наш кеш из асинхронного хранилища и зарегистировали его, перед сборкой пользовательского интерфейса – UI.</p><p>Теперь наше приложение сможет запрашивать данные с указателя из нашего AppSync, а также выполнять мутации и подписки!</p><h2>Навигация</h2><p>Главным указателем приложения является навигация, реализованная в файле <span>Tabs.js</span> через React Navigation.</p><p>Здесь мы создаём и экспортируем <code class="inline">TabNavigator</code> с двумя вкладками, которые:</p><ol><li> <strong>Cities</strong> — в этом компоненте перечислены города и сам по себе он является навигатором. Этот компонент является навигатором потому, что мы хотим иметь возможность просматривать каждый отдельный город и просматривать места в городе.</li> <li> <strong>AddCity</strong> — этот компонент является формой, позволяющей добавлять новые города.</li> </ol><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/uploads/users/2055/posts/30569/image/tabs2.jpg" class="lazy07" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"></figure><h2>Повторные компоненты<br></h2><p>В этом приложении только один повторяющийся и повторно используемый компонент, это наш <code class="inline">TextInput</code>. Так как мы будем дублировать его стиль и функционал снова и снова, мы решили сделать отдельным компонентом. Компонент ввода реализован в <b><span>Input.js</span></b>.</p><h2>Список городов и навигация по городу</h2><p>Главный экран приложения представляет собой список городов, который мы будем получать из GraphQL. Мы хотим переходить от каждого города в списке к детальному просмотру этого города, где мы сможем добавлять места.</p><p>Для этого мы создаём собственный StackNavigator — <strong><span>Cities.js</span></strong> и компонент <strong><span>City.js</span></strong>, к которому мы переходим при выборе города. При нажатии на город в списке городов <code class="inline">Cities</code>, мы передаём его название и id в качестве реквизитов к <code class="inline">City</code>.</p><h4><strong>Cities.js</strong></h4><p>В этом компоненте, мы получаем данные, используя запрос <code class="inline">listCities</code>, а также мы подписываемся на <code class="inline">NewCitySubscription</code>, таким образом, когда добавляется новый город, даже из другого клиента, мы обрабатываем эту подписку и обновляем наш массив с городами. Запрос <code class="inline">listCities</code> делает наш массив городов доступным в нашем компоненте, в качестве <code class="inline">this.props.cities</code>.</p><h4><strong>City.js</strong></h4><p>В этом компоненте, мы передаём город в качестве параметра от навигации (доступен как <code class="inline">props.navigation.state.params.city</code>). Мы используем <code class="inline">id</code> города, чтобы получить список мест для выбранного города, используя запрос <code class="inline">listLocations</code>. Мы подписываемся на новое место подобным образом, которым мы подписываемся на новые города в <strong>Cities.js</strong>, используя подписку <code class="inline">NewLocationSubscription</code>. Также мы предоставляем функции <code class="inline">optimisticResponse</code> и <code class="inline">update</code> для добавления новых городов. Оптимистичный ответ </p><h2>Добавление городов</h2><p>И наконец, нам нужно реализовать функционал добавления новых городов в наш GraphQL API в файле <span>AddCity.js</span>. Для этого нам нужно обернуть мутацию вместе с формой, которая вызывает <code class="inline">createCity</code>, передавая значения из формы.</p><p>В AddCity есть функция <code class="inline">onAdd</code>, которую мы определяем в компоненте GraphQL, который не только вписывает новый город в нашу базу данных GraphQL, а ещё реализует оптимистичный UI, используя комбинацию из <code class="inline">optimisitcResponse</code> и <code class="inline">update</code>.<br></p><h2>Мутации, запросы и подписки</h2><p><em></em>Мутации, запросы и подписки – основные функции для интеграции с GraphQL API. В нашем приложении, эта функциональность реализована в файлах <strong>Cities.js</strong>, <strong>City.js</strong>, и <strong>AddCity.js</strong>, используя клиент AppSync.</p><p>Давайте посмотрим подробнее на то, как мутации, запросы и подписки, реализованы в нашем коде.</p><h3>Запросы</h3><p>Для начала, давайте посмотрим на то, как создавать и экспортировать GraphQL зарос, который может взаимодействовать с запросом <b>listCities</b> в нашей AppSync Schema. Этот код содержится в файле <strong><span>src/queries/LIstCities.js</span></strong>.</p><pre class="brush: javascript noskimlinks noskimwords">import gql from "graphql-tag";export default gql`query listCities {  listCities  {    items {      name      country      id    }  }}`</pre><p>Затем, мы импортируем этот запрос в файл <strong><span>Cities.js</span></strong>, вместе с некоторыми помощниками из <code class="inline">react-apollo</code>, и связываем компонент, который может иметь доступ к этим данным, используя <code class="inline">compose</code> и <code class="inline">graphql</code> из <code class="inline">react-apollo</code>.</p><pre class="brush: javascript noskimlinks noskimwords">import { compose, graphql } from "react-apollo"import ListCities from "./queries/ListCities"class Cities extends React.Component {  // class definition here  // now have access to this.props.cities}export default compose(  graphql(ListCities, {      props: props =&gt; ({        cities: props.data.listCities ? props.data.listCities.items : [],      })  }))(CityList)</pre><p>Теперь у нас есть доступ к массиву городов с нашего GraphQL сервера, в качестве параметра. Мы можем использовать <code class="inline">this.props.cities</code>, для разметки нашего массива городов, идущего из GraphQL.<br></p><h3>Мутации</h3><p>Чтобы создать мутацию, для начала нам понадобится создать основную мутацию GraphQL и экспортировать её.  Мы делаем это в файле <span><strong>src/mutations/CreateCity.js</strong></span>.</p><pre class="brush: javascript noskimlinks noskimwords">import gql from "graphql-tag"export default gql`  mutation addCity($name: String!, $country: String!, $id: ID!) {    createCity(input: {      name: $name, country: $country, id: $id    }) {      name      country      id    }  }`</pre><p>Теперь мы можем импортировать эту мутацию (вместе с помощниками Apollo) в файле <span><strong>AddCity.js</strong></span> и использовать её как компонент: </p><pre class="brush: javascript noskimlinks noskimwords">import { compose, graphql } from "react-apollo"import AddCityMutation from "./mutations/AddCity"class AddCity extends React.Component {  // class definition here  // now have access to this.props.onAdd()}export default compose(  graphql(AddCityMutation, {    props: props =&gt; ({      onAdd: city =&gt; props.mutate({        variables: city      })    })  }))(AddCity)</pre><p>Теперь у нас есть доступ к параметру <code class="inline">onAdd</code>, в котором мы передаём объект, который мы хотим отправить на мутацию!</p><h3>Подписки<br></h3><p>Подписки позволяют нам подписываться на изменения данных, что позволяет держать их обновлёнными в нашем приложении в реальном времени. Если бы мы изменили нашу базу данных, добавив или удалив город, нам бы хотелось, чтобы наше приложение обновило эти изменения в реальном времени.</p><p>Сперва нам надо создать мутацию и экспортировать её, тогда мы получим доступ к ней в нашем клиенте. Мы сохраним это в файле <span><strong>src/subscriptionsNewCitySubscriptions.js</strong></span>.</p><pre class="brush: javascript noskimlinks noskimwords">import gql from "graphql-tag"export default gql`subscription NewCitySub {  onCreateCity {    name    country    id  }}`;</pre><p>Теперь мы можем импортировать и вложить подписку в <span>Cities.js</span>. Мы уже рассмотрели, как получить города через на API. Теперь давайте обновим этот функционал для подписки на новые изменения и обновления массива городов, если добавляется новый город.</p><pre class="brush: plain noskimlinks noskimwords">import AllCity from "./queries/AllCity"import NewCitiesSubscription from "./subscriptions/NewCitySubscription";import { compose, graphql } from "react-apollo"class Cities extends React.Component {  componentWillMount(){    this.props.subscribeToNewCities();  }  render() {    // rest of component here  }}export default compose(  graphql(ListCities, {    options: {      fetchPolicy: "cache-and-network"    },    props: (props) =&gt; {      return {        cities: props.data.listCities ? props.data.listCities.items : [],        subscribeToNewCities: params =&gt; {          props.data.subscribeToMore({            document: NewCitiesSubscription,            updateQuery: (prev, { subscriptionData: { data : { onCreateCity } } }) =&gt; {              return {                ...prev,                listCities: {                  __typename: "CityConnection",                  items: [onCreateCity, ...prev.listCities.items.filter(city =&gt; city.id !== onCreateCity.id)]                }              }            }          })        }      }    }  }))(Cities)</pre><p>Мы добавляем новый реквизит, названный <code class="inline">subscribeToNewCities</code>, который мы вызываем в <code class="inline">componentDidMount</code>. В подписке, мы передаём в документ (определение подписки) и <code class="inline">updateQuery</code>, чтобы описать то, что мы хотим, чтобы произошло при этом обновлением.</p><p>Мы деструктурируем <code class="inline">createCity</code> (содержащий мутацию) из параметра, который передаётся в функцию <code class="inline">updateQuery</code> и возвращаем все существующие значения, вместе с обновлённым массивом <code class="inline">listCities</code>, содержащим предыдущие города и данные нового города, который мы получаем из <code class="inline">createCity</code>.</p><p>Оптимистичный UI<br></p><p>Что, если мы не хотим ждать пока подписка вернёт самые свежие данные из нашего API для обновления UI?</p><p>Если пользователь создаёт новый город, мы хотим автоматического добавления его в массив городов и отображения его в нашем приложении до получения подтверждения от back-end сервера.</p><p>Используя несколько техник и функций, мы можем сделать это с лёгкостью.</p><p>Давайте изменим наш <code class="inline">AddCityMutation</code> к этому (вы можете посмотреть этот код в файле <span>AddCity.js</span>):</p><pre class="brush: javascript noskimlinks noskimwords">import { compose, graphql } from "react-apollo"import AddCityMutation from "./mutations/AddCity"class AddCity extends React.Component {  // class definition here  // now have access to this.props.onAdd()}export default compose(  graphql(AddCityMutation, {    props: props =&gt; ({      onAdd: city =&gt; props.mutate({        variables: city,        optimisticResponse: {          __typename: "Mutation",          createCity: { ...city,  __typename: "City" }        },        update: (proxy, { data: { createCity } }) =&gt; {          const data = proxy.readQuery({ query: ListCities });          data.listCities.items.unshift(createCity);          proxy.writeQuery({ query: ListCities, data });        }      })    })  }))(AddCity)</pre><p>Тут мы добавили два новых свойства, чтобы мутировать объект функции:</p><ol><li> <code class="inline">optimisticResponse</code> задаёт новый ответ, который вы хотите получить в функции обновления</li> <li> <code class="inline">update</code> принимает два аргумента, proxy (который позволяет вам читать кеш) и data (данные), которые вы хотели бы использовать для обновления. Мы читаем текущий кеш (<code class="inline">proxy.readQuery</code>), и это наш новый элемент для массива элементов, потом пишем его обратно в кеш, который обновляет наш UI.</li> </ol><h2>Заключение</h2><p>GraphQL становится все более популярным. Большая часть сложности, связанной с GraphQL, связана с управлением backend"ом и API. Тем не менее, такие инструменты, как AppSync, абстрагируют эту сложность, освобождая разработчиков от большей части времени настройки и работ на сервере.</p><p>Я с нетерпением жду гораздо большего количества инноваций в этом направлении и не могу дождаться, что ещё мы увидим в 2018 году!</p><p>Если вы заинтересованы в использовании AppSync вместе с платформой Serverless, ознакомьтесь с этим <span>замечательным введением по их совместному использованию</span>.</p><p>Если вы хотите узнать больше о AWS AppSync, я бы порекомендовал заглянуть на <span>домашнюю страницу AppSync</span> и в <span>документацию по построению клиента для GraphQL</span>.</p><p>Если вы хотите принять участие в этом проект, вы можете подключиться к нашему <span>GitHub репозиторию</span>. Если у вас есть идеи, можете послать нам PR, или используйт это приложение в качестве отправной точки для вашего следующего проекта на React Native GraphQL!</p><p>А пока, проверьте некоторые наши другие уроки по React Native, тут а Envato Tuts+!</p><ul class="roundup-block__contents posts--half-width roundup-block--list"><li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1125/posts/29791/preview_image/RN.jpg" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Mobile Development</div> <div class="roundup-block__content-title">Tools for React Native Development</div> <div class="roundup-block__author">Wernher-Bel Ancheta</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1125/posts/27567/preview_image/rn.jpg" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"><div class="roundup-block__primary-category topic-code">React Native</div> <div class="roundup-block__content-title">Practical Animation Examples in React Native</div> <div class="roundup-block__author">Wernher-Bel Ancheta</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1125/posts/27418/preview_image/rn.jpg" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"><div class="roundup-block__primary-category topic-code">React Native</div> <div class="roundup-block__content-title">Get Started With React Native Layouts</div> <div class="roundup-block__author">Wernher-Bel Ancheta</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/34/posts/29003/preview_image/react.js.png" alt="Кодим приложение с GraphQL, React Native и AWS AppSync..." title="Кодим приложение с GraphQL, React Native и AWS AppSync..." width="50" height="50"><div class="roundup-block__primary-category topic-code">React</div> <div class="roundup-block__content-title">10 React Native Applications for You to Use, Study, and Apply</div> <div class="roundup-block__author">Eric Dye</div></span></li> </ul><p></p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="React Native" href="https://norma-studio.github.io/article/220824805-kodim-prilozhenie-s-graphql-react-native-i-aws-appsync" class="tm-article-body__tags-item-link">React Native</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
36289</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
483</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
