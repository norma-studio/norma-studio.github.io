
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Этот учебник является частью серии статей-Пишем свой стартап на PHP-на Envato Tuts +. В этой серии я направляю вас через запуск приложения от концепции до готового продукта, используя приложение-Планировщик встреч-в качестве реального приложения. На каждом шаге я делаю релиз кода планировщика собраний в качестве примеров с открытым исходным кодом, ...">
<meta property="og:description" content="Этот учебник является частью серии статей-Пишем свой стартап на PHP-на Envato Tuts +. В этой серии я направляю вас через запуск приложения от концепции до готового продукта, используя приложение-Планировщик встреч-в качестве реального приложения. На каждом шаге я делаю релиз кода планировщика собраний в качестве примеров с открытым исходным кодом, ...">
<meta name="twitter:description" content="Этот учебник является частью серии статей-Пишем свой стартап на PHP-на Envato Tuts +. В этой серии я направляю вас через запуск приложения от концепции до готового продукта, используя приложение-Планировщик встреч-в качестве реального приложения. На каждом шаге я делаю релиз кода планировщика собраний в качестве примеров с открытым исходным кодом, ...">
<meta property="aiturec:description" content="Этот учебник является частью серии статей-Пишем свой стартап на PHP-на Envato Tuts +. В этой серии я направляю вас через запуск приложения от концепции до готового продукта, используя приложение-Планировщик встреч-в качестве реального приложения. На каждом шаге я делаю релиз кода планировщика собраний в качестве примеров с открытым исходным кодом, ...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/final_image/featured%20-%20pt1.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/final_image/featured%20-%20pt1.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/final_image/featured%20-%20pt1.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/final_image/featured%20-%20pt1.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/final_image/featured%20-%20pt1.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html" title="Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io" title="Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/654345654.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html" class="tm-user-info__username" title="
А. Кузнецов" aria-label="
А. Кузнецов">
А. Кузнецов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Пишем свой стартап: уведомление пользователей об изменениях в стречах...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Yii" href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah" class="tm-article-snippet__hubs-item-link"><span>Yii</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/final_image/featured%20-%20pt1.jpg">
    <meta itemprop="headline name" content="Пишем свой стартап: уведомление пользователей об изменениях в стречах... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Этот учебник является частью серии статей-Пишем свой стартап на PHP-на Envato Tuts +. В этой серии я направляю вас через запуск приложения от концепции до готового продукта, используя приложение-Планировщик встреч-в качестве реального приложения. На каждом шаге я делаю релиз кода планировщика собраний в качестве примеров с открытым исходным кодом, ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Этот учебник является частью серии статей-Пишем свой стартап на PHP-на Envato Tuts +. В этой серии я направляю вас через запуск приложения от концепции до готового продукта, используя приложение-Планировщик встреч-в качестве реального приложения. На каждом шаге я делаю релиз кода планировщика собраний в качестве примеров с открытым исходным кодом, ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Этот учебник является частью серии статей <span>Пишем свой стартап на PHP</span> на Envato Tuts +. В этой серии я направляю вас через запуск приложения от концепции до готового продукта, используя приложение <span>Планировщик встреч</span> в качестве реального приложения. На каждом шаге я делаю релиз кода планировщика собраний в качестве примеров с открытым исходным кодом, из которых вы можете узнать что-то новое. Я также рассмотрю связанные с запуском бизнес-вопросы по мере их возникновения.</p><p>В этой серии из двух частей я опишу, как мы построили инфраструктуру уведомлений и их доставку. Сегодня я собираюсь сосредоточиться на MeetingLog для отслеживания изменений, которые помогают нам определить, когда отправлять обновления.</p><p>Если вы еще не опробовали Планировщик собраний, то обязательно <span>запланируйте свою первую встречу</span>. Я участвую в комментариях ниже, так что скажите мне, что вы думаете! Меня особенно интересует, если вы хотите предложить новые функции или темы для будущих учебников.</p><p>Напомним, что весь код Планировщика собраний написан в Yii2 Framework для PHP. Если вы хотите узнать больше о Yii2, ознакомьтесь с нашей параллельной серией <span>Программирование с Yii2</span>.</p><h2>Мое видение уведомлений</h2><p>Вот что обычно видит участник собрания, когда они получают приглашение. Они начнут делиться своей доступностью на различные места и время, а иногда и делать окончательный выбор:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/image/current%20view.jpg" alt="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." title="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." width="50" height="50"></figure><p>Когда участник собрания отвечает на приглашение, подобное приведенному выше, он может внести несколько изменений. Например:</p><ul><li>Эти дата и время подходят, а эти - нет.</li> <li>Это место подходит, а другое - нет, давайте также рассмотрим это дополнительно.</li> <li>Я выбираю это место и это время.</li> <li>Добавьте примечание: «Я рад, что мы наконец собрались вместе».</li> </ul><p>После внесения изменений нам необходимо сообщить организатору.</p><p>Наша цель - упростить планирование встреч и сократить количество связанных с ними электронных писем. Если мы подождем несколько минут после того, как человек внесет изменения и консолидирует изменения в одно обновление, то, скорее всего, это будет подходящее время для доставки уведомления. Но как мы напишем код, который это делает? Как мы будем отслеживать, какие изменения были внесены, и покажем их организатору?</p><p>Еще одна идея, о которой я думал, - избавиться от необходимости нажимать кнопку «Отправить», когда вы закончите внесение изменений. Во-первых, для этого потребуется некоторое обучение пользователей, чтобы заверить их, что мы отправим их изменения, когда они будут сделаны. Но нам также нужен был способ узнать, когда можно было бы отправить изменения организатору.</p><h2>Как будут работать уведомления</h2><p>Пересказывая и обобщая требования, вот как будут работать уведомления: </p><p>Все действия, связанные с встречами, хранятся в нашей модели MeetingLog. Но нам понадобится способ создания текстовой сводки журнала для обмена с участниками. Мы можем просто показать изменения, произошедшие со времени последнего обновления. Поэтому нам придется их отслеживать.</p><p>Поскольку человек вносит изменения в собрание, мы будем наглядно указывать, что нет необходимости нажимать кнопку несуществующей отправки или сохранения изменений.</p><p>Мы хотим отслеживать, когда с момент изменений прошло уже несколько минут, и объединим их в одно обновление для другого участника или организатора.</p><p>И, наконец, нам нужно будет доставить обновление электронной почты только другим участникам, а не тем, кто внес изменения. Или, если оба участника внесли изменения в течение этого времени, нам нужно будет уведомить о каждом из действий другого.</p><h2>Создание журнала собрания</h2><p>По ряду причин нам с самого начала нужен полный журнал действий, выполняемых при планировании совещаний. Возможно, люди захотят увидеть историю планирования или вернуться к определенному моменту, но также, это полезно для отладки. Также оказалось необходимым знать, когда следует доставлять обновления об изменениях в собрании.</p><p>Давайте рассмотрим структуру модели MeetingLog. Вот миграция, создающая таблицу:</p><pre class="brush: php noskimlinks noskimwords">class m141025_220133_create_meeting_log_table extends Migration{  public function up()  {      $tableOptions = null;      if ($this-&gt;db-&gt;driverName === "mysql") {          $tableOptions = "CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB";      }      $this-&gt;createTable("{{%meeting_log}}", [          "id" =&gt; Schema::TYPE_PK,          "meeting_id" =&gt; Schema::TYPE_INTEGER." NOT NULL",          "action" =&gt; Schema::TYPE_INTEGER." NOT NULL",          "actor_id" =&gt; Schema::TYPE_BIGINT." NOT NULL",          "item_id" =&gt; Schema::TYPE_INTEGER." NOT NULL",          "extra_id" =&gt; Schema::TYPE_INTEGER." NOT NULL",          "created_at" =&gt; Schema::TYPE_INTEGER . " NOT NULL",          "updated_at" =&gt; Schema::TYPE_INTEGER . " NOT NULL",      ], $tableOptions);      $this-&gt;addForeignKey("fk_meeting_log_meeting", "{{%meeting_log}}", "meeting_id", "{{%meeting}}", "id", "CASCADE", "CASCADE");      $this-&gt;addForeignKey("fk_meeting_log_actor", "{{%meeting_log}}", "actor_id", "{{%user}}", "id", "CASCADE", "CASCADE");  }</pre><p>Основные элементы, которые мы записываем:</p><ul><li><code class="inline">meeting_id</code> сообщает нам, какую встречу мы отслеживаем.</li> <li><code class="inline">action</code> говорит нам, что было сделано.</li> <li><code class="inline">actor_id</code> сообщает нам, кто выполнил действие (например, <code class="inline">user_id</code>).</li> <li>Перегруженный <code class="inline">item_id</code> может представлять собой время, место или примечание.</li> <li><code class="inline">extra_id</code> предназначен для записи другой информации в зависимости от действия.</li> <li> <code class="inline">created_at</code> сообщает нам, когда действие было выполнено.</li> </ul><p>Затем я определил константы для всех действий, таких как <code class="inline">ACTION_SUGGEST_PLACE</code> или <code class="inline">ACTION_ADD_NOTE</code> и т.д.</p><pre class="brush: php noskimlinks noskimwords">class MeetingLog extends \yii\db\ActiveRecord{    const ACTION_CREATE_MEETING = 0;  const ACTION_EDIT_MEETING = 3;const ACTION_CANCEL_MEETING = 7;const ACTION_DELETE_MEETING = 8;const ACTION_DECLINE_MEETING = 9;const ACTION_SUGGEST_PLACE = 10;const ACTION_ACCEPT_ALL_PLACES = 11;const ACTION_ACCEPT_PLACE = 12;const ACTION_REJECT_PLACE = 15;const ACTION_SUGGEST_TIME = 20;const ACTION_ACCEPT_ALL_TIMES = 21;const ACTION_ACCEPT_TIME = 22;const ACTION_REJECT_TIME = 25;const ACTION_INVITE_PARTICIPANT = 30;const ACTION_ADD_NOTE = 40;const ACTION_SEND_INVITE = 50;const ACTION_FINALIZE_INVITE = 60;const ACTION_COMPLETE_MEETING = 100;const ACTION_CHOOSE_PLACE = 110;const ACTION_CHOOSE_TIME = 120;const ACTION_SENT_CONTACT_REQUEST = 150;const TIMELAPSE = 300; // five minutes</pre><p>Метод add упрощает функциональность внутри приложения для записи активности в MeetingLog:</p><pre class="brush: plain noskimlinks noskimwords">// add to log    public static function add($meeting_id,$action,$actor_id=0,$item_id=0,$extra_id=0) {         $log = new MeetingLog;         $log-&gt;meeting_id=$meeting_id;         $log-&gt;action =$action;         $log-&gt;actor_id =$actor_id;         $log-&gt;item_id =$item_id;         $log-&gt;extra_id =$extra_id;         $log-&gt;save();         // sets the touched_at field for the Meeting Meeting::touchLog($meeting_id);    }</pre><p>Я также добавил два новых поля в таблицу Meeting: <code class="inline">logged_at</code> и <code class="inline">cleared_at</code>. Когда добавляются записи журнала, собрание обновляет отметку <code class="inline">logged_at</code>, показывающую момент последнего изменения собрания:</p><pre class="brush: php noskimlinks noskimwords"> public static function touchLog($id) {         $mtg = Meeting::findOne($id);         $mtg-&gt;logged_at = time();          $mtg-&gt;update();       }</pre><p>Например, всякий раз, когда кто-то добавляет новый параметр MeetingPlace, в журнал добавляется событие <code class="inline">afterSave</code>, а затем, конечно, также обновляется <code class="inline">Meeting-&gt; logged_at</code>:</p><pre class="brush: php noskimlinks noskimwords">public function afterSave($insert,$changedAttributes)    {        parent::afterSave($insert,$changedAttributes);        if ($insert) {          // if MeetingPlace is added          // add MeetingPlaceChoice for owner and participants          $mpc = new MeetingPlaceChoice;          $mpc-&gt;addForNewMeetingPlace($this-&gt;meeting_id,$this-&gt;suggested_by,$this-&gt;id);          MeetingLog::add($this-&gt;meeting_id,MeetingLog::ACTION_SUGGEST_PLACE,$this-&gt;suggested_by,$this-&gt;place_id);        }    }</pre><p>Время <code class="inline">logged_at</code> указывает нам, когда произошло последнее изменение. Время <code class="inline">Meeting-&gt;cleared_at</code> сообщит нам время, когда мы в последний раз делились обновлениями с участниками. Итак, если <code class="inline">logged_at</code> &gt; <code class="inline">cleared_at</code>, мы знаем, что участники не полностью обновлены.</p><h3>Создание краткого описания на английском языке</h3><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/image/meeting%20log%20index.jpg" alt="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." title="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." width="50" height="50"></figure><p>Затем я создал методы, помогающие перевести журнал в историю изменений встречи на английском языке. </p><p>Во-первых, я создал <strong>getMeetingLogCommand()</strong>, чтобы получить текстовое описание действия:</p><pre class="brush: php noskimlinks noskimwords">public function getMeetingLogCommand() {  switch ($this-&gt;action) {    case MeetingLog::ACTION_CREATE_MEETING:      $label = Yii::t("frontend","create meeting");    break;    case MeetingLog::ACTION_EDIT_MEETING:      $label = Yii::t("frontend","edit meeting");    break;    case MeetingLog::ACTION_CANCEL_MEETING:      $label = Yii::t("frontend","cancel meeting");    break;    case MeetingLog::ACTION_DELETE_MEETING:      $label = Yii::t("frontend","cancel meeting");    break;    case MeetingLog::ACTION_DELETE_MEETING:      $label = Yii::t("frontend","deleted meeting");    break;    case MeetingLog::ACTION_SUGGEST_PLACE:    $label = Yii::t("frontend","add place");    break;    case MeetingLog::ACTION_SUGGEST_TIME:    $label = Yii::t("frontend","add time");    break;    case MeetingLog::ACTION_ADD_NOTE:    $label = Yii::t("frontend","add note");    break;    case MeetingLog::ACTION_INVITE_PARTICIPANT:    $label = Yii::t("frontend","Invite participant");    break;    case MeetingLog::ACTION_ACCEPT_ALL_PLACES:      $label = Yii::t("frontend","accept all places");    break;    case MeetingLog::ACTION_ACCEPT_PLACE:      $label = Yii::t("frontend","accept place");    break;    case MeetingLog::ACTION_REJECT_PLACE:      $label = Yii::t("frontend","reject place");    break;    case MeetingLog::ACTION_ACCEPT_ALL_TIMES:      $label = Yii::t("frontend","accept all times");    break;    case MeetingLog::ACTION_ACCEPT_TIME:      $label = Yii::t("frontend","accept time");    break;    case MeetingLog::ACTION_REJECT_TIME:      $label = Yii::t("frontend","reject time");    break;    case MeetingLog::ACTION_CHOOSE_PLACE:      $label = Yii::t("frontend","choose place");    break;    case MeetingLog::ACTION_CHOOSE_TIME:      $label = Yii::t("frontend","choose time");    break;    case MeetingLog::ACTION_SEND_INVITE:    $label = Yii::t("frontend","Send");    break;    case MeetingLog::ACTION_FINALIZE_INVITE:    $label = Yii::t("frontend","Finalize");    break;    case MeetingLog::ACTION_COMPLETE_MEETING:    $label = Yii::t("frontend","Complete meeting");    break;    case MeetingLog::ACTION_SENT_CONTACT_REQUEST:    $label = Yii::t("frontend","Send request for contact information");    default:      $label = Yii::t("frontend","Unknown");    break;  }  return $label;}</pre><p>Затем я создал <strong>getMeetingLogItem()</strong>, который контекстно находит соответствующую метку объекта, на основе которой было выполнено действие. Здесь есть некоторые отладочные заметки:</p><pre class="brush: php noskimlinks noskimwords">public function getMeetingLogItem() {  $label="";  switch ($this-&gt;action) {    case MeetingLog::ACTION_CREATE_MEETING:    case MeetingLog::ACTION_EDIT_MEETING:    case MeetingLog::ACTION_CANCEL_MEETING:    case MeetingLog::ACTION_DECLINE_MEETING:      $label = Yii::t("frontend","-");    break;    case MeetingLog::ACTION_INVITE_PARTICIPANT:      $label = MiscHelpers::getDisplayName($this-&gt;item_id);      if (is_null($label)) {        $label = "Error - unknown user";      }    break;    case MeetingLog::ACTION_SUGGEST_PLACE:    $label = Place::find()-&gt;where(["id"=&gt;$this-&gt;item_id])-&gt;one();    if (is_null($label)) {      $label = "Error - suggested unknown place";    } else {      $label = $label-&gt;name;      if (is_null($label)) {        $label = "Error - suggested place has unknown name";      }    }    break;    case MeetingLog::ACTION_ACCEPT_PLACE:    case MeetingLog::ACTION_REJECT_PLACE:    $label = MeetingPlace::find()-&gt;where(["id"=&gt;$this-&gt;item_id])-&gt;one();    if (is_null($label)) {      $label = "Error - Accept or reject unknown place x1";    } else {      if (is_null($label-&gt;place))        $label = "Error Accept or reject unknown place x2";      else {        $label = $label-&gt;place-&gt;name;        if (is_null($label)) {          $label = "Error accept or reject unknown place name x3";        }      }    }    break;    case MeetingLog::ACTION_CHOOSE_PLACE:    $label = MeetingPlace::find()-&gt;where(["id"=&gt;$this-&gt;item_id])-&gt;one();    if (is_null($label)) {      $label = "Error - chose unknown place x1";    } else {      if (is_null($label-&gt;place))        $label = "Error chose unknown place x2";      else {        $label = $label-&gt;place-&gt;name;        if (is_null($label)) {          $label = "Error - choose unknown place name x3";        }      }    }    break;    case MeetingLog::ACTION_CHOOSE_TIME:    case MeetingLog::ACTION_SUGGEST_TIME:    case MeetingLog::ACTION_ACCEPT_TIME:    case MeetingLog::ACTION_REJECT_TIME:      // get the start time      $mt = MeetingTime::find()-&gt;where(["id"=&gt;$this-&gt;item_id])-&gt;one();      if (is_null($mt)) {        $label = "Error meeting time unknown";      } else {        $label = Meeting::friendlyDateFromTimestamp($mt-&gt;start);      }    break;    case MeetingLog::ACTION_ADD_NOTE:      if ($this-&gt;item_id ==0) {        $label = "note not logged";      } else {        $label = MeetingNote::find()-&gt;where(["id"=&gt;$this-&gt;item_id])-&gt;one()-&gt;note;      }    break;    case MeetingLog::ACTION_ACCEPT_ALL_PLACES:    case MeetingLog::ACTION_ACCEPT_ALL_TIMES:    case MeetingLog::ACTION_SEND_INVITE:    case MeetingLog::ACTION_FINALIZE_INVITE:    case MeetingLog::ACTION_COMPLETE_MEETING:    case MeetingLog::ACTION_SENT_CONTACT_REQUEST:      $label = Yii::t("frontend","-");    break;    default:      $label = Yii::t("frontend","n/a");    break;  }  return $label;}</pre><p>Например, создание, редактирование, отмена, удаление собрания не требует информации о позиции, тогда как для принятия времени требуется определенный <code class="inline">item_id</code>, соответствующий дате и времени <code class="inline">MeetingTimeChoice</code>.</p><h2>Предоставление визуальных подсказок<br></h2><p>Когда участник меняет ползунки на местах и времени, чтобы указать их предпочтения или, если разрешено, делает окончательный выбор, я хотел указать им, что их организатор собрания будет уведомлен. Я также хотел, чтобы это выглядело ненавязчивым, например, всплывающее предупреждение.</p><p>Поскольку многие из этих изменений связаны с AJAX, сообщение должно появляться рядом с действиями мыши. В случае отправки изменения (например, новая заметка) уведомление может появляться в верхней части страницы.</p><p>Yii Flash отлично здесь подходят, но они отображаются только в верхней части страниц. Например, в настоящее время добавление заметки требует обновления страницы. Люди будут видеть подсказку уведомления в верхней части страницы после публикации своего примечания:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/image/flash%20hint.jpg" alt="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." title="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." width="50" height="50"></figure><p>Итак, пока наша дизайн еще в процессе, я только что создал скрытые элементы флэш-уведомлений над областями, показывающими места и над областью, показывающей время. Всякий раз, когда люди вносят изменения, они будут видеть уведомление рядом с действием мыши.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/image/place%20notifications.jpg" alt="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." title="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." width="50" height="50"></figure><p>В будущем мы не будем показывать эти уведомления опытным пользователям.</p><p>Итак, если человек вносит изменения в какое-то время или место, мы вызываем <strong>displayNotifier()</strong>:</p><pre class="brush: javascript noskimlinks noskimwords">// users can say if a time is an option for them$("input[name="meeting-time-choice"]").on("switchChange.bootstrapSwitch", function(e, s) {  // set intval to pass via AJAX from boolean state  if (s)    state = 1;  else    state =0;  $.ajax({     url: "$urlPrefix/meeting-time-choice/set",     data: {id: e.target.id, "state": state},     success: function(data) {       displayNotifier("time");       refreshSend();       refreshFinalize();       return true;     }  });});JS;</pre><p>Этот код в /frontend/views/meeting/view.php гарантирует, что они не будут видеть оповещения повторно через сеанс. Он использует переменные сеанса для отслеживания того, была ли подсказка уже показана:</p><pre class="brush: javascript noskimlinks noskimwords">$session = Yii::$app-&gt;session;if ($session["displayHint"]=="on" || $model-&gt;status == $model::STATUS_PLANNING ) {  $notifierOkay="off";  $session-&gt;remove("displayHint");} else {  $notifierOkay="on";}?&gt;&lt;input id="notifierOkay" value="&lt;?= $notifierOkay ?&gt;" type="hidden"&gt;&lt;?php$script = &lt;&lt;&lt; JSvar notifierOkay; // meeting sent already and no page change session flashif  ($("#notifierOkay").val() == "on") {  notifierOkay = true;} else {  notifierOkay = false;}function displayNotifier(mode) {  if (notifierOkay) {    if (mode == "time") {      $("#notifierTime").show();    } else if (mode == "place") {       $("#notifierPlace").show();    } else {      alert("We\"ll automatically notify the organizer when you"re done making changes.");    }    notifierOkay=false;  }}</pre><h2>Что дальше?</h2><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/26594/image/featured%20-%20pt1.jpg" alt="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." title="Пишем свой стартап: уведомление пользователей об изменениях в стречах..." width="50" height="50"></figure><p>Я описал мое видение, которое я пытаюсь создать при планировании действий между участниками. В следующем уроке я покажу вам, как мы отслеживаем время, чтобы узнать, когда и как доставлять обновления. И я покажу вам, как мы доставляем обновления по электронной почте. Я также покажу вам, как мы создаем текстовое резюме последних изменений, которые были сделаны.</p><p>Пока вы ждете, попробуйте функцию уведомлений и <span>запланируйте первую встречу</span>. Кроме того, я был бы признателен, если вы поделитесь своим опытом ниже в комментариях, меня всегда интересуют ваши предложения. Вы также можете связаться со мной в Twitter <span>@reifman</span>.</p><p>Следите за предстоящими учебными пособиями в разделе серии <span>Пишем свой стартап на PHP</span>. Есть еще несколько больших функций.</p><h2>Ссылки по теме</h2><ul><li><span>Планировщик встреч</span></li> <li><span>Программирование с помощью Yii2: Начало работы</span></li> <li><span>Yii2 Developer Exchange</span></li> </ul>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Yii" href="https://norma-studio.github.io/article5/220825126-pishem-svoj-startap-uvedomlenie-polzovatelej-ob-izmeneniyah-v-strechah" class="tm-article-body__tags-item-link">Yii</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40384</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
540</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
