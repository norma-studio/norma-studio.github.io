
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="С базовой структурой для нашей платформы пришло время начать добавлять к ней функциональность. В этом руководстве мы создадим менеджер шаблонов и обработчик базы данных, что приблизит нас к мощной платформе, пригодной для использования практически в любом проекте. Если вы еще этого не сделали, обязательно сначала ознакомьтесь с первой частью...">
<meta property="og:description" content="С базовой структурой для нашей платформы пришло время начать добавлять к ней функциональность. В этом руководстве мы создадим менеджер шаблонов и обработчик базы данных, что приблизит нас к мощной платформе, пригодной для использования практически в любом проекте. Если вы еще этого не сделали, обязательно сначала ознакомьтесь с первой частью...">
<meta name="twitter:description" content="С базовой структурой для нашей платформы пришло время начать добавлять к ней функциональность. В этом руководстве мы создадим менеджер шаблонов и обработчик базы данных, что приблизит нас к мощной платформе, пригодной для использования практически в любом проекте. Если вы еще этого не сделали, обязательно сначала ознакомьтесь с первой частью...">
<meta property="aiturec:description" content="С базовой структурой для нашей платформы пришло время начать добавлять к ней функциональность. В этом руководстве мы создадим менеджер шаблонов и обработчик базы данных, что приблизит нас к мощной платформе, пригодной для использования практически в любом проекте. Если вы еще этого не сделали, обязательно сначала ознакомьтесь с первой частью...">
<meta property="og:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="aiturec:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta name="twitter:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="vk:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html" title="Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io" title="Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64535356345.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html" class="tm-user-info__username" title="
В. Чендылов" aria-label="
В. Чендылов">
В. Чендылов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создайте структуру PHP5 - часть 2...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2" class="tm-article-snippet__hubs-item-link"><span>PHP</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2.html" />
    <link itemprop="image" href="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
    <meta itemprop="headline name" content="Создайте структуру PHP5 - часть 2... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="С базовой структурой для нашей платформы пришло время начать добавлять к ней функциональность. В этом руководстве мы создадим менеджер шаблонов и обработчик базы данных, что приблизит нас к мощной платформе, пригодной для использования практически в любом проекте. Если вы еще этого не сделали, обязательно сначала ознакомьтесь с первой частью...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">С базовой структурой для нашей платформы пришло время начать добавлять к ней функциональность. В этом руководстве мы создадим менеджер шаблонов и обработчик базы данных, что приблизит нас к мощной платформе, пригодной для использования практически в любом проекте. Если вы еще этого не сделали, обязательно сначала ознакомьтесь с первой частью...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>С базовой структурой для нашей платформы пришло время начать добавлять к ней функциональность. В этом руководстве мы создадим менеджер шаблонов и обработчик базы данных, что приблизит нас к мощной платформе, пригодной для использования практически в любом проекте. Если вы еще этого не сделали, обязательно сначала <span>ознакомьтесь с первой частью</span> этой серии!<!--more--></p><div class="tutorial_image"> <span><br><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg" class="lazy07" alt="Создайте структуру PHP5 - часть 2..." title="Создайте структуру PHP5 - часть 2..." width="50" height="50"></span><br><span><br><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_demo_nm.jpg" class="lazy07" alt="Создайте структуру PHP5 - часть 2..." title="Создайте структуру PHP5 - часть 2..." width="50" height="50"></span> </div> <h3>MVC: настроить структуру</h3> <p>В первой части этого руководства мы создали папку с названием <strong>controllers</strong> для хранения бизнес-логики для наших приложений. Как отметил Даок в комментарии, это не лучшее место для всей бизнес-логики, и что <strong>модель</strong> должна использоваться для хранения этой логики. Раньше я всегда использовал саму базу данных в качестве модели в большинстве моих приложений, однако, выделив ее немного больше, мы сделаем нашу среду еще более мощной и ее будет легче расширять.</p> <p>Итак, что такое <strong>MVC</strong>? MVC - это шаблон проектирования (как и шаблоны Singleton и Registry, которые мы рассмотрели в первой части), он обозначает Model View Controller, и цель этого шаблона состоит в том, чтобы отделить бизнес-логику, действия пользовательского интерфейса и пользовательский интерфейс от друг друга. Хотя мы пока не будем ничего делать с нашими моделями и контроллерами, давайте обновим структуру папок наших структур, добавив в них папку «models». Модель будет содержать основную бизнес-логику, а контроллер будет заниматься взаимодействием с пользователем (например, отправкой данных, таких как комментарий). NB: Наш __ функция автогруза не должна быть изменена.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" border="0" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=364/net/uploads/legacy/071_PHPFramework2/1.png" alt="Создайте структуру PHP5 - часть 2..." title="Создайте структуру PHP5 - часть 2..." width="50" height="50"></div> <h3>Обработчик базы данных</h3> <p>использующих PHP, также используют механизм базы данных, такой как MySQL. Если мы сохраним все функции, связанные с базой данных, в одном месте, то (теоретически) мы сможем легко изменить используемый движок базы данных. Мы также можем упростить определенные операции, такие как вставка записей, обновление записей или удаление записей из базы данных. Это также может облегчить работу с несколькими подключениями к базе данных.</p> <p>Итак ... что должен делать <em>наш</em> обработчик базы данных:</p> <ul><li>Управление подключениями к базе данных</li> <li>Попробуйте обеспечить некоторый уровень абстракции от базы данных</li> <li>Кэшируйте запросы, чтобы мы могли использовать их позже</li> <li>Упростите общие операции с базами данных</li> </ul><p> Давайте посмотрим на код для нашего обработчика базы данных, а потом обсудим его.</p> <pre class="brush: php noskimlinks noskimwords">&lt;?php/** * Database management and access class * This is a very basic level of abstraction */class database {  /** * Allows multiple database connections * probably not used very often by many applications, but still useful */private $connections = array();/** * Tells the DB object which connection to use * setActiveConnection($id) allows us to change this */private $activeConnection = 0;/** * Queries which have been executed and then "saved for later" */private $queryCache = array();/** * Data which has been prepared and then "saved for later" */private $dataCache = array();/** * Record of the last query */private $last;/** * Hello */    public function __construct()    {        }        /**     * Create a new database connection     * @param String database hostname     * @param String database username     * @param String database password     * @param String database we are using     * @return int the id of the new connection     */    public function newConnection( $host, $user, $password, $database )    {    $this-&gt;connections[] = new mysqli( $host, $user, $password, $database );    $connection_id = count( $this-&gt;connections )-1;    if( mysqli_connect_errno() )    {    trigger_error("Error connecting to host. ".$this-&gt;connections[$connection_id]-&gt;error, E_USER_ERROR);}         return $connection_id;    }        /**     * Close the active connection     * @return void     */    public function closeConnection()    {    $this-&gt;connections[$this-&gt;activeConnection]-&gt;close();    }        /**     * Change which database connection is actively used for the next operation     * @param int the new connection id     * @return void     */    public function setActiveConnection( int $new )    {    $this-&gt;activeConnection = $new;    }        /**     * Store a query in the query cache for processing later     * @param String the query string     * @return the pointed to the query in the cache     */    public function cacheQuery( $queryStr )    {    if( !$result = $this-&gt;connections[$this-&gt;activeConnection]-&gt;query( $queryStr ) )    {    trigger_error("Error executing and caching query: ".$this-&gt;connections[$this-&gt;activeConnection]-&gt;error, E_USER_ERROR);    return -1;}else{$this-&gt;queryCache[] = $result;return count($this-&gt;queryCache)-1;}    }        /**     * Get the number of rows from the cache     * @param int the query cache pointer     * @return int the number of rows     */    public function numRowsFromCache( $cache_id )    {    return $this-&gt;queryCache[$cache_id]-&gt;num_rows;    }        /**     * Get the rows from a cached query     * @param int the query cache pointer     * @return array the row     */    public function resultsFromCache( $cache_id )    {    return $this-&gt;queryCache[$cache_id]-&gt;fetch_array(MYSQLI_ASSOC);    }        /**     * Store some data in a cache for later     * @param array the data     * @return int the pointed to the array in the data cache     */    public function cacheData( $data )    {    $this-&gt;dataCache[] = $data;    return count( $this-&gt;dataCache )-1;    }        /**     * Get data from the data cache     * @param int data cache pointed     * @return array the data     */    public function dataFromCache( $cache_id )    {    return $this-&gt;dataCache[$cache_id];    }        /**     * Delete records from the database     * @param String the table to remove rows from     * @param String the condition for which rows are to be removed     * @param int the number of rows to be removed     * @return void     */    public function deleteRecords( $table, $condition, $limit )    {    $limit = ( $limit == "" ) ? "" : " LIMIT " . $limit;    $delete = "DELETE FROM {$table} WHERE {$condition} {$limit}";    $this-&gt;executeQuery( $delete );    }        /**     * Update records in the database     * @param String the table     * @param array of changes field =&gt; value     * @param String the condition     * @return bool     */    public function updateRecords( $table, $changes, $condition )    {    $update = "UPDATE " . $table . " SET ";    foreach( $changes as $field =&gt; $value )    {    $update .= "`" . $field . "`="{$value}",";    }           // remove our trailing ,    $update = substr($update, 0, -1);    if( $condition != "" )    {    $update .= "WHERE " . $condition;    }        $this-&gt;executeQuery( $update );        return true;        }        /**     * Insert records into the database     * @param String the database table     * @param array data to insert field =&gt; value     * @return bool     */    public function insertRecords( $table, $data )    {    // setup some variables for fields and values    $fields  = "";$values = "";// populate themforeach ($data as $f =&gt; $v){$fields  .= "`$f`,";$values .= ( is_numeric( $v ) &amp;&amp; ( intval( $v ) == $v ) ) ? $v."," : ""$v",";}// remove our trailing ,    $fields = substr($fields, 0, -1);    // remove our trailing ,    $values = substr($values, 0, -1);    $insert = "INSERT INTO $table ({$fields}) VALUES({$values})";$this-&gt;executeQuery( $insert );return true;    }        /**     * Execute a query string     * @param String the query     * @return void     */    public function executeQuery( $queryStr )    {    if( !$result = $this-&gt;connections[$this-&gt;activeConnection]-&gt;query( $queryStr ) )    {    trigger_error("Error executing query: ".$this-&gt;connections[$this-&gt;activeConnection]-&gt;error, E_USER_ERROR);}else{$this-&gt;last = $result;}    }        /**     * Get the rows from the most recently executed query, excluding cached queries     * @return array      */    public function getRows()    {    return $this-&gt;last-&gt;fetch_array(MYSQLI_ASSOC);    }        /**     * Gets the number of affected rows from the previous query     * @return int the number of affected rows     */    public function affectedRows()    {    return $this-&gt;$this-&gt;connections[$this-&gt;activeConnection]-&gt;affected_rows;    }        /**     * Sanitize data     * @param String the data to be sanitized     * @return String the sanitized data     */    public function sanitizeData( $data )    {    return $this-&gt;connections[$this-&gt;activeConnection]-&gt;real_escape_string( $data );    }        /**     * Deconstruct the object     * close all of the database connections     */    public function __deconstruct()    {    foreach( $this-&gt;connections as $connection )    {    $connection-&gt;close();    }    }}?&gt;</pre> <p> Прежде чем обсуждать это более подробно, я должен отметить, что этот обработчик базы данных очень прост. Мы могли бы обеспечить полную абстракцию, не выполняя запросы напрямую, а вместо этого создавая запросы на основе параметров для функции запроса, а затем выполняя ее.</p> <p>Наши методы удаления, вставки и обновления записи облегчают выполнение некоторых распространенных задач (как я упоминал выше, мы могли бы расширить это, чтобы сделать намного больше), предоставляя только такую ​​информацию, как имя таблицы, массив полей и значения, соответствующие ядру, предельные значения и условия. Запросы также можно «кэшировать», чтобы мы могли что-то сделать с ними позже. Я считаю, что эта функция (а также возможность «кэшировать» массивы данных) очень удобна в сочетании с менеджером шаблонов, так как мы можем легко перебирать строки данных и вносить их в наши шаблоны без особых усилий, как вы будете посмотрим, когда мы посмотрим на менеджер шаблонов.</p> <pre class="brush: php noskimlinks noskimwords">// insert record$registry-&gt;getObject("db")-&gt;insertRecords( "testTable", array("name"=&gt;"Michael" ) );// update a record$registry-&gt;getObject("db")-&gt;updateRecords( "testTable", array("name"=&gt;"MichaelP" ), "ID=2" );// delete a record (well, upto 5 in this case)$registry-&gt;getObject("db")-&gt;deleteRecords( "testTable", "name="MichaelP"", 5 );</pre> <p>Мы также можем относительно легко работать с несколькими соединениями с базой данных, если мы переключаемся между подходящими соединениями, когда это необходимо (хотя это не будет работать при кэшировании запросов и получении их через наш менеджер шаблонов без дальнейшей работы), например, фрагмент кода ниже позволит нам удалить записи из двух баз данных.</p> <pre class="brush: php noskimlinks noskimwords">// our second database connection (let"s assume we already have a connection to our main DB)$newConnection = $registry-&gt;getObject("db")-&gt;newConnection("localhost", "root", "password", "secondDB");// delete from the primary db connection$registry-&gt;getObject("db")-&gt;deleteRecords( "testTable", "name="MichaelP"", 5 );// change our active db connection, to allow future queries to be on the second connection$registry-&gt;getObject("db")-&gt;setActiveConnection( $newConnection );// delete from the secondary db connection$registry-&gt;getObject("db")-&gt;deleteRecords( "testTable", "name="MichaelP"", 5 );// revert the active connection so future queries are on the primary db connection$registry-&gt;getObject("db")-&gt;setActiveConnection( 0 );</pre> <p>Как мы можем расширить этот класс?</p> <ul><li>Полная абстракция </li> <li>Используйте наследование, создайте интерфейс и наследуйте от него классы базы данных, каждый для разных механизмов базы данных</li> <li>Сохраняйте идентификаторы соединения вместе с запросом при кэшировании запросов</li> <li>Улучшение санации данных в зависимости от типа данных, которые мы хотим санировать</li> </ul><h3>Диспетчер шаблонов </h3> <p>Менеджер шаблонов будет обрабатывать все выходные данные, он должен уметь работать с различными файлами шаблонов, заменять заполнители (я называю их тегами) данными и выполнять итерации по частям шаблона с несколькими строками данных из базы данных.</p> <p> Чтобы упростить задачу, мы будем использовать класс страницы для содержания, связанного со страницей, это также облегчит нам его расширение и добавление функций к нему позже. Менеджер шаблонов будет управлять этим объектом.</p> <pre class="brush: php noskimlinks noskimwords">&lt;?php// prevent this file being called directlyif ( ! defined( "PCAFW" ) ) {echo "This file can only be called via the main index.php file, and not directly";exit();}/** * Template manager class */class template {private $page;/** * Hello! */    public function __construct()     {    include( APP_PATH . "/PCARegistry/objects/page.class.php");    $this-&gt;page = new Page();    }        /**     * Add a template bit onto our page     * @param String $tag the tag where we insert the template e.g. {hello}     * @param String $bit the template bit (path to file, or just the filename)     * @return void     */    public function addTemplateBit( $tag, $bit )    {if( strpos( $bit, "skins/" ) === false ){    $bit = "skins/" . PCARegistry::getSetting("skin") . "/templates/" . $bit;}$this-&gt;page-&gt;addTemplateBit( $tag, $bit );    }        /**     * Put the template bits into our page content     * Updates the pages content     * @return void     */    private function replaceBits()    {    $bits = $this-&gt;page-&gt;getBits();    foreach( $bits as $tag =&gt; $template )    {    $templateContent = file_get_contents( $bit );    $newContent = str_replace( "{" . $tag . "}", $templateContent, $this-&gt;page-&gt;getContent() );    $this-&gt;page-&gt;setContent( $newContent );    }    }        /**     * Replace tags in our page with content     * @return void     */    private function replaceTags()    {    // get the tags    $tags = $this-&gt;page-&gt;getTags();    // go through them all    foreach( $tags as $tag =&gt; $data )    {    if( is_array( $data ) )    {      if( $data[0] == "SQL" )    {    // it is a cached query...replace DB tags    $this-&gt;replaceDBTags( $tag, $data[1] );    }    elseif( $data[0] == "DATA" )    {     // it is some cached data...replace data tags    $this-&gt;replaceDataTags( $tag, $data[1] );    }    }    else    {    // replace the content        $newContent = str_replace( "{" . $tag . "}", $data, $this-&gt;page-&gt;getContent() );    // update the pages content    $this-&gt;page-&gt;setContent( $newContent );    }    }    }        /**     * Replace content on the page with data from the DB     * @param String $tag the tag defining the area of content     * @param int $cacheId the queries ID in the query cache     * @return void     */    private function replaceDBTags( $tag, $cacheId )    {    $block = "";$blockOld = $this-&gt;page-&gt;getBlock( $tag );// foreach record relating to the query...while ($tags = PCARegistry::getObject("db")-&gt;resultsFromCache( $cacheId ) ){$blockNew = $blockOld;// create a new block of content with the results replaced into itforeach ($tags as $ntag =&gt; $data)        {        $blockNew = str_replace("{" . $ntag . "}", $data, $blockNew);         }        $block .= $blockNew;}$pageContent = $this-&gt;page-&gt;getContent();// remove the seperator in the template, cleaner HTML$newContent = str_replace( "&lt;!-- START " . $tag . " --&gt;" . $blockOld . "&lt;!-- END " . $tag . " --&gt;", $block, $pageContent );// update the page content$this-&gt;page-&gt;setContent( $newContent );}    /**     * Replace content on the page with data from the cache     * @param String $tag the tag defining the area of content     * @param int $cacheId the datas ID in the data cache     * @return void     */    private function replaceDataTags( $tag, $cacheId )    {    $block = $this-&gt;page-&gt;getBlock( $tag );$blockOld = $block;while ($tags = PCARegistry::getObject("db")-&gt;dataFromCache( $cacheId ) ){foreach ($tags as $tag =&gt; $data)        {       $blockNew = $blockOld;        $blockNew = str_replace("{" . $tag . "}", $data, $blockNew);         }        $block .= $blockNew;}$pageContent = $this-&gt;page-&gt;getContent();$newContent = str_replace( $blockOld, $block, $pageContent );$this-&gt;page-&gt;setContent( $newContent );    }        /**     * Get the page object     * @return Object      */    public function getPage()    {    return $this-&gt;page;    }        /**     * Set the content of the page based on a number of templates     * pass template file locations as individual arguments     * @return void     */    public function buildFromTemplates()    {    $bits = func_get_args();    $content = "";    foreach( $bits as $bit )    {        if( strpos( $bit, "skins/" ) === false )    {    $bit = "skins/" . PCARegistry::getSetting("skin") . "/templates/" . $bit;    }    if( file_exists( $bit ) == true )    {    $content .= file_get_contents( $bit );    }        }    $this-&gt;page-&gt;setContent( $content );    }        /**     * Convert an array of data (i.e. a db row?) to some tags     * @param array the data      * @param string a prefix which is added to field name to create the tag name     * @return void     */    public function dataToTags( $data, $prefix )    {    foreach( $data as $key =&gt; $content )    {    $this-&gt;page-&gt;addTag( $key.$prefix, $content);    }    }        public function parseTitle()    {    $newContent = str_replace("&lt;title&gt;", "&lt;title&gt;". $page-&gt;getTitle(), $this-&gt;page-&gt;getContent() );    $this-&gt;page-&gt;setContent( $newContent );    }        /**     * Parse the page object into some output     * @return void     */    public function parseOutput()    {    $this-&gt;replaceBits();    $this-&gt;replaceTags();    $this-&gt;parseTitle();    }            }?&gt;</pre> <p> <em>Итак, что именно делает этот класс?</em> </p> <p> <strong>Создает наш объект страницы и основывает его на файлах шаблонов</strong>. Объект страницы содержит содержимое и информацию, необходимые для создания HTML-кода страницы. Затем мы собираем buildFromTemplate ("templatefile.tpl.php", "templatefile2.tpl.php"), чтобы получить начальный контент для нашей страницы, этот метод принимает любое количество файлов шаблонов в качестве аргументов,и объединяет их по порядку, полезно для шаблонов заголовка, содержимого и нижнего колонтитула.</p> <p> <strong>Управляет контентом, связанным со страницей</strong>, помогая объекту страницы поддерживать запись данных, подлежащих замене на странице, а также дополнительные биты шаблона, которые необходимо включить в страницу (addTemplateBit ("userbar", "usertoolsbar.tpl.php) «)).</p> <p> <strong>Добавляет данные и содержимое на страницу</strong>, выполняя различные операции замены содержимого страницы, включая получение результатов из кэшированного запроса и добавление их на страницу.</p> <p>Файл шаблона должен отмечать внутри себя, где должен быть извлечен кэшированный запрос и заменены данные из запроса. Когда менеджер шаблонов встречает тег для замены, являющийся запросом, он получает часть страницы, на которой ему нужно пройти итерацию, вызывая getBlock ("block") для объекта страницы. Этот кусок контента затем копируется для каждой записи в запросе, и внутри него заменяются теги с результатами запроса. Мы посмотрим, как это будет выглядеть в шаблоне позже в этом уроке.</p> <h3>Диспетчер шаблонов: страница</h3> <p>Объект страницы управляется менеджером шаблонов, и он содержит все детали, связанные со страницей. Это позволяет управлять менеджером шаблонов, в то же время упрощая для нас расширение функциональности этого на более позднем этапе.</p> <pre class="brush: php noskimlinks noskimwords">&lt;?php/** * This is our page object * It is a seperate object to allow some interesting extra functionality to be added * Some ideas: passwording pages, adding page specific css/js files, etc */class page {// room to grow later?private $css = array();private $js = array();private $bodyTag = "";private $bodyTagInsert = "";// future functionality?private $authorised = true;private $password = "";// page elementsprivate $title = "";private $tags = array();private $postParseTags = array();private $bits = array();private $content = "";/** * Constructor... */    function __construct() { }        public function getTitle()    {    return $this-&gt;title;    }        public function setPassword( $password )    {    $this-&gt;password = $password;    }         public function setTitle( $title )    {    $this-&gt;title = $title;    }        public function setContent( $content )    {    $this-&gt;content = $content;    }        public function addTag( $key, $data )    {    $this-&gt;tags[$key] = $data;    }        public function getTags()    {    return $this-&gt;tags;    }        public function addPPTag( $key, $data )    {    $this-&gt;postParseTags[$key] = $data;    }        /**     * Get tags to be parsed after the first batch have been parsed     * @return array     */    public function getPPTags()    {    return $this-&gt;postParseTags;    }        /**     * Add a template bit to the page, doesnt actually add the content just yet     * @param String the tag where the template is added     * @param String the template file name     * @return void     */    public function addTemplateBit( $tag, $bit )    {    $this-&gt;bits[ $tag ] = $bit;    }        /**     * Get the template bits to be entered into the page     * @return array the array of template tags and template file names     */    public function getBits()    {    return $this-&gt;bits;    }        /**     * Gets a chunk of page content     * @param String the tag wrapping the block ( &lt;!-- START tag --&gt; block &lt;!-- END tag --&gt; )     * @return String the block of content     */    public function getBlock( $tag )    {preg_match ("#&lt;!-- START ". $tag . " --&gt;(.+?)&lt;!-- END ". $tag . " --&gt;#si", $this-&gt;content, $tor);$tor = str_replace ("&lt;!-- START ". $tag . " --&gt;", "", $tor[0]);$tor = str_replace ("&lt;!-- END "  . $tag . " --&gt;", "", $tor);return $tor;    }        public function getContent()    {    return $this-&gt;content;    }  }?&gt;</pre> <p>Как этот класс можно расширить и улучшить?</p> <ul><li>PostParseTags: Вы можете захотеть заменить теги <em>после </em>того, как большая часть страницы будет проанализирована, возможно, содержимое в базе данных содержит теги, которые необходимо проанализировать.</li> <li>траницы с паролем: назначьте пароль странице, проверьте, есть ли у пользователя пароль в файле cookie или сеансе, чтобы они могли видеть страницу.</li> <li>Страницы с ограниченным доступом (хотя сначала нам нужны наши компоненты аутентификации!)</li> <li>Изменение </li> <li>Динамическое добавление ссылок на файлы JavaScript и CSS на основе страницы или приложения.</li> </ul><h3>Загрузить основные объекты</h3> <p>Теперь, когда у нас есть некоторые объекты, которые наш реестр собирается хранить для нас, нам нужно сообщить реестру, какие это объекты. Я создал метод в объекте PCARegistry под названием loadCoreObjects, который (как говорится) загружает основные объекты. Это означает, что можно просто вызвать это из нашего файла index.php, чтобы загрузить реестр с этими объектами.</p> <pre class="brush: php noskimlinks noskimwords">public function storeCoreObjects(){$this-&gt;storeObject("database", "db" );$this-&gt;storeObject("template", "template" );}</pre> <p>Этот метод может быть изменен позже, чтобы включить другие основные объекты, которые должен загружать реестр, конечно, могут быть объекты, которыми мы хотим управлять нашим реестром, но только в зависимости от приложения, для которого используется среда. Эти объекты будут загружены вне этого метода.</p> <h3>Некоторые данные</h3> <p>Чтобы мы могли продемонстрировать новые функции, добавленные в нашу инфраструктуру, нам нужна база данных для использования обработчика базы данных и некоторые функции управления шаблонами (где мы заменяем блок контента строками в базе данных).</p> <p>Демонстрационный сайт, который мы создадим с нашей платформой к концу этой серии учебных пособий, - это веб-сайт с каталогом участников, поэтому давайте создадим очень простую таблицу базы данных для профилей участников, содержащую идентификатор, имя и адрес электронной почты.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" border="0" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=762/net/uploads/legacy/071_PHPFramework2/2.png" alt="Создайте структуру PHP5 - часть 2..." title="Создайте структуру PHP5 - часть 2..." width="50" height="50"></div> <p>Очевидно, нам нужно несколько строк данных в этой таблице!</p> <h3>Быстрый шаблон </h3> <p>Для того, чтобы что-либо отображалось, нам нужен базовый шаблон, в котором мы будем перечислять данные из нашей таблицы участников.</p> <pre class="brush: html noskimlinks noskimwords">&lt;html&gt;&lt;head&gt;&lt;title&gt; Powered by PCA Framework&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Our Members&lt;/h1&gt;&lt;p&gt;Below is a list of our members:&lt;/p&gt;&lt;ul&gt;&lt;!-- START members --&gt;&lt;li&gt;{name} {email}&lt;/li&gt;&lt;!-- END members --&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;</pre> <p> HTML-комментарии членов START и END обозначают блок members (который получается с помощью метода getBlock () на странице), здесь менеджер шаблонов будет перебирать записи в базе данных и отображать их.</p> <h3>Структура в использовании</h3> <p>Теперь, мы должны принести это все вместе с нашим index.php файлом:</p> <pre class="brush: php noskimlinks noskimwords">// require our registryrequire_once("PCARegistry/pcaregistry.class.php");$registry = PCARegistry::singleton();// store those core objects$registry-&gt;storeCoreObjects();// create a database connection$registry-&gt;getObject("db")-&gt;newConnection("localhost", "root", "", "pcaframework");// set the default skin setting (we will store these in the database later...)$registry-&gt;storeSetting("default", "skin");// populate our page object from a template file$registry-&gt;getObject("template")-&gt;buildFromTemplates("main.tpl.php");// cache a query of our members table$cache = $registry-&gt;getObject("db")-&gt;cacheQuery("SELECT * FROM members");// assign this to the members tag$registry-&gt;getObject("template")-&gt;getPage()-&gt;addTag("members", array("SQL", $cache) );// set the page title$registry-&gt;getObject("template")-&gt;getPage()-&gt;setTitle("Our members");// parse it all, and spit it out$registry-&gt;getObject("template")-&gt;parseOutput();print $registry-&gt;getObject("template")-&gt;getPage()-&gt;getContent();</pre> <p>Если мы теперь просматриваем эту страницу в нашем веб-браузере, результаты вопроса показаны на странице:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" border="0" data-src="https://cdn.tutsplus.com/net/uploads/legacy/071_PHPFramework2/3.png" class="lazy07" alt="Создайте структуру PHP5 - часть 2..." title="Создайте структуру PHP5 - часть 2..." width="50" height="50"></div> <h3>Переход в 3-ю часть  ...</h3> <p>В третьей части мы немного отклонимся от стороны разработки нашей платформы и рассмотрим, как проектировать с учетом нашей инфраструктуры и как нарезать шаблоны HTML таким образом, чтобы они подходили для нашей платформы. Когда мы начнем создавать наше первое приложение с нашей платформой, мы более подробно рассмотрим некоторые из этих классов. Наконец, спасибо за ваши комментарии в прошлый раз!</p> <ul class="webroundup"><li>Подпишитесь на <span>RSS-канал NETTUTS</span>, чтобы узнать больше о новостях и статьях о веб-разработке.</li> </ul><p> <br></p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825770-sozdaite-strukturu-php5--chast-2" class="tm-article-body__tags-item-link">PHP</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
34117</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
556</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
