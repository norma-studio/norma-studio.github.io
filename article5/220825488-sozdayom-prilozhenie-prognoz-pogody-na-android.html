
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Многие популярные приложения прогноза погоды в Google Play либо содержат много рекламы, либо требуют слишком большого количества разрешений, либо содержат функционал, который большинство из нас никогда не используют. Было бы здорово, если бы мы могли создать собственное приложение погоды с нуля?...">
<meta property="og:description" content="Многие популярные приложения прогноза погоды в Google Play либо содержат много рекламы, либо требуют слишком большого количества разрешений, либо содержат функционал, который большинство из нас никогда не используют. Было бы здорово, если бы мы могли создать собственное приложение погоды с нуля?...">
<meta name="twitter:description" content="Многие популярные приложения прогноза погоды в Google Play либо содержат много рекламы, либо требуют слишком большого количества разрешений, либо содержат функционал, который большинство из нас никогда не используют. Было бы здорово, если бы мы могли создать собственное приложение погоды с нуля?...">
<meta property="aiturec:description" content="Многие популярные приложения прогноза погоды в Google Play либо содержат много рекламы, либо требуют слишком большого количества разрешений, либо содержат функционал, который большинство из нас никогда не используют. Было бы здорово, если бы мы могли создать собственное приложение погоды с нуля?...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=480/uploads/users/362/posts/21587/final_image/p2.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=480/uploads/users/362/posts/21587/final_image/p2.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=480/uploads/users/362/posts/21587/final_image/p2.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=480/uploads/users/362/posts/21587/final_image/p2.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=480/uploads/users/362/posts/21587/final_image/p2.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html" title="Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io" title="Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/65404fb3f3f8602d7f5b3bdc85cbef02.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html" class="tm-user-info__username" title="
А. Крайнов" aria-label="
А. Крайнов">
А. Крайнов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создаём приложение “прогноз погоды” на Android
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android" class="tm-article-snippet__hubs-item-link"><span>Android SDK</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=480/uploads/users/362/posts/21587/final_image/p2.png">
    <meta itemprop="headline name" content="Создаём приложение “прогноз погоды” на Android
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Многие популярные приложения прогноза погоды в Google Play либо содержат много рекламы, либо требуют слишком большого количества разрешений, либо содержат функционал, который большинство из нас никогда не используют. Было бы здорово, если бы мы могли создать собственное приложение погоды с нуля?...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Многие популярные приложения прогноза погоды в Google Play либо содержат много рекламы, либо требуют слишком большого количества разрешений, либо содержат функционал, который большинство из нас никогда не используют. Было бы здорово, если бы мы могли создать собственное приложение погоды с нуля?...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



 <p>Многие популярные приложения прогноза погоды в Google Play либо содержат много рекламы, либо требуют слишком большого количества разрешений, либо содержат функционал, который большинство из нас никогда не используют. Было бы здорово, если бы мы могли создать собственное приложение погоды с нуля?</p><p>В этом уроке я покажу вам, как это сделать. Наше приложение будет иметь простой и минималистичный пользовательский интерфейс, показывающий пользователю именно то, что ему нужно знать о текущих погодных условиях. Давайте начнем.</p><h2> <span class="sectionnum">1. Подготовка</span></h2><p>Прежде чем продолжить, дважды проверьте, что у вас установлены следующие компоненты:</p><ul><li> <b>Eclipse ADT Bundle</b>: вы можете скачать его на <span>веб-сайте разработчика Android</span>.<br></li> <li> <b>Ключ API</b> <b>OpenWeatherMap</b> : это не обязательно для выполнения нашей задачи, но это бесплатно. Вы можете получить его, зарегистрировавшись на <span>сайте OpenWeatherMap</span>.<br></li> <li> <b>Иконки</b>: Я рекомендую вам скачать шрифт weather icons font, созданный <span>Эриком Флорсом</span>. Вам нужно загрузить файл <span>TTF</span>, потому что мы будем использовать его в нативном приложении. Мы будем использовать этот шрифт чтобы показывать различные значки в зависимости от погодных условий.<br></li> </ul><h2> <span class="sectionnum">2. Создадим новый проект</span></h2><p>Я собираюсь назвать это приложение <b>SimpleWeather</b>, но вы можете дать ему любое имя, которое вам понравится. Введите уникальное имя пакета, установите минимальный необходимый SDK на <b>Android 2.2</b> и установите целевой SDK на <b>Android 4.4</b>. Вы можете оставить тему <b>Holo Dark</b>.<br></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/362/posts/21587/image/step1a.png" alt="Создаём приложение “прогноз погоды” на Android..." title="Создаём приложение “прогноз погоды” на Android..." width="50" height="50"></figure><p>Это приложение будет иметь только одно <code class="inline">Activity</code>, и оно будет основано на шаблоне <b>Blank Activity</b>, как показано ниже.<br></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/362/posts/21587/image/step2.png" alt="Создаём приложение “прогноз погоды” на Android..." title="Создаём приложение “прогноз погоды” на Android..." width="50" height="50"></figure><p>Назовите <code class="inline">Activity</code> <b>WeatherActivity</b>. Мы будем использовать <code class="inline">Fragment</code> внутри этого <code class="inline">Activity</code>. Макет, связанный с <code class="inline">Activity</code> называется <b>activity_weather.xml</b>. Макет, связанный с <code class="inline">Fragment</code> называется <b>fragment _weather.xml</b>.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/362/posts/21587/image/step3.png" alt="Создаём приложение “прогноз погоды” на Android..." title="Создаём приложение “прогноз погоды” на Android..." width="50" height="50"></figure><h2> <span class="sectionnum">3. Добавим пользовательский шрифт</span></h2><p>Скопируйте <b>weathericons-regular-webfont.ttf</b> в каталог <b>assets/fonts</b> вашего проекта и переименуйте его в <b>weather.ttf</b>.<br></p><h2> <span class="sectionnum">4. Отредактируем файл манифеста</span></h2><p>Единственное разрешение, которое требуется этому приложению - это <code class="inline">android.permission.INTERNET</code>.</p><pre class="brush: xml noskimlinks noskimwords">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;</pre><br><p>Чтобы упростить этот урок, мы рассмотрим только <b>портретный</b> режим. Узел <code class="inline">activity</code> манифеста должен выглядеть так:</p><pre class="brush: xml noskimlinks noskimwords">&lt;activity    android:name="ah.hathi.simpleweather.WeatherActivity"    android:label="@string/app_name"    android:screenOrientation="portrait"    &gt;    &lt;intent-filter&gt;      &lt;action android:name="android.intent.action.MAIN" /&gt;      &lt;category android:name="android.intent.category.LAUNCHER" /&gt;    &lt;/intent-filter&gt;&lt;/activity&gt;</pre><h2> <span class="sectionnum">5. Отредактируем макет Activity</span></h2><p>В <b>activity_weather.xml</b> изменений не так много. Он должен уже включать в себя <code class="inline">FrameLayout</code>. Добавьте дополнительное свойство, чтобы изменить <code class="inline">цвет фона</code> на <code class="inline">#FF0099CC</code>.<br></p><pre class="brush: xml noskimlinks noskimwords">&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"    xmlns:tools="http://schemas.android.com/tools"    android:id="@+id/container"    android:layout_width="match_parent"    android:layout_height="match_parent"    tools:context="ah.hathi.simpleweather.WeatherActivity"    tools:ignore="MergeRootFrame"    android:background="#FF0099CC" /&gt;</pre><h2> <span class="sectionnum">6. Отредактируем макет Fragment</span></h2><p>Измените файл <b>fragment_weather.xml</b>, добавив пять тегов <code class="inline">TextView</code>, чтобы отобразить следующую информацию:<br></p><ul><li>город и страна<br></li> <li>текущая температура</li> <li>значок, показывающий текущее погодное условие</li> <li>отметка времени, указывающая пользователю, когда было получено последнее обновление информация о погоде</li> <li>более подробная информация о текущей погоде, например, описание и влажность<br></li> </ul><p>Используйте <code class="inline">RelativeLayout</code> для размещения текстовых представлений. Вы можете настроить <code class="inline">textSize</code> для различных устройств.<br></p><pre class="brush: xml noskimlinks noskimwords">&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"    xmlns:tools="http://schemas.android.com/tools"    android:layout_width="match_parent"    android:layout_height="match_parent"    android:paddingBottom="@dimen/activity_vertical_margin"    android:paddingLeft="@dimen/activity_horizontal_margin"    android:paddingRight="@dimen/activity_horizontal_margin"    android:paddingTop="@dimen/activity_vertical_margin"    tools:context="ah.hathi.simpleweather.WeatherActivity$PlaceholderFragment" &gt;    &lt;TextView        android:id="@+id/city_field"        android:layout_width="wrap_content"        android:layout_height="wrap_content"        android:layout_alignParentTop="true"        android:layout_centerHorizontal="true"        android:textAppearance="?android:attr/textAppearanceLarge" /&gt;    &lt;TextView        android:id="@+id/updated_field"        android:layout_width="wrap_content"        android:layout_height="wrap_content"        android:layout_below="@+id/city_field"        android:layout_centerHorizontal="true"        android:textAppearance="?android:attr/textAppearanceMedium"        android:textSize="13sp" /&gt;    &lt;TextView        android:id="@+id/weather_icon"        android:layout_width="wrap_content"        android:layout_height="wrap_content"                android:layout_centerVertical="true"        android:layout_centerHorizontal="true"        android:textAppearance="?android:attr/textAppearanceLarge"        android:textSize="70sp"        /&gt;    &lt;TextView        android:id="@+id/current_temperature_field"        android:layout_width="wrap_content"        android:layout_height="wrap_content"        android:layout_alignParentBottom="true"        android:layout_centerHorizontal="true"        android:textAppearance="?android:attr/textAppearanceLarge"        android:textSize="40sp" /&gt;    &lt;TextView         android:id="@+id/details_field"        android:layout_width="wrap_content"        android:layout_height="wrap_content"        android:layout_below="@+id/weather_icon"        android:layout_centerHorizontal="true"        android:textAppearance="?android:attr/textAppearanceMedium"        /&gt;        &lt;/RelativeLayout&gt;</pre><h2> <span class="sectionnum">7. Изменим strings.xml</span></h2><p>Этот файл содержит строки, используемые в нашем приложении, а также коды символов Юникода, которые мы будем использовать для отображения значков погоды. Приложение сможет отображать восемь различных типов погодных условий. Если вам нужно больше, примените <span>следующую хитрость</span>. Добавьте следующие значения в файл <b>values/strings.xml</b>:</p><pre class="brush: xml noskimlinks noskimwords">&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;resources&gt;    &lt;string name="app_name"&gt;Simple Weather&lt;/string&gt;    &lt;string name="change_city"&gt;Change city&lt;/string&gt;    &lt;!-- Put your own APP ID here --&gt;    &lt;string name="open_weather_maps_app_id"&gt;11111&lt;/string&gt;        &lt;string name="weather_sunny"&gt;&amp;#xf00d;&lt;/string&gt;    &lt;string name="weather_clear_night"&gt;&amp;#xf02e;&lt;/string&gt;        &lt;string name="weather_foggy"&gt;&amp;#xf014;&lt;/string&gt;    &lt;string name="weather_cloudy"&gt;&amp;#xf013;&lt;/string&gt;    &lt;string name="weather_rainy"&gt;&amp;#xf019;&lt;/string&gt;    &lt;string name="weather_snowy"&gt;&amp;#xf01b;&lt;/string&gt;    &lt;string name="weather_thunder"&gt;&amp;#xf01e;&lt;/string&gt;    &lt;string name="weather_drizzle"&gt;&amp;#xf01c;&lt;/string&gt;        &lt;string name="place_not_found"&gt;Sorry, no weather data found.&lt;/string&gt;        &lt;/resources&gt;</pre><h2> <span class="sectionnum">8. Добавим пункт меню</span><br></h2><p>Пользователь должен иметь возможность выбирать город, чью погоду они хотят видеть. Измените файл <b>menu/weather.xml</b> и добавьте элемент для этой опции.</p><pre class="brush: xml noskimlinks noskimwords">&lt;menu xmlns:android="http://schemas.android.com/apk/res/android"    xmlns:app="http://schemas.android.com/apk/res-auto"    xmlns:tools="http://schemas.android.com/tools"    tools:context="ah.hathi.simpleweather.WeatherActivity" &gt;    &lt;item        android:id="@+id/change_city"        android:orderInCategory="1"        android:title="@string/change_city"        app:showAsAction="never"/&gt;&lt;/menu&gt;</pre><p>Теперь, когда все XML-файлы готовы к использованию, давайте перейдем к запросу на API OpenWeatherMap для получения данных о погоде.<br></p><h2> <span class="sectionnum">9. Получаем данные из OpenWeatherMap</span></h2><p>Мы можем получить текущие данные о погоде в любом городе, в формате JSON, с помощью API OpenWeatherMap. В строке запроса мы передаем имя города и систему измерения, в которой должны быть результаты.</p><p>Например, чтобы получить текущую информацию о погоде в Канберре, используя метрическую систему, мы отправляем запрос на<span> http://api.openweathermap.org/data/2.5/weather?q=Canberra&amp;units=metric</span></p><p>Ответ, который мы получаем через API, выглядит так:<br></p><pre class="brush: javascript noskimlinks noskimwords">{    "base": "cmc stations",     "clouds": {        "all": 90    },     "cod": 200,     "coord": {        "lat": -35.28,         "lon": 149.13    },     "dt": 1404390600,     "id": 2172517,     "main": {        "humidity": 100,         "pressure": 1023,         "temp": -1,         "temp_max": -1,         "temp_min": -1    },     "name": "Canberra",     "sys": {        "country": "AU",         "message": 0.313,         "sunrise": 1404335563,         "sunset": 1404370965    },     "weather": [        {            "description": "overcast clouds",             "icon": "04n",             "id": 804,             "main": "Clouds"        }    ],     "wind": {        "deg": 305.004,         "speed": 1.07    }}</pre><p>Создайте новый класс Java и назовите его <b>RemoteFetch.java</b>. Этот класс отвечает за получение данных о погоде через API OpenWeatherMap.</p><p>Мы используем класс <code class="inline">HttpURLConnection</code> для выполнения удаленного запроса. API OpenWeatherMap ожидает ключ API в HTTP-заголовке с именем <code class="inline">x-api-key</code>. Это определено в нашем запросе с использованием метода <code class="inline">setRequestProperty</code>.</p><p>Мы используем <code class="inline">BufferedReader</code> для чтения ответа API в <code class="inline">StringBuffer</code>. Когда мы получим полный ответ, мы преобразуем его в объект <code class="inline">JSONObject</code>.<br></p><p>Как видно из приведенного выше ответа, данные JSON содержат поле с именем <code class="inline">cod</code>. Его значение равно <code class="inline">200</code>, если запрос был успешным. Мы используем это значение, чтобы проверить, имеет ли ответ JSON текущую информацию о погоде или нет.</p><p>Класс <b>RemoteFetch.java</b> должен выглядеть следующим образом:<br></p><pre class="brush: java noskimlinks noskimwords">package ah.hathi.simpleweather;import java.io.BufferedReader;import java.io.InputStreamReader;import java.net.HttpURLConnection;import java.net.URL;import org.json.JSONObject;import android.content.Context;import android.util.Log;public class RemoteFetch {    private static final String OPEN_WEATHER_MAP_API =   "http://api.openweathermap.org/data/2.5/weather?q=%s&amp;units=metric";public static JSONObject getJSON(Context context, String city){try {URL url = new URL(String.format(OPEN_WEATHER_MAP_API, city));HttpURLConnection connection = (HttpURLConnection)url.openConnection();connection.addRequestProperty("x-api-key", context.getString(R.string.open_weather_maps_app_id));BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));StringBuffer json = new StringBuffer(1024);String tmp="";while((tmp=reader.readLine())!=null)json.append(tmp).append("\n");reader.close();JSONObject data = new JSONObject(json.toString());// This value will be 404 if the request was not// successfulif(data.getInt("cod") != 200){return null;}return data;}catch(Exception e){return null;}}}</pre><h2> <span class="sectionnum">10. Сохраним город в настройках</span></h2><p>Пользователь не должен указывать имя города каждый раз, когда захочет использовать приложение.  Приложение должно запомнить последний город, который искал пользователь.  Мы делаем это, используя <code class="inline">SharedPreferences</code>. Однако вместо прямого доступа к этим настройкам из нашего класса <code class="inline">Activity</code>, для этого лучше создать отдельный класс.</p><p>Создайте новый класс Java и назовите его <b>CityPreference.java</b>. Чтобы сохранить и получить имя города, создайте два метода <code class="inline">setCity</code> и <code class="inline">getCity</code>. Объект <code class="inline">SharedPreferences</code> инициализируется в конструкторе. Класс <b>CityPreference.java</b> должен выглядеть следующим образом:<b><br></b></p><pre class="brush: java noskimlinks noskimwords">package ah.hathi.simpleweather;import android.app.Activity;import android.content.SharedPreferences;public class CityPreference {    SharedPreferences prefs;public CityPreference(Activity activity){prefs = activity.getPreferences(Activity.MODE_PRIVATE);}    // If the user has not chosen a city yet, return    // Sydney as the default cityString getCity(){return prefs.getString("city", "Sydney, AU");        }void setCity(String city){prefs.edit().putString("city", city).commit();}}</pre><h2> <span class="sectionnum">11. Создадим Fragment</span></h2><p>Создайте новый класс Java и назовите его <b>WeatherFragment.java</b>. В этом фрагменте в качестве макета используется <b>frag_weather.xml</b>. Объявите пять объектов <code class="inline">TextView</code> и инициализируйте их в методе <code class="inline">onCreateView</code>. Объявите новый объект <code class="inline">Typeface</code> с именем <code class="inline">weatherFont</code>. Объект <code class="inline">TypeFace</code> указывает на веб-шрифт, который вы загрузили и сохранили в папке <b>assets/fonts</b>.</p><p>Мы будем использовать отдельный <code class="inline">Thread</code> для асинхронного получения данных через API OpenWeatherMap. Мы не можем обновить пользовательский интерфейс из подобного фонового потока. Поэтому нам нужен объект <code class="inline">Handler</code>, который мы инициализируем в конструкторе класса <code class="inline">WeatherFragment</code>.<br></p><pre class="brush: java noskimlinks noskimwords">public class WeatherFragment extends Fragment {    Typeface weatherFont;TextView cityField;TextView updatedField;TextView detailsField;TextView currentTemperatureField;TextView weatherIcon;Handler handler;public WeatherFragment(){handler = new Handler();}    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,            Bundle savedInstanceState) {        View rootView = inflater.inflate(R.layout.fragment_weather, container, false);        cityField = (TextView)rootView.findViewById(R.id.city_field);        updatedField = (TextView)rootView.findViewById(R.id.updated_field);        detailsField = (TextView)rootView.findViewById(R.id.details_field);        currentTemperatureField = (TextView)rootView.findViewById(R.id.current_temperature_field);        weatherIcon = (TextView)rootView.findViewById(R.id.weather_icon);                weatherIcon.setTypeface(weatherFont);        return rootView;     }}</pre><p>Инициализируем объект <code class="inline">weatherFont</code>, вызывая <code class="inline">createFromAsset</code> в классе <code class="inline">Typeface</code>.  Мы также вызываем метод <code class="inline">updateWeatherData</code> в <code class="inline">onCreate</code>.</p><pre class="brush: java noskimlinks noskimwords">@Overridepublic void onCreate(Bundle savedInstanceState) {    super.onCreate(savedInstanceState);  weatherFont = Typeface.createFromAsset(getActivity().getAssets(), "fonts/weather.ttf");    updateWeatherData(new CityPreference(getActivity()).getCity());}</pre><p>В <code class="inline">updateWeatherData</code>, мы запускаем новый поток и вызываем <code class="inline">getJSON</code> в классе <code class="inline">RemoteFetch</code>. Если значение, возвращаемое <code class="inline">getJSON</code>, равно <code class="inline">null</code>, мы выводим сообщение об ошибке пользователю. Если это не так, мы вызываем метод <code class="inline">renderWeather</code>.</p><p>Только основной <code class="inline">поток</code> разрешает обновлять пользовательский интерфейс приложения для Android. Вызов <code class="inline">Toast</code> или <code class="inline">renderWeather</code> прямо из фонового потока приведет к ошибке выполнения. Вот почему мы вызываем эти методы с использованием метода <code class="inline">post</code>-<code class="inline">обработчика</code>.</p><pre class="brush: java noskimlinks noskimwords">private void updateWeatherData(final String city){    new Thread(){public void run(){final JSONObject json = RemoteFetch.getJSON(getActivity(), city);if(json == null){handler.post(new Runnable(){public void run(){Toast.makeText(getActivity(), getActivity().getString(R.string.place_not_found), Toast.LENGTH_LONG).show(); }});} else {handler.post(new Runnable(){public void run(){renderWeather(json);}});}    }}.start();}</pre><p>Метод <code class="inline">renderWeather</code> использует данные JSON для обновления объектов <code class="inline">TextView</code>. Узел <code class="inline">weather</code> ответа JSON представляет собой массив данных. В этом уроке мы будем использовать только первый элемент массива метеорологических данных.</p><pre class="brush: java noskimlinks noskimwords">private void renderWeather(JSONObject json){    try {    cityField.setText(json.getString("name").toUpperCase(Locale.US) +     ", " +     json.getJSONObject("sys").getString("country"));        JSONObject details = json.getJSONArray("weather").getJSONObject(0);    JSONObject main = json.getJSONObject("main");    detailsField.setText(    details.getString("description").toUpperCase(Locale.US) +    "\n" + "Humidity: " + main.getString("humidity") + "%" +    "\n" + "Pressure: " + main.getString("pressure") + " hPa");        currentTemperatureField.setText(    String.format("%.2f", main.getDouble("temp"))+ " ℃");    DateFormat df = DateFormat.getDateTimeInstance();    String updatedOn = df.format(new Date(json.getLong("dt")*1000));    updatedField.setText("Last update: " + updatedOn);    setWeatherIcon(details.getInt("id"),    json.getJSONObject("sys").getLong("sunrise") * 1000,    json.getJSONObject("sys").getLong("sunset") * 1000);    }catch(Exception e){Log.e("SimpleWeather", "One or more fields not found in the JSON data");}}</pre><p>В конце метода <code class="inline">renderWeather</code> мы вызываем <code class="inline">setWeatherIcon</code> с <code class="inline">идентификатором</code> текущей погоды, а также временем восхода и захода солнца. Настройка значка погоды немного сложна, потому что API OpenWeatherMap поддерживает больше погодных условий, чем мы можем отобразить с помощью используемого веб-шрифта. К счастью, идентификаторы погоды следуют шаблону, о котором вы можете узнать больше на <span>веб-сайте OpenWeatherMap</span>.<br></p><p>Так мы будем сопоставлять идентификатор погоды с иконкой:</p><ul><li>коды погоды в диапазоне 200 обозначают грозу, что означает, что мы можем использовать <code class="inline">R .string.weather_thunder</code> для них</li> <li>коды погоды в диапазоне 300 связаны с моросями, и мы используем <code class="inline">R.string.weather_drizzle</code></li> <li>коды погоды в диапазоне 500 означают дождь, и мы используем <code class="inline">R.string.weather_rain</code></li> <li>и так далее ...</li> </ul><p>Мы используем время восхода и захода солнца, чтобы отобразить солнце или луну, в зависимости от текущего времени суток и только в том случае, если погода ясная.<br></p><pre class="brush: java noskimlinks noskimwords">private void setWeatherIcon(int actualId, long sunrise, long sunset){    int id = actualId / 100;String icon = "";if(actualId == 800){long currentTime = new Date().getTime();if(currentTime&gt;=sunrise &amp;&amp; currentTime&lt;sunset) {icon = getActivity().getString(R.string.weather_sunny);} else {icon = getActivity().getString(R.string.weather_clear_night);}} else {    switch(id) {    case 2 : icon = getActivity().getString(R.string.weather_thunder);  break;         case 3 : icon = getActivity().getString(R.string.weather_drizzle);  break;        case 7 : icon = getActivity().getString(R.string.weather_foggy);     break;    case 8 : icon = getActivity().getString(R.string.weather_cloudy);  break;    case 6 : icon = getActivity().getString(R.string.weather_snowy);  break;    case 5 : icon = getActivity().getString(R.string.weather_rainy);     break;    }}weatherIcon.setText(icon);}</pre><p>Конечно, вы можете обрабатывать больше погодных <code class="inline">условий</code>, соответственно <code class="inline">изменяя</code> метод <code class="inline">setWeatherIcon</code>.</p><p>Наконец, добавим метод <code class="inline">changeCity</code> к фрагменту, чтобы пользователь мог обновить текущий город. Метод <code class="inline">changeCity</code> будет вызываться только из основного класса <code class="inline">Activity</code>.<br></p><pre class="brush: java noskimlinks noskimwords">public void changeCity(String city){    updateWeatherData(city);}</pre><h2> <span class="sectionnum">12. Редактируем Activity</span></h2><p>В течении настройки проекта, Eclipse заполняет <b>WeatherActivity.java</b> некоторым шаблонным кодом. Замените стандартную реализацию метода <code class="inline">onCreate</code> на приведенную ниже, в которой мы используем <code class="inline">WeatherFragment</code>.  Метод <code class="inline">onCreate</code> должен выглядеть следующим образом:</p><pre class="brush: java noskimlinks noskimwords">@Overrideprotected void onCreate(Bundle savedInstanceState) {    super.onCreate(savedInstanceState);    setContentView(R.layout.activity_weather);    if (savedInstanceState == null) {        getSupportFragmentManager().beginTransaction()                .add(R.id.container, new WeatherFragment())                .commit();    }}</pre><p>Затем отредактируйте метод <code class="inline">onOptionsItemSelected</code> и обработайте единственный параметр меню, который у нас есть. Все, что вам нужно сделать, это вызвать метод <code class="inline">showInputDialog</code>.</p><p>В методе <code class="inline">showInputDialog</code> мы используем <code class="inline">AlertDialog.Builder</code> для создания объекта <code class="inline">Dialog</code>, который предлагает пользователю ввести имя города. Эта информация передается методу <code class="inline">changeCity</code>, который хранит имя города с использованием класса <code class="inline">CityPreference</code> и вызывает метод <code class="inline">changeCity</code> во <code class="inline">фрагменте</code>.</p><pre class="brush: java noskimlinks noskimwords">@Overridepublic boolean onOptionsItemSelected(MenuItem item) {    if(item.getItemId() == R.id.change_city){showInputDialog();}return false;}private void showInputDialog(){AlertDialog.Builder builder = new AlertDialog.Builder(this);builder.setTitle("Change city");final EditText input = new EditText(this);input.setInputType(InputType.TYPE_CLASS_TEXT);builder.setView(input);builder.setPositiveButton("Go", new DialogInterface.OnClickListener() {@Overridepublic void onClick(DialogInterface dialog, int which) {changeCity(input.getText().toString());}});builder.show();}public void changeCity(String city){WeatherFragment wf = (WeatherFragment)getSupportFragmentManager().findFragmentById(R.id.container);wf.changeCity(city);new CityPreference(this).setCity(city);}</pre><p>Теперь ваше приложение для погоды готово. Соберите проект и установите его на Android-устройстве для тестирования.<br></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=480/uploads/users/362/posts/21587/image/p1.png" alt="Создаём приложение “прогноз погоды” на Android..." title="Создаём приложение “прогноз погоды” на Android..." width="50" height="50"></figure><h2>Заключение</h2><p>Теперь у вас есть полнофункциональное приложение прогноза погоды. Изучайте <span>API OpenWeatherMap</span> для дальнейшего развития вашего приложения. Вы также можете использовать больше <span>значков погоды</span>, так как в примере мы используем только немногие из них.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825488-sozdayom-prilozhenie-prognoz-pogody-na-android" class="tm-article-body__tags-item-link">Android SDK</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
32281</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
565</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
