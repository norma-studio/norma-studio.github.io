
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Сеть это сложно. Существуют различные движущиеся части, и для его работы необходимо учитывать множество факторов. К счастью, с течением времени появилось несколько библиотек с открытым исходным кодом, облегчающих работу в сети. AFNetworking, созданный и поддерживаемый людьми Gowalla, является одной из таких библиотек. Этот учебник познакомит вас...">
<meta property="og:description" content="Сеть это сложно. Существуют различные движущиеся части, и для его работы необходимо учитывать множество факторов. К счастью, с течением времени появилось несколько библиотек с открытым исходным кодом, облегчающих работу в сети. AFNetworking, созданный и поддерживаемый людьми Gowalla, является одной из таких библиотек. Этот учебник познакомит вас...">
<meta name="twitter:description" content="Сеть это сложно. Существуют различные движущиеся части, и для его работы необходимо учитывать множество факторов. К счастью, с течением времени появилось несколько библиотек с открытым исходным кодом, облегчающих работу в сети. AFNetworking, созданный и поддерживаемый людьми Gowalla, является одной из таких библиотек. Этот учебник познакомит вас...">
<meta property="aiturec:description" content="Сеть это сложно. Существуют различные движущиеся части, и для его работы необходимо учитывать множество факторов. К счастью, с течением времени появилось несколько библиотек с открытым исходным кодом, облегчающих работу в сети. AFNetworking, созданный и поддерживаемый людьми Gowalla, является одной из таких библиотек. Этот учебник познакомит вас...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-1.png">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-1.png">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-1.png">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-1.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-1.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html" title="Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io" title="Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533jfgfsfxcv.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html" class="tm-user-info__username" title="
О. Гуськов" aria-label="
О. Гуськов">
О. Гуськов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Сеть стала проще с AFNetworking...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="iOS SDK" href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking" class="tm-article-snippet__hubs-item-link"><span>iOS SDK</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-1.png">
    <meta itemprop="headline name" content="Сеть стала проще с AFNetworking... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Сеть это сложно. Существуют различные движущиеся части, и для его работы необходимо учитывать множество факторов. К счастью, с течением времени появилось несколько библиотек с открытым исходным кодом, облегчающих работу в сети. AFNetworking, созданный и поддерживаемый людьми Gowalla, является одной из таких библиотек. Этот учебник познакомит вас...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Сеть это сложно. Существуют различные движущиеся части, и для его работы необходимо учитывать множество факторов. К счастью, с течением времени появилось несколько библиотек с открытым исходным кодом, облегчающих работу в сети. AFNetworking, созданный и поддерживаемый людьми Gowalla, является одной из таких библиотек. Этот учебник познакомит вас...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Сеть это сложно. Существуют различные движущиеся части, и для его работы необходимо учитывать множество факторов. К счастью, с течением времени появилось несколько библиотек с открытым исходным кодом, облегчающих работу в сети. AFNetworking, созданный и поддерживаемый людьми Gowalla, является одной из таких библиотек. Этот учебник познакомит вас с платформой AFNetworking, а также покажет, как запрашивать API iTunes Store!</p><p><!--more--></p> <p>В этом руководстве я познакомлю вас с AFNetworking и покажу, что может предложить эта библиотека. Потратив несколько минут с этой библиотекой, вы заметите, что она была разработана с учетом удобства использования. Это не только ускорит вашу разработку, но также позаботится о многих кропотливых сетевых задачах. Мы создадим простое приложение, которое запрашивает в iTunes Store фильмы, соответствующие поисковому запросу «Гарри». Результаты нашего запроса будут отображены в виде таблицы.</p> <hr><h2>Краткое описание проекта</h2> <p>Приложение, которое мы собираемся создать, запрашивает API поиска iTunes Store. В частности, мы ищем в iTunes Store фильмы, соответствующие поисковому запросу «Гарри». Если наш запрос выполнен успешно, мы обрабатываем результаты и отображаем их в виде таблицы. Каждая строка представляет фильм с названием, режиссером и миниатюрой, показывающей обложку фильма. Готовы? Давайте начнем.</p> <hr><h2>Настройка проекта</h2> <p>Прежде чем мы запачкаем руки с помощью AFNetworking, нам необходимо создать базовую основу. Это означает настройку нашего проекта, создание табличного представления и добавление представления индикатора активности. Мы покажем индикатор активности, когда наш запрос обрабатывается iTunes Store. Это даст пользователю тот ценный дополнительный бит обратной связи, который часто упускается из виду.</p> <p>Создайте новый проект в XCode, выбирая <strong>шаблон Приложения единого</strong> представления из списка шаблонов. Назовите свое приложение <strong>NetworkingIsFun</strong>, введите идентификатор компании, установите «iPhone» для семейства устройств и снимите флажок «Использовать раскадровки». Вы можете оставить остальные нетронутыми, но убедитесь, что установлен флажок <strong>Использовать автоматический подсчет</strong> ссылок. Сообщите Xcode, где вы хотите сохранить свой проект, и нажмите «Сохранить».</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-1.png" alt="Сеть стала проще с AFNetworking..." title="Сеть стала проще с AFNetworking..." width="50" height="50"></div> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-2.png" alt="Сеть стала проще с AFNetworking..." title="Сеть стала проще с AFNetworking..." width="50" height="50"></div> <hr><h2>Добавление таблицы и активность индикатор просмотров</h2> <p>Несмотря на то, что Interface Builder великолепен, я часто создаю свои интерфейсы программно, и это то, что мы будем делать и в этом уроке. Это позволит нам просто сосредоточиться на коде, не отвлекаясь на Interface Builder. Откройте <strong>ViewController.h</strong> и создайте три переменных экземпляра (ivars), а также свойства для этих ivars. Поскольку мы собираемся работать с табличным представлением, не забудьте привести свой контроллер представления в соответствие с протоколами <strong>UITableViewDataSource</strong> и <strong>UITableViewDelegate</strong>. Заголовочный файл вашего контроллера представления должен выглядеть примерно так, как показано ниже:</p> <pre class="brush: objc noskimlinks noskimwords">#import &lt;UIKit/UIKit.h&gt;@interface ViewController : UIViewController &lt;UITableViewDataSource, UITableViewDelegate&gt; {    UITableView *_tableView;    UIActivityIndicatorView *_activityIndicatorView;    NSArray *_movies;}@property (nonatomic, retain) UITableView *tableView;@property (nonatomic, retain) UIActivityIndicatorView *activityIndicatorView;@property (nonatomic, retain) NSArray *movies;@end</pre> <p>Если вас смущает использование подчеркивания, я рекомендую вам прочитать об этом<span> здесь</span>. Не стесняйтесь опускать подчеркивания, если вы думаете, что это выглядит некрасиво или заставляет вас чувствовать себя некомфортно. Помимо подчеркивания, не должно быть никаких сюрпризов. Мы объявляем наши UITableView и UIActivityIndicatorView, а также NSArray, который мы будем использовать для хранения результатов, которые мы получаем из нашего поискового запроса. Готовы? Давайте перейдем к файлу реализации нашего контроллера представления.</p> <p>Поскольку мы объявили три свойства в нашем заголовочном файле, нам нужно синтезировать их методы доступа в <strong>ViewController.m</strong>. Опять же, если подчеркивание сбивает вас с толку, вы можете пропустить их.</p> <pre class="brush: objc noskimlinks noskimwords">@synthesize tableView = _tableView, activityIndicatorView = _activityIndicatorView, movies = _movies;</pre> <p>В нашем методе <strong>viewDidLoad</strong> мы настраиваем представления таблицы и индикатора активности. Код ниже должен быть самоочевидным по большей части. Если вы никогда не настраивали табличное представление без использования Interface Builder, вы можете увидеть несколько незнакомых вам строк. Вместо того, чтобы связывать табличное представление в Интерфейсном Разработчике, мы заботимся об этом в методе <strong>viewDidLoad</strong>. После вызова метода <strong>viewDidLoad</strong> суперкласса мы инициализируем наше табличное представление с помощью рамки и стиля и устанавливаем наш контроллер представления в качестве источника данных и делегата нашего табличного представления. Когда наше приложение запускается, мы скрываем наше табличное представление, так как нам нечего показывать, если наш запрос не дал результатов. Перед добавлением табличного представления в качестве подпредставления к представлению нашего контроллера представления, мы устанавливаем его маску авторазмера. Маска авторазмера определяет, как следует изменять размер табличного представления, если родительское представление -представление контроллера представления, к которому мы добавляем представление таблицы - изменения в размере. Это происходит, когда устройство поворачивается, например. Смущенный? Не беспокойся об этом. Это не важно для этого приложения.</p> <pre class="brush: objc noskimlinks noskimwords">- (void)viewDidLoad {    [super viewDidLoad];        // Setting Up Table View    self.tableView = [[UITableView alloc] initWithFrame:CGRectMake(0.0, 0.0, self.view.bounds.size.width, self.view.bounds.size.height) style:UITableViewStylePlain];    self.tableView.dataSource = self;    self.tableView.delegate = self;    self.tableView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;    self.tableView.hidden = YES;    [self.view addSubview:self.tableView];        // Setting Up Activity Indicator View    self.activityIndicatorView = [[UIActivityIndicatorView alloc] initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleGray];    self.activityIndicatorView.hidesWhenStopped = YES;    self.activityIndicatorView.center = self.view.center;    [self.view addSubview:self.activityIndicatorView];    [self.activityIndicatorView startAnimating];        // Initializing Data Source    self.movies = [[NSArray alloc] init];}</pre> <p>Настроить вид индикатора активности так же просто. Мы инициализируем представление индикатора активности с предопределенным стилем, устанавливаем его свойство <strong>hidesWhenStopped</strong> в значение <strong>YES</strong> и размещаем его в центре родительского представления. После добавления его в представление контроллера вида мы начинаем анимировать индикатор активности. Индикатор активности будет отображаться автоматически, поскольку мы установили для его свойства <strong>hidesWhenStopped</strong> значение YES.</p> <p>В конце нашего метода <strong>viewDidLoad</strong> мы инициализируем массив <strong>movies</strong>. Мы будем использовать его позже для хранения результатов нашего поискового запроса.</p> <hr><h2>Протоколы табличного представления</h2> <p>В этом руководстве мы реализуем только два метода протокола источника данных табличного представления. Оба эти метода являются обязательными. Это минимальная реализация, необходимая для запуска и запуска нашего табличного представления. Несмотря на то, что мы установили наш контроллер представления в качестве делегата табличного представления, мы не будем использовать ни один из методов делегата в нашем приложении. Если вы уже использовали табличное представление, вы не найдете сюрпризов в реализациях методов, показанных ниже.</p> <pre class="brush: objc noskimlinks noskimwords">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {    if (self.movies &amp;&amp; self.movies.count) {        return self.movies.count;    } else {        return 0;    }}- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {    static NSString *cellID = @"Cell Identifier";        UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID];        if (!cell) {        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:cellID];    }        return cell;}</pre> <p>В<strong> tableView: numberOfRowsInSection:</strong> мы должны вернуть количество строк в каждом разделе табличного представления. В нашем примере табличное представление содержит только один раздел (по умолчанию), что делает все немного проще. Сначала мы проверяем, не является ли наша переменная <strong>movies</strong> значение nil, и проверяем, что она содержит элементы. Если оба эти требования выполнены, мы возвращаем количество элементов в массиве movies, если нет, мы возвращаем ноль.</p> <p>Наш <strong>tableView: cellForRowAtIndexPath:</strong> метод также является базовым. Мы начинаем с того, что спрашиваем наше табличное представление, есть ли ячейка, которую мы можем использовать повторно. Если это не так, мы создаем новую ячейку со стилем и повторно используем идентификатор. Мы заканчиваем нашу реализацию, возвращая нашу ячейку. Это будет делать сейчас. Теперь вы можете создавать и запускать ваше приложение. Если вы правильно выполнили шаги, вы должны увидеть, что индикатор активности вращается как сумасшедший, а представление таблицы должно быть скрыто.</p> <hr><h2>Добавление AFNetworking в Mix</h2> <p>Добавить AFNetworking в ваш проект очень просто. Начните с загрузки библиотеки с <span>GitHub</span> и распакуйте архив. Архив содержит папку с именем <strong>AFNetworking</strong>, в которой содержатся исходные файлы, которые мы должны включить в наш проект. Перетащите всю эту папку в свой проект XCode и убедитесь, что вы отметили пункт <strong>Копировать элементы в папку целевой группы (если необходимо)</strong> и также добавили исходные файлы в свою цель.</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-3.png" alt="Сеть стала проще с AFNetworking..." title="Сеть стала проще с AFNetworking..." width="50" height="50"></div> <p>После добавления библиотеки AFNetworking в ваш проект создайте и запустите приложение и наблюдайте, как все разваливается. Что случилось с нашим проектом? Почему мы получаем все эти предупреждения и ошибки? Когда мы настроили наш проект XCode, мы включили <strong>автоматический подсчет ссылок (ARC)</strong>. На момент написания, библиотека AFNetworking не использовала ARC. Не волнуйтесь, однако, мы все еще можем использовать эту аккуратную библиотеку без особых усилий. Все, что нам нужно сделать, это сообщить компилятору, что все исходные файлы библиотеки AFNetworking не используют ARC. Вот и все.</p> <p>Как нам это сделать? Выберите ваш проект в <strong>Навигаторе проектов</strong> и выберите цель. Перейдите на вкладку <strong>«Фазы сборки»</strong> в верхней панели навигации и откройте панель <strong>«Компилировать источники»</strong>. В этой таблице показаны все исходные файлы, которые компилятор будет компилировать во время компиляции. Левый столбец показывает имена файлов, а правый столбец показывает флаги, о которых должен знать компилятор.</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-4.png" alt="Сеть стала проще с AFNetworking..." title="Сеть стала проще с AFNetworking..." width="50" height="50"></div> <p>Вы можете видеть эти флаги как инструкции или сообщения для компилятора. Все, что вам нужно сделать, это добавить флаг компилятора в каждый исходный файл библиотеки AFNetworking. Для этого выберите исходный файл из списка и дважды щелкните ячейку в правом столбце. Появится небольшое окно, в котором вы можете добавить один или несколько флагов компилятора. В нашем случае просто введите <strong>-fno-objc-arc</strong> и нажмите <strong>Готово</strong>. Этот флаг сообщает компилятору, что исходный файл не использует ARC. Убедитесь, что вы добавили этот флаг ко всем десяти исходным файлам библиотеки AFNetworking.</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/mobile/uploads/legacy/iOS-SDK_AFNetworking/iOS-SDK_AFNetworking_figure-5.png" alt="Сеть стала проще с AFNetworking..." title="Сеть стала проще с AFNetworking..." width="50" height="50"></div> <hr><h2>Запрос к API для поиска iTunes Store</h2> <p>AFNetworking - это библиотека, которая может многое для вас сделать, но сегодня мы собираемся использовать только две изящные функции. Прежде чем мы сможем начать использовать классы AFNetworking, нам нужно добавить следующий оператор импорта чуть ниже первого оператора импорта в файле реализации вашего контроллера представления.</p> <pre class="brush: objc noskimlinks noskimwords">#import "AFNetworking.h"</pre> <p>Это утверждение импорта даст нам доступ ко всем классам AFNetworking. Вернитесь к методу <strong>viewDidLoad</strong> нашего контроллера представления и добавьте следующий фрагмент сразу после инициализации массива <strong>movie</strong>.</p> <pre class="brush: objc noskimlinks noskimwords">NSURL *url = [[NSURL alloc] initWithString:@"http://itunes.apple.com/search?term=harry&amp;country=us&amp;entity=movie"];NSURLRequest *request = [[NSURLRequest alloc] initWithURL:url];AFJSONRequestOperation *operation = [AFJSONRequestOperation JSONRequestOperationWithRequest:request success:^(NSURLRequest *request, NSHTTPURLResponse *response, id JSON) {    NSLog(@"%@", JSON);    } failure:^(NSURLRequest *request, NSHTTPURLResponse *response, NSError *error, id JSON) {    NSLog(@"Request Failed with Error: %@, %@", error, error.userInfo);}];[operation start];</pre> <p>Позвольте мне объяснить, что происходит. В первой строке мы создаем NSURL для нашего запроса. Строка, которую мы используем при инициализации, соответствует формату, который ожидает API поиска iTunes Store. Синтаксис API поиска довольно прост: термин, который мы ищем, это «Гарри», мы ограничиваем наш поиск в американском iTunes Store и ищем только фильмы. Легко, правда?</p> <p>Затем мы инициализируем NSURLRequest и передаем NSURL, который мы только что создали. Затем начинается AFNetworking. AFNetworking содержит несколько очень специализированных классов, которые делают нашу работу очень легкой. Здесь мы используем <strong>AFJSONRequestOperation</strong>. Это класс, предназначенный для извлечения и анализа данных JSON в фоновом режиме. Как следует из названия, этот класс является подклассом NSOperation или, если быть более точным, один из суперклассов этого класса наследуется от NSOperation. Класс позволяет вам получить запрошенные данные, а также анализирует ответ JSON. Это означает, что нам не нужно иметь дело с необработанным JSON. Возвращаемые данные готовы к использованию в вашем приложении. AFNetworking использует встроенный анализатор JSON в iOS 5 и использует свой собственный анализатор JSON для более старых версий iOS.</p> <p>Использовать AFJSONRequestOperation легко, поскольку он имеет только один метод класса. Этот метод класса принимает три аргумента: (1) NSURLRequest, (2) блок успеха, выполняемый при успешном выполнении запроса, и (3) блок отказа, исполняемый при сбое запроса. Если блоки являются новыми для вас, или вам неудобно их использовать, то я рекомендую прочитать учебник Коллина Руффенаха о<span> блоках и перечислении</span> на Mobiletuts +. Блок успеха принимает три аргумента: (1) наш NSURLRequest, (2) NSHTTPURLResponse нашего запроса и (3) проанализированный JSON-объект. Блок отказов практически идентичен. Единственное отличие состоит в том, что он принимает дополнительный аргумент, NSError, который содержит больше информации о том, что пошло не так в случае сбоя нашего запроса.</p> <p>В целях тестирования мы регистрируем проанализированный JSON-объект, чтобы увидеть, что API-интерфейс поиска в iTunes Store возвращает нам. Кроме того, мы также регистрируем ошибку в блоке сбоя в случае сбоя нашего запроса. Перед тем как снова собрать и запустить наше приложение, нам нужно запустить операцию, вызвав <strong>start</strong> нашего объекта операции. Создайте и запустите ваше приложение и посмотрите на вывод в консоли.</p> <p>Если все прошло хорошо, вы увидите результаты нашего запроса, записанные в консоли. Анализируемый объект JSON представляет собой словарь с двумя ключами: (1) <strong>resultCount</strong>, который содержит количество возвращаемых результатов и (2) фактические <strong>результаты</strong> в виде массива словарей. Мы не только зарегистрировали ответ в консоли, чтобы увидеть, был ли наш запрос успешным, мы теперь можем видеть ключи для каждого элемента в массиве результатов. Нам понадобятся эти ключи для отображения некоторой информации в нашем табличном представлении.</p> <hr><h2>Заполнение табличного представления</h2> <p>Теперь мы готовы показать результаты в нашем табличном представлении. Замените оператор журнала в блоке успеха на фрагмент, показанный ниже. Мы начнем с присвоения массива результатов объекта ответа массиву movies. Осталось только скрыть индикатор активности, остановив его, отобразив табличное представление и перезагрузив табличное представление с новыми данными, сохраненными в массиве movies.</p> <pre class="brush: objc noskimlinks noskimwords">self.movies = [JSON objectForKey:@"results"];[self.activityIndicatorView stopAnimating];[self.tableView setHidden:NO];[self.tableView reloadData];</pre> <p>Затем мы изменяем<strong> tableView: cellForRowAtIndexPath</strong>: метод. Настройте свою реализацию так, чтобы она соответствовала приведенной ниже После получения ссылки на ячейку, мы запрашиваем массив фильмов для правильного элемента и обновляем метки ячейки заголовком и режиссером фильма. Создайте и запустите ваше приложение.</p> <pre class="brush: objc noskimlinks noskimwords">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {    static NSString *cellID = @"Cell Identifier";        UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID];        if (!cell) {        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:cellID];    }        NSDictionary *movie = [self.movies objectAtIndex:indexPath.row];    cell.textLabel.text = [movie objectForKey:@"trackName"];    cell.detailTextLabel.text = [movie objectForKey:@"artistName"];        return cell;}</pre> <p>Возможно, вы заметили, что нет миниатюр, которые можно увидеть. Давайте исправим это, добавив три дополнительные строки в наш <strong>tableView: cellForRowAtIndexPath</strong>: метод. Создайте и запустите ваше приложение.</p> <pre class="brush: objc noskimlinks noskimwords">NSURL *url = [[NSURL alloc] initWithString:[movie objectForKey:@"artworkUrl100"]];NSData *data = [NSData dataWithContentsOfURL:url];cell.imageView.image = [[UIImage alloc] initWithData:data];</pre> <p>Вы заметили, что наше табличное представление не прокручивается плавно. Это почему? Как я уже упоминал в <span>предыдущем руководстве</span>, вы всегда должны следить за тем, чтобы основной поток вашего приложения оставался отзывчивым. В текущей реализации нашего метода <strong>tableView: cellForRowAtIndexPath:</strong> мы загружаем миниатюры в основном потоке. Это означает, что пользовательский интерфейс не может быть обновлен, пока не будет завершен запрос эскиза. Наши миниатюры крошечные, поэтому запросы не занимают слишком много времени, но представьте, что вы используете тот же подход для больших активов. Пользовательский опыт был бы ужасен. Даже для нашего простого приложения пользовательский опыт неприемлем. Однако мы можем исправить это с помощью очень полезной функции библиотеки AFNetworking.</p> <hr><h2>AF Networking на помощь</h2> <p>Создатели AFNetworking также увидели необходимость загрузки ресурсов в фоновом режиме. Поэтому они создали категорию для UIImageView. Эта категория позволяет загружать изображения в фоновом режиме только с двумя строками кода. Эта категория - настоящий спасатель жизни. Посмотрите на фрагмент ниже.</p> <pre class="brush: objc noskimlinks noskimwords">NSURL *url = [[NSURL alloc] initWithString:[movie objectForKey:@"artworkUrl100"]];[cell.imageView setImageWithURL:url placeholderImage:[UIImage imageNamed:@"placeholder"]];</pre> <p>Первая строка кода остается прежней. Во второй строке мы сообщаем представлению изображения, где находится миниатюра, передавая NSURL, и передаем изображение-заполнитель, которое отображается, пока наш запрос не вернул ответ. Как это круто? Все, что нам нужно сделать, это добавить изображение-заполнитель в наш проект. Это может быть любое изображение, которое вы хотите, но вы можете найти изображение, которое я использовал в качестве заполнителя, в файле загрузки, прилагаемом к этому учебному пособию. После того, как вы добавили изображение-заполнитель, соберите и запустите ваше приложение и убедитесь, насколько плавно прокручивается табличное представление!</p> <hr><h2>Заключение </h2> <p>Обратите внимание, что наше приложение очень простое в своем исполнении, поскольку оно не выполняет никакого кэширования, и мы можем искать в iTunes Store только термин «гарри» в разделе фильмов. Однако, приложив совсем немного усилий, вы можете сделать аккуратное приложение для более быстрого поиска в iTunes Store.</p> <p>Я надеюсь, что этот урок убедил вас, что библиотека AFNetworking - отличный инструмент для вашего арсенала. Он может сделать намного больше, чем то, что я показал вам в этом посте, но главная цель этого урока - научить вас работать с AFNetworking и быть готовым использовать его в реальном сценарии.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="iOS SDK" href="https://norma-studio.github.io/article5/220825645-set-stala-prosche-s-afnetworking" class="tm-article-body__tags-item-link">iOS SDK</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40774</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
575</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
