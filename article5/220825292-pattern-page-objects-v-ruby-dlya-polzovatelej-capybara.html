
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Это шаблон проектирования для инкапсуляции разметки и взаимодействия с страницами - в частности, для рефакторинга функциональных спеков. Это комбинация двух очень распространенных методов рефакторинга: Extract class и Extract method, которые не должны происходить одновременно, при этом есть возможность постепенно вести разработку извлекая все в кла...">
<meta property="og:description" content="Это шаблон проектирования для инкапсуляции разметки и взаимодействия с страницами - в частности, для рефакторинга функциональных спеков. Это комбинация двух очень распространенных методов рефакторинга: Extract class и Extract method, которые не должны происходить одновременно, при этом есть возможность постепенно вести разработку извлекая все в кла...">
<meta name="twitter:description" content="Это шаблон проектирования для инкапсуляции разметки и взаимодействия с страницами - в частности, для рефакторинга функциональных спеков. Это комбинация двух очень распространенных методов рефакторинга: Extract class и Extract method, которые не должны происходить одновременно, при этом есть возможность постепенно вести разработку извлекая все в кла...">
<meta property="aiturec:description" content="Это шаблон проектирования для инкапсуляции разметки и взаимодействия с страницами - в частности, для рефакторинга функциональных спеков. Это комбинация двух очень распространенных методов рефакторинга: Extract class и Extract method, которые не должны происходить одновременно, при этом есть возможность постепенно вести разработку извлекая все в кла...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/851/posts/25204/final_image/capybara_snob_03_600.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/851/posts/25204/final_image/capybara_snob_03_600.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/851/posts/25204/final_image/capybara_snob_03_600.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/851/posts/25204/final_image/capybara_snob_03_600.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/851/posts/25204/final_image/capybara_snob_03_600.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html" title="Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io" title="Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543543242.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html" class="tm-user-info__username" title="
А. Морозов" aria-label="
А. Морозов">
А. Морозов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Паттерн Page Objects в Ruby для пользователей Capybara
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Ruby" href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara" class="tm-article-snippet__hubs-item-link"><span>Ruby</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/851/posts/25204/final_image/capybara_snob_03_600.jpg">
    <meta itemprop="headline name" content="Паттерн Page Objects в Ruby для пользователей Capybara
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Это шаблон проектирования для инкапсуляции разметки и взаимодействия с страницами - в частности, для рефакторинга функциональных спеков. Это комбинация двух очень распространенных методов рефакторинга: Extract class и Extract method, которые не должны происходить одновременно, при этом есть возможность постепенно вести разработку извлекая все в кла...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Это шаблон проектирования для инкапсуляции разметки и взаимодействия с страницами - в частности, для рефакторинга функциональных спеков. Это комбинация двух очень распространенных методов рефакторинга: Extract class и Extract method, которые не должны происходить одновременно, при этом есть возможность постепенно вести разработку извлекая все в кла...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<h2>Что такое Page Objects?</h2><p>Это шаблон проектирования для инкапсуляции разметки и взаимодействия с страницами - в частности, для рефакторинга функциональных спеков. Это комбинация двух очень распространенных методов рефакторинга: <em>Extract class</em> и <em>Extract method</em>, которые не должны происходить одновременно, при этом есть возможность постепенно вести разработку извлекая все в класс через новый Page Object.</p> <p>Этот метод позволяет писать высокоуровневые функциональные спеки, которые являются очень выразительными и краткими. В некотором смысле, они являются приемочными тестами на языке приложения. Вы можете спросить, разве спеки написаные с Capybara не являются высокоуровневыми и выразительными? Конечно, для разработчиков, которые ежедневно пишут код, спеки Capybara читаются просто отлично. Являются ли они краткими из коробки? На самом деле, нет!</p> <pre class="brush: ruby noskimlinks noskimwords">feature "M creates a mission" do  scenario "successfully" do    sign_in_as "M@mi6.com"        visit missions_path    click_on     "Create Mission"     fill_in      "Mission Name",  with: "Project Moonraker"    click_button "Submit"    expect(page).to have_css "li.mission-name", text: "Project Moonraker"  endend</pre> <pre class="brush: ruby noskimlinks noskimwords">feature "M marks mission as complete" do  scenario "successfully" do    sign_in_as "M@mi6.com"        visit missions_path    click_on     "Create Mission"     fill_in      "Mission Name", with: "Octopussy"    click_button "Submit"    within "li:contains("Octopussy")" do      click_on "Mission completed"    end    expect(page).to have_css "ul.missions li.mission-name.completed", text: "Octopussy"  endend</pre> <p>Когда вы смотрите на эти примеры функциональных спеков, где вы видите возможности сделать улучшения, и как вы можете извлечь информацию, чтобы избежать дублирования? Кроме того, достаточно ли этого уровня для легкого моделирования пользовательских историй и для понимания нетехническими пользователями?</p> <p>На мой взгляд, есть несколько способов улучшить это и сделать всех довольными разработчиками, которые могут избежать возини с деталями взаимодействия с DOM при применении ООП и другими членами команды, которые не занимаются кодингом, не испытывая проблем с переходом между историями пользователей и их тестми. Последний момент конечно приятен, но самые важные преимущества в основном связаны с тем, что ваши DOM-взаимодействующие спеки становятся более надежными.</p> <p>Инкапсуляция - ключевое понятие в Page Objects. Когда вы пишете свои функциональные спеки, вы получаете стратегию для извлечения поведения, которое проходит через тестовый флоу. Для повышения качества кода вы хотите захватить взаимодействие с определенными наборами элементов на ваших страницах, особенно если вы натыкаетесь на повторяющиеся шаблоны. По мере того, как ваше приложение растет, вам нужен подход, который позволяет избежать распространения этой логики во всех спеках.</p> <p>«Ну, разве это не перебор? Капибара прекрасно читается!» Что вы говорите?</p> <p>Спросите себя: почему бы не иметь все детали реализации HTML в одном месте, имея более стабильные тесты? Почему тесты на взаимодействие с UI не должны быть такими же, как тесты для кода приложения? Вы действительно хотите остановиться на этом?</p> <p>Из-за каждодневных изменений ваш код Capybara уязвим, когда он распространяется повсюду - он вводит возможные точки отказа. Предположим, что дизайнер хочет изменить текст на кнопке. Не сложно, не так ли? Но хотите ли вы адаптироваться к этим изменениям в одной центральной области для этого элемента в своих спецификациях или вы предпочитаете делать это повсюду? Я так и думал!</p> <p>Существует множество рефакторингов для ваших функциональных спеков, но Page Objects предлагает самые чистые абстракции для инкапсуляции поведения пользователя на страницы или более сложных сценариев. Вам не нужно симулировать поведение для всей страницы, а сосредоточиться на существенных фичах, которые необходимы для пользовательских сценариев. Не нужно переусердствовать!</p> <h3>Приемочные тесты / Фича спеки</h3> <p>Прежде чем мы перейдем к сути вопроса, я хотел бы сделать шаг назад для людей, которые только начали знакомятся с тестированием, и прояснить некоторые из жаргонов, которые важны в этом контексте. Люди, более знакомые с TDD, ничего не упустят, если пропустят эту часть.</p> <p>О чем мы здесь говорим? Приемочное тестирование обычно выполняется на более позднем этапе разработки проектов, чтобы оценить, разрабатываете ли вы что-то ценное для своих пользователей, владельца продукта или другого заинтересованного лица. Эти тесты обычно запускаются клиентами или вашими пользователями. Это какая-то проверка выполнения требований. Существует что-то вроде пирамиды для всех видов тестовых слоев, а приемочные тесты находятся на самом верху. Поскольку этот процесс часто включает нетехнических людей, язык высокого уровня для написания этих тестов является ценным достоянием для общения.</p> <p>Фича спеки, с другой стороны, немного уровнем ниже в тестовой пищевой цепи. Более высокий уровень, чем модульные тесты, которые сосредоточены на технических деталях и бизнес-логике ваших моделей, фича спеки описывают поведение на странице и между ними.</p> <p>Такие инструменты, как <span>Capybara</span>, помогут вам избежать выполнение этого вручную, что означает, что вам редко придется открывать браузер для проверки функционала вручную. С такими тестами, вам понравится как можно больше автоматизировать эти задачи и тестировать взаимодействие через браузер при написании утверждений на страницах. Кстати, вы не используете <code class="inline">get</code>, <code class="inline">put</code>, <code class="inline">post</code> или <code class="inline">delete</code>, как вы делаете со спеками запросов.</p> <p>Фича спеки очень похожи на приемочные тесты - иногда я чувствую, что различия слишком размыты, чтобы действительно заботиться о терминологии. Вы пишете тесты, которые прогоняют все ваше приложение, что часто связано с многоступенчатым набором действий пользователя. Эти тесты интерактивные показывают, что ваши компоненты работают в гармонии, когда они собраны вместе.</p> <p>На территории Ruby они являются главным героем, когда мы имеем дело с Page Objects. Фича спеки сами по себе уже очень выразительны, но их можно оптимизировать и очистить, извлекая свои данные, поведение и разметку в отдельный класс или классы.</p> <p>Я надеюсь, что устранение этой размытой терминологии поможет вам понять, что наличие Page Objects немного похоже на тестирование приемочного уровня при написании фича спеков.</p> <h4>Capybara</h4> <p>Может, нам стоит это сделать и побыстрее. Эта библиотека описывает себя как «Фреймворк для приемочного тестирования веб-приложений». Вы можете имитировать взаимодействие пользователей с вашими страницами с помощью очень мощного и удобного для домена языка. По моему личному мнению, RSpec в паре с Capybara предлагает лучший способ написать свои фича спеки на данный момент. Он позволяет вам посещать страницы, заполнять формы, нажимать на ссылки и кнопки, а также искать разметку на ваших страницах, и вы можете легко комбинировать все виды этих команд для взаимодействия со своими страницами через ваши тесты.</p> <p>В основном вы можете не открывать браузер самостоятельно, чтобы тестировать этот материал вручную большую часть времени, что не только менее изящно, но и намного более трудоемко и подвержено ошибкам. Без этого инструмента процесс «наружного тестирования», который вы передадите из высокоуровневых тестов в свои юнит тесты, будет намного более болезненным и, возможно, поэтому будет игнорироваться.</p> <p>Другими словами, вы начинаете писать эти функциональные тесты, которые основаны на ваших историях пользователей, а оттуда вы спускаетесь в кроличью нору, пока ваши модульные тесты не обеспечивают покрытие ваших спецификаций. После этого, когда ваши тесты зеленые, конечно, игра начинается заново, и вы возвращаетесь обратно, чтобы продолжить с новым функциональным тестом.</p> <h5>Как?</h5> <p>Давайте рассмотрим два простых примера фича спеков, которые позволяют M создавать секретные миссии, которые затем могут быть завершены.</p> <p>В разметке у вас есть список миссий, и успешное завершение создает дополнительный класс, <code class="inline">completed</code> в этом <code class="inline">li</code> конкретной миссии. Просто, да? В качестве первого подхода я начал с небольших, очень распространенных рефакторингов, которые извлекали общее поведение в методы.</p> <p><strong>spec/features/m_creates_a_mission_spec.rb</strong></p> <pre class="brush: ruby noskimlinks noskimwords">require "rails_helper"feature "M creates mission" do  scenario "successfully" do    sign_in_as "M@mi6.com"        create_classified_mission_named "Project Moonraker"      agent_sees_mission              "Project Moonraker"  end  def create_classified_mission_named(mission_name)    visit missions_path    click_on     "Create Mission"     fill_in      "Mission Name", with: mission_name    click_button "Submit"  end  def agent_sees_mission(mission_name)    expect(page).to have_css "li.mission-name", text: mission_name  end  def sign_in_as(email)    visit root_path    fill_in      "Email", with: email    click_button "Submit"  endend</pre> <p><strong>spec/features/agent_completes_a_mission_spec.rb</strong></p> <pre class="brush: ruby noskimlinks noskimwords">require "rails_helper"feature "M marks mission as complete" do  scenario "successfully" do    sign_in_as "M@mi6.com"        create_classified_mission_named "Project Moonraker"    mark_mission_as_complete        "Project Moonraker"    agent_sees_completed_mission    "Project Moonraker"  end  def create_classified_mission_named(mission_name)    visit missions_path    click_on     "Create Mission"     fill_in      "Mission Name", with: mission_name    click_button "Submit"  enddef mark_mission_as_complete(mission_name)    within "li:contains("#{mission_name}")" do      click_on "Mission completed"    end  end  def agent_sees_completed_mission(mission_name)    expect(page).to have_css "ul.missions li.mission-name.completed", text: mission_name  end  def sign_in_as(email)    visit root_path    fill_in      "Email", with: email    click_button "Submit"  endend</pre> <p>Хотя, конечно, есть и другие способы работы с такими вещами, как <code class="inline">sign_in_as</code>, <code class="inline">create_classified_mission_named</code> и т. д., Легко понять, как быстро эти вещи могут начать утомлять и накапливаться.</p> <p>Я думаю, что спецификации, связанные с UI, часто не получают обьектно ореинтированного подхода, который им нужен. Они имеют репутацию приносящих слишком мало удовольствия, и конечно разработчики не очень любят, когда они много работают с разметкой. На мой взгляд, это делает еще более значимым DRY для этих спецификаций и далает их выразительными, при добавлении нескольких Ruby классов.</p> <p>Давайте сделаем небольшой волшебный трюк, где я сейчас скрою реализацию Page Object, и покажу вам конечный результат, примененный к фича спекам выше:</p> <p><strong>spec/features/m_creates_a_mission_spec.rb</strong></p> <pre class="brush: ruby noskimlinks noskimwords">require "rails_helper"feature "M creates mission" do  scenario "successfully" do    sign_in_as "M@mi6.com"    visit missions_path    mission_page = Pages::Missions.new    mission_page.create_classified_mission_named "Project Moonraker"    expect(mission_page).to have_mission_named   "Project Moonraker"  endend</pre> <p><strong>spec/features/agent_completes_a_mission_spec.rb</strong></p> <pre class="brush: ruby noskimlinks noskimwords">require "rails_helper"feature "M marks mission as complete" do  scenario "successfully" do    sign_in_as "M@mi6.com"    visit missions_path    mission_page = Pages::Missions.new    mission_page.create_classified_mission_named         "Project Moonraker"    mission_page.mark_mission_as_complete                "Project Moonraker"        expect(mission_page).to have_completed_mission_named "Project Moonraker"  endend</pre> <p>Не читается слишком плохо, вы в основном создаете экспрессивные методы-обертки на своих Page Objects, которые позволяют вам заниматься концепциями высокого уровня, а не возиться повсюду с кишками вашей разметки все время. Ваши извлеченные методы теперь делают эту грязную работу, и эта <span>операция с дробовиком</span> больше не является вашей проблемой.</p> <p>Иными словами, вы инкапсулируете большую часть шумного, путающего DOM-взаимодействующего кода. Я должен сказать, однако, что иногда разумно извлеченные методы в ваших спецификациях достаточны и читаются немного лучше, так как вы можете избежать использования экземпляров Page Object. В любом случае, давайте посмотрим на реализацию:</p> <p><strong>specs/support/features/pages/missions.rb</strong></p> <pre class="brush: ruby noskimlinks noskimwords">module Pages  class Missions    include Capybara::DSL    def create_classified_mission_named(mission_name)      click_on     "Create Mission"      fill_in      "Mission name", with: mission_name      click_button "Submit"    end    def mark_mission_as_complete(mission_name)      within "li:contains("#{mission_name}")" do        click_on "Mission completed"      end    end    def has_mission_named?(mission_name)      mission_list.has_css? "li", text: mission_name    end    def has_completed_mission_named?(mission_name)      mission_list.has_css? "li.mission-name.completed", text: mission_name    end    private    def mission_list      find("ul.missions")    end   endend</pre> <p>То, что вы видите, - это простой объект Ruby - Page Object - это  по сути, очень простые классы. Обычно вы не создаете Page Objects с данными (когда это необходимо, конечно, вы можете), и вы создаете в основном язык через API, который может использовать пользователь или нетехническая сторона в команде. Когда вы думаете об именовании своих методов, я думаю, что это хороший совет задать себе вопрос: как пользователь описал бы поток или предпринятое действие?</p> <p>Я должен добавить, что без включения Capybara музыка останавливается довольно быстро.</p> <pre class="brush: ruby noskimlinks noskimwords">include Capybara::DSL</pre> <p>Вы, наверное, задаетесь вопросом, как работают эти пользовательские матчеры:</p> <pre class="brush: ruby noskimlinks noskimwords">expect(page).to have_mission_named           "Project Moonraker"expect(page).to have_completed_mission_named "Project Moonraker"def has_mission_named?(mission_name)  ...enddef has_completed_mission_named?(mission_name)  ...end</pre> <p>RSpec генерирует эти пользовательские матчеры на основе предикатных методов на ваших объектах страниц. RSpec преобразует их, удаляя <code class="inline">?</code> и изменения <code class="inline">has</code> на <code class="inline">have</code>. Бум, матчеры с нуля без особого шума! Немного магии, я дам вам это. Хороший пример волшебства, я бы сказал.</p> <p>Поскольку мы положили наш объект страницы в <code class="inline">spec/support/features/pages/mission.rb</code>, вам также необходимо убедиться, что в <code class="inline">spec/rails_helper.rb</code> не закомментировано следующее.</p> <pre class="brush: ruby noskimlinks noskimwords">Dir[Rails.root.join("spec/support/**/*.rb")].each { |f| require f }</pre> <p>Если вы столкнетесь с <code class="inline">NameError</code> с <code class="inline">uninitialized constant Pages</code>, вы знаете, что делать.</p> <p>Если вам интересно, что случилось с методом <code class="inline">sign_in_as</code>, я извлек его в модуль в <code class="inline">spec/support/sign_in_helper.rb</code> и указал RSpec включить этот модуль. Это не имеет ничего общего с объектами страницы - просто имеет смысл хранить тестовые функции, такие как <code class="inline">sign_in</code> , доступным более глобально, чем через объект страницы.</p> <p><strong>spec/support/sign_in_helper.rb</strong></p> <pre class="brush: ruby noskimlinks noskimwords">module SignInHelper  def sign_in_as(email)    visit root_path    fill_in      "Email", with: email    click_button "Submit"endend</pre> <p>И вам нужно сообщить RSpec, что вы хотите получить доступ к этому вспомогательному модулю:</p> <p><strong>spec/spec_helper.rb</strong></p> <pre class="brush: ruby noskimlinks noskimwords">...require "support/sign_in_helper"RSpec.configure do |config|  config.include SignInHelper...end</pre> <p>В целом, легко видеть, что нам удалось скрыть особенности Capybara - например, поиск элементов, клик на  ссылки и т. д. Теперь мы можем сосредоточиться на функциональности и меньше на фактической структуре разметки, которая теперь инкапсулирована в Page Object - Структура DOM должна быть наименьшей из ваших проблем, когда вы проверяете что-то как высокоуровневое, как фича спеки.</p> <h4>Внимание!</h4> <p>Конфигурации, такие как factory data, относятся к спекам, а не к Page Object. Кроме того, утверждения, вероятно, лучше размещаются вне ваших Page Objects для достижения принципа разделения ответственности.</p> <p>На эту тему есть две разные точки зрения. Приверженцы размещения утверждений в Page Objects говорят, что это помогает избежать дублирования утверждений. Вы можете обеспечить лучшее сообщение об ошибках и добиться лучшего стиля «Tell, Do not Ask». С другой стороны, защитники assertion-free Page Objects утверждают, что лучше не смешивать ответственности. Предоставление доступа к данным страницы и логике утверждений является двумя отдельными ответственностяни и приводит к раздутым Page Objects при смешивании. Page Object - это доступ к состоянию страниц, а логика утверждения относится к спецификациям.</p> <h3>Разновидности Page Objects</h3> <p><strong>Компоненты</strong> представляют собой наименьшие единицы и более сфокусированные, например, объекты форм.</p> <p><strong>Страницы</strong> объединяют все эти компоненты и представляют собой абстракции полной страницы.</p> <p><strong>Случаи</strong>, как вы уже догадались, охватывает весь поток через потенциально несколько разных страниц. Они более высокого уровня. Они фокусируются на потоке, который пользователь генерирует, когда они взаимодействуют с различными страницами. Хорошим примером для этого является поток покупки, который имеет пару шагов.</p> <h3>Когда и почему?</h3> <p>Это хорошая идея применить этот шаблон немного позже в жизненном цикле проекта - когда вы накопили немного сложности в своих фича спеках и когда сможете идентифицировать повторяющиеся шаблоны, такие как структуры DOM, извлеченные методы или другие общие характеристики, которые есть на ваших страницах.</p> <p>Поэтому вы, вероятно, не должны сразу начинать писать Page Objects. Вы постепенно подходите к этим рефакторингам, когда возрастает сложность и размер ваших приложений/тестов. Дублирования и рефакторинги, которые нуждаются в улучшении через Page Objects, будут легче выявляться с течением времени.</p> <p>Моя рекомендация - начать с извлечения методов в фича спеках на локальном уровне. Как только они попадут в критическую массу, они будут выглядеть как очевидные кандидаты для дальнейшего извлечения, и большинство из них, вероятно, будут соответствовать профилю для Page Objects. Начните с малого, потому что преждевременная оптимизация оставляет неприятные следы укуса!</p> <h2>Заключительные мысли</h2> <p>Page Object предоставляют вам возможность писать более четкие спецификации, которые лучше читаются и в целом намного более выразительны, потому что они более высокоуровневые. Кроме того, они предлагают хорошую абстракцию для всех, кто любит писать ООП код. Они скрывают специфику DOM, а также позволяют вам иметь приватные методы, которые выполняют грязную работу, не торча в публичном API. Извлеченные методы в ваших спецификациях не предлагают совершенно такой же роскоши. API объектов страницы не должен делиться особенностями Capybara.</p> <p>Во всех сценариях, когда изменения в дизайне меняются, ваши описания того, как ваше приложение должно работать, не должны меняться при использовании Page Objects - ваши фича спеки более сфокусированы на взаимодействиях на уровне пользователя и не заботятся о специфике реализации DOM. Поскольку изменения неизбежны, Page Objects становятся важными, когда приложения разрабатываются, а также помогают понять, когда размер приложения существенно возрастает.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Ruby" href="https://norma-studio.github.io/article5/220825292-pattern-page-objects-v-ruby-dlya-polzovatelej-capybara" class="tm-article-body__tags-item-link">Ruby</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
31814</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
365</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
