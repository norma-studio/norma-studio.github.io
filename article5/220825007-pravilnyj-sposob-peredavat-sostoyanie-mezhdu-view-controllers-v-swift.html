
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Несколько лет назад, когда я ещё работал консультантом мобильный связи, я работал над приложением для большого инвестиционного банка. Для больших компаний, особенно банков, обычно вы работаете прямо на месте, чтобы гарантировать, что их программа безопасна, надёжна и обслуживаема....">
<meta property="og:description" content="Несколько лет назад, когда я ещё работал консультантом мобильный связи, я работал над приложением для большого инвестиционного банка. Для больших компаний, особенно банков, обычно вы работаете прямо на месте, чтобы гарантировать, что их программа безопасна, надёжна и обслуживаема....">
<meta name="twitter:description" content="Несколько лет назад, когда я ещё работал консультантом мобильный связи, я работал над приложением для большого инвестиционного банка. Для больших компаний, особенно банков, обычно вы работаете прямо на месте, чтобы гарантировать, что их программа безопасна, надёжна и обслуживаема....">
<meta property="aiturec:description" content="Несколько лет назад, когда я ещё работал консультантом мобильный связи, я работал над приложением для большого инвестиционного банка. Для больших компаний, особенно банков, обычно вы работаете прямо на месте, чтобы гарантировать, что их программа безопасна, надёжна и обслуживаема....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=842/uploads/users/1637/posts/28474/final_image/Intro%20image.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=842/uploads/users/1637/posts/28474/final_image/Intro%20image.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=842/uploads/users/1637/posts/28474/final_image/Intro%20image.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=842/uploads/users/1637/posts/28474/final_image/Intro%20image.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=842/uploads/users/1637/posts/28474/final_image/Intro%20image.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html" title="Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io" title="Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/542343243.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html" class="tm-user-info__username" title="
А. Анискин" aria-label="
А. Анискин">
А. Анискин</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Правильный способ передавать состояние между View Controllers в Swift...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="iOS SDK" href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift" class="tm-article-snippet__hubs-item-link"><span>iOS SDK</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=842/uploads/users/1637/posts/28474/final_image/Intro%20image.jpg">
    <meta itemprop="headline name" content="Правильный способ передавать состояние между View Controllers в Swift... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Несколько лет назад, когда я ещё работал консультантом мобильный связи, я работал над приложением для большого инвестиционного банка. Для больших компаний, особенно банков, обычно вы работаете прямо на месте, чтобы гарантировать, что их программа безопасна, надёжна и обслуживаема....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Несколько лет назад, когда я ещё работал консультантом мобильный связи, я работал над приложением для большого инвестиционного банка. Для больших компаний, особенно банков, обычно вы работаете прямо на месте, чтобы гарантировать, что их программа безопасна, надёжна и обслуживаема....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Несколько лет назад, когда я ещё работал консультантом мобильный связи, я работал над приложением для большого инвестиционного банка. Для больших компаний, особенно банков, обычно вы работаете прямо на месте, чтобы гарантировать, что их программа безопасна, надёжна и обслуживаема.</p><p>Часть этого процесса заключается в отправке кода приложения, который я написал третей стороне, для рассмотрения. Меня это не напрягало, потому что я думал что мой код был безупречен и что компания, рассматривающая код скажет тоже самое.</p><p>Когда пришел их ответ, вердикт отличался от того, каким я думал он будет. Хотя они сказали, что качество кода неплохое, они указали на то, что этот код сложно обслуживать и тестировать (модульное тестирование в то время не было так популярно в разработке iOS).</p><p>Я отверг их суждения, полагая что мой код был отличным и его просто нельзя было сделать лучше. Они просто не понимают!</p><p>Как у разработчика у меня было типичное высокомерие: мы часто думаем, что то, что мы делаем отлично, а другие просто этого не понимают. </p><p>Оглядываясь назад, я ошибался. Немного позже, я начал читать кое-какие отличные рекомандации. С тех пор, проблемы в моем коде начали выпирать, как больной палец. Я понял, что, как и многие iOS разработчики, я попал в некоторые классические ловушки по применению плохого кода.</p><h2>Что большинство iOS разработчиков делают неправильно</h2><p>Одна из наиболее распространенных проблем при разработки для iOS, возникает при передаче состояния между контроллерами вида приложения — "view controller". В прошлом я сам попадал в эту ловушку.</p><p>Передача состояния через контроллеры вида (представлений) имеет жизненно важное значение в любом приложении для iOS. Поскольку ваши пользователи перемещаются по экранам вашего приложения и взаимодействуют с ним, вам нужно сохранить глобальное состояние, которое отслеживает все изменения, которые пользователь делает с данными.</p><p>И именно здесь большинство iOS разработчиков делаю очевидные, но неправильные решения: шаблон проектирования «одиночка».</p><p>Шаблон «одиночка» очень быстро реализовать, особенно в Swift, и он хорошо работает. Вам просто нужно добавить статическую переменную в класс, чтобы сохранить общий экземпляр самого класса, и все готово.</p><pre class="brush: javascript noskimlinks noskimwords">class Singleton {    static let shared = Singleton()}</pre><p>А потом легко получить доступ к этому общему экземпляру из любого места в вашем коде:</p><pre class="brush: javascript noskimlinks noskimwords">let singleton = Singleton.shared</pre><p>По этой причине многие разработчики считают, что они нашли наилучшее решение проблемы передача состояний. Но они ошибаются.</p><p>Шаблон «одиночка» фактически считается анти-шаблоном. В сообществах разработчиков было очень много разговоров на эту тему. Примеру можете посмотреть <span>вопросы на Stack Overflow</span>.</p><p>Вкратце, «одиночки» создают следующие проблемы:</p><ul><li>Это добавляет большое количество зависимостей в своих классах, что усложняет изменение их в будущем.</li> <li>Это делает так, что глобальные состояния доступны из любой части кода. Это может создать сложности при взаимодействии, что сложно отследить и приводит к множеству неожиданных багов.</li> <li>Это усложняет тестирование ваших классов, так как вы не можете запросто отделить их от «одиночки».<br></li> </ul><p>На этой стадии, некоторые разработчики думают: "Аа, У меня есть решение получше. Вместо этого я буду использовать <code class="inline">AppDelegate</code>.</p><p>Проблема в том, что в  iOS приложениях к классу <code class="inline">AppDelegate</code> можно получить доступ через общий экземпляр <code class="inline">UIApplication</code>:</p><pre class="brush: javascript noskimlinks noskimwords">let appDelegate = UIApplication.shared.delegate</pre><p>Но, дело в том, что этот общий экземпляр <code class="inline">UIApplication</code> сам является «одиночкой». Поэтому, вы ничего не решили!</p><p>Решением этой проблемы является внедрение зависимостей. Внедрение зависимостей означает, что класс не принимает или создает свои собственные зависимости, но принимает их извне.</p><p>Чтобы посмотреть, как использовать внедрение зависимостей в приложениях iOS и как с помощью этого можно передавать состояние, сначала нам нужно пересмотреть один фундаментальный шаблон проектирования приложений для iOS: «Модель–Вид–Контроллер» — Model-View-Controller.</p><h2>Дополнение шаблона MVC</h2><p>Шаблон MVC, в двух словах, утверждает, что в архитектуре приложений iOS есть три уровня:</p><ul><li>Уровень модели представляет данные приложения.</li> <li>Слой вида отображает информацию на экране и позволяет взаимодействовать с ней.</li> <li>Слой контроллер действует как клей между двумя другими слоями, перемещая данные между ними.<br></li> </ul><p>Обычное представление MVC шаблона выглядит примерно так:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=618/uploads/users/1637/posts/28474/image/MVC.png" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"></figure><p>Проблема в том, что эта диаграмма неверна.</p><p>Эта «тайна» кроется на виду, в нескольких строках <span>документации Apple</span>:</p><blockquote>"Можно объединить роли MVC в объект, создав объект, например, чтобы он выполнял обе роли и контроллера, и вида — в этом случае, это будет называться контроллером вида (view controller). Таким же образом, вы можете создать объект модель-контроллер."</blockquote><p>Многие разработчики полагают, что контроллер вида, это единственный контроллер, который существует в iOS приложениях. По этой причине, большая часть кода пишется внутри их, за неимением лучшего места. Именно это приводит разработчиков к использованию «одиночки», когда им нужно передать состояние: это кажется единственным решением.</p><p>Из строк, процитированных выше, становится ясно, что мы можем добавить новую сущность в наше понимание шаблона MVC: модель-контроллер. Контроллеры модели имеют дело с моделью приложения, исполняя роли, которые модель, сама по себе, не должна выполнять. Вот как, в действительности, должна выглядеть схема представленная выше:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=654/uploads/users/1637/posts/28474/image/MVC-Extended.png" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"></figure><p>Идеальный пример того, когда контроллеры модели полезны для поддержания состояния предложения. Модель должна только обрабатывать данные вашего приложения. Состояние приложения не должно относиться к её обязанностям.</p><p>Хранение состояния обычно не выходит за рамки контроллера вида, но теперь, У нас есть более подходящие для этого место: контроллер модели. Такой контроллер модели затем можно передать в контроллер вида, когда те показываются на экране через внедрение зависимости.</p><p>Мы решили анти-шаблон «одиночка». Давайте посмотрим на наше решение в действии и с примерами.</p><h2>Распространение состояния через контроллеры вида (View Controllers) через внедрение  зависимости</h2><p>Мы напишем простое приложение, чтобы посмотреть как работает конкретный пример. Приложение будет показывать на экране ваши любимые цитаты, с возможностью редактировать цитаты на втором экране (виде).</p><p>Это означает, что нашего приложения потребуется два контроллера вида, которые будут передавать между собой состояние. После того, как вы увидите, как работает это решение, вы можете расширить концепцию до приложений любого размера и сложности.</p><p>Для начала, вам нужен тип модели для отображения данных, что в нашем случае является цитатой. Это можно сделать очень просто:</p><pre class="brush: javascript noskimlinks noskimwords">struct Quote {    let text: String  let author: String}</pre><h3>Контроллер модели</h3><p>Зачем нам нужно создать контроллер модели, который содержит состояние приложения. Этот контроллер модели должен быть классом. Это потому, что нам нужeн единственный экземпляр, который мы будем передавать во все наши контроллеры вида. Значения с таким типом как struct, копируются при их передаче, поэтому они определённо не является правильным решением.</p><p>В нашем примере, все контроллеры моделей являются свойством, которое может содержать текущую цитату. Но, конечно, в больших предложениях контроллеры моделей могут быть более сложными чему это:</p><pre class="brush: plain noskimlinks noskimwords">class ModelController {    var quote = Quote(text: "Two things are infinite: the universe and human stupidity; and I"m not sure about the universe.",author: "Albert Einstein")}</pre><p>Я назначил значение по умолчанию на свойство <b>quote</b>, чтобы нам было что показать на экране, при запуске приложения. Это не обязательно и вы можете объявить это свойство необязательным, задав его как <b>nil</b>, если вы хотите, чтобы ваше приложение запустилась с пустым состоянием.</p><h3>Создаем интерфейс пользователя</h3><p>Теперь у нас есть контроллер модели, который будет содержать состояние нашего приложения. Далее, нам понадобится контроллер вида, который будет отображать экраны нашего приложения.</p><p>Для начала, создадим их пользовательский интерфейс. Так выглядят два контроллера вида внутри раскадровки приложения (storyboard).</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/1637/posts/28474/image/storyboard%20copy.jpg" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"></figure><p>Интерфейс первого контроллера вида сделан из нескольких кнопок и заголовков, в сочетании с простыми ограничениями автоматической компоновки. (Вы можете прочитать подробнее об <span>автоматической компоновке здесь на Envato Tuts+</span>.)</p><ul class="roundup-block__contents posts--half-width roundup-block--list"><li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/41/posts/25520/preview_image/preview-image@2x.jpg" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"><div class="roundup-block__primary-category topic-code">iOS</div> <div class="roundup-block__content-title">iOS с нуля со Swift: Основы автоматической компоновки</div> <div class="roundup-block__author">Bart Jacobs (Барт Джейкобс)</div></span></li></ul><p>Интерфейс второго контроллера вида такой же, только содержит текст (text view) для редактирования текста цитаты и текстовое поле (text field) для изменения автора.</p><p>Эти два контроллера вида связаны единым модальным представлениям перехода, который берет своё начало на кнопке <strong>Edit quote</strong> (Редактировать цитату).</p><p>Вы можете изучить интерфейс и ограничения контроллеров вида в <span>репозитории GitHub</span>.</p><h3>Пишем контроллер вида с добавлением зависимости</h3><p>Теперь нам нужно написать наши контроллеры вида. Важно, при этом, иметь ввиду, что им будет нужно получать экземпляр контроллера модели извне, через зависимость. Поэтому им нужно указать свойство.</p><pre class="brush: javascript noskimlinks noskimwords">var modelController: ModelController!</pre><p>Мы можем называть наш первый контроллер вида как <code class="inline">QuoteViewController</code>. В интерфейсе этого контроллера вида потребуется несколько выводов (outlet) для меток цитаты и автора.</p><pre class="brush: javascript noskimlinks noskimwords">class QuoteViewController: UIViewController {    @IBOutlet weak var quoteTextLabel: UILabel!@IBOutlet weak var quoteAuthorLabel: UILabel!var modelController: ModelController!}</pre><p>Когда этот контроллер вида появляется на экране, мы заполняем его интерфейс, отобразив в текущую цитату. Код, который это делает, мы размещаем в методе контроллера <code class="inline">viewWillAppear(_:)</code>.</p><pre class="brush: javascript noskimlinks noskimwords">class QuoteViewController: UIViewController {    @IBOutlet weak var quoteTextLabel: UILabel!@IBOutlet weak var quoteAuthorLabel: UILabel!var modelController: ModelController!override func viewWillAppear(_ animated: Bool) {super.viewWillAppear(animated)let quote = modelController.quotequoteTextLabel.text = quote.textquoteAuthorLabel.text = quote.author}}</pre><p>Мы могли бы разместить этот код внутри метода <code class="inline">viewDidLoad()</code>, что было бы более привычно. Проблема в том, что <code class="inline">viewDidLoad()</code> вызывается только один раз, при создании контроллера вида. В нашем приложении, нам нужно обновлять пользовательский интерфейс <code class="inline">QuoteViewController</code> каждый раз когда он отображается на экране. Это нужно, потому что пользователь может редактировать цитату на втором экране. </p><p>Вот почему мы используем метод <code class="inline">viewWillAppear(_:)</code> вместо <code class="inline">viewDidLoad()</code>. Таким образом мы можем обновлять UI контроллера вида, каждый раз когда он появляется на экране. Если вы хотите больше узнать о жизненном цикле контроллера вида и всех вызываемых методах, <span>я написал статью, в которой подробно описываются все о них</span>.</p><h3>Редактирование контроллера вида</h3><p>Теперь нам нужно написать код для второго контроллера вида. Мы можем назвать его <code class="inline">EditViewController</code>.</p><pre class="brush: javascript noskimlinks noskimwords">class EditViewController: UIViewController {    @IBOutlet weak var textView: UITextView!@IBOutlet weak var textField: UITextField!var modelController: ModelController!override func viewDidLoad() {super.viewDidLoad()let quote = modelController.quotetextView.text = quote.texttextField.text = quote.author}}</pre><p>Этот контроллер вида похож на предыдущий:</p><ul><li>Есть выводы (outlet) для текстового отображения (text view, строка 2) и текстового поля (text field, строка 3), которое пользователь будет использовать для редактирования цитаты.</li> <li>Есть свойство для внедрения зависимости в экземпляр контроллера вида.</li> <li>Это заполняет интерфейс пользователя, перед показом на экране.<br></li> </ul><p>В этом случае, я использовал метод <code class="inline">viewDidLoad()</code>, потому что, этот контроллер вида выйдет на экран только один раз.</p><h3>Передача состояния</h3><p>Теперь, нам надо передать состояние между двумя контроллерами вида и обновить его, если пользователь отредактировал цитату.</p><p>Мы передаем состояние приложение методом <code class="inline">prepare(for:sender:)</code> от <code class="inline">QuoteViewController</code>. Этот метод запускается подключением segue, когда пользователь нажимает кнопку «Редактировать цитату» (<strong>Edit quote</strong>).</p><pre class="brush: javascript noskimlinks noskimwords">class QuoteViewController: UIViewController {    @IBOutlet weak var quoteTextLabel: UILabel!@IBOutlet weak var quoteAuthorLabel: UILabel!var modelController: ModelController!override func viewWillAppear(_ animated: Bool) {super.viewWillAppear(animated)let quote = modelController.quotequoteTextLabel.text = quote.textquoteAuthorLabel.text = quote.author}override func prepare(for segue: UIStoryboardSegue, sender: Any?) {if let editViewController = segue.destination as? EditViewController {editViewController.modelController = modelController}}}</pre><p>Здесь мы передаем дальше экземпляр <code class="inline">ModelController</code>, который содержит состояние приложения. Вот где происходит внедрение зависимости для <code class="inline">EditViewController</code>.</p><p>В <code class="inline">EditViewController</code>,Нам нужно обновить состояние до новой введённой цитаты, прежде чем вернуться к предыдущему контроллеру вида. Мы можем делать это по действию назначенному на кнопку <strong>Save</strong>:</p><pre class="brush: javascript noskimlinks noskimwords">class EditViewController: UIViewController {    @IBOutlet weak var textView: UITextView!@IBOutlet weak var textField: UITextField!var modelController: ModelController!override func viewDidLoad() {super.viewDidLoad()let quote = modelController.quotetextView.text = quote.texttextField.text = quote.author}@IBAction func save(_ sender: AnyObject) {let newQuote = Quote(text: textView.text, author: textField.text!)modelController.quote = newQuotedismiss(animated: true, completion: nil)}}</pre><h3>Инициализация контроллера модели</h3><p>Мы почти закончили, но вы наверно заметили, что мы всё же что-то пропустили: <code class="inline">QuoteViewController</code> передает <code class="inline">ModelController</code> в <code class="inline">EditViewController</code> через внедрение зависимости. А кто в первую очередь передает этот экземпляр в <code class="inline">QuoteViewController</code>? Помните, что при внедрении зависимостей, контроллер вида не должен создавать свои собственные зависимости. Они должны поступить извне.</p><p>Но перед <code class="inline">QuoteViewController</code> нет никакого контроллера вида, потому что это первый контроллер вида в нашем приложении. Нам нужно какой-то другой объект, для создания экземпляра <code class="inline">ModelController</code> и передачи его в <code class="inline">QuoteViewController</code>.</p><p>Этим объектом будет <code class="inline">AppDelegate</code>. Его роль — реагировать на методы жизненного цикла приложения и настраивать приложение соответственно им. Один из этих методов <code class="inline">application(_:didFinishLaunchingWithOptions:)</code>, который называется сразу, как только запускается приложение. Вот где мы создаем экземпляр <code class="inline">ModelController</code> и передаем его к <code class="inline">QuoteViewController</code>:</p><pre class="brush: javascript noskimlinks noskimwords">class AppDelegate: UIResponder, UIApplicationDelegate {    var window: UIWindow?func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {if let quoteViewController = window?.rootViewController as? QuoteViewController {quoteViewController.modelController = ModelController()}return true}}</pre><p>Теперь наше приложение готово. Каждый контроллер вида получает доступ к глобальному состоянию приложения, и мы обошлись без использования «одиночки».</p><p>Вы можете загрузить <span>пример проекта Xcode для этого приложения из репозитория на GitHub</span>.</p><h2>Заключение</h2><p>В этой статье вы увидели, что использование «одиночки» для передачи состояния в приложении iOS — это плохой выбор. «Одиночки» создают множество проблем, несмотря на то, что их очень легко создавать и использовать.</p><p>Мы решили проблему, более внимательно рассмотрев модель MVC и поняв её скрытые возможности. Благодаря использованию контроллеров модели и внедрение зависимостей мы смогли передать состояние приложения на все контроллеры вида, не прибегая к использованию шаблона «одиночка».</p><p>Это пример простого приложения, но концепцию можно распространить на приложения любой сложности. Это стандартная рекомендация для передачи состояния в приложениях для iOS. Теперь я использую его в каждом приложении, которое я пишу для своих клиентов.</p><p>Несколько вещей, о которых нужно помнить, когда вы расширяете концепцию до более крупных приложений:</p><ul><li>Контроллер модели может сохранять состояние приложения, например в файле. Таким образом, наши данные будут сохраняться каждый раз, при закрытии приложения. Вы также можете использовать более сложное решение для хранения данных, например Core Data. Я рекомендую держать это функциональность в отдельном контроллере модели, которые покрывают только работу с хранилищем. Тогда этот контроллер может быть использован контроллером модели, который содержит состояние приложение.</li> <li>В приложении с более сложным потоком, у вас будет больше контейнеров в потоке вашего приложения. Как правило, это контроллеры навигации, со случайным контроллером панели вкладок. Концепция внедрения зависимостей по-прежнему применяется, но вам нужно учитывать контейнеры. При выполнении внедрения зависимостей вы можете либо вникать с содержащие их контроллеры вида, либо создавать собственные подклассы контейнеров, которые передают контроллер модели.</li> <li>Если вы добавили в ваше приложение работу с интернетом, это должно идти в отдельном контроллере модели. Контроллер вида может выполнять сетевой запрос через этот сетевой контроллер, а затем передавать полученные данные контроллеру модели, который сохраняет состояние. Помните, что роль контроллера вида заключается в следующем: действовать как объект клея, который передает данные между объектами.</li> </ul><p>Оставайтесь с нами, чтобы узнать больше подсказок и советов по разработке приложений для iOS!</p><ul class="roundup-block__contents posts--half-width roundup-block--list"><li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/41/posts/25520/preview_image/preview-image@2x.jpg" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"><div class="roundup-block__primary-category topic-code">iOS</div> <div class="roundup-block__content-title">iOS с нуля со Swift: Основы автоматической компоновки</div> <div class="roundup-block__author">Bart Jacobs (Барт Джейкобс)</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/41/posts/27619/preview_image/preview-image@2x.jpg" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Core Data</div> <div class="roundup-block__content-title">Core Data стала лучше</div> <div class="roundup-block__author">Bart Jacobs (Барт Джейкобс)</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/787/posts/27924/preview_image/sirikit.png" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"><div class="roundup-block__primary-category topic-code">iOS SDK</div> <div class="roundup-block__content-title">Создание дополнения SiriKit в iOS 10</div> <div class="roundup-block__author">Patrick Balestra (Патрик Балестра)</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/41/posts/27535/preview_image/preview-image-ios-10.jpg" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"><div class="roundup-block__primary-category topic-code">iOS</div> <div class="roundup-block__content-title">Обновление вашего приложения до iOS 10</div> <div class="roundup-block__author">Bart Jacobs (Барт Джейкобс)</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/1455/posts/27488/preview_image/preview.png" alt="Правильный способ передавать состояние между View Controllers в Swift..." title="Правильный способ передавать состояние между View Controllers в Swift..." width="50" height="50"><div class="roundup-block__primary-category topic-code">iOS SDK</div> <div class="roundup-block__content-title">Игровой центр и списки лидеров в вашем iOS приложении</div> <div class="roundup-block__author">Francesco Franchini (Франческо Франчини)</div></span></li> </ul><p></p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="iOS SDK" href="https://norma-studio.github.io/article5/220825007-pravilnyj-sposob-peredavat-sostoyanie-mezhdu-view-controllers-v-swift" class="tm-article-body__tags-item-link">iOS SDK</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
44077</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
723</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
