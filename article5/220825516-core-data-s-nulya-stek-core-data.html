
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Фреймворк Core Data существует уже много лет. Он используется в тысячах приложений и миллионами людей, как на iOS, так и на OS X. Core Data поддерживаются Apple и очень хорошо документированы. Это состоявшийся фреймворк, который доказывает свою 
ценность снова и снова....">
<meta property="og:description" content="Фреймворк Core Data существует уже много лет. Он используется в тысячах приложений и миллионами людей, как на iOS, так и на OS X. Core Data поддерживаются Apple и очень хорошо документированы. Это состоявшийся фреймворк, который доказывает свою 
ценность снова и снова....">
<meta name="twitter:description" content="Фреймворк Core Data существует уже много лет. Он используется в тысячах приложений и миллионами людей, как на iOS, так и на OS X. Core Data поддерживаются Apple и очень хорошо документированы. Это состоявшийся фреймворк, который доказывает свою 
ценность снова и снова....">
<meta property="aiturec:description" content="Фреймворк Core Data существует уже много лет. Он используется в тысячах приложений и миллионами людей, как на iOS, так и на OS X. Core Data поддерживаются Apple и очень хорошо документированы. Это состоявшийся фреймворк, который доказывает свою 
ценность снова и снова....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-1.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-1.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-1.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-1.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-1.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html" title="Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io" title="Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/45343254534.jpg" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html" class="tm-user-info__username" title="
С. Баранов" aria-label="
С. Баранов">
С. Баранов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Core Data с нуля: стек Core Data
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Mobile Development" href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data" class="tm-article-snippet__hubs-item-link"><span>Mobile Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-1.jpg">
    <meta itemprop="headline name" content="Core Data с нуля: стек Core Data
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Фреймворк Core Data существует уже много лет. Он используется в тысячах приложений и миллионами людей, как на iOS, так и на OS X. Core Data поддерживаются Apple и очень хорошо документированы. Это состоявшийся фреймворк, который доказывает свою 
ценность снова и снова....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Фреймворк Core Data существует уже много лет. Он используется в тысячах приложений и миллионами людей, как на iOS, так и на OS X. Core Data поддерживаются Apple и очень хорошо документированы. Это состоявшийся фреймворк, который доказывает свою 
ценность снова и снова....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



 <h2><span class="sectionnum">Введение</span></h2><p><span class="sectionnum">Фреймворк Core Data существует уже много лет. Он используется в тысячах приложений и миллионами людей, как на iOS, так и на OS X. Core Data поддерживаются Apple и очень <span>хорошо документированы</span>. Это состоявшийся фреймворк, который доказывает свою ценность снова и снова.</span></p><p><span class="sectionnum">Core Data использует преимущества языка Objective-C и его среды и плавно интегрируется с базой Core Foundation. Результат - простая в использовании инфраструктура для управления графом объектов, элегантный в использовании и невероятно эффективный с точки зрения использования памяти.</span></p><h2> <span class="sectionnum">1. Требования</span></h2><p>Несмотря на то, что Core Data не сложная сама по себе, если вы новичок в разработке на iOS или OS X, я рекомендую вам сначала ознакомиться с нашей <span>серией уроков о разработке на iOS</span>. Она научит вас основам разработки на iOS, и после завершения серии у вас будет достаточно знаний для изучения более сложных тем, таких как Core Data.<br></p><p>Как я уже сказал, Core Data не такая сложная для понимания, как думают многие разработчики. Тем не менее, я уверен, что хорошая база имеет решающее значение для ускорения работы с Core Data. У вас должно быть понимание API Core Data, чтобы избежать неправильного применения и убедиться, что вы не столкнётесь с проблемами при использовании фреймворка.</p><p>Каждый компонент Core Data имеет определенную цель и функцию. Если вы попытаетесь использовать Core Data таким образом, каким он не был задуман, вы неизбежно столкнетесь с трудностями использованияфреймворка.</p><p>То, что я расскажу в этой серии о Core Data, применимо к iOS 6+ и OS X 10.8+, но основное внимание будет уделено iOS. В этой серии я буду работать с Xcode 5 и iOS 7 SDK.</p><h2> <span class="sectionnum">2. Изучаем Кривые</span></h2><p>Структура Core Data может показаться сложной на первый взгляд, но API становится интуитивно понятным и лаконичный, как только вы поймете, как различные части взаимодействуют друг с другом. И это именно та часть, где большинство разработчиков сталкиваются с проблемами. Они пытаются использовать Core Data, прежде чем они увидят весь пазл, и не знают, как части головоломки соотносятся друг с другом.</p><p>В этой статье я помогу вам ознакомиться с так называемым <b>ядром Core Data</b>. Как только вы поймете ключевые моменты в стеке Core Data, структура будет казаться менее сложной, и вы даже начнете наслаждаться и оцените хорошо продуманный API фреймворка.</p><p>В отличие от таких систем, как UIKit, которые вы можете использовать без понимания структуры в целом, Core Data требует правильного понимания своих компонентов. Важно уделить время, чтобы ознакомиться с фреймворком, что мы и сделаем в этом уроке.</p><h2> <span class="sectionnum">3. Что такое Core Data?</span></h2><p>Разработчики, новички в Core Data, часто ожидают, что она будет работать как база данных. Если и есть то, что я надеюсь вы запомните из этой серии, это то, что Core Data не является базой данных, и следовательно вы не должны ожидать, что она будет действовать как она.</p><p>Что такое Core Data, если это не база данных? это модельный уровень вашего приложения в самом широком смысле. Это <b>модель</b> в шаблоне <b>Model-View-Controller</b> который пронизывает IOS SDK.</p><p>Core Data - это не база данных для вашего приложения, а также API для хранения данных в базе данных. Core Data - это структура, управляющая графом объектов. Это все. Core Data <i>может</i> сохранять этот граф объектов, записывая его на диск, но это не основная цель структуры.</p><h2>4. Стек Core Data<br></h2><p>Как я уже упоминал ранее, ядро Core Data является основой Core Data. Это набор объектов, которые заставляют Core Data работать. Ключевыми объектами стека являются <b>модель управляемых объектов</b>, <b>постоянный координатор хранилища</b> и один или несколько <b>контекстов управляемых объектов</b>. Давайте начнем с быстрого анализа каждого компонента.</p><h3><code class="inline">NSManagedObjectModel</code></h3><p>Модель управляемых объектов - это модель данных приложения. Несмотря на то, что Core Data не является базой данных, вы можете сравнить модель управляемых объектов со схемой базы данных, то есть она содержит информацию о моделях или объектах графа, какие атрибуты они имеют и как они относятся к друг друга.</p><p>Объект <code class="inline">NSManagedObjectModel</code> знает о модели данных, загружая один или несколько файлов модели данных во время ее инициализации. Мы рассмотрим, как это работает через несколько мгновений.</p><h3> <code class="inline">NSPersistentStoreCoordinator</code><br></h3><p>Как и указывает его имя, объект <code class="inline">NSPersistentStoreCoordinator</code> сохраняет данные на диске и гарантирует совместимость хранилищ и моделей данных. Он является посредником между постоянным хранилищем (хранилищами) и контекстом (-ами) управляемого объекта, а также занимается загрузкой и кэшированием данных. Так и есть. В Core Data встроено кэширование.</p><p>Постоянный координатор хранилища является проводником оркестра Core Data. Несмотря на свою важную роль в стеке Core Data, мы редко взаимодействуем с ним напрямую.</p><h3><code class="inline">NSManagedObjectContext</code></h3><p>Объект <code class="inline">NSManagedObjectContext</code> управляет набором объектов модели, экземплярами класса <code class="inline">NSManagedObject</code>. Возможно иметь несколько контекстов управляемых объектов. Каждый контекст управляемого объекта поддерживается постоянным координатором хранилища.</p><p>Вы можете обнаружить контекст управляемого объекта в виде рабочего пространства, в котором вы работаете с объектами модели. Вы загружаете их, управляете ими и сохраняете их на этом своеобразном верстаке. Загрузка и сохранение оповещаются постоянным координатором хранилища. Вы можете иметь несколько рабочих пространств, что полезно, если ваше приложение многопоточно, к примеру.</p><p>Хотя модель управляемых объектов и постоянный координатор хранилища могут быть разделены между потоками, контексты управляемых объектов никогда не должны быть доступны из потока, отличного от того, в котором они были созданы. Мы обсудим многопоточность более подробно позже в этой серии.</p><h2> <span class="sectionnum">5. Изучение стека Core Data</span></h2><h3>Шаг 1: Шаблон Xcode</h3><p>Давайте рассмотрим стек Core Data более подробно, взглянув на шаблон Xcode Apple для Core Data. Создайте новый проект в Xcode 5, выбрав <b>New &gt; Project...</b> в меню <b>File</b>. Выберите шаблон <b>Пустое приложение</b> из списка шаблонов <b>приложений iOS</b> слева.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-1.jpg" alt="Core Data с нуля: стек Core Data..." title="Core Data с нуля: стек Core Data..." width="50" height="50"></figure><p>Назовите проект <b>Core Data</b>, установите <b>Devices</b> на значение <b>iPhone</b> и установите флажок <b>Использовать основные данные</b>. Укажите Xcode, где вы хотите сохранить файлы проекта и нажмите <b>Создать</b>.<br></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-2.jpg" alt="Core Data с нуля: стек Core Data..." title="Core Data с нуля: стек Core Data..." width="50" height="50"></figure><h3>Шаг 2: Обзор</h3><p>По умолчанию Apple помещает код, связанный с Core Data в класс делегирования приложения, класс <code class="inline">TSPAppDelegate</code> в нашем примере. Начнем с изучения интерфейса <code class="inline">TSPAppDelegate</code>.</p><pre class="brush: objc noskimlinks noskimwords">#import &lt;UIKit/UIKit.h&gt;@interface TSPAppDelegate : UIResponder &lt;UIApplicationDelegate&gt;@property (strong, nonatomic) UIWindow *window;@property (readonly, strong, nonatomic) NSManagedObjectContext *managedObjectContext;@property (readonly, strong, nonatomic) NSManagedObjectModel *managedObjectModel;@property (readonly, strong, nonatomic) NSPersistentStoreCoordinator *persistentStoreCoordinator;- (void)saveContext;- (NSURL *)applicationDocumentsDirectory;@end</pre><p>Как вы можете видеть, делегат приложения имеет свойство для каждого компонента стека основных данных, а также два удобных метода: <code class="inline">saveContext</code> и <code class="inline">applicationDocumentsDirectory</code>.</p><p>Обратите внимание, что свойства Core Data отмечены как <code class="inline">readonly</code>, что означает, что экземпляры не могут быть изменены объектами, отличными от самого приложения.</p><p>Реализация <code class="inline">TSPAppDelegate</code> гораздо интереснее и покажет нам, как работающая модель объекта, постоянный координатор хранилища и контекст управляемых объектов работают вместе. Начнем с начала.</p><pre class="brush: objc noskimlinks noskimwords">#import "TSPAppDelegate.h"@implementation TSPAppDelegate@synthesize managedObjectContext = _managedObjectContext;@synthesize managedObjectModel = _managedObjectModel;@synthesize persistentStoreCoordinator = _persistentStoreCoordinator;</pre><p>Поскольку свойства в интерфейсе класса <code class="inline">TSPAppDelegate</code> объявляются как readonly, не создаются методы setter. Первая директива <code class="inline">@synthesize</code> сообщает компилятору связать переменную экземпляра <code class="inline">_managedObjectContext</code> с свойством <code class="inline">managedObjectContext</code>, которое мы объявили в интерфейсе класса. Это общий шаблон для поэтапной загрузки объектов.</p><p>Вы можете добиться того же результата, используя расширение частного класса в файле реализации класса. Взгляните на следующий фрагмент кода. Директивы <code class="inline">@synthesize</code> не нужны, если вы используете расширение частного класса.</p><pre class="brush: objc noskimlinks noskimwords">#import "TSPAppDelegate.h"@interface TSPAppDelegate ()@property (strong, nonatomic) NSManagedObjectContext *managedObjectContext;@property (strong, nonatomic) NSManagedObjectModel *managedObjectModel;@property (strong, nonatomic) NSPersistentStoreCoordinator *persistentStoreCoordinator;@end</pre><p>Хотя я обычно использую и предпочитаю расширение частного класса, мы будем придерживаться шаблона Apple для этого урока.</p><p>Настройка стека Core Data фактически довольно проста с точки зрения методов, которые необходимо реализовать. Apple не использует специальные методы настройки для создания пакета Core Data. Три ключевых объекта стека Core Data создаются, когда они необходимы. Другими словами, они поэтапно загружаются или создаются.</p><p>На практике это означает, что реализация класса <code class="inline">TSPAppDelegate</code> похожа на то, что вы ожидаете в классе делегирования приложения, за исключением методов <code class="inline">saveContext</code> и <code class="inline">applicationDocumentsDirectory</code>, а также методов getter для управляемого <code class="inline">ObjectContext</code>, <code class="inline">managedObjectModel</code> и <code class="inline">persistentStoreCoordinator</code>. Именно в этих методах происходит волшебство. Это одна из жемчужин Core Data, настройка очень проста и взаимодействие с Core Data так же проста.</p><h3>Шаг 3: Контекст управляемого объекта</h3><p>Класс, который вы будете использовать чаще всего, помимо <code class="inline">NSManagedObject</code>, при взаимодействии с основными данными - это <code class="inline">NSManagedObjectContext</code>. Начнем с изучения его геттера.</p><pre class="brush: objc noskimlinks noskimwords">- (NSManagedObjectContext *)managedObjectContext{    if (_managedObjectContext != nil) {        return _managedObjectContext;    }        NSPersistentStoreCoordinator *coordinator = [self persistentStoreCoordinator];    if (coordinator != nil) {        _managedObjectContext = [[NSManagedObjectContext alloc] init];        [_managedObjectContext setPersistentStoreCoordinator:coordinator];    }    return _managedObjectContext;}</pre><p>Первые три строки его реализации типичны для геттера, который поэтапно загружает переменную экземпляра. Если объект <code class="inline">NSManagedObjectContext</code> не равен <code class="inline">null</code>, он возвращает объект. Интересный момент - это фактическое создание объекта <code class="inline">NSManagedObjectContext</code>.</p><p>Сначала мы получаем ссылку на координатор хранилища сохранения, вызывая его метод getter. Постоянный координатор хранилища также загружается поэтапно, как мы увидим в следующий момент. Если постоянный координатор хранилища не равен <code class="inline">null</code>, мы создаем экземпляр <code class="inline">NSManagedObjectContext</code> и устанавливаемего свойство <code class="inline">persistentStoreCoordinator</code> и передаем его постоянному координатору хранилища. Это было не слишком сложно. Не так ли?</p><p>Таким образом, контекст управляемого объекта управляет набором объектов модели, экземплярами класса <code class="inline">NSManagedObject</code> и сохраняет ссылку на постоянный координатор хранилища. Помните об этом, читая остальную часть этой статьи.</p><h3>Шаг 4: Постоянный координатор хранилища</h3><p>Как мы уже видели, метод <code class="inline">persistentStoreCoordinator</code> вызывается методом <code class="inline">managedObjectContext</code>. Взгляните на реализацию <code class="inline">persistentStoreCoordinator</code>, но не позволяйте этому напугать вас. На самом деле это не так сложно.</p><pre class="brush: objc noskimlinks noskimwords">- (NSPersistentStoreCoordinator *)persistentStoreCoordinator{    if (_persistentStoreCoordinator != nil) {        return _persistentStoreCoordinator;    }        NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@"Core_Data.sqlite"];        NSError *error = nil;    _persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];    if (![_persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error]) {        /*         Replace this implementation with code to handle the error appropriately.                  abort() causes the application to generate a crash log and terminate. You should not use this function in a shipping application, although it may be useful during development.                   Typical reasons for an error here include:         * The persistent store is not accessible;         * The schema for the persistent store is incompatible with current managed object model.         Check the error message to determine what the actual problem was.                           If the persistent store is not accessible, there is typically something wrong with the file path. Often, a file URL is pointing into the application"s resources directory instead of a writeable directory.                  If you encounter schema incompatibility errors during development, you can reduce their frequency by:         * Simply deleting the existing store:         [[NSFileManager defaultManager] removeItemAtURL:storeURL error:nil]                  * Performing automatic lightweight migration by passing the following dictionary as the options parameter:         @{NSMigratePersistentStoresAutomaticallyOption:@YES, NSInferMappingModelAutomaticallyOption:@YES}                  Lightweight migration will only work for a limited set of schema changes; consult "Core Data Model Versioning and Data Migration Programming Guide" for details.                  */        NSLog(@"Unresolved error %@, %@", error, [error userInfo]);        abort();    }            return _persistentStoreCoordinator;}</pre> <p>Вы наверняка захотите сохранить граф объектов Core Data на диске, а шаблон Xcode Apple использует базу данных SQLite для достижения этой цели.</p><p>Когда мы создаем постоянный координатор хранилища в <code class="inline">persistentStoreCoordinator</code>, мы указываем местоположение хранилища на диске. Начнем с создания объекта <code class="inline">NSURL</code>, который указывает на это место в изолированной программной среде приложения. Мы вызываем <code class="inline">applicationDocumentsDirectory</code>, вспомогательный метод, который возвращает местоположение, объект <code class="inline">NSURL</code>, в каталоге <b>Documents</b> в изолированной программной среде приложения. Мы добавляем <code class="inline">Core_Data.sqlite</code> к местоположению и сохраняем его в <code class="inline">storeURL</code> для последующего использования.</p><p>По умолчанию имя хранилища на диске совпадает с именем проекта. Вы можете изменить его на любое, какое захотите.</p><pre class="brush: objc noskimlinks noskimwords">NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@"Core_Data.sqlite"];</pre><p>Как я уже говорил, расширение <code class="inline">.sqlite</code> подсказывает, что хранилище на диске представляет собой базу данных SQLite. Несмотря на то, что Core Data поддерживает несколько типов хранилищ, SQLite на сегодняшний день является наиболее используемым типом хранилища из-за его скорости и надежности.</p><pre class="brush: objc noskimlinks noskimwords">_persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];</pre><p>На следующем шаге мы создаем экземпляр постоянного координатора хранилища, вызывая <code class="inline">initWithManagedObjectModel:</code> и передаем экземпляр <code class="inline">NSManagedObjectModel</code>. Мы получаем ссылку на модель управляемых объектов, вызывая метод <code class="inline">managedObjectModel</code>, который мы рассмотрим далее.</p><p>Теперь у нас есть экземпляр класса <code class="inline">NSPersistentStoreCoordinator</code>, но пока нет связанного с ним хранилища. Мы добавляем хранилище к  постоянному координатору, вызывая довольно впечатляющий метод: <code class="inline">addPersistentStoreWithType: configuration:URL:options:error:</code>.</p><pre class="brush: objc noskimlinks noskimwords">if (![_persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error]) {    }</pre><p>Первый аргумент указывает тип хранилища <code class="inline">NSSQLiteStoreType</code> в этом примере. Core Data также поддерживает двоичные хранилища (<code class="inline">NSBinaryStoreType</code>) и хранилище в памяти (<code class="inline">NSInMemoryStoreType</code>).</p><p>Второй аргумент сообщает Core Data, какую конфигурацию использовать для постоянного хранилища. Мы передаем <code class="inline">null</code>, который сообщает Core Data использовать конфигурацию по умолчанию. Третий аргумент - это местоположение хранилища, которое хранится в <code class="inline">storeURL</code>.</p><p>Четвертый аргумент - это <code class="inline">NSDictionary</code> - опции, которые позволяют нам изменять поведение постоянного хранилища. Мы рассмотрим этот аспект позже в этой серии и перейдем сейчас к <code class="inline">null</code>. Последний аргумент - ссылка на указатель <code class="inline">NSError</code>.</p><p>Если ошибки не появляются, этот метод возвращает объект <code class="inline">NSPersistentStore</code>. Мы не сохраняем ссылки на постоянное хранилище, потому что нам не нужно взаимодействовать с ним, как только он добавляется в постоянный координатор.</p><p>Однако, если добавление стойкого хранилища не удается, это значит, что проблема связана с постоянным хранилищем приложения, и нам необходимо предпринять шаги для решения проблемы. Когда это происходит и почему это происходит, предмет отдельного разговора.</p><p>На данный момент <code class="inline">abort</code> вызывается, когда <code class="inline">addPersistentStoreWithType:configuration:URL:options:error:</code>возвращает <code class="inline">null</code>. Как поясняют комментарии в инструкции <code class="inline">if</code>, вы никогда не должны вызывать <code class="inline">abort</code>  в рабочей среде, потому что это приводит к сбою приложения. Мы исправим это позже в нашей серии.</p><h3>Шаг 5: Управляемая модель объекта</h3><p>Третий и последний фрагмент головоломки - это модель управляемых объектов. Давайте посмотрим на getter свойства <code class="inline">managedObjectModel</code>.</p><pre class="brush: objc noskimlinks noskimwords">- (NSManagedObjectModel *)managedObjectModel{    if (_managedObjectModel != nil) {        return _managedObjectModel;    }    NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"Core_Data" withExtension:@"momd"];    _managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];    return _managedObjectModel;}</pre><p>Реализация его очень проста. Мы сохраняем местоположение модели приложения в <code class="inline">modelURL</code> и передаем <code class="inline">modelURL</code> в <code class="inline">initWithContentsOfURL:</code> для создания экземпляра класса <code class="inline">NSManagedObjectModel</code>.</p><p>На данный момент вы, вероятно, задаетесь вопросом, на что указывает модель <code class="inline">ModelURL</code>, и что такое файл с расширением <code class="inline">.momd</code>. Чтобы ответить на эти вопросы, нам нужно выяснить, что еще создал Xcode для нас во время настройки проекта.</p><p>В <b>Навигаторе проектов</b> слева вы должны увидеть файл с именем <b>Core_Data.xcdatamodeld</b>. Это модель данных приложения, скомпилированный в файл <code class="inline">.momd</code>. Это файл <code class="inline">.momd</code>, который использует модель управляемых объектов для создания модели данных приложения.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-4.jpg" alt="Core Data с нуля: стек Core Data..." title="Core Data с нуля: стек Core Data..." width="50" height="50"></figure><p>Возможна ситуация когда у вас есть сразу несколько файлов модели данных. Класс <code class="inline">NSManagedObjectModel</code> отлично способен объединить несколько моделей данных в один, что является одной из наиболее мощных и продвинутых функций Core Data.</p><p>Структура Core Data также поддерживает моделирование версий данных, а также миграции. Это гарантирует, что данные, хранящиеся в постоянных хранилищах, не будут повреждены. В этой серии мы расскажем о версиях и миграции.</p><p>В настоящий момент файл модели данных в нашем проекте пуст, что означает, что наша модель данных не содержит объектов. Мы исправим это в следующем уроке, который будет ориентирован исключительно на модель данных.</p><h2> <span class="sectionnum">6. Соединяем все вместе</span></h2><p>Прежде чем мы закончим эту статью, я хотел бы показать вам диаграмму, иллюстрирующую три компонента стека Core Data.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/20926/image/figure-03.jpg" alt="Core Data с нуля: стек Core Data..." title="Core Data с нуля: стек Core Data..." width="50" height="50"></figure><p>Вышеприведенная диаграмма - это визуальное представление того, что мы изучили в шаблоне Xcode мгновение назад. Объект <code class="inline">NSPersistentStoreCoordinator</code> является мозгом стека основных данных приложения. Он ведет переговоры с одним или несколькими постоянными хранилищами и гарантирует сохранение, загрузку и кэширование данных.</p><p>Постоянный координатор хранилища знает о модели данных, схеме графического объекта, если хотите, через объект <code class="inline">NSManagedObjectModel</code>. Модель управляемых объектов создает модель данных приложения из одного или нескольких файлов <code class="inline">.momd</code>, двоичных представлений модели данных.</p><p>И последнее, но не менее важное: приложение обращается к графу объектов через один или несколько экземпляров класса <code class="inline">NSManagedObjectContext</code>. Контекст управляемого объекта знает о модели данных через постоянный координатор хранилища, но он не знает или не поддерживает ссылку на модель управляемых объектов. Нет необходимости в этом соединении.</p><p>Контекст управляемых объектов запрашивает постоянный координатор данных и сообщает ему, чтобы он сохранял данные, когда это необходимо. Все это делается для вас базой данных Core, и вашему приложению редко приходится напрямую разговаривать с постоянным координатором магазина.</p><h2>Заключение</h2><p>В этой статье мы рассмотрели ключевых игроков стека Core Data, постоянного координатора хранилища, модели управляемого объекта и контекста управляемого объекта. Удостоверьтесь, что вы понимаете роль каждого компонента и, что более важно, как они работают вместе, чтобы позволить Core Data делать своё волшебство.</p><p>В следующем выпуске этой серии посвященной Core Data мы погрузимся в изучение модели данных. Мы рассмотрим редактор модели данных в Xcode 5, и мы создаем несколько сущностей, атрибутов и отношений.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Mobile Development" href="https://norma-studio.github.io/article5/220825516-core-data-s-nulya-stek-core-data" class="tm-article-body__tags-item-link">Mobile Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
34913</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
601</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
