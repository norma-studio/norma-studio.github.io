
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Если вы живете на диете «толстые модели, тонкие контроллеры», вы определенно двигались в верном направлении. Тем не менее, держать контроллеры тонкими, не так просто, как кажется. В этой статье вы узнаете пару подходов для новичков, которые подходят для того, чтобы сделать ваши контролеры тоньше....">
<meta property="og:description" content="Если вы живете на диете «толстые модели, тонкие контроллеры», вы определенно двигались в верном направлении. Тем не менее, держать контроллеры тонкими, не так просто, как кажется. В этой статье вы узнаете пару подходов для новичков, которые подходят для того, чтобы сделать ваши контролеры тоньше....">
<meta name="twitter:description" content="Если вы живете на диете «толстые модели, тонкие контроллеры», вы определенно двигались в верном направлении. Тем не менее, держать контроллеры тонкими, не так просто, как кажется. В этой статье вы узнаете пару подходов для новичков, которые подходят для того, чтобы сделать ваши контролеры тоньше....">
<meta property="aiturec:description" content="Если вы живете на диете «толстые модели, тонкие контроллеры», вы определенно двигались в верном направлении. Тем не менее, держать контроллеры тонкими, не так просто, как кажется. В этой статье вы узнаете пару подходов для новичков, которые подходят для того, чтобы сделать ваши контролеры тоньше....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/851/profiles/19371/profileImage/edgar_avatar_400x.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/851/profiles/19371/profileImage/edgar_avatar_400x.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/851/profiles/19371/profileImage/edgar_avatar_400x.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/851/profiles/19371/profileImage/edgar_avatar_400x.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/851/profiles/19371/profileImage/edgar_avatar_400x.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html" title="Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io" title="Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64535356345.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html" class="tm-user-info__username" title="
В. Чендылов" aria-label="
В. Чендылов">
В. Чендылов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Антипаттерны: контроллеры Rails...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Ruby on Rails" href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails" class="tm-article-snippet__hubs-item-link"><span>Ruby on Rails</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/851/profiles/19371/profileImage/edgar_avatar_400x.png">
    <meta itemprop="headline name" content="Антипаттерны: контроллеры Rails... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Если вы живете на диете «толстые модели, тонкие контроллеры», вы определенно двигались в верном направлении. Тем не менее, держать контроллеры тонкими, не так просто, как кажется. В этой статье вы узнаете пару подходов для новичков, которые подходят для того, чтобы сделать ваши контролеры тоньше....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Если вы живете на диете «толстые модели, тонкие контроллеры», вы определенно двигались в верном направлении. Тем не менее, держать контроллеры тонкими, не так просто, как кажется. В этой статье вы узнаете пару подходов для новичков, которые подходят для того, чтобы сделать ваши контролеры тоньше....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Если вы живете на диете «толстые модели, тонкие контроллеры», вы определенно двигались в верном направлении. Тем не менее, держать контроллеры тонкими, не так просто, как кажется. В этой статье вы узнаете пару подходов для новичков, которые подходят для того, чтобы сделать ваши контролеры тоньше.</p><h2>Темы</h2><ul><li>Толстые контроллеры</li> <li>Не-RESTful контроллеры</li> <li>Вложенные ресурсы</li> </ul><h2>Толстые контроллеры</h2><p>Ну, «толстые модели, тонкие контроллеры», правильно? Если вы не прочитали предыдущие статьи из серии Антипаттернов, я должен упомянуть, что стремление к контроллерам, которые остаются тонкими, является лучшим ориентиром  для вас. Все, что добавляет лишний жир не подходит для ваших проектов - «все тонкое» имеет гораздо больше смысла. (Может быть, я должен четко указать, что я никоим образом не связан с индустрией моды и не хочу произвести впечатление, что нельзя считать красивым, не приспосабливаясь к определенному типу воображаемого тела.) </p><p>Как и в случае с моделями, вы хотите, чтобы контроллеры имели только одну ответственность. Контролеры должны быть на самом деле максимально тупыми, управляя трафиком и не намного больше этого. Кроме того, если это возможно, мы хотим сделать наши шаблоны настолько тупыми, насколько это возможно - презентеры могут быть весьма полезны в этом отношении.</p><p>Кроме того, важно, чтобы вы не отклонялись от действий контроллеров RESTful. Конечно, время от времени может иметь смысл иметь дополнительные методы, но большую часть времени вы должны чувствовать себя немного неловко, когда вы ими окружены. Контроллеры, как правило, толстеют, когда они собирают бизнес-логику, которая действительно принадлежит моделям, или когда неопытные разработчики не используют соглашения Rails. </p><p>Вы не будете первым пытаться изобретать колесо, и вы, конечно, не будете последним. Не чувствуйте себя плохо, потому что, вероятно, большинство из нас было там, но, как ремесленник, вам действительно нужно инвестировать свое время и усилия, чтобы знать соглашения, преимущества и ограничения фреймворка, с которым вы работаете, по крайней мере в коммерческих целях, кто-то все таки платит вам за ваш опыт. Конечно, эксперименты всегда прекрасны.</p><p>Поскольку контроллеры отвечают за поток вашего приложения, а также собирают информацию, необходимую вашим отображениям, у них уже есть довольно важная ответственность. Им действительно не нужна дополнительная сложность из области ваших моделей. Контроллеры тесно взаимодействуют с вашими представлениями, чтобы отобразить данные, предоставленные слоем модели. Их отношения плотнее, чем отношения с моделями. Модельный слой потенциально может развиваться гораздо более независимо от других. Хорошая вещь в том, что чистый слой контроллеров часто оказывает положительное влияние на то, насколько аккуратны ваши отображения.</p><p>То, что я хочу объяснить, заключается в том, что толстые контроллеры очень распространены в Rails, особенно среди новичков и неопытных разработчиков, и что добавив немного любви и заботы эту ситуацию очень легко поправить. </p><p>Первый шаг прост. Спросите себя, когда контроллер растет в размерах, связана ли эта сложность с добавленной бизнес-логикой. Если это так, найдите способ переместить ее на слой модели, где вы можете получить приемущество при тестировании сложного кода.</p><h3>Презентеры</h3><p>Чтобы следовать приведенной выше рекомендации о перемещении новой логики контроллера в модели, презентеры могут оказаться весьма полезны. Они могут моделировать модель, одновременно сочетая пару взаимосвязанных атрибутов, которые могут быть полезны для того, чтобы сохранить ваши контроллеры стройными и привлекательными. Кроме того, они также помогут вам избавиться от бардака логики в ваших отображениях. Довольно хорошая сделка для создания дополнительного  объекта в системе!<br></p><p>Презернтеры могут «имитировать» модель, которая представляет состояние, которое в свою очередь требуется вашему представлению, и объединяет атрибуты, которые необходимо перемещать через контроллер. Они конечно могут быть более сложными, но тогда я начинаю чувствовать что они уже залезают на территорию "Декоратора". </p><p>Иногда контроллер отвечает за создание нескольких моделей одновременно, а мы хотим избежать обработки нескольких переменных экземпляра. Почему это так важно? Потому что это помогает нам поддерживать проверку работоспособности наших приложений. Презентер объединяет поведение и атрибуты, что позволяет нашим контроллерам легко сосредоточиться на небольших и предельно простых задачах - с одним объектом. Кроме того, форматирование данных в вашем представлении или другие подобные мелкие функции часто являются постоянно возникающими задачами. Наличие этого содержимого в презентере не только отлично подходит для чистых представлений, но и для того, чтобы иметь выделенное место, которое упрощает тестирование этого поведения - более легко тестировать слой модели. Отличный удар и всего этого джаза.<br></p><p>Если вы натыкаетесь на шаблон презентера и находите несколько подходов или разные способы его описания, вы не начинаете сходить с ума. Кажется, что нет четкого соглашения о том, что такое презентер. Однако общеизвестно, что он находится между уровнями MVC. Мы можем использовать его для управления несколькими объектами модели, которые необходимо создать одновременно. Комбинируя эти объекты, он имитирует модель ActiveRecord. <br></p><p>Наиболее частый сценарий - это своего рода форма, которая вводит информацию для разных моделей, например новую учетную запись пользователя, которая также имеет поля ввода для кредитных карт и адресов или что-то еще. Переход к полному мастеру путем последовательного прохождения нескольких форм не так уж и отличается. Поскольку эти части вашего приложения имеют тенденцию быть очень важными, определенно будет хорошей идей держать вещи в порядке, имея при этом наилучший возможный вариант для тестирования. </p><p>Поведение пользователя тоже играет при этом ключевую роль. В приведенном ниже примере мы хотим создать простую миссию, которая имеет <code class="inline">has_one</code> <code class="inline">agent</code> и один <code class="inline">quartermaster</code>. Это хороший пример того, как быстро все может выйти из-под контроля. Контроллеру нужно манипулировать несколькими объектами, которые нужно отобразить во вложенной форме, чтобы связать вещи вместе. Вы скоро увидите, что все это можно вылечить с помощью приятного «объекта формы», который представляет необходимые объекты и объединяет все в одном центральном классе.<br></p><p><strong>app/models/mission.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">class Mission &lt; ActiveRecord::Base  has_one :agent  has_one :quartermaster  accepts_nested_attributes_for :agent, :quartermaster, allow_destroy: true  validates :mission_name, presence: true  ...endclass Agent &lt; ActiveRecord::Base  belongs_to :mission  validates :name, presence: true  ...endclass Quartermaster &lt; ActiveRecord::Base  belongs_to :mission  validates :name, presence: true  ...end</pre><p>Я упоминаю модели здесь только ради полноты картины, если вы никогда до этого не использовали <code class="inline">fields_for</code>  - все просто. Ниже приведена вся суть дела. </p><h4>Слишком много переменных экземпляра</h4><p><strong>app/controllers/missions_controller.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">class MissionsController &lt; ApplicationController  def new    @mission = Mission.new    @agent = Agent.new    @quartermaster = Quartermaster.new  end  def create    @mission = Mission.new(mission_params)    @agent = Agent.new(agent_params)    @quartermaster = Quartermaster.new(quartermaster_params)    @mission.agent = @agent    @mission.quartermaster = @quartermaster    if @account.save and @agent.save and @quartermaster.save      flash[:notice] = "Mission accepted"      redirect_to missions_path    else      flash[:alert] = "Mission not accepted"      render :new         end  end  private  def mission_params    params.require(:mission).permit(:mission_name, :objective, :enemy)  end  def agent_params    params.require(:agent).permit(:name, :number, :licence_to_kill)  end  def quartermaster_params    params.require(:quartermaster).permit(:name, :number, :hacker, :expertise, :humor)  endend</pre><p>В целом, легко увидеть, что здесь мы движемся в неправильном направлении. Уже все довольно громоздко, хотя и состоит только из методов <code class="inline">new</code> и <code class="inline">create</code>. Нехорошо! Приватные методы уже слишком быстро накапливаются. Надеюсь, что <code class="inline">agent_params</code> и <code class="inline">quartermaster_params</code> в <code class="inline">MissionsController</code> не кажутся вам слишком гладкими. Вы считаете, что такое редко случается? Боюсь что нет. «Единственная ответственность» в контроллерах действительно являются золотым ориентиром. И через минуту вы увидите почему.<br></p><p>Даже если вы прищурились, это выглядит черезчур противно. И во время сохранения в действии <code class="inline">create</code> сразу с валидацией, если мы не сможем сохранить каждый объект из-за какой-либо ошибки или чего-то еще, мы закончим с потерянными объектами, с которыми никто не хочет иметь дело. Хлоп! </p><p>Конечно, мы могли бы поместить это в <code class="inline">transaction</code> блок, который успешно завершает сохранение только в том случае, если все объекты в порядке, но это немного похоже как будто мы плывем против течения - так, что же действия уровня моделей происходят в контроллерах? Есть более элегантные способы.<br></p><p>Следуя этому пути, в представлении будет прилагаться <code class="inline">form_for</code> для <code class="inline">@mission</code> и дополнительные <code class="inline">fields_for</code> для <code class="inline">@agent</code> и <code class="inline">@quartermaster</code>.<br></p><h4>Грязная форма с несколькими объектами<br></h4><p><strong>app/views/missions/new.html.erb</strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;%= form_for(@mission) do |mission| %&gt;  &lt;h3&gt;Mission&lt;/h3&gt;    &lt;%= mission.label      :mission_name %&gt;    &lt;%= mission.text_field :mission_name %&gt;    &lt;%= mission.label      :objective %&gt;    &lt;%= mission.text_field :objective %&gt;    &lt;%= mission.label      :enemy %&gt;    &lt;%= mission.text_field :enemy %&gt;  &lt;h3&gt;Agent&lt;/h3&gt;  &lt;%= fields_for @agent do |agent| %&gt;      &lt;%= agent.label      :name %&gt;      &lt;%= agent.text_field :name %&gt;      &lt;%= agent.label      :number %&gt;      &lt;%= agent.text_field :number %&gt;      &lt;%= agent.label      :licence_to_kill %&gt;      &lt;%= agent.check_box  :licence_to_kill %&gt;  &lt;% end %&gt;  &lt;h3&gt;Quartermaster&lt;/h3&gt;  &lt;%= fields_for @quartermaster do |quartermaster| %&gt;      &lt;%= quartermaster.label      :name %&gt;      &lt;%= quartermaster.text_field :name %&gt;      &lt;%= quartermaster.label      :number %&gt;      &lt;%= quartermaster.text_field :number %&gt;      &lt;%= quartermaster.label      :hacker %&gt;      &lt;%= quartermaster.check_box  :hacker %&gt;      &lt;%= quartermaster.label      :expertise %&gt;      &lt;%= quartermaster.text_field :expertise %&gt;      &lt;%= quartermaster.label      :humor %&gt;      &lt;%= quartermaster.check_box  :humor %&gt;  &lt;% end %&gt;  &lt;%= mission.submit %&gt;&lt;% end %&gt;</pre><p>Конечно, это работает, но я не был бы слишком счастлив, наткнувшись на такое. <code class="inline">fields_for</code> конечно удобен, но обработка этого с помощью ООП гораздо более удобна. В таком случае презентер также поможет нам получить более простое представление, потому что форма будет иметь дело только с одним объектом. Вложение формы становится ненужным. Кстати, я убрал все обертки для стилизации формы, чтобы было легче все это воспринимать визуально. <br></p><h3>Презентер объекта формы<br></h3><p><strong>app/views/missions/new.html.erb</strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;%= form_for @mission_presenter, url: missions_path do |mission| %&gt;  &lt;h3&gt;Mission&lt;/h3&gt;    &lt;%= mission.label      :mission_name %&gt;    &lt;%= mission.text_field :mission_name %&gt;    &lt;%= mission.label      :objective %&gt;    &lt;%= mission.text_field :objective %&gt;    &lt;%= mission.label      :enemy %&gt;    &lt;%= mission.text_field :enemy %&gt;  &lt;h3&gt;Agent&lt;/h3&gt;    &lt;%= mission.label      :agent_name %&gt;    &lt;%= mission.text_field :agent_name %&gt;    &lt;%= mission.label      :agent_number %&gt;    &lt;%= mission.text_field :agent_number %&gt;    &lt;%= mission.label      :licence_to_kill %&gt;    &lt;%= mission.check_box  :licence_to_kill %&gt;  &lt;h3&gt;Quartermaster&lt;/h3&gt;    &lt;%= mission.label      :quartermaster_name %&gt;    &lt;%= mission.text_field :quartermaster_name %&gt;    &lt;%= mission.label      :quartermaster_number %&gt;    &lt;%= mission.text_field :quartermaster_number %&gt;    &lt;%= mission.label      :hacker %&gt;    &lt;%= mission.check_box  :hacker %&gt;    &lt;%= mission.label      :expertise %&gt;    &lt;%= mission.text_field :expertise %&gt;    &lt;%= mission.label      :humor %&gt;    &lt;%= mission.check_box  :humor %&gt;  &lt;%= mission.submit %&gt;&lt;% end %&gt;</pre><p>Как вы можете легко увидеть, наше отображение стало намного проще - никаких больше вложений. Но есть часть, с которой вы должны быть немного осторожны:</p><pre class="brush: rails noskimlinks noskimwords">&lt;%= form_for @mission_presenter, url: missions_path do |mission| %&gt;</pre><p>Вам необходимо предоставить <code class="inline">form_for</code> вместе с <code class="inline">url</code>, чтобы можно было отправить параметры из этой формы в соответствующий контроллер - в данном случае <code class="inline">MissionsController</code>. Без этого дополнительного аргумента Rails попытается найти контроллер для нашего объекта-презетнера <code class="inline">@mission_presenter</code> с помощью соглашений - в данном случае <code class="inline">MissionFormPresentersController</code> - и конечно же сломаться без него.<br></p><p>В общем, мы должны стараться держать наши действия контроллера в основном такими же простыми, как будто мы имеем дело с манипуляцией ресурсами CRUD - это то, что контроллер делает и для чего он лучше всего оборудован, чтобы не смешивать компоненты MVC. Как хороший побочный эффект, уровень сложности в ваших контроллерах при этом также заметно снизится.<br></p><p><strong>app/controllers/missions_controller.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">class MissionsController &lt; ApplicationController  def new    @mission_presenter = MissionFormPresenter.new  end  def create    @mission_presenter = MissionFormPresenter.new(mission_params)    if      @mission_presenter.save      flash[:notice] = "Mission accepted"      redirect_to missions_path    else      flash[:alert] = "Mission not accepted"      render :new    end  end  private  def mission_params    params.require(:mission_form_presenter).permit(whitelisted)  end  def whitelisted    [:mission_name, :objective, :enemy, :agent_name, :agent_number, :licence_to_kill, :quartermaster_name, :quartermaster_number, :hacker, :expertise, :humor]  endend</pre><p>Контроллер становится проще прямо на глазах, не так ли? Гораздо чище и почти стандартные действия контроллера. Мы имеем дело с одним объектом, который выполняет одну работу. Мы создаем экземпляр одного объекта, презентера, и наполняем его как обычно параметрами.<br></p><p>Единственное, что меня беспокоило, это отправка этого длинного списка параметров. Я извлек их в метод <code class="inline">whitelisted</code>, который просто возвращает массив с полным списком параметров. В противном случае <code class="inline">mission_params</code> выглядел бы следующим образом: это было слишком неприятно:</p><pre class="brush: rails noskimlinks noskimwords">def mission_params  params.require(:mission_form_presenter).permit(:mission_name,                                                 :objective, :enemy,                                                 :agent_name,                                                  :agent_number,                                                  :licence_to_kill,                                                  :quartermaster_name,                                                  :quartermaster_number,                                                  :hacker,                                                  :expertise,                                                  :humor)end</pre><p>И да, слово об аргументе <code class="inline">:mission_form_presenter</code> для <code class="inline">params.require</code>. Хотя мы назвали нашу переменную экземпляра для презентера <code class="inline">@mission_presenter</code>, когда мы используем его с <code class="inline">form_for</code>, Rails ожидает, что ключ хэша params для формы будет называться по имени объекта, созданного экземпляром, а не по имени, указанного в контроллере. Я видел как новички несколько раз спотыкались на этом. То, что Rails предоставляет вам критические ошибки в таком случае, также не помогает. Если вам нужно немного переосмыслить параметры, вот хорошее место для поиска:</p><ul><li><span>Документация</span></li> <li><span>Бесплатный скринкаст</span></li> </ul><p>В нашей модели <code class="inline">Mission</code> мы больше не нуждаемся в <code class="inline">accepts_nested_attributes</code> и можем избавиться от этой безобидной, но страшной вещи. Метод <code class="inline">validates</code> также не имеет здесь значения, потому что мы добавляем эту ответственность к нашему объекту формы. То же самое можно сказать и о наших проверках на <code class="inline">Agent</code> и <code class="inline">Quartermaster</code>.<br></p><p><strong>app/models/mission.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">class Mission &lt; ActiveRecord::Base  has_one :agent  has_one :quartermaster  #accepts_nested_attributes_for :agent, :quartermaster, allow_destroy: true  #validates :mission_name, presence: true  ...end</pre><p>Инкапсуляция этой логики проверки непосредственно на наш новый объект помогает нам сохранять чистоту и организованность кода. Разумеется, в тех случаях, когда вы также можете создавать эти объекты независимо друг от друга, проверки должны оставаться там, где они нужны в настоящее время. Этот вид дублирования также можно решить, например, используя <code class="inline">validates_with</code> с отдельным классом для проверки, который наследуется от <code class="inline">ActiveModel::Validator</code>.<br></p><p>Теперь у нас есть тонкий контроллер с единственной ответственностью и простая форма для одновременного создания нескольких объектов. Потрясающе! Как мы достигли всего этого? Ниже представлен презентер, который делает всю работу, не подразумевая, что этот класс выполняет большую работу. Мы хотим иметь какую-то промежуточную модель без базы данных, которая управляет несколькими объектами. Взгляните на этот простой старый ruby объект (PORO).<br></p><p><strong>app/presenters/mission_form_presenter.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">class MissionFormPresenter  include ActiveModel::Model  attr_accessor  :mission_name, :objective, :enemy, :agent_name,                 :agent_number, :licence_to_kill, :quartermaster_name,                 :quartermaster_number, :hacker, :expertise, :humor  validates :mission_name, :agent_name, :quartermaster_name, presence: true  def save    ActiveRecord::Base.transaction do      @mission = Mission.create!(mission_attributes)      @mission.create_agent!(agent_attributes)      @mission.create_quartermaster!(quartermaster_attributes)    end  end  private   def mission_attributes    { mission_name: mission_name, objective: objective, enemy: enemy }  end  def agent_attributes    { name: agent_name, number: agent_number, licence_to_kill: licence_to_kill }  end  def quartermaster_attributes    { name: quartermaster_name, number: quartermaster_number, hacker: hacker, expertise: expertise, humor: humor }  endend</pre><p>Я думаю, что будет справедливо сказать, что это выглядит не очень сложно. <code class="inline">MissionFormPresenter</code> - это объект формы, который теперь инкапсулирует то, что делало наш контроллер излишне толстым. В качестве бонуса наше отображение теперь стало тонким простым. Здесь мы можем агрегировать всю информацию из нашей формы, а затем последовательно мы создаем все объекты, которые нам нужны последовательно.</p><p>Самая важная часть происходит в нашем новом методе <code class="inline">save</code>. Сначала мы создаем новый объект <code class="inline">Mission</code>. После этого мы можем создать два связанных с ним объекта: <code class="inline">Agent</code> и <code class="inline">Quartermaster</code>. Через наши ассоциации <code class="inline">has_one</code> и <code class="inline">belongs_to</code> мы можем использовать метод <code class="inline">create_x</code>, который адаптируется к имени связанного объекта. </p><p>Например, если мы используем <code class="inline">has_one :agent</code>, мы получаем метод <code class="inline">create_agent</code>. Легко, правда? (На самом деле мы также получаем метод <code class="inline">build_agent</code>.) Я решил использовать версию с ошибкой (!), потому что она вызывает ошибку <code class="inline">ActiveRecord::RecordInvalid</code>, если запись недействительна при попытке ее сохранить. Если обернуть эти методы внутрь блока <code class="inline">transaction</code>, то мы можем быть спокойны что объект не будет сохранен если не прошла валидация. Блок транзакций откатится, если что-то пойдет не так во время сохранения. <br></p><p>Но вы можете спросить, как это работает с атрибутами? Мы просим Rails немного поработать с помощью <code class="inline">include ActiveModel::Model</code>  (<span>API</span>). Это позволяет нам инициализировать объекты с помощью хэша атрибутов - а это именно то, что мы делаем в контроллере. После этого мы можем использовать наши методы <code class="inline">attr_accessor</code> для извлечения наших атрибутов для создания объектов, которые нам действительно нужны.</p><p><code class="inline">ActiveModel::Model</code> также позволяет нам взаимодействовать с представлениями и контроллерами. Среди других лакомств вы также можете использовать это для валидации в подобных классах. Помещение этих валидаций в такие объекты выделенной формы - хорошая идея для организации вашего кода, и это также помогает вашим моделям выглядеть немного аккуратнее. </p><p>Я решил извлечь длинный список параметров в приватные методы, которые заполняют объекты, созданные в <code class="inline">save</code>. В таком объекте-презентере я мало беспокоюсь о том, что вокруг есть еще несколько приватных методов. Почему нет? Так гораздо чище!<br></p><p>Тестирование таких сценариев, в которых объединяются несколько моделей, должно рассматриваться с максимальной осторожностью - чем проще объекты, о которых идет речь, тем легче тестировать. Ничего на самом деле сложного. Презентеры вам только играют на руку. Наличие таких тестов, потенциально связанных с контроллером, не лучший способ для тестирования. Помните, что юнит тесты должны быть быстрыми и простыми.<br></p><p>Немного предостережения. Не злоупотребляйте презентерами - они не должны быть вашим первым выбором. Как правило, потребность в презентере появляется со временем. Для меня лично они лучше всего используются, когда у вас есть данные, представленные несколькими моделями, которые должны собираться вместе в одном представлении. </p><p>Без презентера вам придется подготовить несколько переменных в своем контроллере для одного отображения. Это само по себе уже может сделать их жирными. Вещь, которую вы должны учитывать и взвешивать, заключается в том, что в то время как презентеры добавляют объекты к вашей кодовой базе, они также могут сократить количество объектов, которые необходимо контролировать контроллеру, уменьшая при этом его сложность и приводя к единственной ответственности. Вероятно, это довольно продвинутая техника, для того чтобы сбросить с контроллера немного жира, но когда вы действительно хотите похудеть, вам нужно приложить к этому еще и другую работу. <br></p><h2>Не-RESTful контроллеры<br></h2><p>Скорее всего будет плохой идеей не придерживаться стандартных действий контроллера. Вы можете легко избежать антипаттерна, когда у вас контроллеры с огромной кучей кастомных методов. Такие методы, как <code class="inline">login_user</code>, <code class="inline">activate_admin</code>, <code class="inline">show_books</code> и другие забавные имена, которые на самом деле стоят за <code class="inline">new</code>, <code class="inline">create</code>, <code class="inline">show</code> и т.д., должны дать вам повод для паузы и усомниться в вашем подходе. Не следование подходу RESTful может легко привести к массивным контроллерам, главным образом, потому что вам придется сражаться с фреймворком или каждый раз изобретать колесо. </p><p>Короче говоря, это не очень хорошая идея. Кроме того, чаще всего это симптом неопытности или небрежности. Следовать принципу единственной ответственности также очень тяжело в подобных условиях.<br></p><p>Обработка ресурсов в вашем контроллере с помощью RESTful делает вашу жизнь намного проще, а ваши приложения будет легче поддерживать. Подумайте о том, как обрабатывать ресурсы RESTfully с точки зрения жизненного цикла объекта. Вы создаете, обновляете, показываете (отдельно или в коллекции), обновляете и уничтожаете их. </p><p>В большинстве случаев все это вам подойдет. FYI, действия <code class="inline">new</code> и <code class="inline">edit</code> не являются частью REST - они больше похожи на разные версии действия <code class="inline">show</code>, помогая вам представить различные этапы жизненного цикла ресурса. В совокупности, в большинстве случаев, эти семь стандартных действий контроллера дают вам все необходимое для управления вашими ресурсами в ваших контроллерах. Еще одно большое преимущество заключается в том, что другие разработчики Rails, работающие с вашим кодом, смогут быстрее перемещаться по вашим контроллерам.<br></p><p>Следуя этой простой логике RESTful также поможет им разобраться как вы называете свои контролеры. Имя ресурса, на котором вы работаете, должно быть отражено в объекте контроллера. </p><p>Например, наличие <code class="inline">MissionsController</code>, который обрабатывает другие ресурсы, помимо объектов <code class="inline">@mission</code>, является признаком того, что что-то здесь не так. Большой размер контроллера часто также является явным признаком того, что REST игнорировался. Если вы столкнулись с большими контроллерами, которые реализуют множество кастомных методов, которые не соблюдают соглашения, то может стать весьма эффективно стратегией, чтобы разделить их на несколько контроллеров, которые имеют целенаправленные обязанности и в основном управляют только одним ресурсом, придерживаясь стиля RESTful. Разделите их, и вам будет легче создавать свои методы Rails.<br></p><h2>Вложенные ресурсы<br></h2><p>Посмотрите на следующий пример и спросите себя, что здесь не так:<br></p><h4>Вложенный AgentsController<br></h4><p><strong>app/controllers/agents_controller.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">class AgentsController &lt; ApplicationController  def index    if params[:mission_id]      @mission = Mission.find(params[:mission_id])      @agents = @mission.agents    else      @agents = Agent.all    end  endend</pre><p>Здесь мы проверяем, есть ли у нас вложенный маршрут, который предоставляет нам идентификатор для возможного объекта <code class="inline">@mission</code>. Если это так, то мы хотим использовать связанный объект, чтобы получить от него <code class="inline">agents</code>. В противном случае мы получим список всех агентов для представления. Выглядит безвредно, особенно потому, что он по-прежнему очень простой, но это начало потенциальной более крупной вложенности.<br></p><h4>Вложенные маршруты</h4><pre class="brush: rails noskimlinks noskimwords">resources :agentsresources :missions do  resources :agentsend</pre><p>Здесь нет ничего плохого во вложенных маршрутах. В общем, нет ничего плохого в этом подходе. Мы должны быть осторожны в том, как контроллер обрабатывает все это дело - и, как следствие, то, как представление должно адаптироваться. Не совсем чисто, как вы можете видеть ниже.<br></p><h4>Отображение с ненужными условиями<br></h4><p><strong>app/views/agents/index.html.erb</strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;% if @mission %&gt;  &lt;h2&gt;Mission&lt;/h2&gt;  &lt;div&gt;&lt;%= @mission.name %&gt;&lt;/div&gt;  &lt;div&gt;&lt;%= @mission.objective %&gt;&lt;/div&gt;  &lt;div&gt;&lt;%= @mission.enemy %&gt;&lt;/div&gt;&lt;% end %&gt;&lt;h2&gt;Agents&lt;/h2&gt;&lt;ul&gt;  &lt;% @agents.each do |agent| %&gt;    &lt;li class="agent"&gt;      &lt;div&gt;Name:            &lt;%= agent.name %&gt;&lt;/div&gt;      &lt;div&gt;Number:          &lt;%= agent.number %&gt;&lt;/div&gt;      &lt;div&gt;Licence to kill: &lt;%= agent.licence_to_kill %&gt;&lt;/div&gt;      &lt;div&gt;Status:          &lt;%= agent.status %&gt;&lt;/div&gt;    &lt;/li&gt;  &lt;% end %&gt;&lt;/ul&gt;</pre><p>Я понимаю, что возможно здесь нет ничего страшного. Однако уровень сложности не совсем реальный. Помимо этого, аргумент больше связан с ресурсами с объектно-ориентированным подходом. </p><p>Я думаю, это немного красноречиво относится к отдельным обязанностям. Это не слишком сильно нарушает эту идею, хотя у нас есть вторй объект - <code class="inline">@mission</code> . Но поскольку мы используем его для получения доступа к определенному набору агентов, это абсолютно нормально.<br></p><p>Разветвление является неотъемлемой частью и, скорее всего, приведет к плохим проектным решениям - как в представлениях, так и в контроллерах. Создание двух версий <code class="inline">@agents</code> одним и тем же методом является здесь плохим местом. Короче говоря, все это очень быстро может выйти из-под контроля. Как только вы начнете использовать такие ресурсы, возможно, скоро появятся новые крысы. </p><p>И отображение выше также требует условного оператора, которое адаптируется к ситуации, когда у вас есть <code class="inline">@agents</code>, связанные с <code class="inline">@mission</code>. Как вы можете легко заметить, небольшая небрежность в вашем контроллере может привести к раздутым отображениям, которые в итоге будут имеют больше кода, чем это необходимо. Давайте попробуем другой подход. Время для уничтожения! <br></p><h4>Отдельные контроллеры<br></h4><p>Вместо того, чтобы вкладывать эти ресурсы, мы должны предоставлять каждой версии этого ресурса свой собственный отдельный контроллер-один контроллер для «простых», неназванных агентов и один для агентов, связанных с миссией. Мы можем добиться этого, сделав для одного из них неймспейс в папке <code class="inline">/missions</code>. <br></p><p><strong>app/controllers/missions/agents_controller.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">module Missions  class AgentsController &lt; ApplicationController      def index      @mission = Mission.find(params[:mission_id])      @agents = @mission.agents    end  endend</pre><p>Обертывая этот контроллер внутри модуля, мы можем избежать того, чтобы <code class="inline">AgentsController</code> дважды наследовался от <code class="inline">ApplicationController</code>. Без этого мы бы столкнулись бы с такой ошибкой:<code class="inline"> Unable to autoload constant Missions::AgentsController</code>. Я думаю, что модуль представляет собой небольшую цену, чтобы заплатить за автозагрузку Rails. Второй <code class="inline">AgentsController</code> может оставаться в том же файле, что и раньше. Теперь он имеет дело только с одним возможным ресурсом в <code class="inline">index</code> - отображение всех агентов без миссий, которые находятся вокруг. <br></p><p><strong>app/controllers/agents_controller.rb</strong></p><pre class="brush: rails noskimlinks noskimwords">class AgentsController &lt; ApplicationController  def index    @agents = Agent.all  endend</pre><p>Разумеется, нам также необходимо переделать наши маршруты, чтобы они смотрели на новый контроллер из неймспейса, если агенты связаны с миссией.</p><pre class="brush: rails noskimlinks noskimwords">resources :agentsresources :missions do  resources :agents, controller: "missions/agents"end</pre><p>После того, как мы указали, что наш вложенный ресурс имеет контроллер из неймспейса, все готово. Когда мы проводим проверку <code class="inline">rake routes</code> в терминале, мы увидим, что наш новый контроллер находится в пространстве имен и что мы готовы двигаться дальше.<br></p><h4>Новые маршруты</h4><pre class="brush: bash noskimlinks noskimwords"> Prefix Verb   URI Pattern                                     Controller#Action              root GET    /                                               agents#index            agents GET    /agents(.:format)                               agents#index                   POST   /agents(.:format)                               agents#create         new_agent GET    /agents/new(.:format)                           agents#new        edit_agent GET    /agents/:id/edit(.:format)                      agents#edit             agent GET    /agents/:id(.:format)                           agents#show                   PATCH  /agents/:id(.:format)                           agents#update                   PUT    /agents/:id(.:format)                           agents#update                   DELETE /agents/:id(.:format)                           agents#destroy    mission_agents GET    /missions/:mission_id/agents(.:format)          missions/agents#index                   POST   /missions/:mission_id/agents(.:format)          missions/agents#create new_mission_agent GET    /missions/:mission_id/agents/new(.:format)      missions/agents#newedit_mission_agent GET    /missions/:mission_id/agents/:id/edit(.:format) missions/agents#edit     mission_agent GET    /missions/:mission_id/agents/:id(.:format)      missions/agents#show                   PATCH  /missions/:mission_id/agents/:id(.:format)      missions/agents#update                   PUT    /missions/:mission_id/agents/:id(.:format)      missions/agents#update                   DELETE /missions/:mission_id/agents/:id(.:format)      missions/agents#destroy</pre><p>Наш вложенный ресурс для <code class="inline">agents</code> теперь правильно перенаправляется на <code class="inline">controllers/missions/agents_controller.rb</code> и каждое действие может заботиться о агентах, которые являются частью миссии. Ради полноты, давайте посмотрим также на наши итоговые отображения:<br></p><h4>Агенты с миссией<br></h4><p><strong>app/views/missions/agents/index.html.erb </strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;h2&gt;Mission&lt;/h2&gt;&lt;div&gt;&lt;%= @mission.mission_name %&gt;&lt;/div&gt;&lt;div&gt;&lt;%= @mission.objective %&gt;&lt;/div&gt;&lt;div&gt;&lt;%= @mission.enemy %&gt;&lt;/div&gt;&lt;h2&gt;Agents&lt;/h2&gt;&lt;ul&gt;  &lt;% @agents.each do |agent| %&gt;    &lt;li class="agent"&gt;      &lt;div&gt;Name:            &lt;%= agent.name %&gt;&lt;/div&gt;      &lt;div&gt;Number:          &lt;%= agent.number %&gt;&lt;/div&gt;      &lt;div&gt;Licence to kill: &lt;%= agent.licence_to_kill %&gt;&lt;/div&gt;    &lt;/li&gt;  &lt;% end %&gt;&lt;/ul&gt;</pre><h4>Агенты без миссии<br></h4><p><strong>app/views/agents/index.html</strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;h2&gt;Agents&lt;/h2&gt;&lt;ul&gt;  &lt;% @agents.each do |agent| %&gt;    &lt;li class="agent"&gt;      &lt;div&gt;Name:            &lt;%= agent.name %&gt;&lt;/div&gt;      &lt;div&gt;Number:          &lt;%= agent.number %&gt;&lt;/div&gt;      &lt;div&gt;Licence to kill: &lt;%= agent.licence_to_kill %&gt;&lt;/div&gt;    &lt;/li&gt;  &lt;% end %&gt;&lt;/ul&gt;</pre><p>Так, давайте избавимся от этого небольшого количества дублирования, где мы также перебираем <code class="inline">@agents</code>. Я создал партиал для рендеринга список агентов и поместил его в <code class="inline">shared</code> каталог под <code class="inline">views</code>. </p><p><strong>app/views/shared/_agents.html.erb</strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;h2&gt;Agents&lt;/h2&gt;&lt;ul&gt;  &lt;% @agents.each do |agent| %&gt;    &lt;li class="agent"&gt;      &lt;div&gt;Name: &lt;%=            agent.name %&gt;&lt;/div&gt;      &lt;div&gt;Number: &lt;%=          agent.number %&gt;&lt;/div&gt;      &lt;div&gt;Licence to kill: &lt;%= agent.licence_to_kill %&gt;&lt;/div&gt;    &lt;/li&gt;  &lt;% end %&gt;&lt;/ul&gt;</pre><p>Здесь ничего нового или удивительного, но наши отображения теперь лучше следуют принципу DRY.<br></p><h4>Агенты с миссией<br></h4><p><strong>app/views/missions/agents/index.html.erb </strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;h2&gt;Mission&lt;/h2&gt;&lt;div&gt;&lt;%= @mission.mission_name %&gt;&lt;/div&gt;&lt;div&gt;&lt;%= @mission.objective %&gt;&lt;/div&gt;&lt;div&gt;&lt;%= @mission.enemy %&gt;&lt;/div&gt;&lt;%= render "shared/agents", collection: @agents %&gt;</pre><h4>Агенты без миссии<br></h4><p><strong>app/views/agents/index.html</strong></p><pre class="brush: rails noskimlinks noskimwords">&lt;%= render "shared/agents", collection: @agents %&gt;</pre><p>Готово!<br></p><h2>Заключение<br></h2><p>Я думаю, что если вы, как новичок, можете избежать этих антипаттернов в своих контроллерах, то вы далеко сможете продвинуться. В этом отношении еще многое предстоит узнать, но дайте этому время, ведь ничего не происходит слишком легко или быстро. С другой стороны, если вы хотите знать больше и хотели бы изучать более совершенные методы, я к этому готов. Не позволяйте себя обескуражить тегу "продвинутый". </p><p>Не торопитесь, получайте удовольствие, и не расстраивайтесь, если вам нужно снова вернуться к теме, потому что у вас еще нет всех фрагментов головоломки. Если вы на ранней стадии разработки и только начали играть с шаблонами дизайна, я считаю, что вы опережаете эту игру и приняли правильное решение. </p><p>Не ждите и выходите из своей зоны комфорта, чтобы немного растянуть свое серое вещество.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Ruby on Rails" href="https://norma-studio.github.io/article5/220825243-antipatterny-kontrollery-rails" class="tm-article-body__tags-item-link">Ruby on Rails</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
37455</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
695</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
