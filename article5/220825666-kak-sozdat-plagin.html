
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Как создать плагин... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Как создать плагин... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Как создать плагин... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Как создать плагин... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Sublime Text 2 - это настраиваемый текстовый редактор, который все больше привлекает внимание кодеров, ищущих мощный, быстрый и современный инструмент. Сегодня мы собираемся воссоздать мой популярный плагин Sublime, который 
отправляет CSS через API Nettuts + Prefixr для упрощенного 
кросс-браузерного CSS....">
<meta property="og:description" content="Sublime Text 2 - это настраиваемый текстовый редактор, который все больше привлекает внимание кодеров, ищущих мощный, быстрый и современный инструмент. Сегодня мы собираемся воссоздать мой популярный плагин Sublime, который 
отправляет CSS через API Nettuts + Prefixr для упрощенного 
кросс-браузерного CSS....">
<meta name="twitter:description" content="Sublime Text 2 - это настраиваемый текстовый редактор, который все больше привлекает внимание кодеров, ищущих мощный, быстрый и современный инструмент. Сегодня мы собираемся воссоздать мой популярный плагин Sublime, который 
отправляет CSS через API Nettuts + Prefixr для упрощенного 
кросс-браузерного CSS....">
<meta property="aiturec:description" content="Sublime Text 2 - это настраиваемый текстовый редактор, который все больше привлекает внимание кодеров, ищущих мощный, быстрый и современный инструмент. Сегодня мы собираемся воссоздать мой популярный плагин Sublime, который 
отправляет CSS через API Nettuts + Prefixr для упрощенного 
кросс-браузерного CSS....">
<meta property="og:image" content="//www.gravatar.com/avatar/47a9b062c664549d66905cdd10eade49?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="aiturec:image" content="//www.gravatar.com/avatar/47a9b062c664549d66905cdd10eade49?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta name="twitter:image" content="//www.gravatar.com/avatar/47a9b062c664549d66905cdd10eade49?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="vk:image" content="//www.gravatar.com/avatar/47a9b062c664549d66905cdd10eade49?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:type" content="article">
<link image_src="image" href="//www.gravatar.com/avatar/47a9b062c664549d66905cdd10eade49?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html" title="Как создать плагин... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Как создать плагин... | envatomarket.ru | norma-studio.github.io" title="Как создать плагин... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/65404fb3f3f8602d7f5b3bdc85cbef02.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html" class="tm-user-info__username" title="
А. Крайнов" aria-label="
А. Крайнов">
А. Крайнов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Как создать плагин...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Python" href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin" class="tm-article-snippet__hubs-item-link"><span>Python</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin.html" />
    <link itemprop="image" href="//www.gravatar.com/avatar/47a9b062c664549d66905cdd10eade49?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
    <meta itemprop="headline name" content="Как создать плагин... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Sublime Text 2 - это настраиваемый текстовый редактор, который все больше привлекает внимание кодеров, ищущих мощный, быстрый и современный инструмент. Сегодня мы собираемся воссоздать мой популярный плагин Sublime, который 
отправляет CSS через API Nettuts + Prefixr для упрощенного 
кросс-браузерного CSS....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Sublime Text 2 - это настраиваемый текстовый редактор, который все больше привлекает внимание кодеров, ищущих мощный, быстрый и современный инструмент. Сегодня мы собираемся воссоздать мой популярный плагин Sublime, который 
отправляет CSS через API Nettuts + Prefixr для упрощенного 
кросс-браузерного CSS....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p><span>Sublime Text 2</span> - это настраиваемый текстовый редактор, который все больше<span> привлекает внимание</span> кодеров, ищущих мощный, быстрый и современный инструмент. Сегодня мы собираемся <span>воссоздать мой популярный плагин Sublime</span>, который отправляет CSS через API <span>Nettuts + Prefixr</span> для упрощенного кросс-браузерного CSS.</p> <p>Когда закончите, у вас будет четкое представление о том, как написан <span>плагин Sublime Prefixr</span>, и быть готовым начать писать свои собственные плагины для редактора!</p> <p><!--more--></p> <hr><h2> <span>Предисловие:</span> терминология и справочный материал</h2> <blockquote class="pullquote"> <p>Модель расширения для <span>Sublime Text 2</span> довольно полнофункциональна. </p> </blockquote> <p>Модель расширения для <span>Sublime Text 2 </span>довольно полнофункциональна. Есть способы изменить подсветку синтаксиса, фактический хром редактора и все меню. Кроме того, можно создавать новые системы сборки, автозавершения, определения языков, фрагменты, макросы, привязки клавиш, привязки и плагины мыши. Все эти различные типы модификаций реализуются через файлы, которые организованы в пакеты.</p> <p>Пакет - это папка, которая хранится в вашем каталоге <code>Packages</code>. Вы можете получить доступ к своему каталогу пакетов, нажав на пункт меню <em>Preferences &gt; Browse Packages </em>.... Также возможно объединить пакет в один файл, создав zip-файл и изменив расширение на <code>.sublime-package</code>.  В этом уроке мы обсудим несколько дополнительных вопросов.</p> <p>Sublime поставляется в комплекте с множеством различных пакетов. Большинство пакетов в комплекте имеют специфику языка. Они содержат определения языков, автодоставки и системы сборки. В дополнение к языковым пакетам есть еще два пакета: <code>Default</code> и <code>User</code>. Пакет<br><code>Default</code> (по умолчанию) содержит все стандартные привязки клавиш, определения меню, настройки файлов и целую кучу плагинов, написанных на Python. Пакет <code>User</code> отличается тем, что он всегда загружен последним. Это позволяет пользователям переопределять значения по умолчанию, настраивая файлы в своем <code>User</code> пакете.</p> <blockquote class="pullquote"> <p> Во время написания плагина <span>ссылка Sublime Text 2 API </span>будет иметь важное значение.</p> </blockquote> <p>Во время написания плагина <span>ссылка Sublime Text 2 API </span>будет иметь важное значение. Кроме того, пакет <code>Default</code> служит хорошей ссылкой для выяснения того, как делать вещи и что возможно. Большая часть функциональности редактора отображается через <em>команды</em>. Любая операция, отличная от ввода символов, выполняется с помощью команд. Просмотрев вкладку<em> Preferences&gt; Key Bindings - Default</em>menu, вы можете найти сокровищницу встроенных функций.</p> <p>Теперь, когда различие между плагином и пакетом ясно, давайте начнем писать наш плагин.</p> <hr><h2> <span>Шаг 1</span> - Запуск плагина</h2> <p>Sublime поставляется с функциональностью, которая генерирует каркас кода Python, необходимый для написания простого плагина. Выберите пункт меню <em>Tools &gt; New Plugin</em>, и новый буфер будет открыт с помощью этого шаблона.</p> <pre class="brush: python noskimlinks noskimwords">import sublime, sublime_pluginclass ExampleCommand(sublime_plugin.TextCommand):    def run(self, edit):        self.view.insert(edit, 0, "Hello, World!")</pre> <p>Здесь вы можете увидеть, что два модуля Sublime Python импортируются для использования API и создается новый класс команд.  Прежде чем редактировать это и начать создавать свой собственный плагин, давайте сохраним файл и запустим встроенные функции.</p> <p>Когда мы сохраним файл, мы создадим новый пакет для его сохранения. Нажмите<b> ctrl+s </b>(Windows / Linux) или <b>cmd+s</b> (OS X), чтобы сохранить файл. Диалоговое окно сохранения откроется для пакета <code>User</code>. Не сохраняйте файл там, но вместо этого найдите папку и создайте новую папку с именем <code>Prefixr</code>.</p> <pre class="brush: js noskimlinks noskimwords">Packages/…- OCaml/- Perl/- PHP/- Prefixr/- Python/- R/- Rails/…</pre> <p>Теперь сохраните файл внутри папки Prefixr как <code>Prefixr.py</code>. На самом деле не имеет значения, что такое имя файла, просто оно заканчивается на <code>.py</code>. Однако по соглашению мы будем использовать имя плагина для имени файла.</p> <p>Теперь, когда плагин сохранен, давайте попробуем его. Откройте консоль Sublime, нажав <b>ctrl + `</b>. Это консоль Python, которая имеет доступ к API. Введите следующий Python, чтобы проверить новый плагин:</p> <pre class="brush: python noskimlinks noskimwords">view.run_command("example")</pre> <p>Вы должны увидеть, что <code>Hello World</code> вставлен в начало файла плагина. Обязательно отмените это изменение, прежде чем мы продолжим.</p> <hr><h2> <span>Шаг 2</span> - Типы команд и присвоение имен</h2> <p>Для плагинов Sublime предоставляет три разных типа команд.</p> <ul><li>  <em>Текстовые команды </em>обеспечивают доступ к содержимому выбранного файла/буфера через объект <code>View</code> </li> <li> <em>Команды окна</em> предоставляют ссылки на текущее окно через объект <code>Window</code> </li> <li> <em>Команды приложения</em> не имеют ссылки на какое-либо конкретное окно или файл/буфер и используются реже </li> </ul><p>Поскольку мы будем манипулировать содержимым файла/буфера CSS с помощью этого плагина, мы собираемся использовать класс <code>sublime_plugin.TextCommand</code> в качестве основы для нашей пользовательской команды Prefixr. Это приводит нас к теме названия классов команд.</p> <p>В каркасе плагина, предоставленном Sublime, вы заметите класс:</p> <pre class="brush: python noskimlinks noskimwords">class ExampleCommand(sublime_plugin.TextCommand):</pre> <p>Когда мы хотели запустить команду, мы выполнили следующий код в консоли</p> <pre class="brush: python noskimlinks noskimwords">view.run_command("example")</pre> <p>Sublime будет принимать любой класс, который расширяет один из классов <code>sublime_plugin</code><br> (<code>TextCommand</code>, <code>WindowCommand</code> или <code>ApplicationCommand</code>), удалите <code>Command</code> суффикса, а затем преобразуйте значение <code>CamelCaseinto </code>в <code>underscore_notation</code>  для имени команды.</p> <p>Таким образом, для создания команды с именем <code>prefixr</code>, класс должен быть <code>PrefixrCommand</code>.</p> <pre class="brush: python noskimlinks noskimwords">class PrefixrCommand(sublime_plugin.TextCommand):</pre> <hr><h2> <span>Шаг 3</span> - Выбор текста   </h2> <blockquote class="pullquote"> <p> Одной из наиболее полезных функций Sublime является возможность множественного выбора.</p> </blockquote> <p>Теперь, когда мы правильно включили наш плагин, мы можем начать процесс присвоения CSS из текущего буфера и отправки его в API Prefixr. Одной из наиболее полезных функций Sublime является возможность множественного выбора. Когда мы присваиваем выделенный текст, нам нужно написать наш плагин в ручку не только для первого выбора, но и для всех.</p> <p>Поскольку мы пишем текстовую команду, у нас есть доступ к текущему представлению через <code>self.view</code>. Метод <code>sel()</code> объекта <code>View</code> возвращает итерируемый <code>RegionSet</code> текущего выбора. Начнем с сканирования этих фигурных скобок. Если фигурных скобок нет, мы можем развернуть выделение на окружающие фигурные скобки, чтобы обеспечить префикс целого блока. Независимо от того, был ли наш выбор включенными фигурными фигурными скобками, также будет полезно узнать, можем ли мы настроить прописные и форматирование на результат, который мы получаем от  Prefixr API.</p> <pre class="brush: python noskimlinks noskimwords">braces = Falsesels = self.view.sel()for sel in sels:    if self.view.substr(sel).find("{") != -1:        braces = True</pre> <p>Этот код заменяет содержимое метода каркаса <code>run()</code>.</p> <p>Если мы не нашли фигурных скобок, мы прокручиваем каждый выбор и корректируем выбор ближайшего закрытия фигурных скобок. Затем мы используем встроенную команду <code>expand_selection</code> с аргументом <code>to</code> в <code>brackets</code>, чтобы убедиться, что у вас есть полное содержимое каждого выбранного блока CSS.</p> <pre class="brush: python noskimlinks noskimwords">if not braces:    new_sels = []    for sel in sels:        new_sels.append(self.view.find("\}", sel.end()))    sels.clear()    for sel in new_sels:        sels.add(sel)    self.view.run_command("expand_selection", {"to": "brackets"})</pre> <p>Если вы хотите проверить вашу работу до сих пор, сравните источник с файлом <code>Prefixr-1.py</code> в zip-файле исходного кода.</p> <hr><h2> <span>Шаг 4</span> - Работа потоков</h2> <blockquote class="pullquote"> <p> Чтобы предотвратить плохое соединение от прерывания другой работы, нам нужно убедиться, что вызовы API Prefixr происходят в фоновом режиме.</p> </blockquote> <p>На этом этапе выбор был расширен, чтобы получить полное содержимое каждого блока CSS. Теперь нам нужно отправить их в Prefixr API. Это простой HTTP-запрос, который мы будем использовать для модулей <code>urllib</code> и <code>urllib2</code>. Тем не менее, прежде чем мы начнем снимать веб-запросы, нам нужно подумать о том, как потенциально отстающий веб-запрос может повлиять на производительность редактора. Если по какой-либо причине пользователь работает с высокой задержкой или медленным подключением, запросы к Prefixr API могут легко занять пару секунд или более.</p> <p>Чтобы предотвратить плохое соединение от прерывания другой работы, нам нужно убедиться, что вызовы Prefixr API происходят в фоновом режиме. Если вы ничего не знаете о потоковой передаче, очень простое объяснение заключается в том, что потоки - это способ для программы планировать несколько наборов кода для запуска, казалось бы, в одно и то же время. Это важно в нашем случае, потому что он позволяет коду, который отправляет данные и ожидает ответа от Prefixr API, препятствует замораживанию остальной части пользовательского интерфейса Sublime.</p> <hr><h2> <span>Шаг 5</span> - Создание потоков</h2> <p>Мы будем использовать Python <code>threading</code> module для создания потоков. Чтобы использовать модуль потоковой передачи, мы создаем новый класс, который расширяет <code>threading.Thread</code>, называемый <code>PrefixrApiCall</code>. Классы, которые расширяют <code>threading.Thread</code> включают метод <code>run()</code>, который содержит весь код для выполнения в потоке.</p> <pre class="brush: python noskimlinks noskimwords">class PrefixrApiCall(threading.Thread):    def __init__(self, sel, string, timeout):        self.sel = sel        self.original = string        self.timeout = timeout        self.result = None        threading.Thread.__init__(self)    def run(self):        try:            data = urllib.urlencode({"css": self.original})            request = urllib2.Request("http://prefixr.com/api/index.php", data,                headers={"User-Agent": "Sublime Prefixr"})            http_file = urllib2.urlopen(request, timeout=self.timeout)            self.result = http_file.read()            return        except (urllib2.HTTPError) as (e):            err = "%s: HTTP error %s contacting API" % (__name__, str(e.code))        except (urllib2.URLError) as (e):            err = "%s: URL error %s contacting API" % (__name__, str(e.reason))        sublime.error_message(err)        self.result = False</pre> <p>Здесь мы используем метод <code>__init __ ()</code> потока, чтобы установить все значения, которые понадобятся во время веб-запроса. Метод <code>run()</code> содержит код для настройки и выполнения HTTP-запроса для Prefixr API. Поскольку потоки работают одновременно с другим кодом, невозможно напрямую вернуть значения. Вместо этого мы устанавливаем <code>self.result</code> на результат вызова.</p> <p>Поскольку мы только начали использовать еще несколько модулей в нашем плагине, мы должны добавить их в операторы импорта в верхней части скрипта.</p> <pre class="brush: python noskimlinks noskimwords">import urllibimport urllib2import threading</pre> <p>Теперь, когда у нас есть потоковый класс для выполнения HTTP-вызовов, нам нужно создать поток для каждого выбора. Для этого мы возвращаемся к методу <code>run()</code> нашего класса <code>PrefixrCommand </code>и используем следующий цикл:</p> <pre class="brush: python noskimlinks noskimwords">threads = []for sel in sels:    string = self.view.substr(sel)    thread = PrefixrApiCall(sel, string, 5)    threads.append(thread)    thread.start()</pre> <p>Мы отслеживаем каждый поток, который мы создаем, а затем вызываем метод <code>start()</code> для запуска каждого из них.</p> <p>Если вы хотите проверить вашу работу до сих пор, сравните источник с файлом <code>Prefixr-2.py</code> в zip-файле исходного кода.</p> <hr><h2> <span>Шаг 6</span> - Подготовка к результатам</h2> <p>Теперь, когда мы начали выполнять запросы Prefixr API, перед обработкой ответов нам нужно настроить несколько последних деталей.</p> <p>Во-первых, мы очищаем все выборки, потому что раньше мы их модифицировали. Позже мы вернем их в разумное состояние.</p> <pre class="brush: python noskimlinks noskimwords">self.view.sel().clear()</pre> <p>Кроме того, мы запускаем новый объект <code>Edit</code>. Эта группа операций для отмены и повтора. Мы указываем, что мы создаем группу для команды <code>prefixr</code>.</p> <pre class="brush: python noskimlinks noskimwords">edit = self.view.begin_edit("prefixr")</pre> <p>В качестве последнего шага мы вызываем метод, который будем писать далее, который будет обрабатывать результат запросов API.</p> <pre class="brush: python noskimlinks noskimwords">self.handle_threads(edit, threads, braces)</pre> <hr><h2> <span>Шаг 7</span> - Обработка потоков</h2> <p>На этом этапе наши потоки работают или, возможно, даже завершены. Затем нам нужно реализовать метод <code>handle_threads()</code>, на который мы только что ссылались. Этот метод будет проходить через список потоков и искать потоки, которые больше не работают.</p> <pre class="brush: python noskimlinks noskimwords">def handle_threads(self, edit, threads, braces, offset=0, i=0, dir=1):    next_threads = []    for thread in threads:        if thread.is_alive():            next_threads.append(thread)            continue        if thread.result == False:            continue        offset = self.replace(edit, thread, braces, offset)    threads = next_threads</pre> <p>Если поток все еще работает, добавим его в список потоков, чтобы проверить его позже. Если результат был неудачным, мы игнорируем его, однако для хороших результатов мы вызываем новый метод <code>replace()</code>, который мы будем писать в ближайшее время.</p> <p>Если есть какие-то потоки, которые все еще работают, нам нужно проверить  их снова в ближайшее время. Кроме того, это приятное улучшение пользовательского интерфейса, чтобы обеспечить индикатор активности, чтобы показать, что наш плагин все еще работает.</p> <pre class="brush: python noskimlinks noskimwords">if len(threads):    # This animates a little activity indicator in the status area    before = i % 8    after = (7) - before    if not after:        dir = -1    if not before:        dir = 1    i += dir    self.view.set_status("prefixr", "Prefixr [%s=%s]" % \        (" " * before, " " * after))    sublime.set_timeout(lambda: self.handle_threads(edit, threads,        braces, offset, i, dir), 100)    return</pre> <p>В первом разделе кода используется простое целочисленное значение, хранящееся в переменной <code>i</code>,  для перемещения <code>=</code> назад и вперед между двумя скобками. Последняя часть является самой важной. Это говорит Sublime снова запустить метод <code>handle_threads()</code> с новыми значениями за 100 миллисекунд. Это похоже на функцию <code>setTimeout()</code> в JavaScript.</p> <blockquote> <p>Ключевое слово <code>lambda</code> - это функция Python, которая позволяет нам создать новую неназванную или анонимную функцию</p> </blockquote> <p> Метод <code>sublime.set_timeout()</code> требует функции или метода и количества миллисекунд, пока он не будет выполнен. Без <code>lambda</code> мы могли бы сказать, что мы хотели запустить <code>handle_threads()</code>, но мы не смогли бы указать параметры.</p> <p>Если все потоки завершены, нам не нужно устанавливать другой тайм-аут, но вместо этого мы завершаем нашу группу отмены и обновляем пользовательский интерфейс, чтобы пользователь знал, что все сделано.</p> <pre class="brush: python noskimlinks noskimwords">self.view.end_edit(edit)self.view.erase_status("prefixr")selections = len(self.view.sel())sublime.status_message("Prefixr successfully run on %s selection%s" %    (selections, "" if selections == 1 else "s"))</pre> <p>Если вы хотите проверить вашу работу до сих пор, сравните источник с файлом <code>Prefixr-3.py</code> в zip-файле исходного кода.</p> <hr><h2> <span>Шаг 8</span> - Выполнение замены</h2> <p>При обработке наших потоков нам просто нужно написать код, который заменяет исходный CSS результатом из  Prefixr API. Как мы упоминали ранее, мы собираемся написать метод под названием <code>replace()</code>.</p> <p>Этот метод принимает ряд параметров, включая объект <code>Edit</code> для отмены, поток, который захватил результат из API Prefixr, если исходный выбор включал фигурные скобки и, наконец, смещение выбора.</p> <pre class="brush: python noskimlinks noskimwords">def replace(self, edit, thread, braces, offset):    sel = thread.sel    original = thread.original    result = thread.result    # Here we adjust each selection for any text we have already inserted    if offset:        sel = sublime.Region(sel.begin() + offset,            sel.end() + offset)</pre> <p>Смещение необходимо при работе с несколькими вариантами выбора. Когда мы заменим блок CSS префиксом CSS, длина этого блока будет увеличиваться. Смещение гарантирует, что мы заменим правильный контент для последующих выборов, так как текстовые позиции сдвигаются при каждой замене.</p> <p>Следующим шагом будет подготовка результата из Prefixr API, который нужно удалить в качестве замены CSS. Это включает в себя преобразование окончаний строк и отступов в соответствии с текущим документом и исходным выбором.</p> <pre class="brush: python noskimlinks noskimwords">result = self.normalize_line_endings(result)(prefix, main, suffix) = self.fix_whitespace(original, result, sel,    braces)self.view.replace(edit, sel, prefix + main + suffix)</pre> <p>В качестве последнего шага мы устанавливаем выбор пользователя для включения конца последней строки нового CSS, который мы вставили, а затем возвращаем отрегулированное смещение для использования для любых последующих выборов.</p> <pre class="brush: python noskimlinks noskimwords">end_point = sel.begin() + len(prefix) + len(main)self.view.sel().add(sublime.Region(end_point, end_point))return offset + len(prefix + main + suffix) - len(original)</pre> <p>Если вы хотите проверить свою работу до сих пор, сравните источник с файлом <code>Prefixr-4.py</code> в zip-файле исходного кода.</p> <hr><h2> <span>Шаг 9</span> - Манипуляция пробелами</h2> <p>Мы использовали два пользовательских метода во время процесса замены, чтобы подготовить новый CSS для документа. Эти методы принимают результат Prefixr и изменяют его в соответствии с текущим документом.</p> <p> <code>normalize_line_endings()</code> берет строку и гарантирует соответствие строк окончанию текущего файла. Мы используем класс <code>Settings</code> из Sublime API для получения правильных окончаний строк.</p> <pre class="brush: python noskimlinks noskimwords">def normalize_line_endings(self, string):    string = string.replace("\r\n", "\n").replace("\r", "\n")    line_endings = self.view.settings().get("default_line_ending")    if line_endings == "windows":        string = string.replace("\n", "\r\n")    elif line_endings == "mac":        string = string.replace("\n", "\r")    return string</pre> <p>Метод <code>fix_whitespace()</code> немного сложнее, но выполняет те же манипуляции, что и для отступов и пробелов в блоке CSS. Эта манипуляция работает только с одним блоком CSS, поэтому мы выходим, если одна или несколько фигурных скобок были включены в исходный выбор.</p> <pre class="brush: python noskimlinks noskimwords">def fix_whitespace(self, original, prefixed, sel, braces):    # If braces are present we can do all of the whitespace magic    if braces:        return ("", prefixed, "")</pre> <p>В противном случае мы начнем с определения уровня отступа исходного CSS. Это делается путем поиска пробелов в начале выбора. Это делается путем поиска пробелов в начале выбора.</p> <pre class="brush: python noskimlinks noskimwords">(row, col) = self.view.rowcol(sel.begin())indent_region = self.view.find("^\s+", self.view.text_point(row, 0))if self.view.rowcol(indent_region.begin())[0] == row:    indent = self.view.substr(indent_region)else:    indent = ""</pre> <p>Затем мы обрезаем пробел из префикса CSS и используем текущие настройки просмотра, чтобы отделить CSS до исходного уровня с помощью вкладок или пробелов в зависимости от текущих настроек редактора.</p> <pre class="brush: python noskimlinks noskimwords">prefixed = prefixed.strip()prefixed = re.sub(re.compile("^\s+", re.M), "", prefixed)settings = self.view.settings()use_spaces = settings.get("translate_tabs_to_spaces")tab_size = int(settings.get("tab_size", 8))indent_characters = "\t"if use_spaces:    indent_characters = " " * tab_sizeprefixed = prefixed.replace("\n", "\n" + indent + indent_characters)</pre> <p>Мы заканчиваем метод, используя исходное начальное и конечное пустое пространство, чтобы гарантировать, что новый префикс CSS подходит именно к оригиналу.</p> <pre class="brush: python noskimlinks noskimwords">match = re.search("^(\s*)", original)prefix = match.groups()[0]match = re.search("(\s*)\Z", original)suffix = match.groups()[0]return (prefix, prefixed, suffix)</pre> <p>С помощью метода <code>fix_whitespace()</code> мы использовали (re)модуль регулярного выражения Python, поэтому нам нужно добавить его в список импорта в верхней части скрипта.</p> <pre class="brush: python noskimlinks noskimwords">import re</pre> <p>И с этим мы завершили процесс написания команды <code>prefixr</code>. Следующий шаг - сделать команду легкой для запуска, предоставив комбинацию клавиш и запись в меню.</p> <hr><h2> <span>Шаг 10</span> - Привязки клавиш</h2> <p>Большинство настроек и модификаций, которые могут быть сделаны для Sublime, выполняются через файлы JSON, и это верно для привязки клавиш. Привязка клавиш обычно зависит от ОС, а это значит, что для вашего плагина необходимо создать три файла привязки ключей. Файлы должны быть названы <code>Deafult (Windows).sublime-keymap</code>, <code>Default (Linux).sublime-keymap</code> и <code>Default (OSX).sublime-keymap</code>.</p> <pre class="brush: js noskimlinks noskimwords">Prefixr/...- Default (Linux).sublime-keymap- Default (OSX).sublime-keymap- Default (Windows).sublime-keymap- Prefixr.py</pre> <p>Файлы <code>.sublime-keymap</code> содержат массив JSON, который содержит объекты JSON для указания привязок клавиш. Объекты JSON должны содержать<code>keys</code> и <code>command</code> ключ и могут также содержать ключ <code>args</code>, если команда требует аргументов. Самое сложное в выборе привязки ключей - это то, что привязка ключей еще не используется. Это можно сделать, перейдя в меню <em>Preferences &gt; Key Bindings – Default </em>и поиск ключевого слова, который вы хотите использовать. Как только вы найдете подходящую неиспользуемую привязку, добавьте ее в <code>.sublime-keymap</code> файл.</p> <pre class="brush: javascript noskimlinks noskimwords">[  { "keys": ["ctrl+alt+x"], "command": "prefixr" }]</pre> <p>Обычно привязки клавиш Linux и Windows одинаковы. Ключ cmd в OS X указан строкой <code>super</code> в <code>.sublime-keymap</code> файлах. При портировании привязки ключей к операционным системам обычно используется ключ <code>ctrl </code>на Windows и Linux для <code>super</code> на OS X. Однако это может быть не самым естественным движением руки, поэтому, если возможно, попробуйте и проверьте ваши комбинации клавиш на реальной клавиатуре.</p> <hr><h2> <span>Шаг 11</span> - Записи в меню</h2> <p>Одна из более классных вещей в расширении Sublime заключается в том, что можно добавлять элементы в структуру меню, создавая <code>.sublime-menu</code> файлы. Файлы меню должны быть названы конкретными именами, чтобы указать, на какое меню они влияют:</p> <ul><li> <code>Main.sublime-menu</code> управляет основным программным меню</li> <li> <code>Side Bar.sublime-menu</code> управляет щелчком правой кнопки мыши по файлу или папке на боковой панели</li> <li> <code>Context.sublime-menu</code> управляет щелчком правой кнопки мыши по редактируемому файлу</li> </ul><p>Существует целый ряд других файлов меню, которые влияют на различные другие меню во всем интерфейсе. Просмотр пакетов <em>Deafult </em>- это самый простой способ узнать обо всех этих проблемах.</p> <p>Для Prefixr мы хотим добавить пункт меню в меню <em>Edit </em>и некоторые записи в меню <em>Preferences </em>для настроек. Следующий пример - структура JSON для записи меню <em>Edit</em>. Я опустил записи в меню <em>Preferences</em>, так как они довольно многословны, вложенные на несколько уровней.</p> <pre class="brush: javascript noskimlinks noskimwords">[{"id": "edit","children":[    {"id": "wrap"},    { "command": "prefixr" }]}]</pre> <p>Один кусок, на который нужно обратить внимание, - это <code>id</code> ключи. Указав <code>id</code> существующей записи меню, можно добавить запись без переопределения существующей структуры. Если вы откроете файл <code>Main.sublime-menu</code> из пакета <code>Default</code> и просмотрите его, вы можете определить, в какой <code>id</code> хотите добавить вашу запись.</p> <p>На данный момент ваш пакет Prefixr должен выглядеть почти идентично <span>официальной версии GitHub.</span></p> <hr><h2> <span>Шаг 12 </span>- Распределение пакета</h2> <p>Теперь, когда вы нашли время, чтобы написать полезный плагин Sublime, настало время ему попасть в руки других пользователей. </p> <blockquote> <p>Sublime поддерживает распространение zip-файла каталога пакетов в качестве простого способа совместного использования пакетов. Просто закройте папку вашего пакета и измените расширение на <code>.sublime-package</code>. Теперь другие пользователи могут поместить это в свой каталог <em>установленных пакетов</em> и перезапустить Sublime для установки пакета.</p> </blockquote> <blockquote class="pullquote"> <p> Наряду с легкой доступностью для большого количества пользователей, наличие пакета через пакет управления пакетами позволяет пользователям автоматически обновляться до последних обновлений.</p> </blockquote> <p>Хотя это, безусловно, может работать, есть также менеджер пакетов для Sublime, называемый <span>Package Control</span>, который поддерживает основной список пакетов и автоматическое обновление. Чтобы ваш пакет был добавлен к каналу по умолчанию, просто запустите его на <span>GitHub </span>или <span>BitBucket</span>, а затем разветвите файл канала (<span>на GitHub</span> или <span>BitBucket</span>), добавьте репозиторий и отправьте запрос на перенос. После принятия запроса на перенос ваш пакет будет доступен тысячам пользователей, использующих Sublime. Наряду с легкой доступностью для большого количества пользователей, наличие пакета через пакет управления пакетами позволяет пользователям автоматически обновляться до последних обновлений.</p> <p>Если вы не хотите размещать на GitHub или BitBucket, существует система custom/JONON channel/repository, которую можно использовать для размещения в любом месте, при этом все же предоставляя пакет всем пользователям. Он также предоставляет расширенные функции, такие как указание доступности пакетов ОС. Дополнительную информацию см. На <span>странице PackageControl.</span></p> <hr><h2>Идите напишите несколько плагинов!</h2> <p>Теперь, когда мы рассмотрели шаги, чтобы написать плагин Sublime, пришло время для вас погрузиться! Сообщество плагинов Sublime создает и публикует новые функции почти каждый день. С каждым выпуском Sublime становится все более мощным и универсальным. <span>Sublime Text Forum</span> - отличное место, где можно получить помощь и поговорить с другими о том, что вы создаете.</p> 

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Python" href="https://norma-studio.github.io/article5/220825666-kak-sozdat-plagin" class="tm-article-body__tags-item-link">Python</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
42209</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
328</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
