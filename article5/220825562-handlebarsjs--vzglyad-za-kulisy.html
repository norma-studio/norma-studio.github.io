
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Handlebars завоевывает популярность благодаря его внедрению в таких системах, как Meteor и Ember.js, но что действительно происходит за кулисами этого захватывающего шаблонного движка?...">
<meta property="og:description" content="Handlebars завоевывает популярность благодаря его внедрению в таких системах, как Meteor и Ember.js, но что действительно происходит за кулисами этого захватывающего шаблонного движка?...">
<meta name="twitter:description" content="Handlebars завоевывает популярность благодаря его внедрению в таких системах, как Meteor и Ember.js, но что действительно происходит за кулисами этого захватывающего шаблонного движка?...">
<meta property="aiturec:description" content="Handlebars завоевывает популярность благодаря его внедрению в таких системах, как Meteor и Ember.js, но что действительно происходит за кулисами этого захватывающего шаблонного движка?...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_1.png">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_1.png">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_1.png">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_1.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_1.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html" title="Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io" title="Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/63456435436.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html" class="tm-user-info__username" title="
М. Старостенко" aria-label="
М. Старостенко">
М. Старостенко</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Handlebars.js - взгляд за кулисы...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy" class="tm-article-snippet__hubs-item-link"><span>Web Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_1.png">
    <meta itemprop="headline name" content="Handlebars.js - взгляд за кулисы... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Handlebars завоевывает популярность благодаря его внедрению в таких системах, как Meteor и Ember.js, но что действительно происходит за кулисами этого захватывающего шаблонного движка?...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Handlebars завоевывает популярность благодаря его внедрению в таких системах, как Meteor и Ember.js, но что действительно происходит за кулисами этого захватывающего шаблонного движка?...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p><span>Handlebars</span> завоевывает популярность благодаря его внедрению в таких системах, как Meteor и Ember.js, но что действительно происходит за кулисами этого захватывающего шаблонного движка?</p><p>В этой статье мы рассмотрим базовый процесс, который обрабатывает Handlebars для компиляции ваших шаблонов.</p> <p><!--more--></p> <p>В этой статье предполагается, что вы прочитали мое предыдущее введение в <span>Handlebars</span>, и поэтому предполагается, что вы знаете основы создания шаблонов Handlebar.</p> <p>При использовании шаблона Handlebars вы, вероятно, знаете, что начинаете с компиляции источника шаблона в функцию с помощью <code>Handlebars.compile()</code>, а затем используете эту функцию для генерации окончательного HTML, передавая значения для свойств и заполнителей.</p> <p>Но эта, казалось бы, простая функция компиляции на самом деле за кулисами делает несколько шагов, и именно об этом мы поговорим в этой статье; давайте взглянем на быструю разбивку процесса:</p> <ul><li>Обозначить токенами источник в компонентах.</li> <li>Обработать каждый токен в наборе операций.</li> <li>Преобразовать стек процесса в функцию.</li> <li>Запустить функцию с контекстом и помощниками для вывода некоторого HTML.</li> </ul><hr><h2>Настройка</h2> <p>В этой статье мы будем создавать инструмент для анализа шаблонов Handlebars на каждом из этих этапов, поэтому для отображения результатов на экране, я буду использовать подсветку синтаксиса <span>prism.js</span>, созданную <span>Lea Verou</span>. Загрузите минимифицированный источник.</p> <p>Следующий шаг - создать пустой HTML-файл и заполнить его следующим:</p> <pre class="brush: html noskimlinks noskimwords">&lt;!DOCTYPE HTML&gt;&lt;html xmlns="http://www.w3.org/1999/html"&gt;    &lt;head&gt;        &lt;title&gt;Handlebars.js&lt;/title&gt;        &lt;link rel="stylesheet" href="prism.css"&gt;&lt;/p&gt;        &lt;script src="prism.js" data-manual&gt;&lt;/script&gt;        &lt;script src="handlebars.js"&gt;&lt;/script&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;div id="analysis"&gt;            &lt;div id="tokens"&gt;&lt;h1&gt;Tokens:&lt;/h1&gt;&lt;/div&gt;            &lt;div id="operations"&gt;&lt;h1&gt;Operations:&lt;/h1&gt;&lt;/div&gt;            &lt;div id="output"&gt;&lt;h1&gt;Output:&lt;/h1&gt;&lt;/div&gt;            &lt;div id="function"&gt;                &lt;h1&gt;Function:&lt;/h1&gt;                &lt;pre&gt;&lt;code class="language-javascript" id="source"&gt;&lt;/code&gt;&lt;/pre&gt;            &lt;/div&gt;        &lt;/div&gt;        &lt;script id="dt" type="template/handlebars"&gt;        &lt;/script&gt;        &lt;script&gt;            //Code will go here        &lt;/script&gt;    &lt;/body&gt;&lt;/html&gt;</pre> <p>Это всего лишь некоторый шаблонный код, который включает в себя handlebars и prism, а затем устанавливает некоторые div для разных шагов. Внизу вы можете увидеть два блока сценариев: первый для шаблона, второй - для нашего JS-кода.</p> <p>Я также добавил немного CSS, чтобы все выглядело немного лучше:</p> <pre class="brush: css noskimlinks noskimwords">         body{        margin: 0;        padding: 0;        font-family: "opensans", Arial, sans-serif;        background: #F5F2F0;        font-size: 13px;    }    #analysis {        top: 0;        left: 0;        position: absolute;        width: 100%;        height: 100%;        margin: 0;        padding: 0;    }    #analysis div {        width: 33.33%;        height: 50%;        float: left;        padding: 10px 20px;        box-sizing: border-box;        overflow: auto;    }    #function {        width: 100% !important;    }</pre> <p>Далее нам нужен шаблон, так что давайте начнем с самого простого шаблона, просто статического текста:</p> <pre class="brush: html noskimlinks noskimwords">&lt;script id="dt" type="template/handlebars"&gt;    Hello World!&lt;/script&gt;&lt;script&gt;    var src = document.getElementById("dt").innerHTML.trim();    //Display Output    var t = Handlebars.compile(src);    document.getElementById("output").innerHTML += t();&lt;/script&gt;</pre> <p>Открытие этой страницы в вашем браузере должно привести к тому, что шаблон будет отображаться в окне вывода, как ожидалось, ничего другого, теперь нам нужно написать код для анализа процесса на каждом из трех других этапов.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_1.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><hr><h2>Токены</h2> <p>Первыми шагами, которые выполняет handlebars, является токенизация источника, что означает, что нам нужно разбить источник на отдельные компоненты, чтобы мы могли обрабатывать каждую часть соответственно. Так, например, если бы был какой-то текст с заполнителем посередине, то Handlebars разделил бы текст до placeholder и разместил его в один токен, тогда сам placeholder будет помещен в другой токен и, наконец, весь текст после заполнителя будет помещен в третий токен. Это связано с тем, что эти части должны сохранять порядок шаблона, но их также нужно обрабатывать по-разному.</p> <p>Этот процесс выполняется с помощью функции <code>Handlebars.parse()</code>, и то, что вы возвращаете, является объектом, который содержит все сегменты или «утверждения».</p> <p>Чтобы лучше проиллюстрировать то, о чем я говорю, давайте создадим список абзацев для каждого токена:</p> <pre class="brush: js noskimlinks noskimwords">        //Display Tokens    var tokenizer = Handlebars.parse(src);    var tokenStr = "";    for (var i in tokenizer.statements) {        var token = tokenizer.statements[i];        tokenStr += "&lt;p&gt;" + (parseInt(i)+1) + ") ";        switch (token.type) {            case "content":                tokenStr += "[string] - \"" + token.string + "\"";                break;            case "mustache":                tokenStr += "[placeholder] - " + token.id.string;                break;            case "block":                tokenStr += "[block] - " + token.mustache.id.string;        }    }    document.getElementById("tokens").innerHTML += tokenStr;</pre> <p>Поэтому мы начнем с запуска источника шаблонов в <code>Handlebars.parse</code>, чтобы получить список токенов. Затем мы перебираем все отдельные компоненты и создаем набор человекочитаемых строк на основе типа сегмента. Обычный текст будет иметь тип «content», который мы можем просто вывести строкой, заключенной в кавычки, чтобы показать, чему она равна. У заполнителей будет тип «mustache», который мы можем отобразить вместе с их «id» (имя заполнителя). И последнее, но не менее важное: блок-помощники будут иметь тип «block», который затем мы также можем просто отобразить внутренние блоки «id» (имя блока).</p> <p>Обновляя это сейчас в браузере, вы должны увидеть только один токен "string", с текстом нашего шаблона.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_2.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><hr><h2>Операции</h2> <p>Когда у handlebars есть набор токенов, он циклически проходит через каждый и «генерирует» список предопределенных операций, которые необходимо выполнить для скомпилированного шаблона. Этот процесс выполняется с использованием объекта <code>Handlebars.Compiler()</code>, передающего объект токена с шага 1:</p> <pre class="brush: js noskimlinks noskimwords">        //Display Operations    var opSequence = new Handlebars.Compiler().compile(tokenizer, {});    var opStr = "";    for (var i in opSequence.opcodes) {        var op = opSequence.opcodes[i];        opStr += "&lt;p&gt;" + (parseInt(i)+1) + ") - " + op.opcode;    }    document.getElementById("operations").innerHTML += opStr;</pre> <p>Здесь мы компилируем токены в последовательность операций, о которой я говорил, а затем мы циклически перемещаемся по каждому из них и создаем аналогичный список, как на первом шаге, но здесь нам просто нужно распечатать код операции. Код операции - это «операция» или «имя» функции, которая должна выполняться для каждого элемента в последовательности.</p> <p>В браузере теперь вы должны увидеть только одну операцию под названием «appendContent», которая добавит значение в текущий «буфер» или «строку текста». Есть много разных кодов операций, и я не думаю, что я могу объяснить некоторые из них, но быстрый поиск в исходном коде для данного кода операции покажет вам функцию, которая будет для него запущена.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_3.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><hr><h2>Функция</h2> <p>Последний этап - взять список кодов операций и преобразовать их в функцию, он делает это, читая список операций и умело конкатенируя код для каждого из них. Вот код, необходимый для выполнения функции для этого шага:</p> <pre class="brush: js noskimlinks noskimwords">        //Display Function    var outputFunction = new Handlebars.JavaScriptCompiler().compile(opSequence, {}, undefined, true);    document.getElementById("source").innerHTML = outputFunction.toString();    Prism.highlightAll();</pre> <p>Первая строка создает компилятор, проходящий в последовательности op, и эта строка возвращает конечную функцию, используемую для генерации шаблона. Затем мы преобразуем функцию в строку и расскажем prism о синтаксисе.</p> <p>С помощью этого окончательного кода ваша страница должна выглядеть примерно так:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_4.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><p>Эта функция невероятно проста, так как была только одна операция, она просто возвращает заданную строку; давайте теперь взглянем на редактирование шаблона и посмотрим, как эти индивидуальные шаги объединяются вместе, чтобы сформировать очень мощную абстракцию.</p> <hr><h2>Изучение шаблонов</h2> <p>Начнем с чего-то простого, и давайте просто заменим слово «Мир» на местозаполнитель; ваш новый шаблон должен выглядеть следующим образом:</p> <pre class="brush: html noskimlinks noskimwords">    &lt;script id="dt" type="template/handlebars"&gt;        Hello {{name}}!    &lt;/script&gt;</pre> <p>И не забудьте передать переменную так, чтобы результат выглядел нормально:</p> <pre class="brush: js noskimlinks noskimwords">    //Display Output    var t = Handlebars.compile(src);    document.getElementById("output").innerHTML += t({name: "Gabriel"});</pre> <p>Запустив это, вы обнаружите, что, добавив только один простой заполнитель, это совсем немного усложняет процесс.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_5.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><blockquote class="pullquote"> <p>Сложный раздел if/else состоит в том, что он не знает, является ли местозаполнитель фактически заполнителем или вспомогательным методом</p> </blockquote> <p>Если вы все еще не уверены в том, что означают токены, у вас сейчас должна быть хорошая мысль; как вы можете видеть на картинке, он отделил местозаполнитель от строк и создал три отдельных компонента.</p> <p>Далее, в разделе операций есть немало дополнений. Если вы помните ранее, чтобы просто вывести какой-то текст, Handlebars использует операцию «appendContent», что вы теперь можете увидеть в верхней и нижней части списка (как для «Hello», так и для «!»). Остальные в середине - все операции, необходимые для обработки заполнителя и добавления экранированного содержимого.</p> <p>Наконец, в нижнем окне вместо того, чтобы просто возвращать строку, на этот раз она создает буферную переменную и обрабатывает один токен за раз. Сложный раздел if/else состоит в том, что он не знает, является ли местозаполнитель фактически заполнителем или вспомогательным методом. Поэтому он пытается увидеть, существует ли вспомогательный метод с заданным именем, и в этом случае он вызовет вспомогательный метод и установит значение «stack1». В случае, если это местозаполнитель, он присваивает значение из переданного контекста (здесь называется «depth0»), и если функция была передана в него, он поместит результат функции в переменную «stack1». Как только все это будет сделано, затем происходит экранирование, как мы видели в операциях, и добавляем его в буфер.</p> <p>Для нашего следующего изменения давайте просто попробуем тот же шаблон, но на этот раз не экранируя результатов (для этого добавьте еще одну фигурную скобку "<code>{{{name}}}</code>")</p> <p>Обновляя страницу, теперь вы увидите, что она удалила операцию, чтобы избежать этой переменной, и вместо этого она просто добавляет ее, она превращается в функцию, которая теперь просто проверяет, чтобы значение не было ложным (кроме 0), а затем добавляет его, не экранируя.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_6.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><p>Поэтому я думаю, что заполнители довольно прямолинейны, теперь давайте взглянем на использование вспомогательных функций.</p> <hr><h2>Вспомогательные функции</h2> <p>Нет никакого смысла в том, чтобы сделать это более сложным, чем это должно быть, давайте просто создадим простую функцию, которая вернет дубликат числа, переданного в нее, поэтому замените шаблон и добавьте новый блок сценария для помощника (перед остальным кодом):</p> <pre class="brush: html noskimlinks noskimwords">&lt;script id="dt" type="template/handlebars"&gt;    3 * 2 = {{{doubled 3}}}&lt;/script&gt;&lt;script&gt;    Handlebars.registerHelper("doubled", function(number){        return number * 2;    });&lt;/script&gt;</pre> <p>Я решил не избегать этого, так как это делает последнюю функцию немного более простой для чтения, но вы можете попробовать обе, если хотите. В любом случае, выполнение этого должно привести к следующему:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_7.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><p>Здесь вы можете видеть, что движок знает, что это помощник, поэтому вместо того, чтобы говорить «invokeAmbiguous», теперь он говорит «invokeHelper», а потому и в функции больше нет блока if/else. Тем не менее он все же гарантирует, что помощник существует и пытается вернуться к контексту для функции с тем же именем в случае, если это не так.</p> <p>Еще одна вещь, о которой стоит упомянуть, - это рассмотреть то, как параметры для помощников передаются напрямую и на самом деле жестко закодированы, если это возможно, когда генерируется функция get (число 3 в удвоенной функции).</p> <p>Последний пример, который я хочу затронуть, - это блок-помощники.</p> <hr><h2>Блок помощники</h2> <p>Блочные помощники позволяют обернуть другие токены внутри функции, которая может установить свой собственный контекст и параметры. Давайте посмотрим на пример с использованием вспомогательного блока «if» по умолчанию:</p> <pre class="brush: html noskimlinks noskimwords">&lt;script id="dt" type="template/handlebars"&gt;    Hello    {{#if name}}        {{{name}}}    {{else}}        World!    {{/if}}&lt;/script&gt;</pre> <p>Здесь мы проверяем, установлено ли «имя» в текущем контексте, и в этом случае мы будем отображать его, иначе мы выводим «Мир!». Запустив это в нашем анализаторе, вы увидите только два токена, хотя их больше; это потому, что каждый блок запускается как свой собственный «шаблон», поэтому все токены внутри него (например, <code>{{{name}}}</code>) не будут частью внешнего вызова, и вам нужно будет извлечь его из самого узла блока.</p> <p>Кроме того, если вы посмотрите на функцию:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=850/net/uploads/2013/06/Handlebars_Advanced_8.png" alt="Handlebars.js - взгляд за кулисы..." title="Handlebars.js - взгляд за кулисы..." width="50" height="50"></figure><p>Вы можете видеть, что он фактически компилирует функции хелпера блока в функцию шаблона. Их две, потому что одна из них является основной, а другая - обратной функцией (если параметр не существует или является ложным). Основная функция: «program1» - это то, что было раньше, когда у нас был только текст и один заполнитель, потому что, как я уже упоминал, каждая из вспомогательных функций блока создается и обрабатывается точно как обычный шаблон. Затем они запускаются через помощник «if» для получения правильной функции, которую он затем добавляет к внешнему буферу.</p> <p>Как и прежде, стоит упомянуть, что первым параметром для вспомогательного блока блока является сам ключ, тогда как параметр «this» задается всем переданным параметрам в контексте, что может пригодиться при создании собственных блочных помощников.</p> <hr><h2>Вывод</h2> <p>В этой статье мы, возможно, не нашли практического взгляда на то, как добиться чего-то в Handlebars, но я надеюсь, что вы лучше понимаете, что именно происходит за кулисами, что должно позволить вам создавать лучшие шаблоны и помощники с этим новым знанием.</p> <p>Надеюсь, вам понравилось читать, как всегда, если у вас есть какие-либо вопросы, не стесняйтесь обращаться ко мне в Twitter (<span>@GabrielManricks</span>) или в Nettuts + IRC (#nettuts on freenode).</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825562-handlebarsjs--vzglyad-za-kulisy" class="tm-article-body__tags-item-link">Web Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40425</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
397</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
