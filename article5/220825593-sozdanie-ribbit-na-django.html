
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="После реализации нашего-Twitter-клона,-Ribbit, на чистом-PHP и-Rails, настало время сделать следующий шаг:-Python! В этой статье, мы пересоздадим наш-Ribbit используя-Django. Итак, без лишних слов, начинаем!...">
<meta property="og:description" content="После реализации нашего-Twitter-клона,-Ribbit, на чистом-PHP и-Rails, настало время сделать следующий шаг:-Python! В этой статье, мы пересоздадим наш-Ribbit используя-Django. Итак, без лишних слов, начинаем!...">
<meta name="twitter:description" content="После реализации нашего-Twitter-клона,-Ribbit, на чистом-PHP и-Rails, настало время сделать следующий шаг:-Python! В этой статье, мы пересоздадим наш-Ribbit используя-Django. Итак, без лишних слов, начинаем!...">
<meta property="aiturec:description" content="После реализации нашего-Twitter-клона,-Ribbit, на чистом-PHP и-Rails, настало время сделать следующий шаг:-Python! В этой статье, мы пересоздадим наш-Ribbit используя-Django. Итак, без лишних слов, начинаем!...">
<meta property="og:image" content="https://i.imgur.com/KL1Xl.png">
<meta property="aiturec:image" content="https://i.imgur.com/KL1Xl.png">
<meta name="twitter:image" content="https://i.imgur.com/KL1Xl.png">
<meta property="vk:image" content="https://i.imgur.com/KL1Xl.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://i.imgur.com/KL1Xl.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html" title="Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io" title="Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543543242.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html" class="tm-user-info__username" title="
А. Морозов" aria-label="
А. Морозов">
А. Морозов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создание Ribbit на Django...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Python" href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django" class="tm-article-snippet__hubs-item-link"><span>Python</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django.html" />
    <link itemprop="image" href="https://i.imgur.com/KL1Xl.png">
    <meta itemprop="headline name" content="Создание Ribbit на Django... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="После реализации нашего-Twitter-клона,-Ribbit, на чистом-PHP и-Rails, настало время сделать следующий шаг:-Python! В этой статье, мы пересоздадим наш-Ribbit используя-Django. Итак, без лишних слов, начинаем!...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">После реализации нашего-Twitter-клона,-Ribbit, на чистом-PHP и-Rails, настало время сделать следующий шаг:-Python! В этой статье, мы пересоздадим наш-Ribbit используя-Django. Итак, без лишних слов, начинаем!...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>После реализации нашего Twitter-клона, Ribbit, на чистом <span>PHP</span> и <span>Rails</span>, настало время сделать следующий шаг: Python! В этой статье, мы пересоздадим наш Ribbit используя Django. Итак, без лишних слов, начинаем!</p> <p><!--more--></p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" border="0" data-src="https://i.imgur.com/KL1Xl.png" class="lazy07" alt="Создание Ribbit на Django..." title="Создание Ribbit на Django..." width="50" height="50"></div> <hr><h2> Step 0 - Bootstrapping</h2> <p>На время написания этой статьи, Django 1.4 поддерживал Python 2.5 по 2.7.3. Прежде всего, убедитесь что ваша версия Python соответствует требованиям, набрав <code>python -v</code> в терминале. Обратите внимание что предпочтительно использовать версию Python 2.7.3. На протяжении всей статьи, мы будем использовать pip как пакетный менеджер и virtualenv в качестве виртуального окружения. Что бы установить их, запустите терминал и выполните следующие команды от имени <strong>root</strong></p> <pre class="brush: bash noskimlinks noskimwords">curl https://python-distribute.org/distribute_setup.py | sudo pythoncurl https://raw.github.com/pypa/pip/master/contrib/get-pip.py | sudo pythonsudo pip install virtualenv</pre> <p>Устанавливать среду разработки Django, мы начнем с создания виртуального окружения (Virtual Environment). Выполните нижеследующие команды в вашем терминале (желательно внутри папки предназначенной для поекта)</p> <pre class="brush: bash noskimlinks noskimwords">virtualenv --no-site-packages ribbit_envsource ribbit_env/bin/activate</pre> <p>Теперь наше виртуальное окружение установлено и активировано (ваша командная строка должна изменить вид, приглашение к вводу должно отображать имя вашего окружения), настало время установить все зависимости проекта.  Что бы управлять миграцией нашей базы данных мы будем использовать, независимо от Django, утилиту South. Для их установки мы будем использовать <code>pip</code>. Стоить заметить что начиная с текущего момента все, что мы будем делать, будет делаться внутри виртуального окружения (virtualenv). Как и раньше, перед работой, убедитесь что вы внутри него.</p> <pre class="brush: bash noskimlinks noskimwords">pip install Django South</pre> <p>Теперь, когда все зависимости установлены, мы готовы перейти к созданию нового Django проекта.</p> <hr><h2> <span>Шаг 1 -</span> Создание проекта и Ribbit App</h2> <p>Начнем же создание нового Django проекта и нашего приложения.  <code>cd</code> в выбранную вами директорию и выполните:</p> <pre class="brush: bash noskimlinks noskimwords">django-admin.py startproject ribbitcd ribbitdjango-admin.py startapp ribbit_app</pre> <p>Далее, инициализируем наш git репозиторий и создадим  файл <code>.gitignore</code> внутри Ribbit проекта, которое мы только что создали. Сделаем это, выполнив:</p> <pre class="brush: bash noskimlinks noskimwords">git initecho "*.pyc" &gt;&gt; .gitignoregit add .git commit -m "Initial Commit"</pre> <p>Теперь приступим к редактированию <code>ribbit/settings.py</code> и конфигурированию нашего проекта. Для начала, мы определим некоторые константы. Добавим следующие строчки в начало файла:</p> <pre class="brush: python noskimlinks noskimwords">import osPROJECT_PATH = os.path.dirname(os.path.abspath(__file__))  LOGIN_URL = "/"</pre> <p>Константа <code>PROJECT_PATH</code> будет хранить в себе путь к директории в которой лежит settings.py. Это позволит нам использовать относительные пути для определения будущих констант. <code>LOGIN_URL</code>, как и предполагает название константы,  обозначает, что корень нашего сайта будет URL-адресом для входа (обычный Login).</p> <p>Двигаемся дальше! Давайте теперь сконфигурируем базу данных. Для первоначальной разработки, sqlite3 это просто идеальный выбор. Для этого, отредактируем константу <code>DATABASES</code> как показано ниже:</p> <pre class="brush: python noskimlinks noskimwords">DATABASES = {    "default": {        "ENGINE": "django.db.backends.sqlite3",  # Add "postgresql_psycopg2", "mysql", "sqlite3" or "oracle".        "NAME": os.path.join(PROJECT_PATH, "database.db"),                      # Or path to database file if using sqlite3.        "USER": "",                      # Not used with sqlite3.        "PASSWORD": "",                  # Not used with sqlite3.        "HOST": "",                      # Set to empty string for localhost. Not used with sqlite3.        "PORT": "",                      # Set to empty string for default. Not used with sqlite3.    }}</pre> <p>Django ищет статические файлы в директории указанной в константе <code>STATIC_ROOT</code> и направляет все запросы к файлам используя путь написанный в <code>STATIC_URL</code>. Сконфигурируем их, как показано ниже:</p> <pre class="brush: python noskimlinks noskimwords"># Absolute path to the directory static files should be collected to.# Don"t put anything in this directory yourself; store your static files# in apps" "static/" subdirectories and in STATICFILES_DIRS.# Example: "/home/media/media.lawrence.com/static/"STATIC_ROOT = os.path.join(PROJECT_PATH, "static")# URL prefix for static files.# Example: "http://media.lawrence.com/static/"STATIC_URL = "/static/"</pre> <p>Обратите внимание на использование <code>os.path.join()</code>. Функция позволяет нам, с помощью константы <code>PROJECT_PATH</code>, определять относительный путь.</p> <p>Далее нам нужно указать местоположение, в котором Django будет искать файлы шаблонов. Отредактируем константу <code>TEMPLATE_DIRS</code> что бы указать путь.</p> <pre class="brush: python noskimlinks noskimwords">TEMPLATE_DIRS = (    # Put strings here, like "/home/html/django_templates" or "C:/www/django/templates".    # Always use forward slashes, even on Windows.    # Don"t forget to use absolute paths, not relative paths.    os.path.join(PROJECT_PATH, "templates"))</pre> <p>Наконец, давайте добавим <code>South</code> и <code>ribbit_app</code> в список <code>INSTALLED_APPS</code>.</p> <pre class="brush: python noskimlinks noskimwords">INSTALLED_APPS = (    "django.contrib.auth",    "django.contrib.contenttypes",    "django.contrib.sessions",    "django.contrib.sites",    "django.contrib.messages",    "django.contrib.staticfiles",    "south",    "ribbit_app",    # Uncomment the next line to enable the admin:    # "django.contrib.admin",    # Uncomment the next line to enable admin documentation:    # "django.contrib.admindocs",)</pre> <p>Далее, давайте создадим директории, которые мы определили в настройках, и базу данных:  </p> <pre class="brush: bash noskimlinks noskimwords">mkdir ribbit/static ribbit/templates ribbit_app/staticpython manage.py syncdbpython manage.py schemamigration ribbit_app --initialpython manage.py migrate ribbit_app</pre> <p>Команда <code>syncdb</code> создаст требуемые таблицы и необходимый аккаунт супер пользователя. Т.к. мы используем South для миграций, мы сделаем начальную миграцию для нашего проекта используя конструкцию <code>schemamigration &lt;имя приложения&gt; --initial</code> и применим ее, командой <code>python manage.py migrate ribbit_app</code></p> <p>Давайте запустим наш тестовый сервер, что бы убедиться что все работает правильно.</p> <pre class="brush: bash noskimlinks noskimwords">python manage.py runserver</pre> <p>И если все прошло гладко, то вас должна приветствовать  нижеследующая страница, как только вы войдете по адресу <span>http://localhost:8000</span><br><!-- start img --></p><div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" border="0" data-src="https://i.imgur.com/dgT54.png" class="lazy07" alt="Создание Ribbit на Django..." title="Создание Ribbit на Django..." width="50" height="50"></div> <p>В итоге дерево проекта должно выглядеть следующим образом:</p> <pre class="brush: bash noskimlinks noskimwords">ribbit|-- manage.py|-- ribbit|   |-- database.db|   |-- __init__.py|   |-- __init__.pyc|   |-- settings.py|   |-- settings.pyc|   |-- static|   |-- templates|   |-- urls.py|   |-- urls.pyc|   |-- wsgi.py|   `-- wsgi.pyc`-- ribbit_app    |-- __init__.py    |-- __init__.pyc    |-- migrations    |   |-- 0001_initial.py    |   |-- 0001_initial.pyc    |   |-- __init__.py    |   `-- __init__.pyc    |-- models.py    |-- models.pyc    |-- static    |-- tests.py    `-- views.py</pre> <p>Но перед тем как двигаться дальше, давайте закоммитим все изменения в наш репозиторий.</p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Created app and configured settings"</pre> <hr><h2> <span>Шаг 2</span> - Базовый шаблон и статичные файлы</h2> <p>Перейдем на страничку уроков по интерфейсу, скачаем все файлы и положим их в папку <code>ribbit_app/static</code>. Нам надо только сделать некоторые изменения в файле <code>style.less</code> для этого урока. Давайте начнем с добавления стиля для вспомогательных сообщений.</p> <pre class="brush: css noskimlinks noskimwords">.flash {    padding: 10px;    margin: 20px 0;    &amp;.error {        background: #ffefef;        color: #4c1717;        border: 1px solid #4c1717;    }    &amp;.warning {        background: #ffe4c1;        color: #79420d;        border: 1px solid #79420d;    }    &amp;.notice {        background: #efffd7;        color: #8ba015;        border: 1px solid #8ba015;    }}</pre> <p>Далее, обновим ширину элемента ввода и добавим новый класс для ошибок. Заметьте, что код, приведенный ниже, содержит только те строчки кода, что надо добавить или обновить. Остальной код останется без изменений.</p> <pre class="brush: css noskimlinks noskimwords">input {    width: 179px;    &amp;.error {        background: #ffefef;        color: #4c1717;        border: 1px solid #4c1717;    }}</pre> <p>Нам так же надо увеличить высоту <code>#content.wrapper.panel.right</code>.</p> <pre class="brush: css noskimlinks noskimwords">height: 433px;</pre> <p>Наконец, давайте добавим для картинок футера правый отступ.</p> <pre class="brush: css noskimlinks noskimwords">footer {    div.wrapper {        img {            margin-right: 5px;        }    }}</pre> <p>Но перед тем как двигаться дальше, закоммитим наши изменения:</p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Added static files"</pre> <p>Далее, давайте создадим базовый шаблон, который будет унаследован всеми остальными нашими шаблонами. Django использует свой собственный шаблонный движок (по типу ERB или Jade). Определим шаблон в <code>ribbit/templates/base.html</code> со следующим содержимым:</p> <pre class="brush: html noskimlinks noskimwords">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;link rel="stylesheet/less" href="{{ STATIC_URL }}style.less"&gt;    &lt;script src="{{ STATIC_URL }}less.js"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;    &lt;header&gt;        &lt;div class="wrapper"&gt;            &lt;img src="{{ STATIC_URL }}gfx/logo.png"&gt;            &lt;span&gt;Twitter Clone&lt;/span&gt;            {% block login %}            &lt;a href="/"&gt;Home&lt;/a&gt;            &lt;a href="/users/"&gt;Public Profiles&lt;/a&gt;            &lt;a href="/users/{{ username }}"&gt;My Profile&lt;/a&gt;            &lt;a href="/ribbits"&gt;Public Ribbits&lt;/a&gt;            &lt;form action="/logout"&gt;                &lt;input type="submit" id="btnLogOut" value="Log Out"&gt;            &lt;/form&gt;            {% endblock %}        &lt;/div&gt;    &lt;/header&gt;    &lt;div id="content"&gt;        &lt;div class="wrapper"&gt;            {% block flash %}            {% if auth_form.non_field_errors or user_form.non_field_errors or ribbit_form.errors %}            &lt;div class="flash error"&gt;                {{ auth_form.non_field_errors }}                {{ user_form.non_field_errors }}                {{ ribbit_form.content.errors }}            &lt;/div&gt;            {% endif %}            {% if notice %}            &lt;div class="flash notice"&gt;                {{ notice }}            &lt;/div&gt;            {% endif %}            {% endblock %}            {% block content %}            {% endblock %}        &lt;/div&gt;    &lt;/div&gt;    &lt;footer&gt;        &lt;div class="wrapper"&gt;            Ribbit - A Twitter Clone Tutorial            &lt;a href="http://net.tutsplus.com"&gt;                &lt;img src="{{ STATIC_URL }}gfx/logo-nettuts.png"&gt;            &lt;/a&gt;            &lt;a href="http://www.djangoproject.com/"&gt;                &lt;img src="https://www.djangoproject.com/m/img/badges/djangomade124x25.gif" border="0" alt="Made with Django." title="Made with Django." /&gt;            &lt;/a&gt;        &lt;/div&gt;    &lt;/footer&gt;&lt;/body&gt;&lt;/html&gt;</pre> <p>В разметке, что наверху, <code>{{ STATIC_URL }}</code> выводит путь для статичных url, определенных в settings.py. Другая интересная возможность, это использование блоков. Все содержимое блоков наследуется потомками базового шаблона и не будет перезаписано, покуда блоки явно не будут переопределены в них. Это предоставляет нам некоторую гибкость при размещении навигации в шапке сайта и замене его на форму входа, если пользователь не авторизован. Мы так же используем блок с <code>if</code> условием, что бы проверить, есть ли любые переменные вспомогательных сообщений и есть ли что отображать.</p> <p>Отлично! Время сделать еще один коммит:</p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Created base template"</pre> <hr><h2> <span>Шаг 3 -</span> Создание моделей</h2> <p>Одна из самых лучших черт в Django то, что он включает в себя множество уже готовых моделей и форм, которые могут быть переопределены для множества целей. Для нашего приложения мы будем использовать модель <code>User </code>и добавим несколько свойств к ней, при создании <code>UserProfile</code>. Кроме того, для того чтобы управлять пользователями <code>Ribbit</code>, мы создадим модель Ribbit. В Django есть поля для <code>User</code> имени пользователя, пароля, имени, фамилии и адреса электронной почты (с проверкой), а также другие поля. Я предлагаю вам взглянуть на <span>API</span>, чтобы изучить все доступные поля профайла. Теперь, добавьте следующий код для моделей в <code>ribbit_app / models.py</code></p> <pre class="brush: python noskimlinks noskimwords">from django.db import modelsfrom django.contrib.auth.models import Userimport hashlibclass Ribbit(models.Model):    content = models.CharField(max_length=140)    user = models.ForeignKey(User)    creation_date = models.DateTimeField(auto_now=True, blank=True)class UserProfile(models.Model):    user = models.OneToOneField(User)    follows = models.ManyToManyField("self", related_name="followed_by", symmetrical=False)    def gravatar_url(self):        return "http://www.gravatar.com/avatar/%s?s=50" % hashlib.md5(self.user.email).hexdigest()User.profile = property(lambda u: UserProfile.objects.get_or_create(user=u)[0])</pre> <p>Начнем с модели <code>Ribbit</code>. Атрибуты включают свойство <code>CharField</code> с максимальной длиной в 140 символов для хранения контента, модель <code>ForeignKey</code> для модели пользователя (таким образом, мы получаем отношение между двумя моделями) и <code>DateTimeField</code>, который автоматически сохраняет время, когда экземпляр модели сохранён.</p> <p>Переходя к модели <code>UserProfile</code>, мы увидим поле <code>OneToOne </code>, которое определяет отношение «один к одному» с <code>User</code> моделью пользователя и поле<code>ManyToMany</code> для реализации отношения next / follow_by. Параметр <code>related_name </code>позволяет нам использовать отношение в обратном направлении, используя имя по нашему выбору.  Мы также устанавливаем значение <code>symmetrical </code>на False, чтобы гарантировать, что если пользователь A следует B, то пользователь B автоматически не следует A.Мы также определили функцию для получения ссылки на изображение gravatar на основе URL-адреса пользователя и свойства  (если пользовательский файл существует для пользователя) или создать его, когда мы используем синтаксис <code>&lt;user_object&gt;.profile</code>. Этопозволяет легко получить свойства объекта <code>UserProfile</code>.  Вотпример того, как вы можете использовать ORM, чтобы получить данные пользователей,на кого они подписаны и кто подписан на них.</p> <pre class="brush: bash noskimlinks noskimwords">superUser = User.object.get(id=1)superUser.profile.follows.all() # Will return an iterator of UserProfile instances of all users that superUser followssuperUse.profile.followed_by.all() # Will return an iterator of UserProfile instances of all users that follow superUser</pre> <p>Теперь, когда наши модели определены, давайте создадим файлмиграции и применим их:</p> <pre class="brush: bash noskimlinks noskimwords">python manage.py schemamigration ribbit_app --autopython manage.py migrate ribbit_app</pre> <p>Прежде чем двигаться дальше, давайте применим изменения</p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Created Models"</pre> <hr><h2> <span>Шаг 4 -</span> Создание форм</h2> <p>Djangoпозволяет нам создавать формы, чтобы мы могли легко проверять данные, принятыепользователем  Мы создадим пользовательскую форму для модели<code> Ribbit</code> и создадим форму, которая наследует <code>UserCreationForm</code>, представленную по умолчанию для управления регистрацией. Для управления аутентификацией мы расширим параметр <code>AuthenticationForm</code>, предоставленный по умолчанию в Django. Давайте создадим новый файл <code>ribbit_app/forms.py</code> и добавим импорт необходимых модулей.</p> <pre class="brush: python noskimlinks noskimwords">from django.contrib.auth.forms import AuthenticationForm, UserCreationFormfrom django.contrib.auth.models import Userfrom django import formsfrom django.utils.html import strip_tagsfrom ribbit_app.models import Ribbit</pre> <p>Начнемс создания регистрационной формы. Мы назовемее <code>UserCreateForm</code>, пример кода приведен ниже:</p> <pre class="brush: python noskimlinks noskimwords">class UserCreateForm(UserCreationForm):    email = forms.EmailField(required=True, widget=forms.widgets.TextInput(attrs={"placeholder": "Email"}))    first_name = forms.CharField(required=True, widget=forms.widgets.TextInput(attrs={"placeholder": "First Name"}))    last_name = forms.CharField(required=True, widget=forms.widgets.TextInput(attrs={"placeholder": "Last Name"}))    username = forms.CharField(widget=forms.widgets.TextInput(attrs={"placeholder": "Username"}))    password1 = forms.CharField(widget=forms.widgets.PasswordInput(attrs={"placeholder": "Password"}))    password2 = forms.CharField(widget=forms.widgets.PasswordInput(attrs={"placeholder": "Password Confirmation"}))    def is_valid(self):        form = super(UserCreateForm, self).is_valid()        for f, error in self.errors.iteritems():            if f != "__all_":                self.fields[f].widget.attrs.update({"class": "error", "value": strip_tags(error)})        return form    class Meta:        fields = ["email", "username", "first_name", "last_name", "password1",                  "password2"]        model = User</pre> <p>В приведенной выше примере мы явно указали некоторые из полей как обязательные, указав <code>required = True</code>. Крометого, я добавил атрибут placeholder к различным виджетам, применимым формам. Класс с именем <code>error</code>также добавляется в поля, содержащие ошибки. Это делается в функции <code>is_valid()</code>. Наконец, в классе <code>Meta</code> мы можем указать порядок, в котором мы хотим, чтобы формы поля отображались, и задали модель, с которой должна быть проверена форма.</p> <p>Затем давайте напишем форму для аутентификации:</p> <pre class="brush: python noskimlinks noskimwords">class AuthenticateForm(AuthenticationForm):    username = forms.CharField(widget=forms.widgets.TextInput(attrs={"placeholder": "Username"}))    password = forms.CharField(widget=forms.widgets.PasswordInput(attrs={"placeholder": "Password"}))    def is_valid(self):        form = super(AuthenticateForm, self).is_valid()        for f, error in self.errors.iteritems():            if f != "__all__":                self.fields[f].widget.attrs.update({"class": "error", "value": strip_tags(error)})        return form</pre> <p>Как и в <code>UserCreateForm</code>, <code>AuthenticateForm</code> добавляет некоторые плэйсхолдер и классы ошибок.</p> <p>Наконец, давайте закончим эту форму, и сохраним новуюформу  Ribbit.</p> <pre class="brush: python noskimlinks noskimwords">class RibbitForm(forms.ModelForm):    content = forms.CharField(required=True, widget=forms.widgets.Textarea(attrs={"class": "ribbitText"}))    def is_valid(self):        form = super(RibbitForm, self).is_valid()        for f in self.errors.iterkeys():            if f != "__all__":                self.fields[f].widget.attrs.update({"class": "error ribbitText"})        return form    class Meta:        model = Ribbit        exclude = ("user",)</pre> <p>Опция exclude в вышеперечисленном классе <code>Meta </code>предотвращает визуализацию поля пользователя. Нам это не нужно, поскольку пользователь Ribbit будетобработа с помощью сеансов в Ribbit</p> <p>Теперь применим  изменения</p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Created Forms"</pre> <hr><h2> Шаг 5 – Регистрация и вход в систему</h2> <p>Djangoочень гибкая система, когда дело доходит до маршрутизации. Начнем с определения некоторых маршрутов в <code>ribbit / urls.py</code></p> <pre class="brush: python noskimlinks noskimwords">urlpatterns = patterns("",    # Examples:    url(r"^$", "ribbit_app.views.index"), # root    url(r"^login$", "ribbit_app.views.login_view"), # login    url(r"^logout$", "ribbit_app.views.logout_view"), # logout    url(r"^signup$", "ribbit_app.views.signup"), # signup)</pre> <p>Далее,давайте использовать модели и формы, которые мы уже создали, и напишем соответствующиепредставления для каждого только что определенного маршрута. </p> <pre class="brush: python noskimlinks noskimwords">from django.shortcuts import render, redirectfrom django.contrib.auth import login, authenticate, logoutfrom django.contrib.auth.models import Userfrom ribbit_app.forms import AuthenticateForm, UserCreateForm, RibbitFormfrom ribbit_app.models import Ribbit</pre> <p>Начнемс добавления импорта в ribbit_app / views.py.</p> <pre class="brush: python noskimlinks noskimwords">def index(request, auth_form=None, user_form=None):    # User is logged in    if request.user.is_authenticated():        ribbit_form = RibbitForm()        user = request.user        ribbits_self = Ribbit.objects.filter(user=user.id)        ribbits_buddies = Ribbit.objects.filter(user__userprofile__in=user.profile.follows.all)        ribbits = ribbits_self | ribbits_buddies        return render(request,                      "buddies.html",                      {"ribbit_form": ribbit_form, "user": user,                       "ribbits": ribbits,                       "next_url": "/", })    else:        # User is not logged in        auth_form = auth_form or AuthenticateForm()        user_form = user_form or UserCreateForm()        return render(request,                      "home.html",                      {"auth_form": auth_form, "user_form": user_form, })</pre> <p>Дляпредставления index мы сначала проверяем, зарегистрирован ли пользователь илинет, и соответственно визуализируем шаблон. Запросы <code>ribributes_bibdies</code> и <code>ribbits_buddies</code> объединены с символом оператора <code>|</code> в приведенном выше коде. Крометого, мы проверяем, был ли экземпляр формы передан методу (в определениифункции), и если мы не создаем новый. Это позволяет нам передавать экземпляры формсоответствующим шаблонам и отображать ошибки.</p> <p>Давайтепродолжим редактирование шаблона "home.html", который будет использоваться для отображения индексной страницы для анонимных пользователей. В файле<code> theribbit / templates / home.html</code> добавьте следующий код.</p> <pre class="brush: html noskimlinks noskimwords">{% extends "base.html" %}{% block login %}    &lt;form action="/login" method="post"&gt;{% csrf_token %}        {% for field in auth_form %}        {{ field }}        {% endfor %}        &lt;input type="submit" id="btnLogIn" value="Log In"&gt;    &lt;/form&gt;{% endblock %}{% block content %}{% if auth_form.non_field_errors or user_form.non_field_errors %}&lt;div class="flash error"&gt;    {{ auth_form.non_field_errors }}    {{ user_form.non_field_errors }}&lt;/div&gt;{% endif %}&lt;img src="{{ STATIC_URL}}gfx/frog.jpg"&gt;&lt;div class="panel right"&gt;    &lt;h1&gt;New to Ribbit?&lt;/h1&gt;    &lt;p&gt;        &lt;form action="/signup" method="post"&gt;{% csrf_token %}            {% for field in user_form %}            {{ field }}            {% endfor %}            &lt;input type="submit" value="Create Account"&gt;        &lt;/form&gt;    &lt;/p&gt;&lt;/div&gt;{% endblock %}</pre> <p>Вшаблоне мы наследуем базовый шаблон, определенный ранее, визуализируем ирегистрируем формы, переопределяя блок входа. Приятнаявещь в Django заключается в том, что она упрощает CSRF Protection!  Все, что вам нужно сделать, это добавить<code>csrf_token</code> в каждую форму, которую вы используете в шаблоне.</p> <p>Перейдем к шаблону <code>buddies.html</code>, в котором будет отображаться страница друзей Ribbit. Отредактируйте <code>ribbit / templates / buddies.html</code> и добавьте следующий код:</p> <pre class="brush: html noskimlinks noskimwords">{% extends "base.html" %}{% block login %}    {% with user.username as username %}        {{ block.super }}    {% endwith %}{% endblock %}{% block content %}    &lt;div class="panel right"&gt;        &lt;h1&gt;Create a Ribbit&lt;/h1&gt;        &lt;p&gt;            &lt;form action="/submit" method="post"&gt;            {% for field in ribbit_form %}{% csrf_token %}            {{ field }}            {% endfor %}            &lt;input type="hidden" value="{{ next_url }}" name="next_url"&gt;            &lt;input type="submit" value="Ribbit!"&gt;            &lt;/form&gt;        &lt;/p&gt;    &lt;/div&gt;    &lt;div class="panel left"&gt;        &lt;h1&gt;Buddies" Ribbits&lt;/h1&gt;        {% for ribbit in ribbits %}        &lt;div class="ribbitWrapper"&gt;            &lt;a href="/users/{{ ribbit.user.username }}"&gt;                &lt;img class="avatar" src="{{ ribbit.user.profile.gravatar_url }}"&gt;                &lt;span class="name"&gt;{{ ribbit.user.first_name }}&lt;/span&gt;            &lt;/a&gt;            @{{ ribbit.user.username }}            &lt;p&gt;                {{ ribbit.content }}            &lt;/p&gt;        &lt;/div&gt;        {% endfor %}    &lt;/div&gt;{% endblock %}</pre> <p>В этом шаблоне мы предоставляем родительский шаблон i.e. <code>base.html</code> со значением имени пользователя, чтобы ссылка на навигацию для зарегистрированного пользователя отображалась правильно.  Мы также используем экземпляр <code>RibbitForm</code>, чтобы добавлять новых пользователей и показывать новых друзей наших пользователей</p> <p>Послетого, как только шаблоны доработаны, давайте допишем код для входа / выходапользователя.  Добавьте следующий код <code>ribbit_app / views.py</code></p> <pre class="brush: python noskimlinks noskimwords">def login_view(request):    if request.method == "POST":        form = AuthenticateForm(data=request.POST)        if form.is_valid():            login(request, form.get_user())            # Success            return redirect("/")        else:            # Failure            return index(request, auth_form=form)    return redirect("/")def logout_view(request):    logout(request)    return redirect("/")</pre> <p>Представленияавторизации ожидают запроса через HTTP POST для входа (с тех пор как мыиспользуем метод POST).  Он проверяет форму и вводит пользователя всистему, используя метод <code>login()</code>, который запускает сеанс, а затем перенаправляет нас на корневой URL-адрес.  Если проверка завершается неудачно, мы передаем экземпляр <code>auth_form</code> от пользователя к функции индекса и видим  ошибки, тогда как, если запрос не использует метод POST, пользователь перенаправляется на корневой URL-адрес.</p> <p>Видвыхода довольно прост.  Он использует функцию <code>logout()</code> в Django, которая удаляет сеанс и регистрирует пользователя, а затем перенаправляется на корневой URL.</p> <p>Теперьнам нужно написать представление, чтобы зарегистрировать пользователя и чтобыон смог войти.  Подключитеследующий код к ribbit_app/views.py.</p> <pre class="brush: python noskimlinks noskimwords">def signup(request):    user_form = UserCreateForm(data=request.POST)    if request.method == "POST":        if user_form.is_valid():            username = user_form.clean_username()            password = user_form.clean_password2()            user_form.save()            user = authenticate(username=username, password=password)            login(request, user)            return redirect("/")        else:            return index(request, user_form=user_form)    return redirect("/")</pre> <p>Подобнопредставлению входа в систему, окошко регистрации также ожидает запроса POST и перенаправляетна корневой URL-адрес, если проверка завершилась неудачей. Если форма регистрации действительна, пользователь сохраняется в базе данных, аутентифицируется, регистрируется и затем перенаправляется на домашнюю страницу. В противном случае мы вызываем функцию индекса и передаем в экземпляр <code>user_form</code>, представленный пользователем, чтобы перечислять ошибки.</p> <p>Какой же у нас прогресс? Запустив сервер и протестировавпросмотры, которые мы написали до сих.</p> <pre class="brush: bash noskimlinks noskimwords">python manage.py runserver</pre> <p>Перейдем к <span>серверу разработки</span> и попробуем зарегистрировать нового пользователя. Есливсе идет хорошо, то вы увидите страницу друзей Ribbits. Мыможем выйти из системы и повторно проверить страницу созданного пользователя,для проверки всех функций  в режимеожидании.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" ribbits="" page="" border="0" data-src="https://i.imgur.com/0FTak.png" class="lazy07" alt="Создание Ribbit на Django..." title="Создание Ribbit на Django..." width="50" height="50"></div> <p>Время применять изменения!</p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Implemented User Login and Sign Up"</pre> <hr><h2> Шаг 6 –регистрация  новых пользователей Ribbits и список публичныхаккаунтов Ribbits</h2> <p>В шаблоне <code>buddies.html</code>, который мы создали ранее, ribbit_form отправлялась через<code>/submit</code>.  Давайте отредактируем файлы <code>ribbitbit / urls.py</code> и добавим маршрут для формы и страницы,чтобы отобразить список аккаунтов. </p> <pre class="brush: python noskimlinks noskimwords">urlpatterns = patterns("",    # Examples:    url(r"^$", "ribbit_app.views.index"), # root    url(r"^login$", "ribbit_app.views.login_view"), # login    url(r"^logout$", "ribbit_app.views.logout_view"), # logout    url(r"^ribbits$", "ribbit_app.views.public"), # public ribbits    url(r"^submit$", "ribbit_app.views.submit"), # submit new ribbit)</pre> <p>Давайтенапишем представление, чтобы проверить исохранить зарегистрированных пользователей. Откройте файл <code>ribbit_app/views.py</code> и добавьте следующий код:</p> <pre class="brush: python noskimlinks noskimwords">from django.contrib.auth.decorators import login_required@login_requireddef submit(request):    if request.method == "POST":        ribbit_form = RibbitForm(data=request.POST)        next_url = request.POST.get("next_url", "/")        if ribbit_form.is_valid():            ribbit = ribbit_form.save(commit=False)            ribbit.user = request.user            ribbit.save()            return redirect(next_url)        else:            return public(request, ribbit_form)    return redirect("/")</pre> <p>Представление,которое использует декоратор <code>@login_required</code>, который выполняет функцию тольков том случае, если пользователь авторизирован; иначе, он будет перенаправлен на путь, указанный в константе <code>LOGIN_URL</code> в настройках. Еслипроверка формы прошла успешно, мы вручную устанавливает, что пользователю открыт сеанс ,а затем сохраняем данные. После приема данных пользователь перенаправляется на путь, указанный в поле <code>next_url</code>, который является скрытым полем формы, вводимый нами в шаблон специально для этих целей.   Значение <code>next_url</code> передается в  представление,которое отображает форму Ribbit.</p> <p>Послеперехода, давайте напишем представление, чтобы отобразить список последних 10 пользователей Ribbits.  Добавьте следующий код в файл <code>ribbit_app/views.py</code>.</p> <pre class="brush: python noskimlinks noskimwords">@login_requireddef public(request, ribbit_form=None):    ribbit_form = ribbit_form or RibbitForm()    ribbits = Ribbit.objects.reverse()[:10]    return render(request,                  "public.html",                  {"ribbit_form": ribbit_form, "next_url": "/ribbits",                   "ribbits": ribbits, "username": request.user.username})</pre> <p>Приотображении публичной страницы,  мызапрашиваем в базе данных данные последних 10 пользователей, отфильтровываяданные  запросов последних 10 элементов.  Затемформа вместе с пользователями отображается в шаблоне.  Давайте создадим файл <code>ribbit/templates/public.html</code> для этого представления</p> <pre class="brush: html noskimlinks noskimwords">{% extends "base.html" %}{% block content %}    &lt;div class="panel right"&gt;        &lt;h1&gt;Create a Ribbit&lt;/h1&gt;        &lt;p&gt;            &lt;form action="/submit" method="post"&gt;            {% for field in ribbit_form %}{% csrf_token %}            {{ field }}            {% endfor %}            &lt;input type="hidden" value="{{ next_url }}" name="next_url"&gt;            &lt;input type="submit" value="Ribbit!"&gt;            &lt;/form&gt;        &lt;/p&gt;    &lt;/div&gt;    &lt;div class="panel left"&gt;        &lt;h1&gt;Public Ribbits&lt;/h1&gt;        {% for ribbit in ribbits %}        &lt;div class="ribbitWrapper"&gt;            &lt;img class="avatar" src="{{ ribbit.user.profile.gravatar_url }}"&gt;            &lt;span class="name"&gt;{{ ribbit.user.first_name }}&lt;/span&gt;@{{ ribbit.user.username }}            &lt;span class="time"&gt;{{ ribbit.creation_date|timesince }}&lt;/span&gt;            &lt;p&gt;{{ ribbit.content }}&lt;/p&gt;        &lt;/div&gt;        {% endfor %}    &lt;/div&gt;{% endblock %}</pre> <p>В то время, пока обрабатывается  цикл с объектами пользователей, шаблон использует образец тега<code> timesince</code>, чтобы автоматически определять разницу между временем создания аккаунта и текущим временем и отображает это в стиле Twitter.</p> <p>Убедитесь, что сервер разработки запущен, создайте новогопользователя и посмотрите на страницу <span>Public Ribbits</span>, чтобы все работало верно.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" border="0" data-src="https://i.imgur.com/GwDIp.png" class="lazy07" alt="Создание Ribbit на Django..." title="Создание Ribbit на Django..." width="50" height="50"></div> <p>Давайте сохраним изменения и продолжим:</p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Implemented Ribbit Submission and Public Ribbits Views"</pre> <hr><h2> Шаг 7-аккаунты пользователя и подписчиков</h2> <p>НашТвиттер-клон, пользовательские профили и подписчики  идут рука об руку.  Давайтенапишем маршруты для реализации этого функционала. Обновитефайл <code>ribbit/urls.py</code> следующим образом:</p> <pre class="brush: python noskimlinks noskimwords">urlpatterns = patterns("",    # Examples:    url(r"^$", "ribbit_app.views.index"), # root    url(r"^login$", "ribbit_app.views.login_view"), # login    url(r"^logout$", "ribbit_app.views.logout_view"), # logout    url(r"^ribbits$", "ribbit_app.views.public"), # public ribbits    url(r"^submit$", "ribbit_app.views.submit"), # submit new ribbit    url(r"^users/$", "ribbit_app.views.users"),    url(r"^users/(?P&lt;username&gt;\w{0,30})/$", "ribbit_app.views.users"),    url(r"^follow$", "ribbit_app.views.follow"),)</pre> <p>Интереснымтипом маршрута является пример выше, который указывает  на профиль конкретного пользователя. <code>&lt;?P&lt;username&gt;</code> фиксирует имя пользователя, полученного путем запроса GET, и значение <code>\w {0,30}</code>указывает на то, что максимальная длина для имени пользователя составляет 30 символов:</p> <p>Затеммы продолжим писать представление для профайлов пользователей.  Добавьте следующий код в `ribbit_app/views.py ".</p> <pre class="brush: python noskimlinks noskimwords">from django.db.models import Countfrom django.http import Http404def get_latest(user):    try:        return user.ribbit_set.order_by("-id")[0]    except IndexError:        return ""@login_requireddef users(request, username="", ribbit_form=None):    if username:        # Show a profile        try:            user = User.objects.get(username=username)        except User.DoesNotExist:            raise Http404        ribbits = Ribbit.objects.filter(user=user.id)        if username == request.user.username or request.user.profile.follows.filter(user__username=username):            # Self Profile or buddies" profile            return render(request, "user.html", {"user": user, "ribbits": ribbits, })        return render(request, "user.html", {"user": user, "ribbits": ribbits, "follow": True, })    users = User.objects.all().annotate(ribbit_count=Count("ribbit"))    ribbits = map(get_latest, users)    obj = zip(users, ribbits)    ribbit_form = ribbit_form or RibbitForm()    return render(request,                  "profiles.html",                  {"obj": obj, "next_url": "/users/",                   "ribbit_form": ribbit_form,                   "username": request.user.username, })</pre> <p>Этопредставление ,пожалуй, самое интересное из всех, что мы рассмотрели до сихпор.  Начнемс того, что только зарегистрированные пользователи могут просматривать профилипользователей. В маршрутах, которые мы определили в файле <code>ribbit/ urls.py</code>, мы использовали один из этих маршрутов, для получения имени пользователя. Этотполученный  параметр автоматическивызывается вместе с объектом из запроса о пользователях.  Мыимеем два варианта:</p> <ul><li>Имяпользователя передается в URL-адрес для отображения профиля конкретного пользователя</li> <li>Имяпользователя отсутствует, что подразумевает, что пользователь хочет просмотретьвсе доступные профили</li> </ul><p>Начнемс проверки того, передалось ли имя пользователя и не пустое ли оно.  Затеммы попытаемся получить объект User для соответствующего имени пользователя.  Обратитевнимание на использование блока catch try в коде выше.  Мыобрабатываем исключение Http404, используя возможности Django, чтобы перенаправить на страницуошибки 404.  Затемнам нужно проверить, имеет ли запрашиваемый профиль друзей среди зарегистрированныхпользователей.  Еслиэто так, нам не нужно отображать следующую ссылку в профиле, посколькуотношения между пользователями уже установлены. В противном случае мы передаем параметр <code>follow</code> в представлении для отображения ссылки «Подписаться»</p> <p>Переходя ко второму этапу, в случае, если в URL-адресе не указано имя пользователя, мы получаем список всех доступных пользователей и выполняем функцию <code>annotate() </code>чтобы добавить свойства <code>ribbit_count</code> ко всем объектам, которые содержат количество запросов на подписку  каждого пользователя Ribbits. Этопозволяет нам использовать следующее значение  в строке &lt;user_name&gt;.ribbit_count Ribbit Count пользователя,чтобы получитколичество подписчиков.</p> <p>Получениеданных о последних зарегистрированных пользователях немного сложно. Мы используем для этого встроенную функцию <code>map()</code>  в Python и применяем функцию <code>get_latest()</code> длявсех элементов  в запросе.  Функция <code>get_latest()</code> определена в коде выше и создает двустороннее отношение дляпользователей Ribbit. Например, реализация функции <code>user.ribbit_set.all()</code> вернет значение всех пользователей для конкретного пользователя. Мыупорядочиваем пользователей по их id в порядке убывания и получаем первыйэлемент.  Код заключен в блок catch try, чтобы получить данные, вслучае, если у пользователя нет подписчиков.  Затем мы используем функцию <code>zip()</code> в Python для соединения каждого элемента обоих итераторов (пользователей и подписчиков), чтобы у нас была связь с пользовательским объектом и последней парой пользователей Затеммы передаем этот связанный объект вместе с формами в шаблон.  Давайтенапишем наше последнее представление, которое будет принимать запрос отпользователя по подписку:</p> <pre class="brush: python noskimlinks noskimwords">from django.core.exceptions import ObjectDoesNotExist@login_requireddef follow(request):    if request.method == "POST":        follow_id = request.POST.get("follow", False)        if follow_id:            try:                user = User.objects.get(id=follow_id)                request.user.profile.follows.add(user.profile)            except ObjectDoesNotExist:                return redirect("/users/")    return redirect("/users/")</pre> <p>В приведенном выше представлении мы получаем значение параметра <code>follow</code>, переданного через запрос  POST.  Если идентификатор установлен, мы проверяем, существует ли пользователь и добавляем отношение, в противном случае мы получаем ошибку  <code>bjectDoesNotExist</code> и перенаправляем пользователя на страницу со списком всех доступных пользователей.</p> <p>Мызавершили работу  с представлениями наданном этапе.  Давайтенапишем оставшиеся два шаблона, необходимые для отображения профилейпользователей. Откройтетекстовый редактор и отредактируйте файл <code>ribbit/templates/profiles.html</code></p> <pre class="brush: html noskimlinks noskimwords">{% extends "base.html" %}{% block content %}    &lt;div class="panel right"&gt;        &lt;h1&gt;Create a Ribbit&lt;/h1&gt;        &lt;p&gt;            &lt;form action="/submit" method="post"&gt;            {% for field in ribbit_form %}{% csrf_token %}            {{ field }}            {% endfor %}            &lt;input type="hidden" value="{{ next_url }}" name="next_url"&gt;            &lt;input type="submit" value="Ribbit!"&gt;            &lt;/form&gt;        &lt;/p&gt;    &lt;/div&gt;    &lt;div class="panel left"&gt;        &lt;h1&gt;Public Profiles&lt;/h1&gt;        {% for user, ribbit in obj %}        &lt;div class="ribbitWrapper"&gt;            &lt;a href="/users/{{ user.username }}"&gt;                &lt;img class="avatar" src="{{ user.profile.gravatar_url }}"&gt;                &lt;span class="name"&gt;{{ user.first_name }}&lt;/span&gt;            &lt;/a&gt;            @{{ user.username }}            &lt;p&gt;                {{ user.ribbit_count}} Ribbits                &lt;span class="spacing"&gt;{{ user.profile.followed_by.count }} Followers&lt;/span&gt;                &lt;span class="spacing"&gt;{{ user.profile.follows.count }} Following&lt;/span&gt;            &lt;/p&gt;            &lt;p&gt;{{ ribbit.content }}&lt;/p&gt;        &lt;/div&gt;        {% endfor %}    &lt;/div&gt;{% endblock %}</pre> <p>Чтобы отобразить пользователя вместе со своим последним подписчиком, мы используем общую конструкцию в Python для перебора списка взаимосвязей <code>for user, ribbit in obj j.</code>  Внутрицикла мы отображаем  информацию опользователе вместе с подписчиками.  Обратитевнимание на использование обратной связи в <code>{{user.profile.followed_by.count}}</code>.  <code>follow_by</code> - это имя пользователя, которое мы установили при определении свойства ManyToMany  длямодели UserProfile.</p> <p>Наконец,давайте напишем шаблон для отображения профиля конкретного пользователя. Запишитеследующий код в файл ribbit / templates / user.html.</p> <pre class="brush: html noskimlinks noskimwords">{% extends "base.html" %}{% block login %}    {% with user.username as username %}        {{ block.super }}    {% endwith %}{% endblock %}{% block content %}    &lt;div class="panel left"&gt;        &lt;h1&gt;{{ user.first_name }}"s Profile&lt;/h1&gt;        &lt;div class="ribbitWrapper"&gt;            &lt;a href="/users/{{ user.username }}"&gt;                &lt;img class="avatar" src="{{ user.profile.gravatar_url }}"&gt;                &lt;span class="name"&gt;{{ user.first_name }}&lt;/span&gt;            &lt;/a&gt;                @{{ user.username }}            &lt;p&gt;                {{ ribbits.count }} Ribbits                &lt;span class="spacing"&gt;{{ user.profile.follows.all.count }} Following&lt;/span&gt;                &lt;span class="spacing"&gt;{{ user.profile.followed_by.all.count }} Followers&lt;/span&gt;            &lt;/p&gt;            {% if follow %}            &lt;form action="/follow" method="post"&gt;                {% csrf_token %}                &lt;input type="hidden" name="follow" value="{{ user.id }}"&gt;                &lt;input type="submit" value="Follow"&gt;            &lt;/form&gt;            {% endif %}        &lt;/div&gt;    &lt;/div&gt;    &lt;div class="panel left"&gt;        &lt;h1&gt;{{ user.first_name }}"s Ribbits&lt;/h1&gt;        {% for ribbit in ribbits %}        &lt;div class="ribbitWrapper"&gt;            &lt;a href="/users/{{ user.username }}"&gt;                &lt;img class="avatar" src="{{ user.profile.gravatar_url }}"&gt;                &lt;span class="name"&gt;{{ ribbit.user.first_name }}&lt;/span&gt;            &lt;/a&gt;            @{{ ribbit.user.username }}            &lt;span class="time"&gt;{{ ribbit.creation_date|timesince }}&lt;/span&gt;            &lt;p&gt;{{ ribbit.content }}&lt;/p&gt;        &lt;/div&gt;        {% endfor %}    &lt;/div&gt;{% endblock %}</pre> <p>Как и в шаблоне <code>buddies.html</code>, мы передаем имя пользователя зарегистрированного шаблона в родительский , используя конструкцию <code>{% with%}</code>.  Затем мы отображаем профиль пользователя и показываем следующую ссылку только в том случае, если для переменной <code>follow</code> установлено значение <code>True</code>. Послеэтого мы перечислим всех подписчиков для пользователя, прибавляя значения кпеременной  ribbits.</p> <p>Мы,наконец, сделали все представления и шаблоны.  Проверьтевсе ссылки и попробуйте подписаться на пользователей и наслаждайтесь только чтосозданным  вами клоном Twitter.</p> <p>Давайте сохраним наши изменения: </p> <pre class="brush: bash noskimlinks noskimwords">git add .git commit -m "Implemented User Profiles and Following Relation on frontend"</pre> <hr><h2> Шаг 8 – Размещение приложения на Heroku</h2> <p>Япредпочитаю разделять разработку на две ветви: разработка и публикация. Спомощью git это можно сделать легко.</p> <pre class="brush: bash noskimlinks noskimwords">git branch -b production</pre> <p>Запустите терминал и выполните следующие команды: Давайте обновим наш файл <code>.gitignore</code> и добавим к нему базу данных.  Этотфайл должен содержать следующее:</p> <pre class="brush: bash noskimlinks noskimwords">*.pycribbit/database.db</pre> <p>Давайте установим некоторые расширения в наш virtualenv, которые необходимы для публикации на сервере.</p> <pre class="brush: bash noskimlinks noskimwords">pip install psycopg2 dj-database-url gunicorn</pre> <p>Мы также создадим файл со всеми зависимостями проекта, чтобыони были применены Heroku.</p> <pre class="brush: bash noskimlinks noskimwords">pip freeze &gt; requirements.txt</pre> <p>Затем отредактируем файл<code> ribbit / settings.py.</code>  Настройки базы данных должны быть изменены соответственно:</p> <pre class="brush: python noskimlinks noskimwords">DATABASES = {    "default": {        "ENGINE": "django.db.backends.postgresql_psycopg2", # Add "postgresql_psycopg2", "mysql", "sqlite3" or "oracle".        "NAME": "ribbit",                      # Or path to database file if using sqlite3.        "USER": "username",                      # Not used with sqlite3.        "PASSWORD": "password",                  # Not used with sqlite3.        "HOST": "",                      # Set to empty string for localhost. Not used with sqlite3.        "PORT": "",                      # Set to empty string for default. Not used with sqlite3.    }}</pre> <p>В конце файла добавьте следующее, чтобы Heroku могопределить настройки базы данных.</p> <pre class="brush: python noskimlinks noskimwords">import dj_database_urlDATABASES["default"] = dj_database_url.config()</pre> <p>Давайте создадим Procfile для запуска процесса на сервере Heroku. Добавьте следующий код в файл <code>Procfile</code>.</p> <pre class="brush: bash noskimlinks noskimwords">web: gunicorn ribbit.wsgi</pre> <p>Кроме того, если ваше приложение не большое , вы можетепропустить настройки служб хранения, добавив маршрут для статических файловв <code>ribbit/urls.py</code></p> <pre class="brush: python noskimlinks noskimwords">urlpatterns += patterns("django.contrib.staticfiles.views",        url(r"^static/(?P&lt;path&gt;.*)$", "serve"),    )</pre> <p>Мы всё настроили! Давайте закоммитим изменения:</p> <pre class="brush: bash noskimlinks noskimwords">git commit -a -m "Configured for Production"</pre> <p>Наконец, мы создадим приложение Heroku и переместим нашифайлы на удаленный сервер:</p> <pre class="brush: bash noskimlinks noskimwords">heroku creategit push heroku production:master</pre> <p>После передачи файлов запустите <code>syncdb</code> и примените настройкимиграции к базе данных.</p> <pre class="brush: bash noskimlinks noskimwords">heroku run python manage.py syncdbheroku run python manage.py migrate ribbit_app</pre> <p>Наконец, откройте приложение с помощью:</p> <pre class="brush: bash noskimlinks noskimwords">heroku open</pre> <hr><h2>Заключение</h2> <p>Наконец,мы закончили создание приложения Ribbit с помощью Django!  Этот урок был довольно долгим и, на самом деле, приложение  обладает гораздо большим потенциалом, чем тот. который мы создали. Надеюсь,что если вы новичок в Django, эта статья вдохновит вас на более детальноеизучение Django.</p> <p>Экспериментируйте  вместе с моим приложением  в <span>Heroku</span>.  Если увас есть какие-либо вопросы, я был бы рад ответить на них. </p> 

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Python" href="https://norma-studio.github.io/article5/220825593-sozdanie-ribbit-na-django" class="tm-article-body__tags-item-link">Python</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
41050</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
554</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
