
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Вам интересно, что такое КБП и как его можно интегрировать в ваши собственные приложения для Android? Этот учебник быстро познакомит вас с этой темой, прежде чем погрузиться в нее и научит создавать простое приложение для чтения КБП!...">
<meta property="og:description" content="Вам интересно, что такое КБП и как его можно интегрировать в ваши собственные приложения для Android? Этот учебник быстро познакомит вас с этой темой, прежде чем погрузиться в нее и научит создавать простое приложение для чтения КБП!...">
<meta name="twitter:description" content="Вам интересно, что такое КБП и как его можно интегрировать в ваши собственные приложения для Android? Этот учебник быстро познакомит вас с этой темой, прежде чем погрузиться в нее и научит создавать простое приложение для чтения КБП!...">
<meta property="aiturec:description" content="Вам интересно, что такое КБП и как его можно интегрировать в ваши собственные приложения для Android? Этот учебник быстро познакомит вас с этой темой, прежде чем погрузиться в нее и научит создавать простое приложение для чтения КБП!...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=512/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_2.jpg">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=512/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_2.jpg">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=512/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_2.jpg">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=512/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_2.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=512/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_2.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html" title="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io" title="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/31231313312.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html" class="tm-user-info__username" title="
Д. Грунин" aria-label="
Д. Грунин">
Д. Грунин</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Чтение ярлыков КБП (Коммуникация ближнего поля) с Android...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android" class="tm-article-snippet__hubs-item-link"><span>Android SDK</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=512/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_2.jpg">
    <meta itemprop="headline name" content="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Вам интересно, что такое КБП и как его можно интегрировать в ваши собственные приложения для Android? Этот учебник быстро познакомит вас с этой темой, прежде чем погрузиться в нее и научит создавать простое приложение для чтения КБП!...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Вам интересно, что такое КБП и как его можно интегрировать в ваши собственные приложения для Android? Этот учебник быстро познакомит вас с этой темой, прежде чем погрузиться в нее и научит создавать простое приложение для чтения КБП!...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Вам интересно, что такое КБП и как его можно интегрировать в ваши собственные приложения для Android? Этот учебник быстро познакомит вас с этой темой, прежде чем погрузиться в нее и научит создавать простое приложение для чтения КБП!<br><!--more--></p> <hr><h2>Что такое КБП?</h2> <p>КБП - это сокращение от <em>Коммуникация ближнего поля</em> (NFC -Near Field Communication). Это международный стандарт для бесконтактного обмена данными. В отличие от большой спектр других технологий, таких как беспроводной локальной сети и Bluetooth максимальное расстояние двух устройств составляет 10 см. Разработка стандарта началась в 2002 году NXP Semiconductors, Sony. <span>КБП Форум</span>, консорциум из более 170 компаний и членов, в который входят Mastercard, NXP, Nokia, Samsung, Intel и Google, разрабатывает новые спецификации с 2004 года.</p> <p>Существуют различные возможности использования КБП с мобильными устройствами; например, безбумажные билеты, средства контроля доступа, безналичные платежи и ключи от машины. С помощью ярлыков КБП вы можете управлять своим телефоном и изменять настройки. Данные можно обменивать, просто держа два устройства рядом друг с другом.</p> <p>В этом уроке я хочу объяснить, как реализовать КБП с Android SDK, какие подводные камни существуют и что нужно иметь в виду. Мы шаг за шагом создадим приложение, которое сможет читать содержимое ярлыков КБП, поддерживающих NDEF.</p> <hr><h2>КБП-технологии</h2> <p>Существует множество ярлыков КБП, которые можно прочитать с помощью смартфона. Спектр варьируется от простых наклеек и брелков до сложных карт со встроенным криптографическим оборудованием. Ярлыки также отличаются по своей технологии чипов. Наиболее важным является NDEF, который поддерживается большинством ярлыков. Кроме того, следует упомянуть Mifare, поскольку это самая распространенная технология бесконтактных чипов в мире. Некоторые ярлыки могут быть прочитаны и записаны, в то время как другие доступны только для чтения или зашифрованы.</p> <p>В этом руководстве обсуждается только формат обмена данными КБП (NDEF).</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=512/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_2.jpg" alt="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." title="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." width="50" height="50"><br><fig caption="X-ray view of a girogo-card"></fig><br></figure><h2>Добавление поддержки КБП в приложение</h2> <p>Мы начинаем с нового проекта и нулевой деятельности. Важно выбрать минимальную версию SDK уровня 10, потому что КБП поддерживается только после Android 2.3.3. Не забудьте выбрать имя пакета. Я выбрал <em>net.vrallev.android.nfc.demo</em>, потому что vrallev.net является доменом моего сайта, а другая часть относится к теме этого приложения.</p> <pre class="brush: javascript noskimlinks noskimwords">  &lt;uses-sdkandroid:minSdkVersion="10"        android:targetSdkVersion="17" /&gt;</pre> <p>Макет по умолчанию, сгенерированный Eclipse, для нас почти достаточен. Я только добавил ID к TextView и изменил текст.</p> <pre class="brush: javascript noskimlinks noskimwords">&lt;TextView        android:id="@+id/textView_explanation"        android:layout_width="wrap_content"        android:layout_height="wrap_content"        android:text="@string/explanation" /&gt;</pre> <p>Чтобы получить доступ к оборудованию КБП, вы должны обратиться за разрешением в манифест. Если приложение не будет работать без КБП, вы можете указать состояние с помощью ярлыка метки использования. Если требуется КБП, приложение не может быть установлено на устройство без него, и Google Play будет отображать ваше приложение только пользователям, которые владеют устройством КБП.</p> <pre class="brush: javascript noskimlinks noskimwords">&lt;uses-permission android:name="android.permission.NFC" /&gt;    &lt;uses-feature        android:name="android.hardware.nfc"        android:required="true" /&gt;</pre> <p>MainActivity должен состоять только  методом onCreate (). Вы можете взаимодействовать с оборудованием через класс NfcAdapter. Важно выяснить, является ли NfcAdapter нулевым. В этом случае устройство Android не поддерживает КБП.</p> <pre class="brush: javascript noskimlinks noskimwords">package net.vrallev.android.nfc.demo;import android.app.Activity;import android.nfc.NfcAdapter;import android.os.Bundle;import android.widget.TextView;import android.widget.Toast;/** * Activity for reading data from an NDEF Tag. *  * @author Ralf Wondratschek * */public class MainActivity extends Activity {public static final String TAG = "NfcDemo";private TextView mTextView;private NfcAdapter mNfcAdapter;@Overrideprotected void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);setContentView(R.layout.activity_main);mTextView = (TextView) findViewById(R.id.textView_explanation);mNfcAdapter = NfcAdapter.getDefaultAdapter(this);if (mNfcAdapter == null) {// Stop here, we definitely need NFCToast.makeText(this, "This device doesn"t support NFC.", Toast.LENGTH_LONG).show();finish();return;}if (!mNfcAdapter.isEnabled()) {mTextView.setText("NFC is disabled.");} else {mTextView.setText(R.string.explanation);}handleIntent(getIntent());}private void handleIntent(Intent intent) {// TODO: handle Intent}}</pre> <p>Если мы запустим наше приложение сейчас, мы увидим текст, включен ли КБП или нет.</p> <h2>Как отфильтровать ярлыки КБП</h2> <p>У нас есть пример приложения и мы хотим получать уведомление от системы, когда мы прикрепляем к устройству ярлык КБП. Как обычно, Android использует систему Intent для доставки ярлыков для приложения. Если несколько приложений могут обрабатывать Intent, отображается окно выбора активности, и пользователь может решить, какое приложение будет открыто. Открытие URL или обмен информацией обрабатываются одинаково.</p> <hr><h2>КБП Intent фильтр</h2> <p>Существует три различные фильтры для ярлыков:</p> <ol><li>ACTION_NDEF_DISCOVERED</li> <li>ACTION_TECH_DISCOVERED</li> <li>ACTION_TAG_DISCOVERED</li> </ol><p>Список отсортирован от самого высокого до самого низкого приоритета.</p> <p>Что происходит, когда к смартфону прикрепляется ярлык? Если система обнаруживает ярлык с поддержкой NDEF, запускается Intent. <em>ACTION_TECH_DISCOVERED</em> Intent (намерением) инициируется, если нет активности от любого приложения регистрируется  для NDEF Intent  (намерения) или ярлык не поддерживает NDEF .    Если снова не найдено приложение для Intent или технология чипа не может быть обнаружена, то запускается Intent (намерение) <em>ACTION_TAG_DISCOVERED</em>. На следующем рисунке показан процесс:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=762/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_3.png" alt="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." title="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." width="50" height="50"><br></figure><p>В целом это означает, что каждое приложение необходимо фильтровать после Intent (намерения) с наивысшим приоритетом. В нашем случае это NDEF Intent (намерение). Сначала мы реализуем Intent (намерение) <em>ACTION_TECH_DISCOVERED</em>, чтобы выделить разницу между приоритетами.</p> <hr><h2>Техника обнаружила  Intent (намерения)</h2> <p>Мы должны указать интересующую нас технологию. Для этого мы создаем подпапку с именем <em>xml</em> в папке <em>res</em>. В этой папке мы создаем файл <em>nfc_tech_filter.xml</em>, в котором мы указываем технологии.</p> <pre class="brush: xml noskimlinks noskimwords">&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2"&gt;    &lt;tech-list&gt;        &lt;tech&gt;android.nfc.tech.Ndef&lt;/tech&gt;        &lt;!-- class name --&gt;    &lt;/tech-list&gt;&lt;/resources&gt;&lt;!-- &lt;resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2"&gt;    &lt;tech-list&gt;        &lt;tech&gt;android.nfc.tech.IsoDep&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.NfcA&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.NfcB&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.NfcF&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.NfcV&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.Ndef&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.NdefFormatable&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.MifareClassic&lt;/tech&gt;        &lt;tech&gt;android.nfc.tech.MifareUltralight&lt;/tech&gt;    &lt;/tech-list&gt;&lt;/resources&gt;--&gt;</pre> <p>Теперь мы должны создать IntentFilter в манифесте, и приложение будет запущено, когда мы прикрепим ярлык.</p> <pre class="brush: xml noskimlinks noskimwords">&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;activityandroid:name="net.vrallev.android.nfc.demo.MainActivity"        android:label="@string/app_name" &gt;        &lt;intent-filter&gt;            &lt;action android:name="android.intent.action.MAIN" /&gt;            &lt;category android:name="android.intent.category.LAUNCHER" /&gt;        &lt;/intent-filter&gt;                    &lt;intent-filter&gt;            &lt;action android:name="android.nfc.action.TECH_DISCOVERED" /&gt;        &lt;/intent-filter&gt;        &lt;meta-data            android:name="android.nfc.action.TECH_DISCOVERED"            android:resource="@xml/nfc_tech_filter" /&gt;    &lt;/activity&gt;</pre> <p>Если никакое другое приложение не зарегистрировано для этого  Intent (намерения), наша Деятельность начнется немедленно. На моем устройстве, однако, установлены другие приложения, поэтому отображается выбор активности.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=768/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_4.png" alt="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." title="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." width="50" height="50"><br></figure><hr><h2>NDEF обнаружил намерения</h2> <p>Как я упоминал ранее, техника которая обнаружила  Намерения есть второй самый высокий приоритет. Однако, поскольку наше приложение будет поддерживать только NDEF, вместо этого мы можем использовать обнаруженное намерение NDEF, которое имеет более высокий приоритет. Мы можем снова удалить список технологий и заменить следующие IntentFilter.</p> <pre class="brush: javascript noskimlinks noskimwords">&lt;intent-filter&gt;&lt;action android:name="android.nfc.action.NDEF_DISCOVERED" /&gt;&lt;category android:name="android.intent.category.DEFAULT" /&gt;&lt;data android:mimeType="text/plain" /&gt;&lt;/intent-filter&gt;</pre> <p>Когда мы сейчас прикрепим ярлык, приложение будет запущено, как и раньше. Однако для меня есть разница. Средство выбора действий не отображается, и приложение запускается немедленно, поскольку у намерения NDEF более высокий приоритет, а у других приложений зарегистрирован только более низкий приоритет. Это именно то, что мы хотим.</p> <hr><h2>Передний план Отправка</h2> <p>Обратите внимание, что одна проблема остается. Когда наше приложение уже открыто, и мы снова прикрепляем тег, приложение открывается второй раз вместо прямой доставки тега. Это не наше предполагаемое поведение. Вы можете обойти проблему с помощью Foreground Dispatch (переднего плана).</p> <p>Вместо того, чтобы система распространила Намерение, вы можете зарегистрировать свою активность, чтобы получить ярлык напрямую. Это важно для определенного рабочего процесса, когда нет смысла открывать другое приложение.</p> <p>Я вставил объяснения в соответствующие места в коде.</p> <pre class="brush: javascript noskimlinks noskimwords">package net.vrallev.android.nfc.demo;import android.app.Activity;import android.app.PendingIntent;import android.content.Intent;import android.content.IntentFilter;import android.content.IntentFilter.MalformedMimeTypeException;import android.nfc.NfcAdapter;import android.os.Bundle;import android.widget.TextView;import android.widget.Toast;/** * Activity for reading data from an NDEF Tag. *  * @author Ralf Wondratschek * */public class MainActivity extends Activity {public static final String MIME_TEXT_PLAIN = "text/plain";public static final String TAG = "NfcDemo";private TextView mTextView;private NfcAdapter mNfcAdapter;@Overrideprotected void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);setContentView(R.layout.activity_main);mTextView = (TextView) findViewById(R.id.textView_explanation);mNfcAdapter = NfcAdapter.getDefaultAdapter(this);if (mNfcAdapter == null) {// Stop here, we definitely need NFCToast.makeText(this, "This device doesn"t support NFC.", Toast.LENGTH_LONG).show();finish();return;}if (!mNfcAdapter.isEnabled()) {mTextView.setText("NFC is disabled.");} else {mTextView.setText(R.string.explanation);}handleIntent(getIntent());}@Overrideprotected void onResume() {super.onResume();/** * It"s important, that the activity is in the foreground (resumed). Otherwise * an IllegalStateException is thrown.  */setupForegroundDispatch(this, mNfcAdapter);}@Overrideprotected void onPause() {/** * Call this before onPause, otherwise an IllegalArgumentException is thrown as well. */stopForegroundDispatch(this, mNfcAdapter);super.onPause();}@Overrideprotected void onNewIntent(Intent intent) { /** * This method gets called, when a new Intent gets associated with the current activity instance. * Instead of creating a new activity, onNewIntent will be called. For more information have a look * at the documentation. *  * In our case this method gets called, when the user attaches a Tag to the device. */handleIntent(intent);}private void handleIntent(Intent intent) {// TODO: handle Intent}/** * @param activity The corresponding {@link Activity} requesting the foreground dispatch. * @param adapter The {@link NfcAdapter} used for the foreground dispatch. */public static void setupForegroundDispatch(final Activity activity, NfcAdapter adapter) {final Intent intent = new Intent(activity.getApplicationContext(), activity.getClass());intent.setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);final PendingIntent pendingIntent = PendingIntent.getActivity(activity.getApplicationContext(), 0, intent, 0);IntentFilter[] filters = new IntentFilter[1];String[][] techList = new String[][]{};// Notice that this is the same filter as in our manifest.filters[0] = new IntentFilter();filters[0].addAction(NfcAdapter.ACTION_NDEF_DISCOVERED);filters[0].addCategory(Intent.CATEGORY_DEFAULT);try {filters[0].addDataType(MIME_TEXT_PLAIN);} catch (MalformedMimeTypeException e) {throw new RuntimeException("Check your mime type.");}adapter.enableForegroundDispatch(activity, pendingIntent, filters, techList);}/** * @param activity The corresponding {@link BaseActivity} requesting to stop the foreground dispatch. * @param adapter The {@link NfcAdapter} used for the foreground dispatch. */public static void stopForegroundDispatch(final Activity activity, NfcAdapter adapter) {adapter.disableForegroundDispatch(activity);}}</pre> <p>Теперь, когда вы прикрепляете тег, и наше приложение уже открыто, вызывается onNewIntent, и новая активность не создается.</p> <hr><h2>Чтение данных из ярлыка NDEF</h2> <p>Последний шаг - прочитать данные из ярлыка. Объяснения вставляются в соответствующие места в коде еще раз. NdefReaderTask - это закрытый внутренний класс.</p> <pre class="brush: javascript noskimlinks noskimwords">package net.vrallev.android.nfc.demo;import java.io.UnsupportedEncodingException;import java.util.Arrays;import android.app.Activity;import android.app.PendingIntent;import android.content.Intent;import android.content.IntentFilter;import android.content.IntentFilter.MalformedMimeTypeException;import android.nfc.NdefMessage;import android.nfc.NdefRecord;import android.nfc.NfcAdapter;import android.nfc.Tag;import android.nfc.tech.Ndef;import android.os.AsyncTask;import android.os.Bundle;import android.util.Log;import android.widget.TextView;import android.widget.Toast;/* * ... other code parts */private void handleIntent(Intent intent) {String action = intent.getAction();if (NfcAdapter.ACTION_NDEF_DISCOVERED.equals(action)) {String type = intent.getType();if (MIME_TEXT_PLAIN.equals(type)) {Tag tag = intent.getParcelableExtra(NfcAdapter.EXTRA_TAG);new NdefReaderTask().execute(tag);} else {Log.d(TAG, "Wrong mime type: " + type);}} else if (NfcAdapter.ACTION_TECH_DISCOVERED.equals(action)) {// In case we would still use the Tech Discovered IntentTag tag = intent.getParcelableExtra(NfcAdapter.EXTRA_TAG);String[] techList = tag.getTechList();String searchedTech = Ndef.class.getName();for (String tech : techList) {if (searchedTech.equals(tech)) {new NdefReaderTask().execute(tag);break;}}}}</pre> <pre class="brush: javascript noskimlinks noskimwords">/** * Background task for reading the data. Do not block the UI thread while reading.  *  * @author Ralf Wondratschek * */private class NdefReaderTask extends AsyncTask&lt;Tag, Void, String&gt; {@Overrideprotected String doInBackground(Tag... params) {Tag tag = params[0];Ndef ndef = Ndef.get(tag);if (ndef == null) {// NDEF is not supported by this Tag. return null;}NdefMessage ndefMessage = ndef.getCachedNdefMessage();NdefRecord[] records = ndefMessage.getRecords();for (NdefRecord ndefRecord : records) {if (ndefRecord.getTnf() == NdefRecord.TNF_WELL_KNOWN &amp;&amp; Arrays.equals(ndefRecord.getType(), NdefRecord.RTD_TEXT)) {try {return readText(ndefRecord);} catch (UnsupportedEncodingException e) {Log.e(TAG, "Unsupported Encoding", e);}}}return null;}private String readText(NdefRecord record) throws UnsupportedEncodingException {/* * See NFC forum specification for "Text Record Type Definition" at 3.2.1  *  * http://www.nfc-forum.org/specs/ *  * bit_7 defines encoding * bit_6 reserved for future use, must be 0 * bit_5..0 length of IANA language code */byte[] payload = record.getPayload();// Get the Text EncodingString textEncoding = ((payload[0] &amp; 128) == 0) ? "UTF-8" : "UTF-16";// Get the Language Codeint languageCodeLength = payload[0] &amp; 0063;// String languageCode = new String(payload, 1, languageCodeLength, "US-ASCII");// e.g. "en"// Get the Textreturn new String(payload, languageCodeLength + 1, payload.length - languageCodeLength - 1, textEncoding);}@Overrideprotected void onPostExecute(String result) {if (result != null) {mTextView.setText("Read content: " + result);}}}</pre> <p>Теперь приложение успешно считывает содержимое.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=768/mobile/uploads/2013/05/Reading-NFC-Tags-with-Android_5.png" alt="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." title="Чтение ярлыков КБП (Коммуникация ближнего поля) с Android..." width="50" height="50"><br></figure><hr><h2>Полезные приложения</h2> <p>Чтобы проверить, правильно ли считываются и записываются данные, мне лично нравятся следующие приложения:</p> <ul><li> КБП <span>TagInfo</span> от NFC Research Lab для чтения данных</li> <li> <span>TagInfo</span> от NXP SEMICONDUCTORS для чтения данных</li> <li> <span>TagWriter</span> от NXP SEMICONDUCTORS для записи данных</li> </ul><hr><h2>Заключение</h2> <p>В этом уроке я показал вам, как можно извлечь данные из тега NDEF. Вы можете распространить пример на другие  похожие типы  и технологии чипов; функция записи данных также будет полезна. Первый шаг для работы с NFC был сделан. Тем не менее, Android SDK предлагает гораздо больше возможностей, таких как простой обмен данными (называемый Android Beam).</p> <hr><h2>Об авторе </h2> <p>Ральф Вондрачек - студент информатики из Германии. Помимо учебы, Ральф работает в новшествах, которые и предлагает, в области мобильных компьютеров. В последние несколько лет он работал с Java, XML, HTML, JSP, JSF, Eclipse, Google App Engine и, конечно, с Android. На сегодняшний день он опубликовал два приложения для Android, <span>которые можно найти здесь</span>.</p> <p>Вы можете узнать больше о работе автора на его домашней странице <span>vrallev.net</span>. </p> <hr><h2>Источники </h2> <p><span>http://www.nfc-forum.org/home/n-mark.jpg</span></p> <p><span>http://commons.wikimedia.org/wiki/File%3A%C3%9Cberlagert.jpg</span></p> <p><span>http://developer.android.com/images/nfc_tag_dispatch.png</span></p> <hr>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825570-chtenie-yarlykov-kbp-kommunikatsiya-blizhnego-polya-s-android" class="tm-article-body__tags-item-link">Android SDK</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
44552</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
701</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
