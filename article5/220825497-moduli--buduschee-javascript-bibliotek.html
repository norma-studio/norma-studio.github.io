
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Такие JavaScript библиотеки, как jQuery давно зарекомендовали себя при написании JavaScript кода, который должен работать в браузере. Они были необходимым изобретением того времени, так как между браузерами было полно противоречий и проблем реализации. Библиотека jQuery спасала ситуацию, когда дело касалось ошибок браузера и необходимых обходных пу...">
<meta property="og:description" content="Такие JavaScript библиотеки, как jQuery давно зарекомендовали себя при написании JavaScript кода, который должен работать в браузере. Они были необходимым изобретением того времени, так как между браузерами было полно противоречий и проблем реализации. Библиотека jQuery спасала ситуацию, когда дело касалось ошибок браузера и необходимых обходных пу...">
<meta name="twitter:description" content="Такие JavaScript библиотеки, как jQuery давно зарекомендовали себя при написании JavaScript кода, который должен работать в браузере. Они были необходимым изобретением того времени, так как между браузерами было полно противоречий и проблем реализации. Библиотека jQuery спасала ситуацию, когда дело касалось ошибок браузера и необходимых обходных пу...">
<meta property="aiturec:description" content="Такие JavaScript библиотеки, как jQuery давно зарекомендовали себя при написании JavaScript кода, который должен работать в браузере. Они были необходимым изобретением того времени, так как между браузерами было полно противоречий и проблем реализации. Библиотека jQuery спасала ситуацию, когда дело касалось ошибок браузера и необходимых обходных пу...">
<meta property="og:image" content="//www.gravatar.com/avatar/b56bb22b3a4b83c6b534b4c114671380?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="aiturec:image" content="//www.gravatar.com/avatar/b56bb22b3a4b83c6b534b4c114671380?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta name="twitter:image" content="//www.gravatar.com/avatar/b56bb22b3a4b83c6b534b4c114671380?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="vk:image" content="//www.gravatar.com/avatar/b56bb22b3a4b83c6b534b4c114671380?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:type" content="article">
<link image_src="image" href="//www.gravatar.com/avatar/b56bb22b3a4b83c6b534b4c114671380?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html" title="Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io" title="Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533jfgfsfxcv.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html" class="tm-user-info__username" title="
О. Гуськов" aria-label="
О. Гуськов">
О. Гуськов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Модули - будущее JavaScript библиотек...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="JavaScript" href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek" class="tm-article-snippet__hubs-item-link"><span>JavaScript</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek.html" />
    <link itemprop="image" href="//www.gravatar.com/avatar/b56bb22b3a4b83c6b534b4c114671380?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
    <meta itemprop="headline name" content="Модули - будущее JavaScript библиотек... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Такие JavaScript библиотеки, как jQuery давно зарекомендовали себя при написании JavaScript кода, который должен работать в браузере. Они были необходимым изобретением того времени, так как между браузерами было полно противоречий и проблем реализации. Библиотека jQuery спасала ситуацию, когда дело касалось ошибок браузера и необходимых обходных пу...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Такие JavaScript библиотеки, как jQuery давно зарекомендовали себя при написании JavaScript кода, который должен работать в браузере. Они были необходимым изобретением того времени, так как между браузерами было полно противоречий и проблем реализации. Библиотека jQuery спасала ситуацию, когда дело касалось ошибок браузера и необходимых обходных пу...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Такие JavaScript библиотеки, как jQuery давно зарекомендовали себя при написании JavaScript кода, который должен работать в браузере. Они были необходимым изобретением того времени, так как между браузерами было полно противоречий и проблем реализации. Библиотека jQuery спасала ситуацию, когда дело касалось ошибок браузера и необходимых обходных путей, Ajax, обработка событий и манипуляции DOM элементами, благодаря функциям jQuery разработчики экономили уйму времени и усилий.</p><p>На тот момент, jQuery решала все наши проблемы, мы добавляли всю мощь библиотеки и сразу приступали к работе. Это была своего рода чёрная коробка, которая заставляла правильно функционировать браузеры.</p> <p>Но веб эволюционировал, API (интерфейс браузеров) постоянно улучшается, с каждым днём реализуются новые стандарты, в мире веб всё быстро меняется и я не думаю, что в будущем есть место большим библиотекам. Всё идёт к тому, что библиотеки будут использовать более модульный подход.</p> <h2>Знакомство с модулем</h2> <p>Модуль - это инкапсулированная часть функционала, которая выполняет лишь одну задачу и делает это хорошо. К примеру модуль может отвечать за добавление классов элементу, управлять данными, посредством протокола HTTP, используя Ajax, и так далее, различных возможностей огромное множество.</p> <p>Модули могут отличаться друг от друга и обладать разными размерами, но главная идея модуля - это быть импортированным в вашу программу и работать из коробки. В основном, для каждого модуля есть документация, написанная разработчиком и описания процесса установки, а также указывается среда, в которой данный модуль должен работать (к примеру браузер или сервер).</p> <p>В дальнейшем все модули станут зависимостями нашего проекта, управлять которыми будет очень просто. Дни когда мы добавляли огромную библиотеку постепенно остаются в прошлом, большие библиотеки не предоставляют нам такой гибкости. Разработчикам библиотеки jQuery тоже об этом известно, поэтому они добавили на свой сайт инструмент, который позволяет вам скачать только те части библиотеки, которые вам действительно нужны.</p> <p>Современные API оказались огромным толчком при создании идеи модулей, теперь когда реализации браузеров значительно улучшены, мы можем создавать удобные утилиты - модули для решения наших задач.</p> <p>Время модулей пришло и пора к этому привыкнуть.</p> <h2>Идея первого модуля</h2> <p>Одним из современных API, которое интересовало меня с момента своего появления, стало classList API. Теперь у нас появился нативный способ добавлять класс элементу, не прибегая к помощи jQuery и других сторонних библиотек.</p> <p>classList API существует уже несколько лет, однако не все разработчики знают об этом. Поэтому я решил создать модуль, который использует classList API, а для браузеров где это не поддерживается, я предоставлю фаллбэк.</p> <p>Прежде чем начать писать код, давайте посмотрим, как jQuery решал подобную задачу - добавление класса элементу:</p> <pre class="brush: javascript noskimlinks noskimwords">$(elem).addClass(‘myclass’);</pre> <p>При нативной реализации, мы будем применять вышеупомянутый classList API, вместе с объектом DOMTokenList (значения разделённые пробелом), значения находящиеся в className элемента. classList API предоставляет несколько методов для взаимодействия с DOMTokenList, все они очень похожи на функционал jQuery. Вот пример, как classList API добавляет класс, используя метод <code class="inline">classList.add()</code> :</p> <pre class="brush: javascript noskimlinks noskimwords">elem.classList.add(‘myclass’);</pre> <p>Чему мы здесь можем научиться? Функции библиотеки, более понятные и выразительные, что само - собой является большим плюсом. Что хорошо в открытой веб платформе (open web platform), мы всегда можем найти информацию, как те или иные функции будут развиваться в дальнейшем.</p> <p>Что же дальше? Мы знаем о модулях и нам нравится classList API, но к сожалению, на данный момент, не все браузеры поддерживают это. Хотя мы всегда можем создать фаллбэк. Звучит, как хорошая идея для модуля, использующего classList если в браузере есть поддержка, в противном случае автоматически будет применяться фаллбэк.</p> <h2>Создаём первый модуль: Apollo.js</h2> <p>Примерно шесть месяцев назад, при помощи функций обычного JavaScript, я создал небольшой, отдельный модуль для добавления классов элементу и назвал его <code class="inline">apollo.js</code>.</p> <p>Основной целью этого модуля, была идея использовать замечательный classList API, чтобы избавиться от лишней библиотеки, при выполнении простых задач. jQuery не использовал (и всё ещё не использует) classList API, так что я решил, что это будет отличной возможностью поэкспериментировать с новой технологией.</p> <p>Мы пройдёмся по всем важным моментам и я расскажу вам о чём я думал при написании каждого кусочка кода, в момент реализации этого простого модуля.</p> <h3>Используем classList</h3> <p>Как вы могли заметить, classList очень удобное API, разработчикам знакомым с jQuery не составит лишних усилий при переходе от функций библиотеки к нативным методам. Единственное, что мне не нравится, тот факт, что нам приходится каждый раз ссылаться на объект classList, чтобы применить его методы. При написании apollo я решил избавиться от ненужного повторения, в итоге у меня получился следующий вид моего API:</p> <pre class="brush: javascript noskimlinks noskimwords">apollo.addClass(elem, ‘myclass’);</pre> <p>Хороший модуль для работы с классами должен обладать такими функциями, как: <code class="inline">hasClass</code>, <code class="inline">addClass</code>, <code class="inline">removeClass</code>, <code class="inline">toggleClass</code>. Данные методы будут являться пространством имён нашего "apollo" модуля.</p> <p>Взглянув ближе на упомянутый прежде метод "addClass", можно заметить, что я передаю элемент в качестве первого аргумента. С jQuery вам приходится использовать большой кастомный объект для этого, в нашем модуле разработчик будет решать, как передать DOM элемент, будь-то нативные методы или модуль селектора. Второй аргумент представляет из себя обычную строку - любое имя класса, которое вам нравится.</p> <p>Давайте пройдёмся по остальным методам взаимодействия с классами, чтобы понять, как они будут выглядеть:</p> <pre class="brush: javascript noskimlinks noskimwords">apollo.hasClass(elem, ‘myclass’);apollo.addClass(elem, ‘myclass’);apollo.removeClass(elem, ‘myclass’);apollo.toggleClass(elem, ‘myclass’);</pre> <p>С чего же нам начать? Для начала, нам нужен объект, к которому мы добавим наши методы, а также функция - замыкание, для хранения нашего внутреннего функционала, то есть все функции и переменные. При определении данного модуля я использую анонимную самовызывающуюся функцию (immediate-invoked function expression IIFE), я обернул объект под названием apollo (а также некоторые методы содержащие абстракцию classList).</p> <pre class="brush: javascript noskimlinks noskimwords">(function () {        var apollo = {};        apollo.hasClass = function (elem, className) {        return elem.classList.contains(className);    };        apollo.addClass = function (elem, className) {        elem.classList.add(className);    };        apollo.removeClass = function (elem, className) {        elem.classList.remove(className);    };        apollo.toggleClass = function (elem, className) {        elem.classList.toggle(className);    };        window.apollo = apollo;    })();apollo.addClass(document.body, "test");</pre> <p>Теперь когда у нас есть рабочий classList, мы можем подумать о поддержке браузеров. Цель <code class="inline">apollomodule</code> предоставить небольшое, отдельное API, для манипуляции классами, в не зависимости от поддержки браузеров. Для этого нам понадобиться выявление особенностей (feature detection).</p> <p>Простой способ проверить присутствие тех или иных особенностей classList, выглядит следующим образом:</p> <pre class="brush: javascript noskimlinks noskimwords">if ("classList" in document.documentElement) {    // you’ve got support}</pre> <p>Мы используем оператор <code class="inline">in</code>, который анализирует поддержку classList и возвращает булево значение. Следующим шагом будет создание условия, которое будет предоставлять функции нашего API для браузеров пользователей, в которых имеется соответствующая поддержка:</p> <pre class="brush: javascript noskimlinks noskimwords">(function () {        var apollo = {};    var hasClass, addClass, removeClass, toggleClass;        if ("classList" in document.documentElement) {        hasClass = function () {            return elem.classList.contains(className);        }        addClass = function (elem, className) {            elem.classList.add(className);        }        removeClass = function (elem, className) {            elem.classList.remove(className);        }        toggleClass = function (elem, className) {            elem.classList.toggle(className);        }    }        apollo.hasClass = hasClass;    apollo.addClass = addClass;    apollo.removeClass = removeClass;    apollo.toggleClass = toggleClass;        window.apollo = apollo;    })();</pre> <p>Поддержка для устаревших браузеров, может быть реализована несколькими способами, пройтись циклом по строке содержащей className, заменить их, после чего снова добавить и так далее. jQuery использует много кода для этого, применяя длинный цикл со сложной структурой, я не хочу переполнять этот простой модуль лишним функционалом, так что я воспользуюсь регулярным выражением находящим вхождения и заменяющим их, для получения такого же результата с минимальным количеством кода. </p> <p>Вот самая простая реализация, которой мне удалось добиться:</p> <pre class="brush: javascript noskimlinks noskimwords">function hasClass (elem, className) {    return new RegExp("(^|\s)" + className + "(\s|$)").test(elem.className);}function addClass (elem, className) {    if (!hasClass(elem, className)) {        elem.className += (elem.className ? " " : "") + className;    }}function removeClass (elem, className) {    if (hasClass(elem, className)) {        elem.className = elem.className.replace(new RegExp("(^|\s)*" + className + "(\s|$)*", "g"), "");    }}function toggleClass (elem, className) {    (hasClass(elem, className) ? removeClass : addClass)(elem, className);}</pre> <p>Давайте интегрируем всё это в наш модуль, добавив <code class="inline">else</code> для браузеров, в которых отсутствует поддержка:</p> <pre class="brush: javascript noskimlinks noskimwords">(function () {        var apollo = {};    var hasClass, addClass, removeClass, toggleClass;        if ("classList" in document.documentElement) {        hasClass = function () {            return elem.classList.contains(className);        };        addClass = function (elem, className) {            elem.classList.add(className);        };        removeClass = function (elem, className) {            elem.classList.remove(className);        };        toggleClass = function (elem, className) {            elem.classList.toggle(className);        };    } else {        hasClass = function (elem, className) {            return new RegExp("(^|\s)" + className + "(\s|$)").test(elem.className);        };        addClass = function (elem, className) {            if (!hasClass(elem, className)) {                elem.className += (elem.className ? " " : "") + className;            }        };        removeClass = function (elem, className) {            if (hasClass(elem, className)) {                elem.className = elem.className.replace(new RegExp("(^|\s)*" + className + "(\s|$)*", "g"), "");            }        };        toggleClass = function (elem, className) {            (hasClass(elem, className) ? removeClass : addClass)(elem, className);        };    }        apollo.hasClass = hasClass;    apollo.addClass = addClass;    apollo.removeClass = removeClass;    apollo.toggleClass = toggleClass;        window.apollo = apollo;    })();</pre> <p>Рабочий пример <span>jsFiddle</span>, с тем что мы получили на данный момент.</p> <p>Давайте на этом остановимся, теперь вы знаете основную концепцию. В модуле apollo есть несколько других функций, таких как добавление нескольких классов за раз, вы можете ознакомиться с этим <span>здесь</span>, если вам интересно.</p> <p>Так чего же мы добились? Создали небольшой кусок с инкапсулированным функционалом, предназначенный для выполнения одной задачи и делающий это хорошо. Данный модуль довольно просто читается и его легко понять, можно с лёгкостью добавить новые изменения и проверить работу с помощью unit тестов. Также у нас есть возможность добавить apollo в те проекты где нам не нужен jQuery и это здорово, небольшого модуля будет вполне достаточно.</p> <h2><b>Управление зависимостями: AMD и CommonJS</b></h2> <p>Концепция модулей не является чем-то новым, мы используем их всё время. Вы скорее всего знаете, что JavaScript работает на данный момент не только в браузерах, он может быть выполнен на сервере, даже на телевизоре.</p> <p>Какие паттерны мы можем применить при создании новых модулей? И где мы можем их использовать? Существуют два подхода под названием "AMD" и "CommonJS", давайте разберём их ниже.</p> <h3>AMD</h3> <p>Асинхронное определение модуля (Asynchronous Module Definition AMD) - JavaScript API для определения модуля, который будет загружаться ассинхронно, чаще всего это используется в браузере, так как синхронная загрузка плоха для производительности, также как и для юзабилити, выявления ошибок и обладает проблемами при использовании разных доменов. AMD улучшает процесс разработки, при этом модули будут инкапсулированы в множестве различных файлов.</p> <p>AMD использует функцию под названием <code class="inline">define</code>, которая определяет сам модуль и экспортирует объекты. Используя AMD, мы можем также ссылаться на разные зависимости для импорта других модулей. Небольшой пример взятый с проекта AMD на GitHub.</p> <pre class="brush: javascript noskimlinks noskimwords">define([‘alpha’], function (alpha) {  return {    verb: function () {      return alpha.verb() + 2;    }  };});</pre> <p>Мы можем сделать то же самое для apollo, на тот случай если будем применять подход AMD:</p> <pre class="brush: javascript noskimlinks noskimwords">define([‘apollo’], function (alpha) {  var apollo = {};    var hasClass, addClass, removeClass, toggleClass;        if ("classList" in document.documentElement) {        hasClass = function () {            return elem.classList.contains(className);        };        addClass = function (elem, className) {            elem.classList.add(className);        };        removeClass = function (elem, className) {            elem.classList.remove(className);        };        toggleClass = function (elem, className) {            elem.classList.toggle(className);        };    } else {        hasClass = function (elem, className) {            return new RegExp("(^|\s)" + className + "(\s|$)").test(elem.className);        };        addClass = function (elem, className) {            if (!hasClass(elem, className)) {                elem.className += (elem.className ? " " : "") + className;            }        };        removeClass = function (elem, className) {            if (hasClass(elem, className)) {                elem.className = elem.className.replace(new RegExp("(^|\s)*" + className + "(\s|$)*", "g"), "");            }        };        toggleClass = function (elem, className) {            (hasClass(elem, className) ? removeClass : addClass)(elem, className);        };    }        apollo.hasClass = hasClass;    apollo.addClass = addClass;    apollo.removeClass = removeClass;    apollo.toggleClass = toggleClass;        window.apollo = apollo;});</pre> <h3>CommonJS</h3> <p>Node.js стал невероятно популярен за последние годы, также как паттерны и инструменты для управление зависимостями. При работе с Node.js применяется подход под названием CommonJS, который использует объект "exports", где описывается функционал модуля. Самая простая реализация CommonJS может выглядеть примерно так (идея "экспортирования" чего-то, что может быть использовано в другом месте):</p> <pre class="brush: javascript noskimlinks noskimwords">// someModule.jsexports.someModule = function () {  return "foo";};</pre> <p>Код этого модуля будет находиться в отдельном файле, я называл его <code class="inline">someModule.js</code>. Чтобы импортировать и использовать его где-либо, CommonJS подразумевает применение функции "require" для получения отдельных зависимостей:</p> <pre class="brush: javascript noskimlinks noskimwords">// do something with `myModule`var myModule = require(‘someModule’);</pre> <p>Если вам доводилось работать с Grunt или Gulp, вы скорее всего знакомы с данным паттерном.</p> <p>Чтобы воспользоваться подобным паттерном в apollo, мы будем ссылаться на объект <code class="inline">exports</code> вместо window (посмотрите на последнюю строку <code class="inline">exports.apollo = apollo</code>):</p> <pre class="brush: javascript noskimlinks noskimwords">(function () {        var apollo = {};    var hasClass, addClass, removeClass, toggleClass;        if ("classList" in document.documentElement) {        hasClass = function () {            return elem.classList.contains(className);        };        addClass = function (elem, className) {            elem.classList.add(className);        };        removeClass = function (elem, className) {            elem.classList.remove(className);        };        toggleClass = function (elem, className) {            elem.classList.toggle(className);        };    } else {        hasClass = function (elem, className) {            return new RegExp("(^|\s)" + className + "(\s|$)").test(elem.className);        };        addClass = function (elem, className) {            if (!hasClass(elem, className)) {                elem.className += (elem.className ? " " : "") + className;            }        };        removeClass = function (elem, className) {            if (hasClass(elem, className)) {                elem.className = elem.className.replace(new RegExp("(^|\s)*" + className + "(\s|$)*", "g"), "");            }        };        toggleClass = function (elem, className) {            (hasClass(elem, className) ? removeClass : addClass)(elem, className);        };    }        apollo.hasClass = hasClass;    apollo.addClass = addClass;    apollo.removeClass = removeClass;    apollo.toggleClass = toggleClass;        exports.apollo = apollo;    })();</pre> <h2>Universal Module Definition (UMD)</h2> <p>AMD и CommonJS - замечательные способы, но что если мы хотим создать модуль, который будет работать в любой среде: AMD, CommonJS, а также в браузере?</p> <p>Изначально, для этого использовались хитрости с <code class="inline">if</code> и <code class="inline">else</code>, чтобы передать функцию для каждого типа, мы пытались определить имеется-ли поддержка AMD или CommonJS. Эта идея затем была адаптирована и теперь в нашем распоряжении есть универсальное решение, под названием "<span>UMD</span>". Хитрость с <code class="inline">if/else</code> уже реализована и нам остаётся лишь передать одну функцию в качестве ссылки для каждого типа модуля, который поддерживается, вот вам пример из репозитория этого проекта:</p> <pre class="brush: javascript noskimlinks noskimwords">(function (root, factory) {    if (typeof define === "function" &amp;&amp; define.amd) {        // AMD. Register as an anonymous module.        define(["b"], factory);    } else {        // Browser globals        root.amdWeb = factory(root.b);    }}(this, function (b) {    //use b in some fashion.    // Just return a value to define the module export.    // This example returns an object, but the module    // can return a function as the exported value.    return {};}));</pre> <p>Да, много чего происходит в этом примере. Мы передаём передаём функцию, как второй аргумент IIFE блоку, который в качестве локальной переменной <code class="inline">factory</code> динамически используется как AMD или глобально в браузере. И да, здесь нет поддержки CommonJS. Однако мы можем добавить её (убрав комментарии):</p> <pre class="brush: javascript noskimlinks noskimwords">(function (root, factory) {    if (typeof define === "function" &amp;&amp; define.amd) {        define(["b"], factory);    } else if (typeof exports === "object") {        module.exports = factory;    } else {        root.amdWeb = factory(root.b);    }}(this, function (b) {    return {};}));</pre> <p>Всё волшебство в этой строке - <code class="inline">module.exports = factory</code>, которая определяет нашу factory, как CommonJS.</p> <p>Давайте подытожим, теперь apollo в UMD стиле, может быть запущен в среде CommonJS, AMD и браузере! Я добавил полный скрипт apollo, последнюю версии на GitHub, так что выглядеть это будет немного сложнее, чем пример выше (некоторых новых функций нет в предыдущих примерах):</p> <pre class="brush: javascript noskimlinks noskimwords">/*! apollo.js v1.7.0 | (c) 2014 @toddmotto | https://github.com/toddmotto/apollo */(function (root, factory) {  if (typeof define === "function" &amp;&amp; define.amd) {    define(factory);  } else if (typeof exports === "object") {    module.exports = factory;  } else {    root.apollo = factory();  }})(this, function () {  "use strict";  var apollo = {};  var hasClass, addClass, removeClass, toggleClass;  var forEach = function (items, fn) {    if (Object.prototype.toString.call(items) !== "[object Array]") {      items = items.split(" ");    }    for (var i = 0; i &lt; items.length; i++) {      fn(items[i], i);    }  };  if ("classList" in document.documentElement) {    hasClass = function (elem, className) {      return elem.classList.contains(className);    };    addClass = function (elem, className) {      elem.classList.add(className);    };    removeClass = function (elem, className) {      elem.classList.remove(className);    };    toggleClass = function (elem, className) {      elem.classList.toggle(className);    };  } else {    hasClass = function (elem, className) {      return new RegExp("(^|\s)" + className + "(\s|$)").test(elem.className);    };    addClass = function (elem, className) {      if (!hasClass(elem, className)) {        elem.className += (elem.className ? " " : "") + className;      }    };    removeClass = function (elem, className) {      if (hasClass(elem, className)) {        elem.className = elem.className.replace(new RegExp("(^|\s)*" + className + "(\s|$)*", "g"), "");      }    };    toggleClass = function (elem, className) {      (hasClass(elem, className) ? removeClass : addClass)(elem, className);    };  }  apollo.hasClass = function (elem, className) {    return hasClass(elem, className);  };  apollo.addClass = function (elem, classes) {    forEach(classes, function (className) {      addClass(elem, className);    });  };  apollo.removeClass = function (elem, classes) {    forEach(classes, function (className) {      removeClass(elem, className);    });  };  apollo.toggleClass = function (elem, classes) {    forEach(classes, function (className) {      toggleClass(elem, className);    });  };  return apollo;});</pre> <p>Мы создали и упаковали наш модуль для работы в различных средах исполнения, это даёт нам огромную гибкость, при добавлении новых зависимостей в наши проекты - что-то, что не может предоставить JavaScript библиотека, разделив это на несколько кусочков с определённым функционалом.</p> <h2>Тестирование</h2> <p>Обычно, наши модули должны проходить unit тесты - небольшие тесты, которые позволят новым разработчикам присоединиться к нашему проекту и отправлять pull request"ы для улучшения различных функций, тем самым тесты сильно упростят им задачу и позволят выработать свою систему при создании библиотеки! На обновление большой библиотеки обычно уходит больше времени, нежели обновление маленького модуля, так как это займёт больше времени, потребует отладки ошибок и добавления нового функционала.</p> <h2>Заключение </h2> <p>Было здорово - создать свой собственный модуль, который смогут использовать другие разработчики и который будет способен работать в различных средах выполнения. Такой подход разработки довольно интересен, позволяет нам лучше понять инструменты, которые мы используем, и в итоге мы получаем код, который легко поддерживать. Для каждого модуля существует документация, тем самым мы можем быстро интегрировать их в наш проект. Если модуль вам не подходит, можно найти другой или написать свой собственный, добиться такого сложно при использовании большой библиотеки, в качестве зависимости, мы не хотим всё осложнять и быть привязанными к одному - единственному решению.</p> <h2>Бонус: модули ES6</h2> <p>Перед тем, как закончить, хотелось бы упомянуть, не кажется-ли вам, что это замечательно, как JavaScript библиотеки оказали влияние на нативный язык, к примеру взаимодействие с классами? С ES6 (следующим поколением языка JavaScript) вас ждёт много нового! В нашем распоряжении есть нативные импорты и экспорты (imports, exports)!</p> <p>Посмотрите, как можно экспортировать модуль:</p> <pre class="brush: javascript noskimlinks noskimwords">/// myModule.jsfunction myModule () {  // module content}export myModule;</pre> <p>И импортировать:</p> <pre class="brush: javascript noskimlinks noskimwords">import {myModule} from ‘myModule’;</pre> <p>Вы можете узнать больше о ES6 и модулях, ознакомившись со <span>следующей спецификацией</span>.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="JavaScript" href="https://norma-studio.github.io/article5/220825497-moduli--buduschee-javascript-bibliotek" class="tm-article-body__tags-item-link">JavaScript</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
39032</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
308</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
