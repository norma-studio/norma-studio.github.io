
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Возможно, вы использовали NodeJS в качестве веб-сервера, но знаете ли вы, что вы также можете использовать его для веб-скрапинга? В этом уроке мы рассмотрим, как можно получить содержимое статических веб-страниц а так же рассмотрим эти надоедливые страницы с динамическим контентом, - все это с помощью NodeJS и нескольких полезных модулей NPM....">
<meta property="og:description" content="Возможно, вы использовали NodeJS в качестве веб-сервера, но знаете ли вы, что вы также можете использовать его для веб-скрапинга? В этом уроке мы рассмотрим, как можно получить содержимое статических веб-страниц а так же рассмотрим эти надоедливые страницы с динамическим контентом, - все это с помощью NodeJS и нескольких полезных модулей NPM....">
<meta name="twitter:description" content="Возможно, вы использовали NodeJS в качестве веб-сервера, но знаете ли вы, что вы также можете использовать его для веб-скрапинга? В этом уроке мы рассмотрим, как можно получить содержимое статических веб-страниц а так же рассмотрим эти надоедливые страницы с динамическим контентом, - все это с помощью NodeJS и нескольких полезных модулей NPM....">
<meta property="aiturec:description" content="Возможно, вы использовали NodeJS в качестве веб-сервера, но знаете ли вы, что вы также можете использовать его для веб-скрапинга? В этом уроке мы рассмотрим, как можно получить содержимое статических веб-страниц а так же рассмотрим эти надоедливые страницы с динамическим контентом, - все это с помощью NodeJS и нескольких полезных модулей NPM....">
<meta property="og:image" content="//www.gravatar.com/avatar/39416e8a4f8a9c9677a0a67da51f2207?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="aiturec:image" content="//www.gravatar.com/avatar/39416e8a4f8a9c9677a0a67da51f2207?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta name="twitter:image" content="//www.gravatar.com/avatar/39416e8a4f8a9c9677a0a67da51f2207?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="vk:image" content="//www.gravatar.com/avatar/39416e8a4f8a9c9677a0a67da51f2207?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:type" content="article">
<link image_src="image" href="//www.gravatar.com/avatar/39416e8a4f8a9c9677a0a67da51f2207?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html" title="Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io" title="Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/63456435436.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html" class="tm-user-info__username" title="
М. Старостенко" aria-label="
М. Старостенко">
М. Старостенко</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Делаем снимки экрана с помощью Node.js...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs" class="tm-article-snippet__hubs-item-link"><span>Web Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs.html" />
    <link itemprop="image" href="//www.gravatar.com/avatar/39416e8a4f8a9c9677a0a67da51f2207?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
    <meta itemprop="headline name" content="Делаем снимки экрана с помощью Node.js... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Возможно, вы использовали NodeJS в качестве веб-сервера, но знаете ли вы, что вы также можете использовать его для веб-скрапинга? В этом уроке мы рассмотрим, как можно получить содержимое статических веб-страниц а так же рассмотрим эти надоедливые страницы с динамическим контентом, - все это с помощью NodeJS и нескольких полезных модулей NPM....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Возможно, вы использовали NodeJS в качестве веб-сервера, но знаете ли вы, что вы также можете использовать его для веб-скрапинга? В этом уроке мы рассмотрим, как можно получить содержимое статических веб-страниц а так же рассмотрим эти надоедливые страницы с динамическим контентом, - все это с помощью NodeJS и нескольких полезных модулей NPM....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Возможно, вы использовали NodeJS в качестве веб-сервера, но знаете ли вы, что вы также можете использовать его для веб-скрапинга? В этом уроке мы рассмотрим, как можно получить содержимое статических веб-страниц а так же рассмотрим эти надоедливые страницы с динамическим контентом, - все это с помощью NodeJS и нескольких полезных модулей NPM.</p><p><!--more--></p> <hr><hr><h2>Немного о веб-скрапинге</h2> <p>Веб-скрапинг всегда имел негативный оттенок в мире веб-разработки - и не зря. В современной разработке API-интерфейсы доступны для большинства популярных сервисов, и для извлечения данных следует использовать их, а не для веб-скрапинг. Проблема проблема скрапинга заключается в том, что он опирается на визуальную структуру страницы. Всякий раз, когда этот HTML изменяется, независимо от того, насколько малым может оказаться это изменение, оно может полностью сломать ваш код.</p> <p>Несмотря на эти недостатки, важно немного узнать о веб-скрапинге и некоторых инструментах, доступных для решения этой задачи. Когда сайт не раскрывает API или какой-либо канал для получения данных (RSS / Atom и т.д.), единственный вариант, с которым мы остались, чтобы получить нужны контент ... скрапинг. </p> <blockquote> <p>Примечание. Если вы не можете получить необходимую информацию через API или фид, это хороший признак того, что владелец не хочет, чтобы эта информация была доступна. Однако есть исключения.</p> </blockquote> <hr><h2>Зачем использовать NodeJS?</h2> <p>Скраперы могут быть написаны на любом языке. Причина, по которой мне нравится использовать Node, связана с его асинхронным характером, а это значит, что мой код не блокируется в любой момент процесса. Я хорошо знаком с JavaScript, так что это дополнительный бонус. Наконец, есть несколько новых модулей, которые были написаны для NodeJS, что позволяет легко и надежно скрапить веб-сайты  (ну, так надежно на сколько вообще скрапинг это позволяет!). Давайте начнем!</p> <hr><h2>Простой скрапинг с помощью YQL</h2> <p>Начнем с простого использования: статические веб-страницы. Это стандартные веб-страницы. Для них <span>Yahoo! Язык запросов</span> (YQL) должен хорошо работать Для тех, кто не знаком с YQL, это синтаксис типа SQL, который можно использовать для совместной работы с различными API.</p> <p>В YQL есть несколько отличных таблиц, которые помогут разработчикам получить HTML с страницы. Я хочу выделить:</p> <ul><li><span>html</span></li> <li><span>data.html.cssselect</span></li> <li><span>htmlstring</span></li> </ul><p>Давайте рассмотрим каждую из них и посмотрим, как их реализовать в NodeJS.</p> <h3> таблица <strong><em>html</em></strong></h3> <p>Таблица <strong><em>html</em></strong> - это самый простой способ получить HTML из URL-адреса. Обычный запрос с использованием этой таблицы выглядит следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">select * from html where url="http://finance.yahoo.com/q?s=yhoo" and xpath="//div[@id="yfi_headlines"]/div[2]/ul/li/a"</pre> <p>Этот запрос состоит из двух параметров: «url» и «xpath». Этот URL не требует пояснений. XPath состоит из строки XPath, указывающей YQL, какой раздел HTML должен быть возвращен. Попробуйте выполнить этот запрос <span>здесь</span>. </p> <p>Дополнительные параметры, которые вы можете использовать, включают в себя <code>browser</code> (boolean), <code>charset</code> (string) и <code>compat</code> (string). Мне не пришлось использовать эти параметры, но обратитесь к документации, если вам они оказались нужны.</p> <h4>Неудобно с XPath?</h4> <p>К сожалению, XPath не очень популярный способ обхода древовидной структуры HTML. Он может быть сложным для чтения и написания для новичков. </p> <p>Давайте посмотрим на следующую таблицу, которая делает то же самое, но позволяет вместо этого использовать CSS</p> <h3> Таблица <strong><em>данных.html.cssselect</em></strong></h3> <p>Таблица <strong><em>data.html.cssselect</em></strong> - это мой предпочтительный способ скрапинга HTML со страницы. Он работает так же, как и таблица <strong><em>html</em></strong>, но позволяет использовать CSS вместо XPath. На практике под капотом эта таблица просто преобразует CSS в XPath, а затем вызывает <strong><em>html</em></strong>-таблицу, поэтому она немного медленнее. Для нужд скрапинга разница должна быть незначительной.</p> <p>Обычный запрос с использованием этой таблицы выглядит так:</p> <pre class="brush: js noskimlinks noskimwords">select * from data.html.cssselect where url="www.yahoo.com" and css="#news a"</pre> <p>Как вы можете видеть, он намного чище. Я рекомендую сначала попробовать этот метод, когда вы пытаетесь скрапить HTML с помощью YQL. Попробуйте этот запрос <span>здесь</span>.</p> <h3> Таблица <strong><em>htmlstring</em></strong></h3> <p>Таблица <strong><em>htmlstring</em></strong> полезна для случаев, когда вы пытаетесь очистить большой фрагмент форматированного текста с веб-страницы.</p> <p>Использование этой таблицы позволяет получить весь HTML-контент этой страницы в одной строке, а не как JSON, который разбит на основе структуры DOM. </p> <p>Например, простой ответ JSON, который скрапит тег <code>&lt;a&gt;</code>, выглядит следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">"results": {   "a": {     "href": "...",     "target": "_blank",     "content": "Apple Chief Executive Cook To Climb on a New Stage"    } }</pre> <p>Посмотрите, как атрибуты определяются как свойства? Вместо этого ответ из таблицы <strong><em>htmlstring</em></strong> будет выглядеть так:</p> <pre class="brush: js noskimlinks noskimwords">"results": {  "result": {    "&lt;a href=\"…\" target="_blank"&gt;Apple Chief Executive Cook To Climb on a New Stage&lt;/a&gt;   }}</pre> <p>Итак, зачем вы это используете? Ну, по моему опыту, это очень полезно, когда вы пытаетесь очистить большое количество форматированного текста. Например, рассмотрим следующий фрагмент:</p> <pre class="brush: html noskimlinks noskimwords">&lt;p&gt;Lorem ipsum &lt;strong&gt;dolor sit amet&lt;/strong&gt;, consectetur adipiscing elit.&lt;/p&gt;&lt;p&gt;Proin nec diam magna. Sed non lorem a nisi porttitor pharetra et non arcu.&lt;/p&gt;</pre> <p>Используя таблицу <strong><em>htmlstring</em></strong>, вы можете получить этот HTML как строку и использовать regex для удаления тегов HTML. Это более простая задача, чем итерация через JSON, которая была разделена на свойства и дочерние объекты на основе структуры DOM страницы.</p> <hr><h2>Использование YQL с NodeJS</h2> <p>Теперь, когда мы немного знаем о некоторых таблицах, доступных нам в YQL, давайте внедрим веб-скребок с использованием YQL и NodeJS. К счастью, это очень просто, благодаря модулю node-yql от Derek Gathright.</p> <p>Мы можем установить модуль с помощью <code>npm</code>:</p> <pre class="brush: text noskimlinks noskimwords">npm install yql</pre> <p>Модуль чрезвычайно прост и состоит только из одного метода: метода <code>YQL.exec()</code>. Он определяется как следующее:</p> <pre class="brush: text noskimlinks noskimwords">function exec (string query [, function callback] [, object params] [, object httpOptions])</pre> <p>Мы можем использовать его, заинклюдив и вызывая <code>YQL.exec()</code>. Например, допустим, мы хотим очистить заголовки от всех сообщений на главной странице Nettuts:</p> <pre class="brush: js noskimlinks noskimwords">var YQL = require("yql");new YQL.exec("select * from data.html.cssselect where url="http://net.tutsplus.com/" and css=".post_title a"", function(response) {    //response consists of JSON that you can parse});</pre> <p>Самое замечательное в YQL - это способность тестировать ваши запросы и определять, какой JSON вы возвращаете в режиме реального времени. Перейдите на <span>консоль</span>, чтобы попробовать этот запрос, или нажмите <span>здесь</span>, чтобы увидеть сырой JSON.</p> <p>Объекты <code>params</code> и <code>httpOptions</code> являются необязательными. Параметры могут содержать такие свойства, как <code>env</code> (независимо от того, используете ли вы конкретную среду для таблиц) и <code>format</code> (xml или json). Все свойства, переданные в <code>params</code>, кодируются в URI и добавляются к строке запроса. Объект <code>httpOptions</code> передается в заголовок запроса. Здесь вы можете указать, хотите ли вы включить например SSL. </p> <p>Файл JavaScript с именем <code>yqlServer.js</code> содержит минимальный код, необходимый для скрапинга с помощью YQL. Вы можете запустить его, выполнив следующую команду в своем терминале:</p> <pre class="brush: text noskimlinks noskimwords">node yqlServer.js</pre> <h3>Исключения и другие известные инструменты</h3> <p>YQL - мой предпочтительный выбор для скрапинга содержимого от статических веб-страниц, потому что он легко читается и прост в использовании. Тем не менее, YQL завершится с ошибкой, если на рассматриваемой веб-странице есть файл r<code>obots.txt</code>, который отрицает ответ на него. В этом случае вы можете посмотреть некоторые из упомянутых ниже утилит или использовать PhantomJS, который мы рассмотрим в следующем разделе.</p> <p><span>Node.io</span> - полезная утилита Node, специально предназначенная для скрапинга данных. Вы можете создавать задания, которые принимают входные данные, обрабатывают их и возвращают некоторый вывод. Node.io хорошо просматривается на Github, и у там есть несколько полезных примеров, которые помогут вам начать.</p> <p><span>JSDOM</span> - очень популярный проект, который реализует W3C DOM в JavaScript. По предоставленному HTML он может построить DOM, с которым вы можете взаимодействовать. Ознакомьтесь с документацией, чтобы узнать, как вы можете использовать JSDOM и любую JS-библиотеку (например, jQuery) совместно для скрапинга данных с веб-страниц.</p> <hr><h2>Скрапинг страниц с динамическим контентом</h2> <p>До сих пор мы рассмотрели некоторые инструменты, которые могут помочь нам в скрапинге веб-страницы со статическим контентом. С YQL это относительно легко. К сожалению, нам часто предоставляют страницы, содержащие контент, который динамически загружается с помощью JavaScript. В этих случаях страница часто изначально пуста, а затем уже добавляется содержимое. Как мы можем решить эту проблему? </p> <h3>Пример</h3> <p>Позвольте мне привести пример того, что я имею в виду; я загрузил простой HTML-файл на свой собственный сайт, который добавляет некоторый контент через JavaScript через две секунды после события <code>document.ready()</code> вызывается функция. Вы можете посмотреть страницу <span>здесь</span>. Вот как выглядит исходный код:</p> <pre class="brush: html noskimlinks noskimwords">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;Test Page with content appended after page load&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        Content on this page is appended to the DOM after the page is loaded.        &lt;div id="content"&gt;        &lt;/div&gt;    &lt;script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"&gt;&lt;/script&gt;    &lt;script&gt;        $(document).ready(function() {            setTimeout(function() {                $("#content").append("&lt;h2&gt;Article 1&lt;/h2&gt;&lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&lt;/p&gt;&lt;h2&gt;Article 2&lt;/h2&gt;&lt;p&gt;Ut sed nulla turpis, in faucibus ante. Vivamus ut malesuada est. Curabitur vel enim eget purus pharetra tempor id in tellus.&lt;/p&gt;&lt;h2&gt;Article 3&lt;/h2&gt;&lt;p&gt;Curabitur euismod hendrerit quam ut euismod. Ut leo sem, viverra nec gravida nec, tristique nec arcu.&lt;/p&gt;");            }, 2000);        });    &lt;/script&gt;    &lt;/body&gt;&lt;/html&gt;</pre> <p>Теперь давайте попробуем получить текст внутри <code>&lt;div id="content"&gt;</code> с помощью YQL. </p> <pre class="brush: js noskimlinks noskimwords">var YQL = require("yql");new YQL.exec("select * from data.html.cssselect where url="http://tilomitra.com/repository/screenscrape/ajax.html" and css="#content"", function(response) {    //This will return undefined! The scraping was unsuccessful!    console.log(response.results);});</pre> <p>Вы заметите, что YQL возвращает <code>undefined</code>, потому что, когда страница загружается, <code>&lt;div id = "content"&gt;</code> пуст. Содержимое еще не добавлено. Вы можете попробовать запрос для себя <span>здесь</span>.</p> <p>Давайте посмотрим, как мы можем обойти эту проблему!</p> <h3>Встречаем PhantomJS</h3> <blockquote class="pullquote"><p>PhantomJS может загружать веб-страницы и имитировать браузер на основе Webkit без графического интерфейса.</p></blockquote> <p>Мой предпочтительный метод получения информации с таких сайтов - использовать <span>PhantomJS</span>. PhantomJS описывает себя как «headless Webkit с JavaScript API». В упрощенном виде это означает, что PhantomJS может загружать веб-страницы и имитировать браузер на основе Webkit без использования графического интерфейса. В качестве разработчика мы можем вызвать специальные методы, которые PhantomJS предоставляет для выполнения кода на странице. Поскольку он ведет себя как браузер, скрипты на веб-странице выполняются так же, как в обычном браузере. </p> <p>Чтобы получить данные с нашей страницы, мы собираемся использовать <span>PhantomJS-Node</span>, отличный небольшой проект с открытым исходным кодом, который соединяет PhantomJS с NodeJS. Под капотом этот модуль запускает PhantomJS как дочерний процесс.</p> <h4>Установка PhantomJS</h4> <p>Прежде чем вы сможете установить npm модуль <span>PhantomJS-Node</span>, вы должны установить PhantomJS. Тем не менее, установка и сборка PhantomJS может быть немного сложной.</p> <p>Сначала перейдите на <span>PhantomJS.org</span> и загрузите соответствующую версию для своей операционной системы. В моем случае это Mac OSX. </p> <p>После загрузки разархивируйте его где-нибудь, например <code>/Applications/</code>. Затем вам нужно добавить его в свой <code>PATH</code>:</p> <pre class="brush: text noskimlinks noskimwords">sudo ln -s /Applications/phantomjs-1.5.0/bin/phantomjs /usr/local/bin/</pre> <p>Замените <code>1.5.0</code> на загруженную вами версию PhantomJS. Имейте в виду, что не все системы будут иметь путь <code>/usr/local/bin/</code>. Некоторые системы будут иметь: <code>/usr/bin/</code>, <code>/bin/</code> или <code>usr/X11/bin</code>.</p> <p>Для пользователей Windows ознакомьтесь с <span>кратким учебником</span>. Чтобы понять что все настроено, откройте терминал и введите <code>phantomjs</code>, и если вы не получаете никаких ошибок, то можно двигаться дальше.</p> <p>Если вам неудобно редактировать <code>PATH</code>, обратите внимание на то, где вы распаковывали PhantomJS, и я покажу еще один способ его настройки в следующем разделе, хотя я рекомендую вам всетаки отредактировать свой <code>PATH</code>.</p> <h4>Установка PhantomJS-Node</h4> <p>Настройка PhantomJS-Node будет намного проще. Если у вас установлен NodeJS, вы можете установить его через npm:</p> <pre class="brush: text noskimlinks noskimwords">npm install phantom</pre> <p>Если вы не изменили свой <code>PATH</code> на предыдущем шаге при установке PhantomJS, вы можете перейти в каталог <code>phantom/</code> и отредактировать эту строку в <code>phantom.js</code>. </p> <pre class="brush: text noskimlinks noskimwords">ps = child.spawn("phantomjs", args.concat([__dirname + "/shim.js", port]));</pre> <p>Измените путь:</p> <pre class="brush: text noskimlinks noskimwords">ps = child.spawn("/path/to/phantomjs-1.5.0/bin/phantomjs", args.concat([__dirname + "/shim.js", port]));</pre> <p>Как только это будет сделано, вы можете проверить все, запустив этот код:</p> <pre class="brush: js noskimlinks noskimwords">var phantom = require("phantom");phantom.create(function(ph) {  return ph.createPage(function(page) {    return page.open("http://www.google.com", function(status) {      console.log("opened google? ", status);      return page.evaluate((function() {        return document.title;      }), function(result) {        console.log("Page title is " + result);        return ph.exit();      });    });  });});</pre> <p>Запуск его из командной строки, он должен вызвать следующее:</p> <pre class="brush: text noskimlinks noskimwords">opened google?  successPage title is Google</pre> <p>Если у вас есть это, вы готовы к работе. Если нет, оставьте свой комментарий, и я постараюсь вам помочь!</p> <h4>Использование PhantomJS-Node</h4> <p>Чтобы вам было проще, я включил JS-файл под названием <code>phantomServer.js</code>, который использует некоторые API PhantomJS для загрузки веб-страницы. Он ждет 5 секунд перед тем, как выполнить JavaScript, который скрапит страницу. Вы можете запустить его, перейдя в каталог и вызвав следующую команду в своем терминале:</p> <pre class="brush: text noskimlinks noskimwords">node phantomServer.js</pre> <p>Я сейчас опишу как это все работает. Во-первых, нам требуется PhantomJS:</p> <pre class="brush: js noskimlinks noskimwords">var phantom = require("phantom");</pre> <p>Затем мы реализуем некоторые методы из <span>API</span>. А именно, мы создаем экземпляр страницы, а затем вызываем метод <code>open()</code>:</p> <pre class="brush: js noskimlinks noskimwords">phantom.create(function(ph) {  return ph.createPage(function(page) {    //From here on in, we can use PhantomJS" API methods    return page.open("http://tilomitra.com/repository/screenscrape/ajax.html",          function(status) {            //The page is now open                  console.log("opened site? ", status);        });    });});</pre> <p>После того, как страница будет открыта, мы можем добавить JavaScript на страницу. Давайте введем jQuery через <code>page.injectJs()</code> метод:</p> <pre class="brush: js noskimlinks noskimwords">phantom.create(function(ph) {  return ph.createPage(function(page) {    return page.open("http://tilomitra.com/repository/screenscrape/ajax.html", function(status) {      console.log("opened site? ", status);                     page.injectJs("http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js", function() {                //jQuery Loaded                //We can use things like $("body").html() in here.            });    });  });});</pre> <p>jQuery теперь загружен, но мы не знаем, загружен ли динамический контент на странице. Чтобы учесть это, я обычно добавляю код своего скрапера внутри функции <code>setTimeout()</code>, которая выполняется через определенный промежуток времени. Если вы хотите более динамичное решение,<span> PhantomJS API</span> позволяет слушать и эмулировать определенные события. Простой пример:</p> <pre class="brush: js noskimlinks noskimwords">setTimeout(function() {    return page.evaluate(function() {        //Get what you want from the page using jQuery.         //A good way is to populate an object with all the jQuery commands that you need and then return the object.        var h2Arr = [], //array that holds all html for h2 elements        pArr = []; //array that holds all html for p elements        //Populate the two arrays        $("h2").each(function() {            h2Arr.push($(this).html());        });        $("p").each(function() {            pArr.push($(this).html());        });        //Return this data        return {            h2: h2Arr,            p: pArr        }    }, function(result) {        console.log(result); //Log out the data.        ph.exit();    });}, 5000);</pre> <p>Объединив все это, наш файл <code>phantomServer.js</code> выглядит так:</p> <pre class="brush: js noskimlinks noskimwords">var phantom = require("phantom");phantom.create(function(ph) {  return ph.createPage(function(page) {    return page.open("http://tilomitra.com/repository/screenscrape/ajax.html", function(status) {      console.log("opened site? ", status);                     page.injectJs("http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js", function() {                //jQuery Loaded.                //Wait for a bit for AJAX content to load on the page. Here, we are waiting 5 seconds.                setTimeout(function() {                    return page.evaluate(function() {                        //Get what you want from the page using jQuery. A good way is to populate an object with all the jQuery commands that you need and then return the object.                        var h2Arr = [],                        pArr = [];                        $("h2").each(function() {                            h2Arr.push($(this).html());                        });                        $("p").each(function() {                            pArr.push($(this).html());                        });                        return {                            h2: h2Arr,                            p: pArr                        };                    }, function(result) {                        console.log(result);                        ph.exit();                    });                }, 5000);            });    });    });});</pre> <p>Эта реализация немного грубовата и дезорганизована, но она работает. Используя PhantomJS, мы можем скрапить страницу с динамическим контентом! На консоли должна выводиться следующая информация:</p> <pre class="brush: text noskimlinks noskimwords">→ node phantomServer.jsopened site?  success{ h2: [ "Article 1", "Article 2", "Article 3" ],  p:    [ "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",     "Ut sed nulla turpis, in faucibus ante. Vivamus ut malesuada est. Curabitur vel enim eget purus pharetra tempor id in tellus.",     "Curabitur euismod hendrerit quam ut euismod. Ut leo sem, viverra nec gravida nec, tristique nec arcu." ] }</pre> <hr><h2>Заключение</h2> <p>В этом уроке мы рассмотрели два разных способа выполнения веб-скрапинга. Если вы делаете скрапинг со статической веб-страницы, мы можем воспользоваться YQL, который легко настроить и использовать. С другой стороны, для динамических сайтов мы можем использовать PhantomJS. Его немного сложнее настроить, но он предоставляет куда больше возможностей Помните: вы можете также использовать PhantomJS и для статических сайтов!</p> <p>Если у вас есть вопросы по этой теме, не стесняйтесь спрашивать ниже, и я сделаю все возможное, чтобы помочь вам.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825637-delaem-snimki-ekrana-s-pomoschyu-nodejs" class="tm-article-body__tags-item-link">Web Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40332</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
626</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
