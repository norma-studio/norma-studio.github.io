
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Широкомасштабные распределенные системы, состоящие из нескольких взаимодействующих сервисов, становятся все более важными. Эти системы работают на кластерах сотен, тысяч и более серверов. Разработка, развертывание и обслуживание этих систем эффективно и экономично требует серьезного -порядка....">
<meta property="og:description" content="Широкомасштабные распределенные системы, состоящие из нескольких взаимодействующих сервисов, становятся все более важными. Эти системы работают на кластерах сотен, тысяч и более серверов. Разработка, развертывание и обслуживание этих систем эффективно и экономично требует серьезного -порядка....">
<meta name="twitter:description" content="Широкомасштабные распределенные системы, состоящие из нескольких взаимодействующих сервисов, становятся все более важными. Эти системы работают на кластерах сотен, тысяч и более серверов. Разработка, развертывание и обслуживание этих систем эффективно и экономично требует серьезного -порядка....">
<meta property="aiturec:description" content="Широкомасштабные распределенные системы, состоящие из нескольких взаимодействующих сервисов, становятся все более важными. Эти системы работают на кластерах сотен, тысяч и более серверов. Разработка, развертывание и обслуживание этих систем эффективно и экономично требует серьезного -порядка....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html" title="Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io" title="Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533jfgfsfxcv.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html" class="tm-user-info__username" title="
О. Гуськов" aria-label="
О. Гуськов">
О. Гуськов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Введение в Докер и-Кубернетес...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Docker" href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes" class="tm-article-snippet__hubs-item-link"><span>Docker</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
    <meta itemprop="headline name" content="Введение в Докер и-Кубернетес... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Широкомасштабные распределенные системы, состоящие из нескольких взаимодействующих сервисов, становятся все более важными. Эти системы работают на кластерах сотен, тысяч и более серверов. Разработка, развертывание и обслуживание этих систем эффективно и экономично требует серьезного -порядка....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Широкомасштабные распределенные системы, состоящие из нескольких взаимодействующих сервисов, становятся все более важными. Эти системы работают на кластерах сотен, тысяч и более серверов. Разработка, развертывание и обслуживание этих систем эффективно и экономично требует серьезного -порядка....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Широкомасштабные распределенные системы, состоящие из нескольких взаимодействующих сервисов, становятся все более важными. Эти системы работают на кластерах сотен, тысяч и более серверов. Разработка, развертывание и обслуживание этих систем эффективно и экономично требует серьезного  порядка.</p><p>Виртуализация и, в последнее время, использование контейнеров позволяют гибко распределять ресурсы и управлять ими. Докер сделал контейнеризацию популярной. Ознакомьтесь с этой статьей Envato Tuts + для отличного введения: «<span>Руководство автостопом по Docker и Modulus</span>».</p> <p>Google уже много лет работает над огромным программным обеспечением и центрами обработки данных в контейнерах и накопила <em>большой</em> опыт и знания. Kubernetes - это проект Google с открытым исходным кодом, который передает все эти знания в массы.</p> <p>В этой статье я кратко исследую Докер, а затем глубоко погружаюсь в Кубернетес. Я буду использовать в качестве примера пример службы REST API Python 3. Приступим.</p> <h2>Служба цитат</h2> <p><span>Служба цитат</span> - это REST API, который позволяет добавлять цитаты и получать список всех цитат. Он реализован как веб-сервис Python 3, используя отличную библиотеку <span>hug</span>. Сервис предоставляет один ендпоинт /quotes. Вы можете получить все цитаты или опубликовать новую цитату. Давайте добавим несколько цитат:</p> <pre class="noskimlinks noskimwords">curl https://localhost:8000/quotes -d "quote=TV is chewing gum for the eyes. ~ Frank Lloyd Wright"curl http://localhost:8000/quotes -d "quote=It is better to die on your feet than live on your knees. ~ Emiliano Zapata"curl http://localhost:8000/quotes -d "quote=We must be very careful when we give advice to younger people: sometimes they follow it! ~ Edsger W. Dijkstra"</pre> <p>Если вы перейдете по ссылке <code class="inline">http://localhost:8000/quotes</code>, вы получите: [ "TV is chewing gum for the eyes. ~ Frank Lloyd Wright", "It<code class="inline"> is better to die on your feet than live on your knees. ~ Emiliano Zapata", "We must be very careful when we give advice to younger people: sometimes they follow it! ~ Edsger W. Dijkstra" ]</code> Если вы просто хотите просмотреть автогенерированную документацию HUG, перейдите по адресу: <code class="inline">http://localhost:8000</code></p> <pre class="noskimlinks noskimwords">{    "404": "The API call you tried to make was not defined. Here"s a definition of the API to help you get going :)",    "documentation": {        "/quotes": {            "GET": {                "examples": [                    "http://localhost:8000/quotes"                ],                "outputs": {                    "content_type": "application/json",                    "format": "JSON (Javascript Serialized Object Notation)"                }            },            "POST": {                "outputs": {                    "content_type": "application/json",                    "format": "JSON (Javascript Serialized Object Notation)"                },                "inputs": {                    "quote": {                        "type": "Basic text / string value"                    }                }            }        }    }}</pre> <h2>Основы Docker</h2> <p>Я не буду объяснять слишком много о Docker, а просто буду применять его в сервисе цитат.</p> <h3>Отправляем приложение Python в контейнер</h3> <p>Сначала нам нужен <span>Dockerfile</span>. Он выполняет следующие действия:</p> <ol><li>Делает основу из последнего образа ubuntu</li> <li>Устанавливает Python 3 и несколько других зависимостей</li> <li>Скопирует каталог quot-service</li> <li>Устанавливает зависимости quot-service из файла require.txt</li> <li>Предоставляет порт 8000</li> <li>Запустит сервис цитат через hug</li> </ol><pre class="noskimlinks noskimwords">FROM ubuntu:latestMAINTAINER Gigi Sayfan "the.gigi@gmail.com"RUN apt-get update -yRUN apt-get install -y python3 python3-pip python3-dev build-essentialCOPY . /quote-serviceWORKDIR /quote-serviceRUN pip3 install -r requirements.txtEXPOSE 8000ENTRYPOINT hug -f app.py</pre> <h3>Создаем образ</h3> <p>Следующий шаг - создать образ Docker. Это так просто:</p> <p><code class="inline">docker build .</code></p> <p>Мне также нравится добавлять образам теги:</p> <p><code class="inline">docker tag 715624b7e22a g1g1/quote-service</code></p> <p><code class="inline">g1g1</code> - мое имя пользователя на Docker Hub.</p> <p>Чтобы убедиться, что образ был успешно создан, введите:</p> <pre class="noskimlinks noskimwords">docker ps --all</pre> <p>Вы должны увидеть новый образ:</p> <pre class="noskimlinks noskimwords">CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                     PORTS                    NAMES715624b7e22a        g1g1/quote-service   "/bin/sh -c "hug -f a"   4 hours  ago         Up 35 minutes              0.0.0.0:8000-&gt;8000/tcp   agitated_northcutt</pre> <h3>Отправка образа в Docker Hub</h3> <p>Когда вы создаете образ, вы также можете отправить его в <span>Docker Hub</span>, чтобы его могли использовать другие люди (или самостоятельно на другой машине).</p> <p><code class="inline">docker push g1g1/quote-service</code></p> <p>Обратите внимание, что вам необходимо создать учетную запись на Docker Hub и войти в систему локально, используя:</p> <p><code class="inline">docker login</code></p> <h3>Запуск приложения</h3> <p>ОК. Давайте запустим образ сервиса цитат и выставим хосту порт 8000.</p> <p><code class="inline">docker run -i -t -p 8000 g1g1/quote-service</code></p> <p>Вы увидите следующее: <code class="inline">/############################################# ############################ `` .---- `` ..------- .. `` .- ---.</code> : / ::::: - ---------: - ::::: //. . + :::: ---- ## // оо +: - ## ---- :::: // `// :: ------- / oosoo ------- ::: //. ## ## ## ## ##### .-: ------./++ o / o -.------ :: - `  ## ## ## ## ## <code class="inline">----.-./+o+:..----.</code> .: ///. ######## ## ## ##<code class="inline"> `----.- :::::: ------</code> `.- :::: //. ## ## ## ## ## ####: // :: -. <code class="inline">-: ... ----- ... ``: - ::::::.. ############: / ::::::::: -: - `` `.</code> ::::: -. <code class="inline">## ## #### ###### .</code>-- :::::::. . :::. `` .. ::. . :: EMBRACE API OF THE FUTURE :: -.: - -:: ::<code class="inline">- VERSION 1.9.6 :</code>:- <code class="inline">-:: </code>-::- -::- ######################################################################## Copyright (C) 2015 Timothy Edmund Crosley Under the MIT License</p> <p>Serving on port 8000… ``` Очень круто. Прежде чем попытаться получить доступ к своей службе awesome quote на порту 8000, вам может потребоваться выполнить дополнительную работу в зависимости от вашей среды.</p> <p>Если вы работаете под Mac OS X с помощью VirtualBox и <span>док-машины</span>, вам может потребоваться опубликовать порт 8000 на VirtualBox, чтобы сделать его доступным на хосте.</p> <p>Предполагая, что вы попытались просмотреть <code class="inline">http://localhost:8000/quotes</code>. О нет. Внутренняя ошибка сервера! Что случилось?</p> <p>Давайте посмотрим на код:</p> <pre class="noskimlinks noskimwords">redis_host = os.environ.get("QUOTE_STORE_SERVICE_HOST", "localhost")redis_server = redis.StrictRedis(host=redis_host, port=6379, db=0)</pre> <p>Служба цитат пытается подключиться к серверу redis. Адрес хоста может быть настроен как переменная среды, и если он не установлен, он будет по умолчанию установлен на localhost. К сожалению, redis не установлен по умолчанию, и он не запускается внутри контейнера. Давайте исправим это временно. Чтобы получить доступ к оболочке в контейнере, введите следующую команду:</p> <p><code class="inline">docker exec -it 715624b7e22a /bin/bash</code></p> <p>Затем вы получите доступ к оболочке для контейнера, и вы можете установить redis:</p> <p><code class="inline">root@715624b7e22a:/quote-service# apt-get install redis-server</code></p> <p>Наконец, запустите <code class="inline">root@715624b7e22a:/quote-service# redis-server [25] 29 Nov 00:14:24.546 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf _._ _.-``__ ""-._ _.-`` `. `_. ""-._ Redis 2.8.4 (00000000/0) 64 bit .-`` .-. ```\/ ., ‘’-._ ( ‘ , .-</code> <code class="inline">| ,) Running in stand alone mode | -._- ... - __...-.-._ | " .- «|</code> <code class="inline">Port: 6379 | -._ .</code> <code class="inline">/ .- "| PID: 25 -._ -. -. / _.- "_.-" | -.- ._ -..- "_.-"_.-" | | -._-._ _.-"_.- "| Http://redis.io -._ -._-.__.-"_.- "_.-" | -._-._ -..- "_.-" .- "| | -._-._.-".-" | -._ -.- .__.-"_.- "_.-" -. -.__.- "_.-" -._ _.- "`-.__.-"</code></p> <p>[25] 29 Nov 00:14:24.547 # Server started, Redis version 2.8.4 [25] 29 Nov 00:14:24.547 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. Чтобы исправить эту проблему добавьте ‘vm.overcommit_memory = 1’ в файл /etc/sysctl.conf а затем перезагрузите систему и выполните команду ‘sysctl vm.overcommit_memory=1’ чтобы изменения вступили в силу. [25] 29 Nov 00:14:24.547 * DB loaded from disk: 0.000 seconds [25] 29 Nov 00:14:24.547 * The server is now ready to accept connections on port 6379 ``` Теперь вы можете просматривать и добавлять цитаты по адресу <code class="inline">http://localhost:8000/quotes</code>.</p> <p>Размещение приложения (служба цитат) и базы данных (redis) работает на одном сервере. Но, очевидно, это не масштабируется. Войдите в Кубернетес.</p> <h2>Основы Кубернетеса</h2> <p>Кубернетес, a.k.a. <strong>K8s</strong>, является уместной основой для управления и организации нескольких контейнеров. У этого есть свой собственный способ как делать вещи, которые обычно очень хороши. Он все еще находится в разработке, поэтому иногда могут возникать проблемы. Кубернетес имеет много концепций и очень гибкий. Я объясню и продемонстрирую концепции, применив их к сервису цитат.</p> <h3>Настройка кластера</h3> <p>Существует множество способов создания кластера Kubernetes. Kubernetes может работать на простом сервере, на Google Container, на AWS, и локально на любой ОС с использованием виртуальных машин. Для целей этой статьи я создал кластер из одного мастера и двух миньонов с помощью кластера <span>Core OS OSX GUI k8s</span>. В Mac OS X имеется небольшое меню, в котором вы можете получить доступ ко многим инструментам управления кластерами.</p> <p>Следуйте инструкциям, и вы быстро все настроите.</p> <p>Если вы не используете Mac OSX или просто не интересуетесь графическим интерфейсом, вы можете использовать <span>этот проект</span> для настройки тестового кластера в Vagrant VM.</p> <p>С этого момента я буду использовать командную строку.</p> <h3>Инструмент командной строки kubectl</h3> <p>Kubectl - швейцарский армейский нож Кубернетеса. Вы можете полностью управлять своим кластером с комфортом из своей консоли, используя только kubectl.</p> <p>Ниже приведен список команд: get Показать один или несколько ресурсов show Показывать детали определенного ресурса create Создайте ресурс по имени файла или stdin update Обновить ресурс по имени файла или stdin. Delete Удалить ресурс по имени файла, stdin, ресурсу и идентификатору, а также по ресурсам и селектору ярлыков. Namespace SUPERCEDED: установить и просмотреть текущий журнал пространства имен Kubernetes.  Roll-update Выполнять текущее обновление данного контроллера репликации. Resize Установите новый размер для контроллера репликации. Exec Выполнить команду в контейнере. port-forward Переместить один или несколько локальных портов в контейнер. proxy Запустить прокси-сервер для сервера-загрузчика API-интерфейса Kubernetes Запустить определенный образ в кластере. stop корректно отключить ресурс по имени или имени файла. expose взять реплицированное приложение и опубликовать его в Kubernetes Service. label обновить метки ресурса config  Изменяет файлы kubeconfig. cluster-info Отображает информацию о кластере  api-versions выводит доступные версии API. version выводит информацию о версии клиента и сервера. help Справка о любой команде </p> <p>Не стесняйтесь использовать справочную команду или документацию для изучения того, что делает каждая команда. Многие из них используются для выполнения ручных операций, которые лучше выполнять с использованием файлов конфигурации в широкомасштабной масштабируемой распределенной системе, но это может быть необходимо для быстрой разведки и устранения неполадок. Наиболее распространенными командами, которые я буду использовать, являются: get, create, delete и start.</p> <h3>Pods</h3> <p>Пакет является базовой единицей развертывания и управления в Кубернете. Pod представляет собой группу из одного или нескольких контейнеров. Вы можете указать pod, используя выделенный файл YAML или как часть службы Kubernetes (см. ниже). Контейнер всегда развертывается на одном хосте, и все контейнеры внутри pod могут обращаться друг к другу через localhost. Все контейнеры внутри pod всегда запускаются, останавливаются и масштабируются вместе.</p> <p>Чтобы проверить все pod"ы в кластере, введите:</p> <p><code class="inline">kubectl get pods</code></p> <p>Результатом будет что-то вроде: <code class="inline">NAME READY STATUS RESTARTS AGE quote-frontend-4kyns 1/1 Running 0 1h quote-frontend-v4xk1 1/1 Running 0 1h quote-store-controller-y4ya1 1/1 Running 0 23h ### Volumes</code></p> <p>Контейнеры не должны поддерживать стойкое состояние. Когда контейнер выходит из строя или перезапускается, его локальная файловая система уничтожается. Если вы хотите сохранить постоянное состояние, вы должны использовать постоянные тома. Поскольку все в Kubernetes основано на pod"ах, вам также нужно определить объемы в pod"е. Вот файл определения pod с постоянным томом: <code class="inline">apiVersion: v1 kind: Pod metadata: name: метки-хранилища: app: quote-api role: persistent-storage spec: container: - name: redis image: redis volumeMounts: - Name: quot-store-volume mountPath: / data / redis volume: - name: quote-store-volume emptyDir: {} </code>Обратите внимание, что постоянные тома ограничены узлом и будут сохранение при выходе контейнера из строя и после его перезапуска, но <em>не</em> после сбоя узла/хоста. Вам все еще необходимо выполнить репликацию и резервное копирование важных данных.</p> <h3>Контроллеры репликации</h3> <p>Одной из важнейших особенностей Kubernetes является его способность управлять и легко масштабировать вверх и вниз количество pod"ов. Как правило, у вас будут разные типы контейнеров в вашей системе, и вы захотите указать, сколько pod"ов каждого типа должно быть запущено.</p> <p>Поприветствуем контроллеры репликации. Контроллер репликации имеет шаблон pod"а, который определяет группу контейнеров, набор меток для идентификации этих pod"ов и количество желаемых pod"ов. Контроллер репликации гарантирует, что количество запущенных pod"ов, идентифицированных его метками, всегда совпадает с нужным числом. Если pod завершается, контроллер репликации немедленно создаст новый.</p> <p>Существует несколько интересных вариантов использования, поддерживаемых контроллерами репликации, таких как высокая доступность, эластичное масштабирование и накатывание обновлений. Например, вы можете добавлять и удалять pod"ы из dominion контроллера репликации, изменяя их метку.</p> <p>Разумеется, контроллеры репликации указаваются в файле YAML. Вот пример: `` `apiVersion: v1 kind: ReplicationController</p> <p>metadata: name: quote-frontend spec: replicas: 2 # selector identifies the set of Pods that this # replication controller is responsible for managing selector: app: quote-api role: frontend # podTemplate defines the ‘cookie cutter’ used for creating # new pods when necessary template: metadata: labels: # Important: these labels need to match the selector above # The api server enforces this constraint. app: quote-api role: frontend spec: containers: - name: quote-service image: g1g1/quote-service env: - name: GET_HOSTS_FROM # value: dns value: env ports: - containerPort: 8000 ``` Спецификация шаблона для контейнера quote-service используется образ<span> g1g1/quote-service</span>, который я ранее выложил на Docker Hub. Обратите внимание на раздел <code class="inline">env</code>, в котором обмен информацией между контейнерами может происходить через переменные DNS или среды.</p> <p>Чтобы создать контроллер репликации, введите:</p> <p><code class="inline">kubectl create -f &lt;имя файла контроллера репликации&gt;</code></p> <p>Чтобы просмотреть текущие контроллеры репликации в кластере, введите:</p> <p><code class="inline">kubectl get rc</code></p> <p>Вы должны увидеть что-то вроде: <code class="inline">CONTROLLER CONTAINER (S) IMAGE (S) SELECTOR REPLICAS AGE quote-frontend quote-service g1g1 / quote-service app = quote-api, role = frontend 2 1h quote-store-controller master redis app = quote -api, role = persistent-storage 1 1d</code> ### Services</p> <p>Служба предоставляет свой пакет для остальной части кластера и, доступна извне через переменные среды или DNS. Например, служба цитат состоит из двух типов pod"ов: redis store pod и front-end pod. Фронтенд контейнер должен иметь возможность находить контейнер для хранения, а клиенты должны иметь возможность отправить запрос по одной публичной конечной точке для доступа к службе.</p> <p>Услуга Kubernetes реализована в еще одном файле YAML. Каждый компонент вашей системы, к которому должны обращаться другие компоненты, должен иметь свой собственный служебный файл. Вот два служебных файла для компонентов сервиса цитат:</p> <h4>srv-quote-frontend.yaml</h4> <pre class="noskimlinks noskimwords">apiVersion: v1kind: Servicemetadata:  name: quote-frontendspec:  type: NodePort  ports:  - port: 8000 # the port that this service should serve on    # the container on each pod to connect to, can be a name    # (e.g. "www") or a number (e.g. 80)    targetPort: 80    protocol: TCP  # just like the selector in the replication controller,  # but this time it identifies the set of pods to load balance  # traffic to.  selector:    app: quote-api    role: frontend</pre> <p><code class="inline">#### srv-quote-store.yaml apiVersion: v1 kind: Service metadata: name: quote-store spec: ports: - port: 6379 # the port that this service should serve on targetPort: 6379 # just like the selector in the replication controller, # but this time it identifies the set of pods to load balance # traffic to. selector: app: quote-api role: persistent-storage</code>  Хост и порт каждой службы становятся доступными для каждого контейнера в кластере. Например, если вы запускаете интерактивную оболочку на одном из контейнеров фронтенда:</p> <p><code class="inline">kubectl quote-frontend-4kyns exec -i -t bash</code></p> <p>Затем вы можете проверить, что среда содержит необходимую информацию о хосте и порте для подключения к хранилищу цитат.  <code class="inline">Root @ quote-frontend-4kyns: / quote-service # env | Grep STORE QUOTE_STORE_PORT_6379_TCP_ADDR = 10.100.234.192 QUOTE_STORE_PORT_6379_TCP_PROTO = ТСР QUOTE_STORE_SERVICE_PORT = 6379 QUOTE_STORE_PORT_6379_TCP_PORT = 6379 QUOTE_STORE_PORT = ТСР: //10.100.234.192: 6379 QUOTE_STORE_PORT_6379_TCP = ТСР: //10.100.234.192: 6379 QUOTE_STORE_SERVICE_HOST = 10.100.234.192 </code>Просто, чтобы освежить вашу память, Это именно то, что делает frontend: <code class="inline">redis_host = os.environ.get ("QUOTE_STORE_SERVICE_HOST", "localhost") redis_server = redis.StrictRedis (host = redis_host, port = 6379, db = 0)</code> ## Заключение</p> <p>Докер и Кубернетес - захватывающие технологии. Эта статья едва поцарапала поверхность того, что возможно. Преимущества огромны, но инфраструктура, инструменты и лучшие практики все еще развиваются. Если вы даже дистанционно подключены к крупномасштабным распределенным системам, я рекомендую вам по крайней мере оставаться на вершине этих технологий и в идеале окунуться в них и попытаться их использовать. Существует множество способов экспериментировать и учиться без массово миграции всей вашей производственной инфраструктуры.</p> <p>Что касается Кубернетеса, есть несколько других альтернатив для управления несколькими контейнерами и оркестровки, такие как Mesos и Docker compose. Я считаю, что Кубернетес более архитектурно обоснован, имеет большой импульс и лучше, чем остальные его альтернативы.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Docker" href="https://norma-studio.github.io/article5/220825273-vvedenie-v-doker-i-kubernetes" class="tm-article-body__tags-item-link">Docker</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
41547</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
452</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
