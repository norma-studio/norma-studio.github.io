
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В марте 2015 года Google выпустил API-интерфейс Places для Android в составе Служб Google Play. Этот API позволяет разработчикам получать доступ к большому количеству информации из Google, чтобы предоставить пользователям опыт, соответствующий их текущему местоположению, используя имена и информацию о местах, а не набор координат....">
<meta property="og:description" content="В марте 2015 года Google выпустил API-интерфейс Places для Android в составе Служб Google Play. Этот API позволяет разработчикам получать доступ к большому количеству информации из Google, чтобы предоставить пользователям опыт, соответствующий их текущему местоположению, используя имена и информацию о местах, а не набор координат....">
<meta name="twitter:description" content="В марте 2015 года Google выпустил API-интерфейс Places для Android в составе Служб Google Play. Этот API позволяет разработчикам получать доступ к большому количеству информации из Google, чтобы предоставить пользователям опыт, соответствующий их текущему местоположению, используя имена и информацию о местах, а не набор координат....">
<meta property="aiturec:description" content="В марте 2015 года Google выпустил API-интерфейс Places для Android в составе Служб Google Play. Этот API позволяет разработчикам получать доступ к большому количеству информации из Google, чтобы предоставить пользователям опыт, соответствующий их текущему местоположению, используя имена и информацию о местах, а не набор координат....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/placepicker2.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/placepicker2.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/placepicker2.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/placepicker2.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/placepicker2.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html" title="Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io" title="Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/ded38a8520cf75a955c11fc92a1a403e.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html" class="tm-user-info__username" title="
В. Самсонов" aria-label="
В. Самсонов">
В. Самсонов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Службы Google Play: использование-Places-API
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api" class="tm-article-snippet__hubs-item-link"><span>Android SDK</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/placepicker2.png">
    <meta itemprop="headline name" content="Службы Google Play: использование-Places-API
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В марте 2015 года Google выпустил API-интерфейс Places для Android в составе Служб Google Play. Этот API позволяет разработчикам получать доступ к большому количеству информации из Google, чтобы предоставить пользователям опыт, соответствующий их текущему местоположению, используя имена и информацию о местах, а не набор координат....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В марте 2015 года Google выпустил API-интерфейс Places для Android в составе Служб Google Play. Этот API позволяет разработчикам получать доступ к большому количеству информации из Google, чтобы предоставить пользователям опыт, соответствующий их текущему местоположению, используя имена и информацию о местах, а не набор координат....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



   <p>В марте 2015 года Google выпустил API-интерфейс Places для Android в составе Служб Google Play. Этот API позволяет разработчикам получать доступ к большому количеству информации из Google, чтобы предоставить пользователям опыт, соответствующий их текущему местоположению, используя имена и информацию о местах, а не набор координат.<br></p> <p>В этом учебном пособии вы узнаете, как представить своих пользователей компоненту Place Picker, использовать API-интерфейс Places, чтобы угадать текущее место пользователя, найти место по его идентификатору и разрешить пользователю вводить текстовое поле для их представления с прогнозирующими результатами.</p> <h2> <span class="sectionnum">1.</span> Настройка</h2> <p>Если у вас еще нет открытого ключа API для Android, вам нужно будет создать общедоступный ключ API Google для приложений Android. Вы можете сделать это, посетив <span>Консоль разработчика Google</span>. Инструкции по созданию ключа на основе вашего сертификата подписи и имени пакета доступны в <span>документации Google</span> и выходят за рамки этой статьи.</p> <p>Когда вы создали ключ, найдите API-интерфейс Places и включите его. Некоторые вызовы API Places ограничены тем, сколько запросов может быть отправлено в течение 24-часового периода. На момент написания учетной записи учетная запись без профиля выставления счетов может отправлять до 1000 запросов, а учетная запись с профилем фактуры может отправлять 150 000 запросов. Если вам требуется больше, вы можете отправить запрос на увеличение этого лимита, как описано в документации по <span>ограничениям использования</span>.<br></p> <p>Когда ключ API готов к использованию, пришло время начать работу над демонстрационным проектом. Создайте проект в Android Studio и установите минимальную поддерживаемую версию SDK как минимум на 9. Это минимальное требование для использования Служб Google Play.</p> <p>После того, как Android Studio создала проект шаблона <strong>Hello World</strong>, откройте файл <strong>build.gradle</strong> и под узлом <code class="inline">dependencies</code> добавьте требуемую зависимость Play Services 7.0. Это самое последнее на момент написания статьи, но вы можете проверить последнюю версию, проверив <span>документацию Google</span>.</p> <pre class="brush: groovy noskimlinks noskimwords">dependencies {     compile fileTree(dir: "libs", include: ["*.jar"])     compile "com.android.support:appcompat-v7:22.0.0"     compile "com.google.android.gms:play-services:7.0.0" }</pre> <p>Затем откройте <strong>AndroidManifest.xml</strong>, добавьте необходимые разрешения для проекта и укажите, что приложение OpenGL 2 требуется для приложения.</p> <pre class="brush: xml noskimlinks noskimwords">&lt;uses-permission android:name="com.google.android.providers.gsf.permission.READ_GSERVICES"/&gt; &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;  &lt;uses-feature     android:glEsVersion="0x00020000"     android:required="true"/&gt;</pre> <p>Последнее, что вам нужно сделать в манифесте, - добавить два тега <code class="inline">&lt;meta-data&gt;</code>, чтобы установить версию gms и ключ API для приложения в теге <code class="inline">&lt;application&gt;</code>.</p> <pre class="brush: xml noskimlinks noskimwords">&lt;meta-data     android:name="com.google.android.geo.API_KEY"     android:value="@string/google_api_key" /&gt; &lt;meta-data     android:name="com.google.android.gms.version"     android:value="@integer/google_play_services_version" /&gt;</pre> <p>Когда вы закончите с манифестом, мы готовы начать писать код. Поскольку это компонент из Play Services, вам нужно будет инициализировать ваш <code class="inline">GoogleApiClient</code> и подключить / отключить его во время жизненного цикла вашей <code class="inline">Activity</code>. Мы делаем это в методах <code class="inline">onCreate</code>, <code class="inline">onStart</code> и <code class="inline">onStop</code> класса <code class="inline">Activity</code>.<br></p> <pre class="brush: java noskimlinks noskimwords">@Override protected void onCreate( Bundle savedInstanceState ) {     //--Snippet     mGoogleApiClient = new GoogleApiClient             .Builder( this )             .enableAutoManage( this, 0, this )             .addApi( Places.GEO_DATA_API )             .addApi( Places.PLACE_DETECTION_API )             .addConnectionCallbacks( this )             .addOnConnectionFailedListener( this )             .build(); }  @Override protected void onStart() {     super.onStart();     if( mGoogleApiClient != null )         mGoogleApiClient.connect(); }  @Override protected void onStop() {     if( mGoogleApiClient != null &amp;&amp; mGoogleApiClient.isConnected() ) {         mGoogleApiClient.disconnect();     }     super.onStop(); }</pre> <h2> <span class="sectionnum">2.</span> Использование виджета Place Picker</h2> <p>Виджет Place Picker - это компонент пользовательского интерфейса, предоставляемый Play Services, который позволяет пользователю видеть карту их окружения. Компонент включает список ближайших мест, которые могут использоваться вашим приложением. Используя этот компонент, вы можете следить за стандартным дизайном, который ваши пользователи будут знать, как взаимодействовать, сохраняя время разработки.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/placepicker2.png" alt="Службы Google Play: использование Places API..." title="Службы Google Play: использование Places API..." width="50" height="50"></figure><p>Чтобы использовать Place Picker, вам нужно создать намерение и прослушать результат <code class="inline">Activity</code> для извлечения места, выбранного пользователем. Следующий метод показывает, как запустить эту <code class="inline">Activity</code></p> <pre class="brush: java noskimlinks noskimwords">private void displayPlacePicker() {     if( mGoogleApiClient == null || !mGoogleApiClient.isConnected() )         return;      PlacePicker.IntentBuilder builder = new PlacePicker.IntentBuilder();          try {         startActivityForResult( builder.build( getApplicationContext() ), PLACE_PICKER_REQUEST );     } catch ( GooglePlayServicesRepairableException e ) {             Log.d( "PlacesAPI Demo", "GooglePlayServicesRepairableException thrown" );     } catch ( GooglePlayServicesNotAvailableException e ) {         Log.d( "PlacesAPI Demo", "GooglePlayServicesNotAvailableException thrown" );     } }</pre> <p><code class="inline">PlacePicker.IntentBuilder</code> используется для создания <code class="inline">Intent</code>, которое будет использоваться для запуска Place Picker. Он также имеет доступный метод <code class="inline">setLatLngBounds</code>, который позволяет разместить географическую границу с юго-западного угла в северо-восточном углу, чтобы управлять областью поиска.</p> <p><code class="inline">Intent</code> может быть построен с использованием метода <code class="inline">build</code> из <code class="inline">PlacePicker.IntentBuilder</code> и запущен с использованием метода <code class="inline">startActivityForResult</code> из вашей <code class="inline">Activity</code>. Следует отметить, что использование метода <code class="inline">build</code> имеет возможность выбросить исключение <code class="inline">GooglePlayServicesRepairableException</code> или исключение <code class="inline">GooglePlayServicesNotAvailableException</code>, поэтому их необходимо проверить для использования стандартного блока try / catch и обработать, если они возникнут.</p> <p>Если пользователь выбирает местоположение из списка выбора места, этот объект <code class="inline">Place</code> упаковывается в <code class="inline">Intent</code> и отправляется обратно в вызывающую <code class="inline">Activity</code>. Используя метод <code class="inline">PlacePicker.getPlace</code>, вы можете извлечь данные <code class="inline">Place</code> из возвращаемого <code class="inline">Intent</code>.</p> <pre class="brush: java noskimlinks noskimwords">protected void onActivityResult( int requestCode, int resultCode, Intent data ) {     if( requestCode == PLACE_PICKER_REQUEST &amp;&amp; resultCode == RESULT_OK ) {         displayPlace( PlacePicker.getPlace( data, this ) );     } }</pre> <p>Когда объект <code class="inline">Place</code> будет извлечен, его можно рассматривать как модельный объект для отображения или использования в вашем приложении.</p> <pre class="brush: java noskimlinks noskimwords">private void displayPlace( Place place ) {     if( place == null )         return;      String content = "";     if( !TextUtils.isEmpty( place.getName() ) ) {         content += "Name: " + place.getName() + "\n";     }     if( !TextUtils.isEmpty( place.getAddress() ) ) {         content += "Address: " + place.getAddress() + "\n";     }     if( !TextUtils.isEmpty( place.getPhoneNumber() ) ) {         content += "Phone: " + place.getPhoneNumber();     }      mTextView.setText( content ); }</pre> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/displayplace.png" alt="Службы Google Play: использование Places API..." title="Службы Google Play: использование Places API..." width="50" height="50"></figure><h2> <span class="sectionnum">3.</span> Поиск текущего места пользователя</h2> <p>Еще одна интересная особенность API-интерфейса Places заключается в том, что вы можете использовать его, чтобы угадать, находится ли пользователь в настоящее время в списке. API также обеспечит вероятность того, что вы сможете принимать обоснованные решения о том, как ваше приложение должно взаимодействовать с пользователем. Следует отметить, что это одна из особенностей API, которая требует запроса против ваших выделенных способов использования.</p> <p>Чтобы определить место пользователя, вам необходимо использовать метод <code class="inline">Places.PlacesDetectionApi.getCurrentPlace</code> для создания <code class="inline">PendingIntent</code>, который возвращается с объектом <code class="inline">PlaceLikelihoodBuffer</code>. Используя <code class="inline">ResultCallBack</code>, вы можете взять первое и, скорее всего, место из буфера и использовать его в своем приложении.</p> <p>Если вашему приложению нужна дополнительная информация, вы можете извлечь другие элементы <code class="inline">PlaceLikelihood</code> из буфера, пройдя через него. Вероятность того, что это место находится там, где находится пользователь, передается обратно в каждый объект <code class="inline">PlaceLikelihood</code>, поскольку значение с плавающей точкой от <strong>0.0</strong> до <strong>1.0</strong>, <strong>1.0</strong> является почти гарантированным совпадением. Не забудьте вызвать <code class="inline">release</code> у <code class="inline">PlaceLikelihoodBuffer</code>, чтобы избежать утечек памяти.</p> <pre class="brush: java noskimlinks noskimwords">private void guessCurrentPlace() {     PendingResult&lt;PlaceLikelihoodBuffer&gt; result = Places.PlaceDetectionApi.getCurrentPlace( mGoogleApiClient, null );     result.setResultCallback( new ResultCallback&lt;PlaceLikelihoodBuffer&gt;() {         @Override         public void onResult( PlaceLikelihoodBuffer likelyPlaces ) {              PlaceLikelihood placeLikelihood = likelyPlaces.get( 0 );             String content = "";             if( placeLikelihood != null &amp;&amp; placeLikelihood.getPlace() != null &amp;&amp; !TextUtils.isEmpty( placeLikelihood.getPlace().getName() ) )                 content = "Most likely place: " + placeLikelihood.getPlace().getName() + "\n";             if( placeLikelihood != null )                 content += "Percent change of being there: " + (int) ( placeLikelihood.getLikelihood() * 100 ) + "%";             mTextView.setText( content );              likelyPlaces.release();         }     }); }</pre> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/currentlocation.png" alt="Службы Google Play: использование Places API..." title="Службы Google Play: использование Places API..." width="50" height="50"></figure><h2> <span class="sectionnum">4.</span> Прогнозирование мест</h2> <p>Следующая, и самая сложная тема, которую мы рассмотрим в этом учебном пособии, - это предсказание и отображение мест для пользователя при вводе поискового запроса. Опять же, этот вызов API также учитывает ограничения использования API. Однако, это бесценно для того, чтобы сделать ваше приложение более полезным.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/798/posts/23715/image/predictive.png" alt="Службы Google Play: использование Places API..." title="Службы Google Play: использование Places API..." width="50" height="50"></figure><p>Для этой части учебника вы будете использовать <code class="inline">AutoCompleteTextView</code> и пользовательский адаптер в приложении, чтобы ввести имя места для прогнозов. Практически вся работа выполняется в адаптере. Однако нам нужно будет передать ссылку на <code class="inline">GoogleApiClient</code> на адаптер для доступа к API.</p> <p>Это можно сделать в стандартном обратном вызове <code class="inline">GoogleApiClient</code>, <code class="inline">onConnected</code>, и мы можем удалить экземпляр клиента в <code class="inline">onStop</code>, где <code class="inline">mAdapter</code> является экземпляром нашего пользовательского класса <code class="inline">Adapter</code>, <code class="inline">AutoCompleteAdapter</code>.</p> <pre class="brush: java noskimlinks noskimwords">@Override protected void onStop() {     if( mGoogleApiClient != null &amp;&amp; mGoogleApiClient.isConnected() ) {         mAdapter.setGoogleApiClient( null );         mGoogleApiClient.disconnect();     }     super.onStop(); }  @Override public void onConnected( Bundle bundle ) {     if( mAdapter != null )         mAdapter.setGoogleApiClient( mGoogleApiClient ); }</pre> <p>Чтобы инициировать вызов API, когда пользователь вводит новое письмо в <code class="inline">AutoCompleteTextView</code>, вам необходимо переопределить метод <code class="inline">getFilter</code> для <code class="inline">ArrayAdapter</code>. Этот метод запускается каждый раз, когда пользователь изменяет содержимое представления, связанного с адаптером. Он позволяет изменять содержимое адаптера <code class="inline">AutoCompleteTextView</code>. В следующем примере <code class="inline">constraints</code> представляют собой содержимое представления.</p> <pre class="brush: java noskimlinks noskimwords">@Override public Filter getFilter() {     return new Filter() {         @Override         protected FilterResults performFiltering(CharSequence constraint) {              if( mGoogleApiClient == null || !mGoogleApiClient.isConnected() ) {                 Toast.makeText( getContext(), "Not connected", Toast.LENGTH_SHORT ).show();                 return null;             }              clear();              displayPredictiveResults( constraint.toString() );              return null;         }          @Override         protected void publishResults(CharSequence constraint, FilterResults results) {             notifyDataSetChanged();         }     }; }</pre> <p>Метод <code class="inline">displayPredictiveResults</code> - это фактическое взаимодействие с API. Существует несколько различных объектов, которые можно настроить для настройки ваших прогнозов.</p> <p>Первый - это объект <code class="inline">LatLngBounds</code>, который создает квадратную границу от юго-западной точки до северо-восточной точки, чтобы локализовать запрос. Если вместо инициализированного объекта <code class="inline">LatLngBounds</code> передается значение <code class="inline">null</code>, то в запросе не будут помечены географические ограничения.</p> <pre class="brush: java noskimlinks noskimwords">LatLngBounds bounds = new LatLngBounds( new LatLng( 39.906374, -105.122337 ), new LatLng( 39.949552, -105.068779 ) );</pre> <p>Второй объект, который вы можете создать для настройки запроса, является фильтром для запроса API. Фильтр для вызова <code class="inline">Places</code> <code class="inline">AutoCompletePredictions</code> представляет собой список объектов <code class="inline">Integer</code>, представляющих различные типы фильтров. На данный момент к запросу может быть применен только один тип фильтра. Допустимые значения можно найти в <span>документации</span>. Если список <code class="inline">Integer</code> пуст или передан значение <code class="inline">null</code>, тогда возвращаются все типы результатов.</p> <p>Когда вы будете готовы выполнить запрос, вы можете использовать метод <code class="inline">Places.GeoDataApi.getAutocompletePredictions</code>, чтобы вернуть <code class="inline">PendingIntent</code>, который может быть связан с <code class="inline">ResultCallback</code> для отображения возвращенной информации.</p> <p>Важно отметить, что пользовательский объект, представляющий объекты <code class="inline">AutoCompletePrediction</code> из буфера, используется для хранения данных в <code class="inline">ArrayAdapter</code>. В противном случае исключается исключение <code class="inline">IllegalArgumentsException</code>, как только будет освобожден буфер, что крайне важно для предотвращения утечки памяти.</p> <pre class="brush: java noskimlinks noskimwords">private void displayPredictiveResults( String query ) {     //Southwest corner to Northeast corner.     LatLngBounds bounds = new LatLngBounds( new LatLng( 39.906374, -105.122337 ), new LatLng( 39.949552, -105.068779 ) );      //Filter: https://developers.google.com/places/supported_types#table3     List&lt;Integer&gt; filterTypes = new ArrayList&lt;Integer&gt;();     filterTypes.add( Place.TYPE_ESTABLISHMENT );      Places.GeoDataApi.getAutocompletePredictions( mGoogleApiClient, query, bounds, AutocompleteFilter.create( filterTypes ) )         .setResultCallback (             new ResultCallback&lt;AutocompletePredictionBuffer&gt;() {                 @Override                 public void onResult( AutocompletePredictionBuffer buffer ) {                      if( buffer == null )                         return;                      if( buffer.getStatus().isSuccess() ) {                         for( AutocompletePrediction prediction : buffer ) {                             //Add as a new item to avoid IllegalArgumentsException when buffer is released                             add( new AutoCompletePlace( prediction.getPlaceId(), prediction.getDescription() ) );                         }                     }                      //Prevent memory leak by releasing buffer                     buffer.release();                 }             }, 60, TimeUnit.SECONDS ); }</pre> <p>Содержимое в <code class="inline">AutoCompleteAdapter</code> отображается с использованием макета <code class="inline">android.R.layout.simple_list_item_1</code> и стандартного шаблона ViewHolder в <code class="inline">getView</code>.</p> <pre class="brush: java noskimlinks noskimwords">@Override public View getView( int position, View convertView, ViewGroup parent ) {     ViewHolder holder;      if( convertView == null ) {         holder = new ViewHolder();         convertView = LayoutInflater.from( getContext() ).inflate( android.R.layout.simple_list_item_1, parent, false  );         holder.text = (TextView) convertView.findViewById( android.R.id.text1 );         convertView.setTag( holder );     } else {         holder = (ViewHolder) convertView.getTag();     }      holder.text.setText( getItem( position ).getDescription() );      return convertView; }</pre> <p>Когда элемент выбирается из этого списка, идентификатор выбранного <code class="inline">Place</code> передается в <code class="inline">onItemClickedListener</code> и отображается для отображения.</p> <h2> <span class="sectionnum">5.</span> Поиск места по идентификатору</h2> <p>Последняя часть этого руководства охватывает поиск объекта <code class="inline">Place</code> на основе его идентификатора. Это работает аналогично другим вызовам API, создавая <code class="inline">PendingIntent</code> и взаимодействуя с возвращенным буфером для извлечения места. Как и другие объекты буфера, с которыми вы работали, <code class="inline">PlaceBuffer</code> должен вызвать <code class="inline">release</code>, чтобы избежать утечек памяти.</p> <pre class="brush: java noskimlinks noskimwords">private void findPlaceById( String id ) {     if( TextUtils.isEmpty( id ) || mGoogleApiClient == null || !mGoogleApiClient.isConnected() )         return;     Places.GeoDataApi.getPlaceById( mGoogleApiClient, id ) .setResultCallback( new ResultCallback&lt;PlaceBuffer&gt;() {        @Override        public void onResult(PlaceBuffer places) {            if( places.getStatus().isSuccess() ) {                Place place = places.get( 0 );                displayPlace( place );                mPredictTextView.setText( "" );                mAdapter.clear();            }             //Release the PlaceBuffer to prevent a memory leak            places.release();        }    } ); }</pre> <h2>Заключение</h2> <p></p> <p>API-интерфейс Places - это мощный инструмент для информирования ваших пользователей о местоположении пользователя, чтобы предоставить им контекстуальную информацию. В этом уроке вы узнали, как использовать компонент Place Picker, угадывать место пользователя, представлять его с прогнозирующими результатами при поиске и находить место на основе данного идентификатора. Помимо затронутых здесь тем, также можно отправить новые места в Google, чтобы помочь расширить информацию, к которой имеет доступ API.</p> 

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825395-sluzhby-google-play-ispolzovanie-places-api" class="tm-article-body__tags-item-link">Android SDK</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
36102</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
416</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
