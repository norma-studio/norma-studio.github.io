
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этом уроке вы узнаете, как использовать Mechanize, для того, чтобы кликать на ссылки, заполнять анкеты и загружать файлы. Вы также узнаете, как можно нарезать объекты страниц в Mechanize, как автоматизировать поиск в Google и сохранять его результаты....">
<meta property="og:description" content="В этом уроке вы узнаете, как использовать Mechanize, для того, чтобы кликать на ссылки, заполнять анкеты и загружать файлы. Вы также узнаете, как можно нарезать объекты страниц в Mechanize, как автоматизировать поиск в Google и сохранять его результаты....">
<meta name="twitter:description" content="В этом уроке вы узнаете, как использовать Mechanize, для того, чтобы кликать на ссылки, заполнять анкеты и загружать файлы. Вы также узнаете, как можно нарезать объекты страниц в Mechanize, как автоматизировать поиск в Google и сохранять его результаты....">
<meta property="aiturec:description" content="В этом уроке вы узнаете, как использовать Mechanize, для того, чтобы кликать на ссылки, заполнять анкеты и загружать файлы. Вы также узнаете, как можно нарезать объекты страниц в Mechanize, как автоматизировать поиск в Google и сохранять его результаты....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/851/posts/27566/image/mechanize-links-850.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/851/posts/27566/image/mechanize-links-850.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/851/posts/27566/image/mechanize-links-850.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/851/posts/27566/image/mechanize-links-850.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/851/posts/27566/image/mechanize-links-850.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html" title="Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io" title="Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543543242.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html" class="tm-user-info__username" title="
А. Морозов" aria-label="
А. Морозов">
А. Морозов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создаем свой первый веб-скрэпер, часть 2...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Ruby" href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2" class="tm-article-snippet__hubs-item-link"><span>Ruby</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/851/posts/27566/image/mechanize-links-850.jpg">
    <meta itemprop="headline name" content="Создаем свой первый веб-скрэпер, часть 2... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этом уроке вы узнаете, как использовать Mechanize, для того, чтобы кликать на ссылки, заполнять анкеты и загружать файлы. Вы также узнаете, как можно нарезать объекты страниц в Mechanize, как автоматизировать поиск в Google и сохранять его результаты....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этом уроке вы узнаете, как использовать Mechanize, для того, чтобы кликать на ссылки, заполнять анкеты и загружать файлы. Вы также узнаете, как можно нарезать объекты страниц в Mechanize, как автоматизировать поиск в Google и сохранять его результаты....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этом уроке вы узнаете, как использовать Mechanize, для того, чтобы кликать на ссылки, заполнять анкеты и загружать файлы. Вы также узнаете, как можно нарезать объекты страниц в Mechanize, как автоматизировать поиск в Google и сохранять его результаты.<br></p><h2>Содержание</h2><ul><li>Одна страница или нумерация (разбивка по страницам)</li> <li>Mechanize</li> <li>Агент</li> <li>Страница</li> <li>Метод Nokogiri</li> <li>Ссылки</li> <li>Щелчок</li> <li>Формы</li> </ul><h2>Одна страница или постранично<br></h2><p>До этого момента мы рассматривали, как можно, с помощью Nokogiri, проводить скрэпинг одной страницы. Это было хорошей основой для дальнейшего изучения того, как извлекать контент из нескольких страниц. </p><p>В конце концов, проблема которую мы пытаемся решить, заключается в том, чтобы загрузить контент более чем 140 эпизодов — это намного больше, чем можно вместить на одну веб страницу. Здесь появляется необходимость работы с нумерацией страниц, и таким образом, нам нужно выяснить как же последовать за контентом прямо в кроличью нору. </p><p>Вот где заканчивается работа Nokogiri, и вступает в игру другой полезный пакет, под названием <span>Mechanize</span>.<br></p><h2>Mechanize<br></h2><p>Mechanize - это еще один мощный инструмент, который предлагает много отличных функций. Он, по сути, позволяет автоматизировать процесс взаимодействия с веб сайтами, с которых нужно провести экстракцию информации. В этом смысле он немного напоминает функциональность <span>Capybara</span>, с которым вы возможно знакомы. </p><p>Не поймите меня неправильно, работать с Nokogiri на одной странице - это круто само по себе, но для более сложной экстракции, нам нужно чуть больше лошадиных сил. По существу, мы можем пройти через столько страниц, сколько нужно, и взаимодействовать с их элементами —иммитируя и автоматизируя человеческое поведение. Круто, правда?!<br></p><p>Этот пакет позволяет вам переходить по ссылкам, заполнять формы, и отправлять эти данные — вам даже доступна работа с куки. Это означает, что вы можете имитировать вход в частные сессии под логином пользователя, и получать доступ к контенту сайта, который доступен только для этого пользователя. </p><p>Все что нужно, это добавить регистрационные данные и дать направление Mechanize. Поскольку у нас есть возможность кликать на ссылки и заполнять формы, практически не существует того, что данный инструмент не сможет сделать. Он имеет тесную связь с Nokogiri, и также основывается на нем. <span>Аарон Паттерсон</span> - один из авторов этого отличного пакета.<br></p><h2>Инстанцируем агент Machanize</h2><p>Прежде чем мы начнем работу с Michanize, на нужно инстанцировать агента.</p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.new</pre><p>Этот <code class="inline">агент</code> будет использован для загрузки страницы, аналогично тому, что мы это делали с Nokogiri.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)</pre><p>Здесь агент Mechanize получл страницу подкастов с ее куки.<br></p><h2>Экстракция содержимого страницы</h2><p>Теперь у нас есть готовая для экстракции страница. Но перед этим, предлагаю рассмотреть метод <code class="inline">inspect</code>.</p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)puts page.inspect</pre><p>Результат это получается довольно существенный. Сами посмотрите из чего состоит объект <code class="inline">Mechanize::Page</code> Здесь вы можете видить все атрибуты страницы. </p><p>Это очень удобный объект для среза данных, которые вы хотите извлечь.</p><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">#&lt;Mechanize::Page {url #http://betweenscreens.fm/&gt;} {meta_refresh} {title "Between | Screens "} {iframes  #&lt;Mechanize::Page::Frame   nil   "https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/290328784&amp;color=ff0000&amp;auto...&gt;  #&lt;Mechanize::Page::Frame   nil   "https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/290126141&amp;color=ff0000&amp;auto...&gt;  #&lt;Mechanize::Page::Frame   nil   "https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/289018386&amp;color=ff0000&amp;auto...&gt;  #&lt;Mechanize::Page::Frame   nil   "https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/287425105&amp;color=ff0000&amp;auto...&gt;  #&lt;Mechanize::Page::Frame   nil   "https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/287105342&amp;color=ff0000&amp;auto...&gt;  #&lt;Mechanize::Page::Frame   nil   "https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/221003494&amp;color=ff0000&amp;auto...&gt;  #&lt;Mechanize::Page::Frame   nil   ""&gt;https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/218101809&amp;color=ff0000&amp;auto...} {frames} {links  #&lt;Mechanize::Page::Link "Logo cube" "/"&gt;  #https://github.com/vis-kid/betweenscreens"&gt;  #&lt;Mechanize::Page::Link "about" "pages/about/"&gt;  #&lt;Mechanize::Page::Link "design" "design/"&gt;  #&lt;Mechanize::Page::Link "code" "code/"&gt;  #&lt;Mechanize::Page::Link "Randy J. Hunt" "episodes/144/"&gt;  #&lt;Mechanize::Page::Link "Jason Long" "episodes/143/"&gt;  #&lt;Mechanize::Page::Link "David Heinemeier Hansson" "episodes/142/"&gt;  #&lt;Mechanize::Page::Link "Zach Holman" "episodes/141/"&gt;  #&lt;Mechanize::Page::Link "Joel Glovier" "episodes/140/"&gt;  #&lt;Mechanize::Page::Link "João Ferreira" "episodes/139/"&gt;  #&lt;Mechanize::Page::Link "Corwin Harrell" "episodes/138/"&gt;  #&lt;Mechanize::Page::Link "Older Stuff »" "page/2/"&gt;  #&lt;Mechanize::Page::Link "Exercise" "/tags/exercise/"&gt;  #&lt;Mechanize::Page::Link "Company benefits" "/tags/company-benefits/"&gt;  #&lt;Mechanize::Page::Link "Tmux" "/tags/tmux/"&gt;  #&lt;Mechanize::Page::Link "FileTask" "/tags/filetask/"&gt;  #&lt;Mechanize::Page::Link "Decision making" "/tags/decision-making/"&gt;  #&lt;Mechanize::Page::Link "Favorite feature" "/tags/favorite-feature/"&gt;  #&lt;Mechanize::Page::Link "Working out" "/tags/working-out/"&gt;  #&lt;Mechanize::Page::Link "Scott Savarie" "/tags/scott-savarie/"&gt;  #&lt;Mechanize::Page::Link "Titles" "/tags/titles/"&gt;  #&lt;Mechanize::Page::Link "Erik Spiekermann" "/tags/erik-spiekermann/"&gt;  #&lt;Mechanize::Page::Link "Newbie mistakes" "/tags/newbie-mistakes/"&gt;  #&lt;Mechanize::Page::Link "Playbook" "/tags/playbook/"&gt;  #&lt;Mechanize::Page::Link "Delegation" "/tags/delegation/"&gt;  #&lt;Mechanize::Page::Link "Heat maps" "/tags/heat-maps/"&gt;  #&lt;Mechanize::Page::Link "Europe" "/tags/europe/"&gt;  #&lt;Mechanize::Page::Link "Sizing type" "/tags/sizing-type/"&gt;  #&lt;Mechanize::Page::Link "Focus" "/tags/focus/"&gt;  #&lt;Mechanize::Page::Link "Virtual assistants" "/tags/virtual-assistants/"&gt;  #&lt;Mechanize::Page::Link "Writing" "/tags/writing/"&gt;  #&lt;Mechanize::Page::Link "Hacking" "/tags/hacking/"&gt;  #&lt;Mechanize::Page::Link "Joel Glovier" "/tags/joel-glovier/"&gt;  #&lt;Mechanize::Page::Link "Corwin Harrell" "/tags/corwin-harrell/"&gt;  #&lt;Mechanize::Page::Link "Mario C. Delgado" "/tags/mario-c-delgado/"&gt;  #&lt;Mechanize::Page::Link "Tom Dale" "/tags/tom-dale/"&gt;  #&lt;Mechanize::Page::Link "Obie Fernandez" "/tags/obie-fernandez/"&gt;  #&lt;Mechanize::Page::Link "Chad Pytel" "/tags/chad-pytel/"&gt;  #&lt;Mechanize::Page::Link "Zach Holman" "/tags/zach-holman/"&gt;  #&lt;Mechanize::Page::Link "Max Luster" "/tags/max-luster/"&gt;  #&lt;Mechanize::Page::Link "Kyle Fiedler" "/tags/kyle-fiedler/"&gt;  #&lt;Mechanize::Page::Link "Roberto Machado" "/tags/roberto-machado/"&gt;} {forms}&gt;</pre><p>Если вы хотите взглянуть на саму страницу HTML, вы можете задать методы <code class="inline">body</code> или <code class="inline">content</code>.<br></p><h3>some_scraper.rb<br></h3><pre class="brush: ruby noskimlinks noskimwords">...print page.body...</pre><h3>Результат</h3><pre class="brush: html noskimlinks noskimwords">&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;meta charset="utf-8" /&gt;    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1" /&gt;    &lt;meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"&gt;    &lt;meta name="viewport" content="initial-scale=1"&gt;    &lt;title&gt;Between | Screens &lt;/title&gt;    &lt;link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /&gt;    &lt;link href="stylesheets/all-11b45acc.css" rel="stylesheet" /&gt;    &lt;script src="javascripts/all-4c20da82.js"&gt;&lt;/script&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;header&gt;      &lt;div id="logo"&gt;        &lt;a href="/"&gt;&lt;img src="images/Between_Screens_Logo_Cube_Up-539d6997.svg" alt="Logo cube" /&gt;&lt;/a&gt;      &lt;/div&gt;      &lt;nav class="navigation"&gt;        &lt;ul class="nav-list"&gt; fork"&gt;https://github.com/vis-kid/betweenscreens"&gt;fork!          &lt;li&gt;&lt;a href="pages/about/"&gt;about&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="design/"&gt;design&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="code/"&gt;code&lt;/a&gt;&lt;/li&gt;        &lt;/ul&gt;      &lt;/nav&gt;    &lt;/header&gt;    &lt;div id="main" role="main"&gt;      &lt;div class="posts"&gt;        &lt;ul&gt;          &lt;li&gt;            &lt;article class="index-article"&gt;              &lt;span class="post-date"&gt;Oct 27 | 2016&lt;/span&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/144/"&gt;Randy J. Hunt&lt;/a&gt;&lt;/h2&gt;              &lt;h3 class="topic-list"&gt;Organizing teams | Diversity | Desires | Pizza rule | Effective over clever | Novel solutions | Straightforwardness | Research | Coffeeshop test | Small changes | Reducing errors | Granular diffs&lt;/h3&gt;              &lt;div class="soundcloud-player-small"&gt;                &lt;iframe width="100%"                  height="166"                  scrolling="no"                  frameborder="no"                  src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/290328784&amp;color=ff0000&amp;...&gt;              &lt;/div&gt;            &lt;/article&gt;          &lt;/li&gt;          &lt;li&gt;            &lt;article class="index-article"&gt;              &lt;span class="post-date"&gt;Oct 25 | 2016&lt;/span&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/143/"&gt;Jason Long&lt;/a&gt;&lt;/h2&gt;              &lt;h3 class="topic-list"&gt;Open source | Empathy | Lower barriers | Learning tool | Design contributions | Git website | Branding | GitHub | Neovim | Tmux | Design love | Knowing audiences | Showing work | Dribbble | Progressions | Ideas&lt;/h3&gt;              &lt;div class="soundcloud-player-small"&gt;                &lt;iframe width="100%"                height="166"                scrolling="no"                frameborder="no"                src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/290126141&amp;color=ff0000&amp;...&gt;              &lt;/div&gt;            &lt;/article&gt;          &lt;/li&gt;          &lt;li&gt;            &lt;article class="index-article"&gt;              &lt;span class="post-date"&gt;Oct 18 | 2016&lt;/span&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/142/"&gt;David Heinemeier Hansson&lt;/a&gt;&lt;/h2&gt;              &lt;h3 class="topic-list"&gt;Rails community | Tone | Technical disagreements | Community policing | Ungratefulness | No assholes allowed | Basecamp | Open source persona | Aspirations | Guarding motivations | Dealing with audiences | Pressure | Honesty | Diverse opinions | Small talk&lt;/h3&gt;              &lt;div class="soundcloud-player-small"&gt;                &lt;iframe width="100%"                height="166"                scrolling="no"                frameborder="no"                src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/289018386&amp;color=ff0000&amp;...&gt;              &lt;/div&gt;            &lt;/article&gt;          &lt;/li&gt;          &lt;li&gt;            &lt;article class="index-article"&gt;              &lt;span class="post-date"&gt;Oct 12 | 2016&lt;/span&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/141/"&gt;Zach Holman&lt;/a&gt;&lt;/h2&gt;              &lt;h3 class="topic-list"&gt;Getting Fired | Taboo | Transparency | Different Perspectives | Timing | Growth Stages | Employment &amp; Dating | Managers | At-will Employment | Tech Industry | Europe | Low hanging Fruits | Performance Improvement Plans | Meeting Goals | Surprise Firings | Firing Fast | Mistakes | Company Culture | Communication&lt;/h3&gt;              &lt;div class="soundcloud-player-small"&gt;                  &lt;iframe width="100%"                  height="166"                  scrolling="no"                  frameborder="no"                  src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/287425105&amp;color=ff0000&amp;...&gt;              &lt;/div&gt;            &lt;/article&gt;          &lt;/li&gt;          &lt;li&gt;            &lt;article class="index-article"&gt;              &lt;span class="post-date"&gt;Oct 10 | 2016&lt;/span&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/140/"&gt;Joel Glovier&lt;/a&gt;&lt;/h2&gt;              &lt;h3 class="topic-list"&gt;Digital Product Design | Product Design @ GitHub | Loving Design | Order &amp; Chaos | Drawing | Web Design | HospitalRun | Diversity | Startup Culture | Improving Lives | CURE International | Ember | Offline First | Hospital Information System | Designers &amp; Open Source&lt;/h3&gt;              &lt;div class="soundcloud-player-small"&gt;                &lt;iframe width="100%"                  height="166"                  scrolling="no"                  frameborder="no"                  src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/287105342&amp;color=ff0000&amp;...&gt;              &lt;/div&gt;            &lt;/article&gt;          &lt;/li&gt;          &lt;li&gt;            &lt;article class="index-article"&gt;              &lt;span class="post-date"&gt;Aug 26 | 2015&lt;/span&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/139/"&gt;João Ferreira&lt;/a&gt;&lt;/h2&gt;              &lt;h3 class="topic-list"&gt;Masters @ Work | Subvisual | Deadlines | Design personality | Design problems | Team | Pushing envelopes | Delightful experiences | Perfecting details | Company values&lt;/h3&gt;              &lt;div class="soundcloud-player-small"&gt;                &lt;iframe width="100%"                height="166"                scrolling="no"                frameborder="no"                src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/221003494&amp;color=ff0000&amp;...&gt;              &lt;/div&gt;            &lt;/article&gt;          &lt;/li&gt;          &lt;li&gt;            &lt;article class="index-article"&gt;              &lt;span class="post-date"&gt;Aug 06 | 2015&lt;/span&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/138/"&gt;Corwin Harrell&lt;/a&gt;&lt;/h2&gt;              &lt;h3 class="topic-list"&gt;Q&amp;A | 01 | University | Graphic design | Design setup | Sublime | Atom | thoughtbot | Working location | Collaboration &amp; pairing | Vim advocates | Daily routine | Standups | Clients | Coffee walks | Investment Fridays |&lt;/h3&gt;              &lt;div class="soundcloud-player-small"&gt;                &lt;iframe width="100%"                height="166"                scrolling="no"                frameborder="no"                src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/218101809&amp;color=ff0000&amp;...&gt;              &lt;/div&gt;            &lt;/article&gt;          &lt;/li&gt;        &lt;/ul&gt;      &lt;/div&gt;      &lt;section&gt;        &lt;div class="pagination-link"&gt;&lt;a href="page/2/"&gt;Older Stuff »&lt;/a&gt;&lt;/div&gt;      &lt;/section&gt;    &lt;/div&gt;    &lt;footer&gt;      &lt;div class="footer-tags"&gt;        &lt;h3&gt;Random Tags&lt;/h3&gt;        &lt;ul class="random-tag-list"&gt;          &lt;li&gt;&lt;a href="/tags/exercise/"&gt;Exercise&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/company-benefits/"&gt;Company benefits&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/tmux/"&gt;Tmux&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/filetask/"&gt;FileTask&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/decision-making/"&gt;Decision making&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/favorite-feature/"&gt;Favorite feature&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/working-out/"&gt;Working out&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/scott-savarie/"&gt;Scott Savarie&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/titles/"&gt;Titles&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/erik-spiekermann/"&gt;Erik Spiekermann&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/newbie-mistakes/"&gt;Newbie mistakes&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/playbook/"&gt;Playbook&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/delegation/"&gt;Delegation&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/heat-maps/"&gt;Heat maps&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/europe/"&gt;Europe&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/sizing-type/"&gt;Sizing type&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/focus/"&gt;Focus&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/virtual-assistants/"&gt;Virtual assistants&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/writing/"&gt;Writing&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/hacking/"&gt;Hacking&lt;/a&gt;&lt;/li&gt;        &lt;/ul&gt;      &lt;/div&gt;      &lt;div class="recent-posts"&gt;        &lt;h3&gt;Random Interviewees&lt;/h3&gt;        &lt;ul&gt;          &lt;li&gt;&lt;a href="/tags/joel-glovier/"&gt;Joel Glovier&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/corwin-harrell/"&gt;Corwin Harrell&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/mario-c-delgado/"&gt;Mario C. Delgado&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/tom-dale/"&gt;Tom Dale&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/obie-fernandez/"&gt;Obie Fernandez&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/chad-pytel/"&gt;Chad Pytel&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/zach-holman/"&gt;Zach Holman&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/max-luster/"&gt;Max Luster&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/kyle-fiedler/"&gt;Kyle Fiedler&lt;/a&gt;&lt;/li&gt;          &lt;li&gt;&lt;a href="/tags/roberto-machado/"&gt;Roberto Machado&lt;/a&gt;&lt;/li&gt;        &lt;/ul&gt;      &lt;/div&gt;    &lt;/footer&gt;  &lt;/body&gt;&lt;/html&gt;</pre><p>Поскольку подкаст имеет лишь небольшое число различных элементов на странице, вот, для примера, что получается после экстракции данных со страницы github.com. Здесь намного больше информации. Думаю, полезно попробовать разные страницы.<br></p><h3>Результат со страницы github.com</h3><pre class="brush: bash noskimlinks noskimwords">#&lt;Mechanize::Page {url #https://github.com/&gt;} {meta_refresh} {title "How people build software · GitHub"} {iframes} {frames} {links  #&lt;Mechanize::Page::Link "Skip to content" "#start-of-content"&gt;  #https://github.com/"&gt;  #&lt;Mechanize::Page::Link "\n          Personal\n" "/personal"&gt;  #&lt;Mechanize::Page::Link "\n          Open source\n" "/open-source"&gt;  #&lt;Mechanize::Page::Link "\n          Business\n" "/business"&gt;  #&lt;Mechanize::Page::Link "\n          Explore\n" "/explore"&gt;  #&lt;Mechanize::Page::Link "Sign up" "/join?source=header-home"&gt;  #&lt;Mechanize::Page::Link "Sign in" "/login"&gt;  #&lt;Mechanize::Page::Link "Pricing" "/pricing"&gt;  #&lt;Mechanize::Page::Link "Blog" "/blog"&gt;  #https://help.github.com"&gt;  #https://github.com/search"&gt;  #https://help.github.com/terms"&gt;  #https://help.github.com/privacy"&gt;  #&lt;Mechanize::Page::Link "Sign up for GitHub" "/join?source=button-home"&gt;  #&lt;Mechanize::Page::Link   "\n      \n        \n      \n      \n        A whole new Universe\n        \n          Learn about the exciting features and announcements revealed at this year"s GitHub Universe conference.\n        \n      \n    "   "/universe-2016"&gt;  #&lt;Mechanize::Page::Link "Individuals " "/personal"&gt;  #&lt;Mechanize::Page::Link "Communities " "/open-source"&gt;  #&lt;Mechanize::Page::Link "Businesses " "/business"&gt;  #&lt;Mechanize::Page::Link "NASA" "//github.com/nasa"&gt;  #&lt;Mechanize::Page::Link "Sign up for GitHub" "/join?source=button-home"&gt;  #https://github.com/contact"&gt;  #https://developer.github.com"&gt;  #https://training.github.com"&gt;  #https://shop.github.com"&gt;  #https://github.com/blog"&gt;  #https://github.com/about"&gt;  #https://github.com"&gt;  #https://github.com/site/terms"&gt;  #https://github.com/site/privacy"&gt;  #https://github.com/security"&gt;  #https://status.github.com/"&gt;  #https://help.github.com"&gt;  #&lt;Mechanize::Page::Link "Reload" ""&gt;  #&lt;Mechanize::Page::Link "Reload" ""&gt;} {forms  #&lt;Mechanize::Form   {name nil}   {method "GET"}   {action "/search"}   {fields    [hidden:0x3feb90f8297c type: hidden name: utf8 value: ✓]    [text:0x3feb90f827d8 type: text name: q value: ]}   {radiobuttons}   {checkboxes}   {file_uploads}   {buttons}&gt;  #&lt;Mechanize::Form   {name nil}   {method "POST"}   {action "/join"}   {fields    [hidden:0x3feb90f7be38 type: hidden name: utf8 value: ✓]    [hidden:0x3feb90f7bbb8 type: hidden name: authenticity_token value: vjRATKj7smXreq6Lt02r+MzW+ewWoi+fRzQXPedFAlOZgwzxQ0dZnChirhDfd7vyWZZZBO+ZFydLNedjIEDsrQ==]    [text:0x3feb90f7b9d8 type: text name: user[login] value: ]    [text:0x3feb90f7b7f8 type: text name: user[email] value: ]    [field:0x3feb90f7b654 type: password name: user[password] value: ]    [hidden:0x3feb90f7b474 type: hidden name: source value: form-home]}   {radiobuttons}   {checkboxes}   {file_uploads}   {buttons [button:0x3feb90f7a038 type: submit name:  value: ]}&gt;}&gt;</pre><p>Вернемся к нашим подкастам, вы также можете рассмотреть такие вещи, как кодирование, код ответа HTTP, URI, или заголовки ответа.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)puts "Encodings"puts page.encodingsputs "Repsonse Headers"puts page.responseputs "HTTP response code"puts page.codeputs "URI"puts page.uri</pre><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">EncodingsEUC-JPutf-8utf-8Repsonse Headers{"server"=&gt;"GitHub.com", "date"=&gt;"Sat, 29 Oct 2016 17:56:00 GMT", "content-type"=&gt;"text/html; charset=utf-8", "transfer-encoding"=&gt;"chunked", "last-modified"=&gt;"Fri, 28 Oct 2016 01:48:56 GMT", "access-control-allow-origin"=&gt;"*", "expires"=&gt;"Sat, 29 Oct 2016 18:06:00 GMT", "cache-control"=&gt;"max-age=600", "content-encoding"=&gt;"gzip", "x-github-request-id"=&gt;"501C936D:C723:1631523C:5814E2B0"}HTTP response code200URIhttp://betweenscreens.fm/</pre><p>Есть еще много интересных вещей, если вы хотите изучать дальше. А мы на этом остановимся.<br></p><h2>Методы Nokogiri</h2><ul><li><code class="inline">at</code></li> <li><code class="inline">search</code></li> </ul><p>Mechanize использует Nokogiri для эктракции данных со страниц. Вы можете применять то, что вы узнали о Nokogiri в первой статье, используя эти знания при работе с Mechanize. Это означает, что вы используете Mechanize для навигации по страницам, и методы Nokogiri для экстракции. </p><p>Например, если вы хотите найти отдельный объект, вы можете использовать метод <code class="inline">at</code>, и в тоже время метод <code class="inline">search</code> возвращает все объекты, соответствующие критериям селектора на странице. Иными словами, оба эти метода будут работать как и с объектами документа Nokogiri, так и с объектами страницы Mechanize.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)first_title = page.at("h2.post-title")all_titles = page.search("h2.post-title")all_titles.each do |title|  puts titleendputs " * "*33puts first_title</pre><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">&lt;h2 class="post-title"&gt;&lt;a href="episodes/144/"&gt;Randy J. Hunt&lt;/a&gt;&lt;/h2&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/143/"&gt;Jason Long&lt;/a&gt;&lt;/h2&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/142/"&gt;David Heinemeier Hansson&lt;/a&gt;&lt;/h2&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/141/"&gt;Zach Holman&lt;/a&gt;&lt;/h2&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/140/"&gt;Joel Glovier&lt;/a&gt;&lt;/h2&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/139/"&gt;João Ferreira&lt;/a&gt;&lt;/h2&gt;&lt;h2 class="post-title"&gt;&lt;a href="episodes/138/"&gt;Corwin Harrell&lt;/a&gt;&lt;/h2&gt; *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  * &lt;h2 class="post-title"&gt;&lt;a href="episodes/144/"&gt;Randy J. Hunt&lt;/a&gt;&lt;/h2&gt;</pre><h2>Ссылки</h2><ul><li><code class="inline">links</code></li> <li><code class="inline">link_with</code></li> <li><code class="inline">links_with</code></li> </ul><p>Мы можем перемещаться по всему сайту как захотим. Пожалуй, самое важное в Mechanize это возможность работать с ссылками. В противном случае, вы можете работать только с Nokogiri. Давайте посмотрим, что мы получим, если задать данные ссылки на странице.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)puts "#{page.links}"</pre><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">[#&lt;Mechanize::Page::Link "Logo cube" "/"&gt;, #https://github.com/vis-kid/betweenscreens"&gt;, #&lt;Mechanize::Page::Link "about" "pages/about/"&gt;, #&lt;Mechanize::Page::Link "design" "design/"&gt;, #&lt;Mechanize::Page::Link "code" "code/"&gt;, #&lt;Mechanize::Page::Link "Randy J. Hunt" "episodes/144/"&gt;, #&lt;Mechanize::Page::Link "Jason Long" "episodes/143/"&gt;, #&lt;Mechanize::Page::Link "David Heinemeier Hansson" "episodes/142/"&gt;, #&lt;Mechanize::Page::Link "Zach Holman" "episodes/141/"&gt;, #&lt;Mechanize::Page::Link "Joel Glovier" "episodes/140/"&gt;, #&lt;Mechanize::Page::Link "João Ferreira" "episodes/139/"&gt;, #&lt;Mechanize::Page::Link "Corwin Harrell" "episodes/138/"&gt;, #&lt;Mechanize::Page::Link "Older Stuff »" "page/2/"&gt;, #&lt;Mechanize::Page::Link "Exercise" "/tags/exercise/"&gt;, #&lt;Mechanize::Page::Link "Company benefits" "/tags/company-benefits/"&gt;, #&lt;Mechanize::Page::Link "Tmux" "/tags/tmux/"&gt;, #&lt;Mechanize::Page::Link "FileTask" "/tags/filetask/"&gt;, #&lt;Mechanize::Page::Link "Decision making" "/tags/decision-making/"&gt;, #&lt;Mechanize::Page::Link "Favorite feature" "/tags/favorite-feature/"&gt;, #&lt;Mechanize::Page::Link "Working out" "/tags/working-out/"&gt;, #&lt;Mechanize::Page::Link "Scott Savarie" "/tags/scott-savarie/"&gt;, #&lt;Mechanize::Page::Link "Titles" "/tags/titles/"&gt;, #&lt;Mechanize::Page::Link "Erik Spiekermann" "/tags/erik-spiekermann/"&gt;, #&lt;Mechanize::Page::Link "Newbie mistakes" "/tags/newbie-mistakes/"&gt;, #&lt;Mechanize::Page::Link "Playbook" "/tags/playbook/"&gt;, #&lt;Mechanize::Page::Link "Delegation" "/tags/delegation/"&gt;, #&lt;Mechanize::Page::Link "Heat maps" "/tags/heat-maps/"&gt;, #&lt;Mechanize::Page::Link "Europe" "/tags/europe/"&gt;, #&lt;Mechanize::Page::Link "Sizing type" "/tags/sizing-type/"&gt;, #&lt;Mechanize::Page::Link "Focus" "/tags/focus/"&gt;, #&lt;Mechanize::Page::Link "Virtual assistants" "/tags/virtual-assistants/"&gt;, #&lt;Mechanize::Page::Link "Writing" "/tags/writing/"&gt;, #&lt;Mechanize::Page::Link "Hacking" "/tags/hacking/"&gt;, #&lt;Mechanize::Page::Link "Joel Glovier" "/tags/joel-glovier/"&gt;, #&lt;Mechanize::Page::Link "Corwin Harrell" "/tags/corwin-harrell/"&gt;, #&lt;Mechanize::Page::Link "Mario C. Delgado" "/tags/mario-c-delgado/"&gt;, #&lt;Mechanize::Page::Link "Tom Dale" "/tags/tom-dale/"&gt;, #&lt;Mechanize::Page::Link "Obie Fernandez" "/tags/obie-fernandez/"&gt;, #&lt;Mechanize::Page::Link "Chad Pytel" "/tags/chad-pytel/"&gt;, #&lt;Mechanize::Page::Link "Zach Holman" "/tags/zach-holman/"&gt;, #&lt;Mechanize::Page::Link "Max Luster" "/tags/max-luster/"&gt;, #&lt;Mechanize::Page::Link "Kyle Fiedler" "/tags/kyle-fiedler/"&gt;, #&lt;Mechanize::Page::Link "Roberto Machado" "/tags/roberto-machado/"&gt;]</pre><p>Елы-палы, давайте разобьем это на отдельные части. Так как мы не задавали Mechanize поиск по всему сайту, мы получили массив только страницы. Mechanize проходит по странице сверху вниз, и возвращает список ссылок. Я создал небольшую картинку с зелеными указателями на различные ссылки, которые вы можете видеть на выходе. </p><p>Кстати, это уже конечный результат редизайна моего подкаста. Мне кажется эта версия немного лучше походит для демонстрационных целей. Вы также получите представление о том, как будет выглядеть конечный результат, и почему нужно было выбрать контент с моего старого сайта на Sinatra.<br></p><h3>Скриншот</h3><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/851/posts/27566/image/mechanize-links-850.jpg" alt="Создаем свой первый веб-скрэпер, часть 2..." title="Создаем свой первый веб-скрэпер, часть 2..." width="50" height="50"></figure><p>Как обычно, мы также можем просто извлечь текст.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)page.links.each do |link|  puts link.textend</pre><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">Logo cubefork!aboutdesigncodeRandy J. HuntJason LongDavid Heinemeier HanssonZach HolmanJoel GlovierJoão FerreiraCorwin HarrellOlder Stuff »ExerciseCompany benefitsTmuxFileTaskDecision makingFavorite featureWorking outScott SavarieTitlesErik SpiekermannNewbie mistakesPlaybookDelegationHeat mapsEuropeSizing typeFocusVirtual assistantsWritingHackingJoel GlovierCorwin HarrellMario C. DelgadoTom DaleObie FernandezChad PytelZach HolmanMax LusterKyle FiedlerRoberto Machado</pre><p>Работать со всеми этими ссылками в одной куче может быть и очень полезным, и довольно таки нудным. К счастью, у нас есть несколько инструментов для тонкой настройки.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)focus_link = agent.page.links.find { |link| link.text == "Focus" }puts focus_link</pre><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">Focus</pre><p>Бум! Кажется у нас что-то получается! Мы может сконцентрироваться на конкретных ссылках. Мы можем нацеливаться на ссылки, которые соответствуют определенным критериям — как например текст, — с более интересным API как <code class="inline">links_with</code> или <code class="inline">link_with</code>. Также, если у нас есть многочисленные <code class="inline">Focus</code> ссылки, мы можем сосредоточиться на определенном номере на странице, используя квадратные скобки <code class="inline">[]</code>.</p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)focus_link = agent.page.links_with(:text =&gt; "Focus")[2]puts focus_link</pre><p>Если же вам нужны сами ссылки, а не их текст, вам нужно только указать параметр <code class="inline">href</code>, чтобы найти эти ссылки. Mechanize не будет вам мешать. Вместо параметра <code class="inline">text</code> мы указываем параметр <code class="inline">href</code>.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">page = agent.page.link_with(href: "/episodes/95/")page = agent.page.links_with(href: "/episodes/95/")</pre><p>Если вы хотите найти первую ссылку с нужным текстом, вы также можете использовать этот синтаксис. Очень удобно и немного более читабельно.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">focus_links = agent.page.link_with(:text =&gt; "Focus")</pre><p>А теперь давайте посмотрим, что же скрывается за ссылкой <code class="inline">Focus</code>. Давайте <code class="inline">щелкнем</code> на нее!</p><h2>Клик</h2><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)focus_links = agent.page.links.find { |link| link.text == "Focus" }.click.linksputs focus_links</pre><p>Мы получим еще один длинный список ссылок, как и раньше. Видите, как легко было совместить <code class="inline">.click.links</code>. Mechanize нажимает на ссылку и переходит на следующую страницу. Поскольку мы также запросили список ссылок, мы получим все ссылки, что Mechanize сможет найти на этой новой странице.<br></p><p>Допустим, у меня есть две текстовых ссылки с одним и тем же собеседником — одна, что ссылается на теги, и другая на недавний эпизод — и мне нужно получить ссылки с каждой из этих страниц. <br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newpodcast_url = "http://betweenscreens.fm/"page = agent.get(podcast_url)links = agent.page.links_with(text: "Some interviewee")links.each do |link|  puts link.click.linksend</pre><p>Тут мы получим список ссылок с обеих страниц. Мы пройдем по ссылке каждого собеседника, Mechanize переходит по каждой ссылке, и собирает все ссылки на данной странице. Ниже вы можете найти несколько примеров комбинаций для сравнения.<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">agent.page.links.find { |l| l.text == "Focus" }agent.page.links.find { |l| l.text == "Focus" }.clickagent.page.link_with(text: "Focus")agent.page.links_with(text: "Focus")[0]agent.page.links_with(text: "Focus")[1].clickagent.page.links_with(text: "Focus")[2].click.linksagent.page.link_with(href: "/some-href")agent.page.link_with(href: "/some-href").clickagent.page.links_with(href: "/some-href")agent.page.links_with(href: "/some-href").click</pre><h2>Формы</h2><ul><li><code class="inline">submit</code></li> <li><code class="inline">field_with</code></li> <li><code class="inline">checkbox_with</code></li> <li><code class="inline">radiobuttons_with</code></li> <li><code class="inline">file_uploads</code></li> </ul><p>Давайте теперь рассмотрим формы!<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newgoogle_url = "http://google.com/"page = agent.get(google_url)forms = page.formsputs forms.inspect</pre><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">[#&lt;Mechanize::Form# Attention!! {name "f"}# Attention!! {method "GET"} {action "/search"} {fields  [hidden:0x3fea91d2eb08 type: hidden name: ie value: ISO-8859-1]  [hidden:0x3fea91d2e964 type: hidden name: hl value: es]  [hidden:0x3fea91d2e7e8 type: hidden name: source value: hp]  [hidden:0x3fea91d2e5f4 type: hidden name: biw value: ]  [hidden:0x3fea91d2e428 type: hidden name: bih value: ]# Attention!!  [text:0x3fea91d2e248 type:  name: q value: ]# Attention!!  [hidden:0x3fea91d2bcb4 type: hidden name: gbv value: 1]} {radiobuttons} {checkboxes} {file_uploads} {buttons  [submit:0x3fea91d2e0f4 type: submit name: btnG value: Buscar con Google]  [submit:0x3fea91d2be80 type: submit name: btnI value: Voy a tener suerte]}&gt;]</pre><p>Так как мы используем метод <code class="inline">forms</code>, на выходе мы получаем массив, даже если это только одна форма. Теперь, когда мы знаем, что форма имеет название <code class="inline">"f"</code>, мы можем использовать версию <code class="inline">form</code> в в единственном числе, чтобы получить более удобную информацию.</p><pre class="brush: bash noskimlinks noskimwords">...{name "f"}...</pre><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newgoogle_url = "http://google.com/"page = agent.get(google_url)search_form = page.form("f")puts search_form.inspect</pre><p>Используя <code class="inline">form"f"</code>, мы выделяем отдельную форму для работы. На выходе мы не получим массив.<br></p><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">#&lt;Mechanize::Form# Attention!! {name "f"}# Attention!! {method "GET"} {action "/search"} {fields  [hidden:0x3ffe9ce85ba4 type: hidden name: ie value: ISO-8859-1]  [hidden:0x3ffe9ce859d8 type: hidden name: hl value: es]  [hidden:0x3ffe9ce857bc type: hidden name: source value: hp]  [hidden:0x3ffe9ce85618 type: hidden name: biw value: ]  [hidden:0x3ffe9ce853e8 type: hidden name: bih value: ]# Attention!!  [text:0x3ffe9ce851cc type:  name: q value: ]# Attention!!  [hidden:0x3ffe9ce84bdc type: hidden name: gbv value: 1]} {radiobuttons} {checkboxes} {file_uploads} {buttons  [submit:0x3ffe9ce85078 type: submit name: btnG value: Buscar con Google]  [submit:0x3ffe9ce84e48 type: submit name: btnI value: Voy a tener suerte]}&gt;</pre><p>Мы также можем определить имя поля ввода текста (<code class="inline">q</code>).</p><pre class="brush: bash noskimlinks noskimwords">...[text:0x3ffe9ce851cc type:  name: q value: ]...</pre><p>Мы может выделять его по имени, устанавливая его значение как атрибуты в Ruby. Все, что нам нужно сделать, это дать ему новое значение. Вы можете видеть из примера результата, что оно пусто по умолчанию.<br></p><h3>some_scraper.rb<br></h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newgoogle_url = "http://google.com/"page = agent.get(google_url)search_form = page.form("f")search_form.q = "New Google Search"puts search_form.inspect</pre><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">#&lt;Mechanize::Form {name "f"} {method "GET"} {action "/search"} {fields  [hidden:0x3fcb85b6a784 type: hidden name: ie value: ISO-8859-1]  [hidden:0x3fcb85b6a57c type: hidden name: hl value: es]  [hidden:0x3fcb85b6a3b0 type: hidden name: source value: hp]  [hidden:0x3fcb85b6a16c type: hidden name: biw value: ]  [hidden:0x3fcb85b67f20 type: hidden name: bih value: ]# Attention!!  [text:0x3fcb85b67d18 type:  name: q value: New Google Search]# Attention!!  [hidden:0x3fcb85b67728 type: hidden name: gbv value: 1]} {radiobuttons} {checkboxes} {file_uploads} {buttons  [submit:0x3fcb85b67b9c type: submit name: btnG value: Buscar con Google]  [submit:0x3fcb85b67994 type: submit name: btnI value: Voy a tener suerte]}&gt;</pre><p>Как вы можете видетть выше, значение текстового поля изменилось на <code class="inline">New Google Search</code> (новый поиск Google). Теперь нам нужно лишь послать (<code class="inline">submit</code>) форму и собрать результаты со страницы, которую возвращает Google. Нет ничего проще. А теперь давайте проведем поиск чего-нибудь еще!</p><h3>some_scraper.rb<br></h3><pre class="brush: ruby noskimlinks noskimwords">require "mechanize"agent = Mechanize.newgoogle_url = "http://google.com/"page = agent.get(google_url)search_form = page.form("f")search_form.q = "GitHub TouchFart"page = agent.submit(search_form)pp page.search("h3.r").map(&amp;:text)</pre><p>Здесь я определил заголовок результата поиска с помощью <code class="inline">h3.r</code> селектора CSS, сопоставив его с <code class="inline">text</code>, и распечатал результаты. Ничего трудного, правда? Это, конечно, простой пример, но подумайте о том, какие бесконечные возможности это вам предоставляет!<br></p><h3>Результат</h3><pre class="brush: bash noskimlinks noskimwords">["GitHub - hungtruong/TouchFart: A fart app for the new Macbook ...", "TouchFart/TouchFart at master · hungtruong/TouchFart · GitHub", "Commits · hungtruong/TouchFart · GitHub", "Projects · hungtruong/TouchFart · GitHub", "Pull Requests · hungtruong/TouchFart · GitHub", "Issues · hungtruong/TouchFart · GitHub", "TouchFart/license.txt at master · hungtruong/TouchFart · GitHub", "Add autoplay attribute to &lt;audio&gt; tag and touchfart (er ... - GitHub", "Find file - File Finder · GitHub", "Fart app for the new Macbook Pro"s Touch... #3860 on topic touchfart ..."]</pre><p>В Mechanize имеются различные поля ввода, чтобы вы смогли поэкспериментировать. Вы даже можете загружать файлы!</p><ul><li><code class="inline">field_with</code></li> <li><code class="inline">checkbox_with</code></li> <li><code class="inline">radiobuttons_with</code></li> <li><code class="inline">file_uploads</code></li> </ul><p>Вы можете также задавать по имени такие параметры, как, радио-кнопки, и определять их с помощью метода <code class="inline">check</code>.</p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">form.radiobuttons_with(:name =&gt; "gender")[3].checkform.checkbox_with(:name =&gt; "coder").check</pre><p>Метки опций предлагают пользователям выбрать один элемент из выпадающего списка. Мы определяем их по именам и выбираем номер опции по желанию.<br></p><h4>some_scraper.rb</h4><pre class="brush: ruby noskimlinks noskimwords">form.field_with(:name =&gt; "countries").options[22].select</pre><p>Загрузка файлов работает по тому же принципу, что и ввод текста в форме, установкой его как атрибута Ruby. Определяем место загрузки и указываем путь к файлу (имя файла), который вы хотите передать. Это звучит сложнее, чем есть на самом деле. Давайте взглянем!<br></p><h3>some_scraper.rb</h3><pre class="brush: ruby noskimlinks noskimwords">form.file_uploads.first.file_name = "some-path/some-image.jpg"</pre><h2>Заключительные мысли<br></h2><p>Видите, никакого волшебства! Теперь вы достаточно оснащены, чтобы продолжать экспериментировать. Конечно, вам предстоит еще много чего узнать о Nokogiri и Mechanize, но вместо того, чтобы тратить слишком много времени на ненужные аспекты, поэкспериментируйте с этими пакетами, и если столкнетесь с проблемами, выходящими за рамки  данной статьи для начинающих, обращайтесь к документации.<br></p><p>Я надеюсь, что вы видите, насколько простые и в то же время мощные эти пакеты. Но как мы знаем, возможности также несут за собой обязанности. Используйте эти пакеты в рамках закона, когда у вас нет доступа к API. Вам вряд ли часто придется использовать эти инструменты, но они очень вам пригодятся, если надо провести экстракцию информации с веб-страниц.<br></p><p>Как я и обещал, в следующей статье мы рассмотрим реальный пример, где я буду выбирать данные с моего сайта с подкастами. Я извлеку информацию с моего старого сайта на Sinatra, и перенесу ее на новый сайт на Middleman, который использует <code class="inline">.markdown</code> файлов для каждого эпизода. Мы будем выбирать даты, номера эпизодов, имена собеседников, заголовки, подзаголовки и тому подобное. До встречи!</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Ruby" href="https://norma-studio.github.io/article5/220825079-sozdaem-svoj-pervyj-veb-skreper-chast-2" class="tm-article-body__tags-item-link">Ruby</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
32176</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
646</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
