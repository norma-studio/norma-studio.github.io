
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Это первая часть руководства из двух частей по Ansible. В этой части вы узнаете, что такое Ansible, как его установить и настроить, и как установить локальный кластер Vagrant для его тестирования. Затем вы найдете инвентарь, модули, специальные команды, книги, стратегии запуска, блоки и хранилище....">
<meta property="og:description" content="Это первая часть руководства из двух частей по Ansible. В этой части вы узнаете, что такое Ansible, как его установить и настроить, и как установить локальный кластер Vagrant для его тестирования. Затем вы найдете инвентарь, модули, специальные команды, книги, стратегии запуска, блоки и хранилище....">
<meta name="twitter:description" content="Это первая часть руководства из двух частей по Ansible. В этой части вы узнаете, что такое Ansible, как его установить и настроить, и как установить локальный кластер Vagrant для его тестирования. Затем вы найдете инвентарь, модули, специальные команды, книги, стратегии запуска, блоки и хранилище....">
<meta property="aiturec:description" content="Это первая часть руководства из двух частей по Ansible. В этой части вы узнаете, что такое Ansible, как его установить и настроить, и как установить локальный кластер Vagrant для его тестирования. Затем вы найдете инвентарь, модули, специальные команды, книги, стратегии запуска, блоки и хранилище....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html" title="Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io" title="Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543234456.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html" class="tm-user-info__username" title="
А. Гаврилов" aria-label="
А. Гаврилов">
А. Гаврилов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Автоматизируйте все с помощью Ansible: часть первая...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="DevOps" href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya" class="tm-article-snippet__hubs-item-link"><span>DevOps</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
    <meta itemprop="headline name" content="Автоматизируйте все с помощью Ansible: часть первая... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Это первая часть руководства из двух частей по Ansible. В этой части вы узнаете, что такое Ansible, как его установить и настроить, и как установить локальный кластер Vagrant для его тестирования. Затем вы найдете инвентарь, модули, специальные команды, книги, стратегии запуска, блоки и хранилище....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Это первая часть руководства из двух частей по Ansible. В этой части вы узнаете, что такое Ansible, как его установить и настроить, и как установить локальный кластер Vagrant для его тестирования. Затем вы найдете инвентарь, модули, специальные команды, книги, стратегии запуска, блоки и хранилище....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<h2>Обзор</h2><p>Это первая часть руководства из двух частей по Ansible. В этой части вы узнаете, что такое Ansible, как его установить и настроить, и как установить локальный кластер Vagrant для его тестирования. Затем вы найдете инвентарь, модули, специальные команды, книги, стратегии запуска, блоки и хранилище.</p><h2>Что такое Ansible?</h2><p><span>Ansible</span> - это инструмент управления конфигурацией и оркестровки. Он работает в том же домене, что и Puppet, Chef и Saltstack. Это означает, что с помощью Ansible вы можете удаленно предоставлять целый парк удаленных серверов, устанавливать и развертывать на них программное обеспечение и отслеживать их удаленно. </p><p>Ansible - это проект с открытым исходным кодом, реализованный на Python и имеющий подключаемую архитектуру с модулями, которые могут управлять практически любой операционной системой, облачной средой и инструментом или средой системного администрирования. Вы также можете довольно легко расширить его с помощью своих собственных плагинов, если вы хотите сделать что-то особенное.</p><p>Одной из уникальных особенностей Ansible является то, что он не устанавливает никакого программного обеспечения на управляемые машины. Управляет машинами удаленно через SSH. Чтобы управлять удаленным компьютером, вам просто нужно убедиться, что ваш открытый ключ SSH находится в файле авторизованных ключах этого компьютера.</p><h2>Начало работы с Ansible</h2><p>Ansible работает на управляющей машине и может управлять серверами под управлением любой операционной системы, но управляющая машина не может быть машиной Windows на данный момент. Я буду использовать Mac OS X в этом руководстве в качестве контрольной машины.</p><h3>Установка</h3><p>Ansible требует Python 2.6 или 2.7. Чтобы установить его, введите:</p><p><code class="inline">pip install ansible</code></p><p>В Mac OS X рекомендуется увеличить количество дескрипторов файлов:</p><p><code class="inline">sudo launchctl limit maxfiles 1024 unlimited</code></p><p>Если вы видите ошибку типа «Слишком много открытых файлов», вам, вероятно, нужно это сделать.</p><p>Чтобы проверить правильность установки Ansible, введите <code class="inline">ansible --version</code>. Вы увидите следующее:</p><pre class="brush: bash noskimlinks noskimwords">ansible 2.0.0.2  config file =  configured module search path = Default w/o overrides</pre><p>Конечно, номер версии может быть другим.</p><h3>Файл конфигурации Ansible</h3><p>Ansible имеет файл конфигурации, который позволяет вам управлять многими опциями. Порядок поиска:</p><ul><li>ANSIBLE_CONFIG (переменная окружения)</li> <li>ansible.cfg (в текущем каталоге)</li> <li>.ansible.cfg (в домашнем каталоге)</li> <li>/etc/ansible/ansible.cfg</li> </ul><p>Вы также можете переопределить определенные параметры, используя отдельные <span>переменные среды</span>, которые имеют приоритет над файлом конфигурации.</p><p>Проверьте <span>документацию Ansible</span>, чтобы узнать обо всех вариантах.</p><h3>Настройте Кластер Vagrant</h3><p>Чтобы по-настоящему понять всю мощь Ansible, вам нужно несколько серверов для управления. В этом руководстве я буду использовать кластер Vagrant из 3 виртуальных машин, но для Ansible это всего лишь несколько хостов, которыми он должен управлять. Чтобы узнать больше о Vagrant, ознакомьтесь с разделом <span>Введение в Vagrant</span>.</p><p>Сначала установите <span>VirtualBox</span> и <span>Vagrant</span>. Затем поместите следующее в файл с именем Vagrantfile в рабочем каталоге.</p><pre class="brush: ruby noskimlinks noskimwords"># -*- mode: ruby -*-# vi: set ft=ruby :hosts = {  "larry" =&gt; "192.168.88.10",  "curly" =&gt; "192.168.88.11",  "moe" =&gt; "192.168.88.12"}Vagrant.configure("2") do |config|  config.vm.box = "precise64"  config.vm.box_url = "http://files.vagrantup.com/precise64.box" hosts.each do |name, ip|    config.vm.define name do |machine|      machine.vm.network :private_network, ip: ip      machine.vm.provider "virtualbox" do |v|        v.name = name      end    end  endend</pre><p>Затем наберите <code class="inline">vagrant up</code>. Vagrant создаст для вас три виртуальные машины, доступные как larry, curly и moe. Чтобы проверить, введите <code class="inline">vagrant status</code>. Вы должны увидеть:</p><pre class="brush: bash noskimlinks noskimwords">Current machine states:larry                     running (virtualbox)curly                     running (virtualbox)moe                       running (virtualbox)This environment represents multiple VMs. The VMs are all listedabove with their current state. For more information about a specificVM, run `vagrant status NAME`.</pre><p>Чтобы убедиться, что вы можете использовать SSH на хостах кластера, введите: <code class="inline">vagrant ss &gt;&gt; ~ / .ssh / config</code>.</p><p>Теперь вы можете использовать SSH на любом из ваших виртуальных серверов, используя их имя хоста. Например: <code class="inline">ssh curly</code>. Это позволит Ansible подключаться к хостам вашего кластера через SSH без каких-либо проблем с именами пользователей, паролями или ключами.</p><h2>Инвентарь</h2><p>Теперь, когда у нас есть кластер, нам нужно рассказать об этом Ansible. Это делается с помощью инвентарного файла. Файл инвентаризации - это список имен хостов, организованных в группы с использованием формата файла INI. Поместите следующее в файл с именем "hosts" в вашей рабочей директории. </p><pre class="brush: plain noskimlinks noskimwords">[funny] larry  [funnier] curly moe</pre><p>Я поместил «larry» в группу «funny», а остальные хосты в группу «funnier». Эта организация позволит нам выполнять действия в отношении этих групп. Вы также можете выполнять действия на отдельных хостах и на всех хостах.</p><h2>Модули</h2><p>Ansible имеет очень модульную и расширяемую архитектуру. Все его возможности организованы в модули. Есть основные модули и дополнительные модули. Каждый модуль представляет команду, и большинство принимает аргументы. Вы можете использовать модули непосредственно в специальных командах или в книгах воспроизведения. Вы можете прочитать обо всех модулях в <span>документации</span>.</p><h2>Специальные команды</h2><p>Пришло время взяться за дело. Простейший способ использования Ansible - запуск специальных команд. Специальные команды используют модули. Формат специальной команды:</p><p><code class="inline">ansible  -i  -m  [-a , ... ]</code></p><p>Например, чтобы увидеть, все ли хосты в вашем инвентаре работают, вы можете использовать модуль ping (без аргументов):</p><pre class="brush: bash noskimlinks noskimwords">ansible all -i hosts -m pingcurly | SUCCESS =&gt; {    "changed": false,    "ping": "pong"}larry | SUCCESS =&gt; {    "changed": false,    "ping": "pong"}moe | SUCCESS =&gt; {    "changed": false,    "ping": "pong"}</pre><p>Ansible имеет много модулей для всех распространенных задач системного администрирования, таких как управление файлами, управление пользователями и пакетами, а также множество необычных задач. Но если вы не можете найти то, что вам нужно, или просто чувствуете себя более комфортно с простыми командами оболочки, вы можете использовать модуль оболочки напрямую, включая каналы. Следующая команда извлекает внутренние и внешние IP-адреса всех хостов:</p><pre class="brush: bash noskimlinks noskimwords">ansible all -i hosts -m shell -a "/sbin/ifconfig | grep inet.*Bcast""larry | SUCCESS | rc=0 &gt;&gt;          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0          inet addr:192.168.88.10  Bcast:192.168.88.255  Mask:255.255.255.0curly | SUCCESS | rc=0 &gt;&gt;          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0          inet addr:192.168.88.11  Bcast:192.168.88.255  Mask:255.255.255.0moe | SUCCESS | rc=0 &gt;&gt;          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0          inet addr:192.168.88.12  Bcast:192.168.88.255  Mask:255.255.255.0</pre><h2>Playbooks</h2><p>Специальные команды хороши, когда вы хотите быстро что-то сделать на нескольких хостах, но настоящая сила Ansible в его Playbooks. Playbooks - это файлы YAML, в которых вы определяете наборы задач для достижения таких целей, как подготовка, настройка, развертывание и управление вашей инфраструктурой. </p><h3>Пример Playbook</h3><p>Давайте посмотрим на то, как выглядит типичный playbook, прежде чем мы перейдем к деталям.</p><pre class="brush: plain noskimlinks noskimwords">---- hosts: funnier  tasks:   - name: Install Nginx     apt: pkg=nginx state=installed update_cache=true     notify: Start Nginx   - name: Install Python 3     apt: pkg=python3-minimal state=installed  handlers:    - name: Start Nginx      service: name=nginx state=started</pre><p>В playbook есть раздел hosts, в котором вы указываете хосты из файла инвентаризации. В этом случае название группы "funnier". Затем есть раздел задач с двумя задачами, которые устанавливают Nginx и Python 3. Наконец, есть раздел обработчиков, где Nginx запускается после его установки.</p><h3>Запуск Playbooks</h3><p>Вы запускаете playbook с помощью команды <code class="inline">ansible-playbook</code>. Вам все еще нужно предоставить файл инвентаря и книгу воспроизведения, которую вы хотите запустить. Сохраните playbook в файл с именем "playbook.yml" в вашем рабочем каталоге. Давайте попробуем:</p><pre class="brush: bash noskimlinks noskimwords">ansible-playbook -i hosts playbook.ymlPLAY ***************************************************************************TASK [setup] *******************************************************************ok: [moe]ok: [curly]TASK [Install Nginx] ***********************************************************fatal: [moe]: FAILED! =&gt; {"changed": false, "failed": true, "msg": "Failed to lock apt for exclusive operation"}fatal: [curly]: FAILED! =&gt; {"changed": false, "failed": true, "msg": "Failed to lock apt for exclusive operation"}PLAY RECAP *********************************************************************curly                      : ok=1    changed=0    unreachable=0    failed=1moe                        : ok=1    changed=0    unreachable=0    failed=1</pre><p>О нет. Что случилось? Ansible выдает приличное сообщение об ошибке здесь: «Не удалось заблокировать apt для исключительной операции». Многие playbooks требуют привилегий sudo. Этот playbook не является исключением. Чтобы запустить playbook с правами sudo, просто добавьте флаг <code class="inline">--sudo</code>:</p><pre class="brush: bash noskimlinks noskimwords">ansible-playbook -i hosts playbook.yml --sudoPLAY ***************************************************************************TASK [setup] *******************************************************************ok: [curly]ok: [moe]TASK [Install Nginx] ***********************************************************changed: [moe]changed: [curly]TASK [Install Python 3] ********************************************************changed: [moe]changed: [curly]RUNNING HANDLER [Start Nginx] **************************************************changed: [moe]changed: [curly]PLAY RECAP *********************************************************************curly                      : ok=4    changed=3    unreachable=0    failed=0moe                        : ok=4    changed=3    unreachable=0    failed=0</pre><p>Ansible является идемпотентом, что означает, что если что-то уже находится в желаемом состоянии, то Ansible оставит это в покое. В выводе <code class="inline">ansible-playbook</code> вы можете увидеть, какие задачи были успешными или неудачными, а какие были изменены.</p><p>Давайте снова запустим ту же playbook. Ничто не должно быть изменено:</p><pre class="brush: bash noskimlinks noskimwords">ansible-playbook -i hosts playbook.yml --sudoPLAY ***************************************************************************TASK [setup] *******************************************************************ok: [moe]ok: [curly]TASK [Install Nginx] ***********************************************************ok: [curly]ok: [moe]TASK [Install Python 3] ********************************************************ok: [curly]ok: [moe]PLAY RECAP *********************************************************************curly                      : ok=3    changed=0    unreachable=0    failed=0moe                        : ok=3    changed=0    unreachable=0    failed=0<br></pre><h2>Стратегии запуска</h2><p>До Ansible 2.0 playbook выполнялись линейно, задача за задачей. Все целевые хосты выполнили первое задание. Только когда все узлы были выполнены с первым заданием, они могли начать второе задание. </p><p>В Ansible 2.0 добавлена концепция стратегий запуска. В настоящее время существует две стратегии: «линейная» стратегия, которую я описал выше, которая является стратегией по умолчанию, и «свободная» стратегия, при которой хосты могут выполнять задачи в сборнике playbook по-прежнему в порядке, но не в стопах с другими хостами. </p><p>Это может быть полезно, если сотни хостов должны загрузить несколько файлов с некоторых FTP-серверов. Первый хост может завершить загрузку первого файла и перейти к следующему, в то время как другие хосты все еще заняты загрузкой первого файла. К тому моменту, когда другие хосты загрузят следующий файл, первый хост уже будет готов, и будет меньше конфликтов.</p><p>Свободная стратегия кажется превосходной в большинстве ситуаций. Вы просто добавляете <code class="inline">strategy: free</code> пару ключ-значение в playbook.</p><pre class="brush: plain noskimlinks noskimwords">- hosts: all  strategy: free  tasks:  ...</pre><h2>Блоки</h2><p>Еще одна новая особенность Ansible 2.0 - блоки. Блоки позволяют группировать задачи вместе. Это очень полезно, если у вас есть задачи, которые нужно выполнять только при определенных условиях. Раньше вам приходилось делать это для каждой задачи отдельно.</p><pre class="brush: plain noskimlinks noskimwords">---- hosts: all  tasks:    - debug: msg="Task 1 here"      when: ansible_distribution == "Ubuntu"    - debug: msg="Task 2 here"      when: ansible_distribution == "Ubuntu"    - debug: msg="Task 3 here"      when: ansible_distribution == "Ubuntu"</pre><p>С блоками вы можете сгруппировать все эти задачи отладки и поставить условие « when» на уровне блока.</p><pre class="brush: plain noskimlinks noskimwords">- hosts: all  tasks:    - block:      - debug: msg="Task 1 here"      - debug: msg="Task 2 here"      - debug: msg="Task 3 here"      when: ansible_distribution == "Ubuntu"</pre><h2>Хранилище</h2><p>Ansible связывается с удаленными компьютерами по SSH, но в плейбуках могут содержаться такие секреты, как имя пользователя, пароли и ключи API. Поскольку вы обычно храните playbooks в системах контроля версий, таких как git, эта информация будет видна всем, кто имеет доступ для чтения. </p><p>Ansible помогает с программой ansible-vault, которая позволяет создавать, редактировать и повторно шифровать зашифрованные файлы. Эти файлы могут быть расшифрованы на лету при запуске playbook, указав пароль. Если вы добавите флаг <code class="inline">--vault-ask-pass</code> в ansible-playbook, он запросит пароль хранилища. </p><p>Кроме того, вы можете добавить <code class="inline">--vault-password-file &lt;файл-пароля&gt;</code>, и Ansible прочитает пароль из вашего файла. Если вы используете файл паролей, не храните его в системе контроля версий!</p><p>Теперь вы можете безопасно хранить зашифрованные файлы в системе контроля версий и не беспокоиться о том, что кто-то найдет ваши секреты. Вам нужно тщательно управлять своим паролем хранилища. Если вы потеряете его, вы не сможете расшифровать файлы в хранилище.</p><h2>Заключение</h2><p>Ansible - отличный инструмент. Это легкий. Он может использоваться в интерактивном режиме со специальными командами и очень хорошо масштабируется для больших систем. У него также есть большой импульс и большое сообщество. Если вы управляете или даже просто работаете с удаленными серверами, вам определенно нужен Ansible.</p><p>Оставайтесь с нами для второй части.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="DevOps" href="https://norma-studio.github.io/article5/220825240-avtomatizirujte-vse-s-pomoschyu-ansible-chast-pervaya" class="tm-article-body__tags-item-link">DevOps</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
31051</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
352</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
