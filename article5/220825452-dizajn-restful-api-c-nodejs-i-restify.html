
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Restful API состоит из двух основных концепций: Ресурс (Resource) и Представление (Representation). Ресурс может представлять из себя любой объект ассоциированный с данными или определён в качестве URI (больше чем один URI может ссылаться на один и тот же ресурс) и управлять им можно используя HTTP методы. Представление - это способ, которым вы ото...">
<meta property="og:description" content="Restful API состоит из двух основных концепций: Ресурс (Resource) и Представление (Representation). Ресурс может представлять из себя любой объект ассоциированный с данными или определён в качестве URI (больше чем один URI может ссылаться на один и тот же ресурс) и управлять им можно используя HTTP методы. Представление - это способ, которым вы ото...">
<meta name="twitter:description" content="Restful API состоит из двух основных концепций: Ресурс (Resource) и Представление (Representation). Ресурс может представлять из себя любой объект ассоциированный с данными или определён в качестве URI (больше чем один URI может ссылаться на один и тот же ресурс) и управлять им можно используя HTTP методы. Представление - это способ, которым вы ото...">
<meta property="aiturec:description" content="Restful API состоит из двух основных концепций: Ресурс (Resource) и Представление (Representation). Ресурс может представлять из себя любой объект ассоциированный с данными или определён в качестве URI (больше чем один URI может ссылаться на один и тот же ресурс) и управлять им можно используя HTTP методы. Представление - это способ, которым вы ото...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/487/posts/22637/final_image/api-desing-fundamentals.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/487/posts/22637/final_image/api-desing-fundamentals.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/487/posts/22637/final_image/api-desing-fundamentals.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/487/posts/22637/final_image/api-desing-fundamentals.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/487/posts/22637/final_image/api-desing-fundamentals.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html" title="Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io" title="Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/65404fb3f3f8602d7f5b3bdc85cbef02.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html" class="tm-user-info__username" title="
А. Крайнов" aria-label="
А. Крайнов">
А. Крайнов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Дизайн RESTful API c NodeJS и Restify...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Node.js" href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify" class="tm-article-snippet__hubs-item-link"><span>Node.js</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/487/posts/22637/final_image/api-desing-fundamentals.png">
    <meta itemprop="headline name" content="Дизайн RESTful API c NodeJS и Restify... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Restful API состоит из двух основных концепций: Ресурс (Resource) и Представление (Representation). Ресурс может представлять из себя любой объект ассоциированный с данными или определён в качестве URI (больше чем один URI может ссылаться на один и тот же ресурс) и управлять им можно используя HTTP методы. Представление - это способ, которым вы ото...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Restful API состоит из двух основных концепций: Ресурс (Resource) и Представление (Representation). Ресурс может представлять из себя любой объект ассоциированный с данными или определён в качестве URI (больше чем один URI может ссылаться на один и тот же ресурс) и управлять им можно используя HTTP методы. Представление - это способ, которым вы ото...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Restful API состоит из двух основных концепций: <strong>Ресурс (Resource)</strong> и <strong>Представление (Representation)</strong>. Ресурс может представлять из себя любой объект ассоциированный с данными или определён в качестве URI (больше чем один URI может ссылаться на один и тот же ресурс) и управлять им можно используя HTTP методы. Представление - это способ, которым вы отображаете ресурс. В данном туториале мы разберём теоретическую информацию касательно дизайна RESTful API и реализуем пример API приложения - блога, используя NodeJS.<br></p><h2>Ресурс</h2><p>Выбор правильных ресурсов для RESTful API является важной частью дизайна. Для начала, вам следует определиться со сферой вашего бизнеса и решить как много и каких ресурсов будут использованы, требуются вашему бизнесу. В случае, если речь идёт о дизайне API блога, вы скорее всего будете использовать <strong>Article</strong>, <strong>User</strong> и <strong>Comment</strong>. Это были названия ресурсов, данные которые ассоциированы с этими названиями, сами по себе являются ресурсами:</p><pre class="brush: javascript noskimlinks noskimwords">{    "title": "How to Design RESTful API",    "content": "RESTful API design is a very important case in the software development world.",    "author": "huseyinbabal",    "tags": [        "technology",        "nodejs",        "node-restify"        ]    "category": "NodeJS"}</pre><h3>Методы ресурса</h3><p>После того как вы определились с необходимыми ресурсами, пришло время решить какие действия совершаемые над ресурсами нам понадобятся. Под действиями я имею ввиду HTTP методы. К примеру, для создания статьи вы можете воспользоваться следующим запросом:</p><pre class="brush: plain noskimlinks noskimwords">POST /articles HTTP/1.1Host: localhost:3000Content-Type: application/json{  "title": "RESTful API Design with Restify",  "slug": "restful-api-design-with-restify",  "content": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.",  "author": "huseyinbabal"}</pre><p>Таким же способом, вы можете просмотреть существующую статью, выполнив следующий запрос:</p><pre class="brush: plain noskimlinks noskimwords">GET /articles/123456789012 HTTP/1.1Host: localhost:3000Content-Type: application/json</pre><p>Что насчёт обновления существующей статьи? Я могу слышать, как вы говорите:</p><blockquote>Я могу сделать очередной POST запрос на /articles/update/123456789012.</blockquote><p>Может быть и неплохой вариант, но URI станет более громоздким. Как мы упоминали ранее, действия могут представлять из себя HTTP методы. Это означает, лучше выбрать <strong>updte</strong> метод вместо того, чтобы использовать URI. К примеру:</p><pre class="brush: plain noskimlinks noskimwords">PUT /articles/123456789012 HTTP/1.1Host: localhost:3000Content-Type: application/json{    "title": "Updated How to Design RESTful API",    "content": "Updated RESTful API design is a very important case in the software development world.",    "author": "huseyinbabal",    "tags": [        "technology",        "nodejs",        "restify",        "one more tag"        ]    "category": "NodeJS"}</pre><p>Кстати в данном примере вы можете заметить поля тегов и категорий. Данные поля не обязательны. Вы можете оставить их пустыми и установить значение в будущем. </p><p>Иногда вам понадобится удалить статью если она устарела. В этом случае используйте <strong>DELETE</strong> HTTP запрос для <strong>/articles/123456789012.</strong></p><p><strong></strong>Методы HTTP - стандартная концепция. Используя их в качестве действий, вы будете обладать не сложным URI, пользователи оценят подобное простое API.<br></p><p>Что если вам захочется добавить комментарий в статью? Выберите необходимую статью и добавьте новый комментарий. Для этого подойдёт следующий запрос:</p><pre class="brush: plain noskimlinks noskimwords">POST /articles/123456789012/comments HTTP/1.1Host: localhost:3000Content-Type: application/json{    "text": "Wow! this is a good tutorial",    "author": "john doe"}</pre><p>Форма ресурса выше называется <strong>под-ресурсом (sub-recource)</strong>. <strong>Комментарий (Comment)</strong> под-ресурс <strong>Статьи (Article)</strong>. <strong>Комментарий</strong> выше будет добавлен в базу данных как потомок <strong>Статьи</strong>. Иногда различные URI ссылаются на один и тот же ресурс. К примеру, для просмотра комментария вы можете использовать:</p><pre class="brush: plain noskimlinks noskimwords">GET /articles/123456789012/comments/123 HTTP/1.1Host: localhost:3000Content-Type: application/json</pre><p>или:</p><pre class="brush: plain noskimlinks noskimwords">GET /comments/123456789012 HTTP/1.1Host: localhost:3000Content-Type: application/json</pre><h3>Версии</h3><p>В основном API часто меняются, чтобы предоставить клиентам новый функционал. Поэтому, одновременно, могут существовать две версии API. Для того чтобы разделить два функционала вы можете использовать разные версии. Имеются две формы версий.</p><ol><li> <strong>Версия в URI</strong>: можно предоставить номер версии в URI. К примеру, <strong><code class="inline">/v1.1/articles/123456789012</code></strong>.<strong> </strong> </li> <li> <strong>Версия в хедере</strong>: URI остаётся без изменений, однако в хедере передаётся номер версии, к примеру:</li> </ol><pre class="brush: plain noskimlinks noskimwords">GET /articles/123456789012 HTTP/1.1Host: localhost:3000Accept-Version: 1.0</pre><p>Вообще версия меняет только представление ресурса, но не саму концепцию ресурса. Поэтому вам не нужно менять структуру URI. Предположим в v1.1 было добавлено новое поле для статьи. Однако возвращается всё также статья. Используя вторую опцию, URI остаётся простым и пользователю не приходится менять URI на стороне клиента. </p><p>Важно учесть случаи когда клиент не передаёт номер версии. Можно показать сообщение об ошибке или вернуть ответ используя первую версию. В том случае если по умолчанию используется последняя стабильная версия, пользователь в результате может получить огромное количество ошибок со стороны реализации на клиенте.</p><h2>Представление</h2><p>Представление - способ, которым API отображает ресурсы. Когда осуществляется обращение к API возвращается ресурс. Данный ресурс может быть каким угодно форматом, к примеру XML, JSON и так далее, JSON предпочтительнее, в случае если речь идёт о новом API. Однако, если обновляется существующее API, которое уже реализовано с XML форматом, можно предоставить другую версию с ответами формата JSON. </p><p>Достаточно теории о дизайне RESTful API. Давайте разберём пример из реальной жизни, разработаем дизайн и реализацию API блога с помощью Restify.</p><h2>REST API блога</h2><h3>Дизайн</h3><p>Для того чтобы создать дизайн RESTful API, нам нужно проанализировать сферу деятельности нашего приложения. Тем самым мы будем в состоянии определить необходимые ресурсы. Для API блога, нам нужно:</p><ul><li>Возможность создавать, обновлять, удалять, просматривать <strong>статью (Article)</strong> </li> <li> Создать комментарий для какой-либо <strong>статьи</strong>, обновить, удалить, просмотреть <strong>комментарий (Comment)</strong><br></li> <li> Создавать, обновлять, удалять, просматривать <strong>пользователя (User)</strong><br></li> </ul><p><strong></strong>Для данного API я не буду рассматривать аутентификацию пользователя для создания статьи или комментария. Чтобы ознакомится с реализацией аутентификации взгляните на туториал <span>Аутентификация основанная на токенах с AngularJS и NodeJS</span>. <br></p><p>Названия ресурсов готовы. Действия совершаемые над ресурсами представляют обычный CRUD. Ознакомьтесь с таблицей ниже, чтобы иметь представление о нашем API.</p><table><thead><tr><th>Название ресурса</th> <th>HTTP действие</th> <th>HTTP методы</th> </tr></thead><tbody><tr><td>Article</td> <td>create Article<br>update Article<br>delete Article<br>view Article</td> <td>POST /articles с данными<br>PUT /articles/123 c данными<br>DELETE /articles/123<br>GET /article/123</td> </tr><tr><td>Comment</td> <td>create Comment<br>update Coment<br>delete Comment<br>view Comment<br></td> <td>POST /articles/123/comments с данными<br>PUT /comments/123 с данными<br>DELETE /comments/123<br>GET /comments/123</td> </tr><tr><td>User</td> <td>create User<br>update User<br>delete User<br>view User</td> <td>POST /users с данными<br>PUT /users/123 с данными<br>DELETE /users/123<br>GET /users/123</td> </tr></tbody></table><h3>Настройка проекта</h3><p>В данном проекте мы будем использовать <strong>NodeJS</strong> с <strong>Restify</strong>. Ресурсы будут сохранятся в базе данных <strong>MongoDB</strong>. Для начала мы можем определить наши ресурсы, как Restify модели.</p><h4><strong>Статья</strong></h4><pre class="brush: javascript noskimlinks noskimwords">var mongoose = require("mongoose");var Schema   = mongoose.Schema;var ArticleSchema = new Schema({    title: String,    slug: String,    content: String,    author: {        type: String,        ref: "User"    }});mongoose.model("Article", ArticleSchema);</pre><h4><strong>Комментарий</strong></h4><pre class="brush: javascript noskimlinks noskimwords">var mongoose = require("mongoose");var Schema   = mongoose.Schema;var CommentSchema = new Schema({    text: String,    article: {        type: String,        ref: "Article"    },    author: {        type: String,        ref: "User"    }});mongoose.model("Comment", CommentSchema);</pre><h4>Пользователь</h4><p>Для ресурса User не будет никаких действий. Предполагается, что нам уже известен текущий пользователь, который будет взаимодействовать со статьями.</p><p>Вы можете спросить откуда добавляется модуль <span>mongoose</span>. Это самый популярный ORM фреймворк для MongoDB - модуль написанный на NodeJS. Данный модуль добавляется в проект в другом файле с конфигурацией. </p><p>Теперь мы можем определить HTTP действия для ресурсов описанных выше. Можно заметить следующее:</p><pre class="brush: javascript noskimlinks noskimwords">var restify = require("restify")    , fs = require("fs")var controllers = {}    , controllers_path = process.cwd() + "/app/controllers"fs.readdirSync(controllers_path).forEach(function (file) {    if (file.indexOf(".js") != -1) {        controllers[file.split(".")[0]] = require(controllers_path + "/" + file)    }})var server = restify.createServer();server    .use(restify.fullResponse())    .use(restify.bodyParser())// Article Startserver.post("/articles", controllers.article.createArticle)server.put("/articles/:id", controllers.article.updateArticle)server.del("/articles/:id", controllers.article.deleteArticle)server.get({path: "/articles/:id", version: "1.0.0"}, controllers.article.viewArticle)server.get({path: "/articles/:id", version: "2.0.0"}, controllers.article.viewArticle_v2)// Article End// Comment Startserver.post("/comments", controllers.comment.createComment)server.put("/comments/:id", controllers.comment.viewComment)server.del("/comments/:id", controllers.comment.deleteComment)server.get("/comments/:id", controllers.comment.viewComment)// Comment Endvar port = process.env.PORT || 3000;server.listen(port, function (err) {    if (err)        console.error(err)    else        console.log("App is ready at : " + port)})if (process.env.environment == "production")    process.on("uncaughtException", function (err) {        console.error(JSON.parse(JSON.stringify(err, ["stack", "message", "inner"], 2)))    })</pre><p>В данном кусочке кода, сперва все файлы с контроллерами, которые содержат методы контроллера, обрабатываются и инициализируются для запуска запроса к URI. После этого, URI для действия определяют основные CRUD действия. Также для одного действия с Article доступны разные версии. </p><p>К примеру, если установлена версия <code class="inline">2</code> в хедере Accept-Version, будет выполнен <code class="inline">viewArticle_v2</code>. <code class="inline">viewArticle</code> и <code class="inline">viewArticle_v2</code> оба делают тоже самое, показывают ресурс, но в разных форматах, как можно заметить в поле <code class="inline">title</code>. Наконец, сервер запущен на определённом порту, добавлена проверка ошибок. Мы можем продолжить работу с методами контроллера для HTTP действий ресурсов.</p><h4><strong>article.js</strong></h4><pre class="brush: javascript noskimlinks noskimwords">var mongoose = require("mongoose"),    Article = mongoose.model("Article"),    ObjectId = mongoose.Types.ObjectIdexports.createArticle = function(req, res, next) {    var articleModel = new Article(req.body);    articleModel.save(function(err, article) {        if (err) {            res.status(500);            res.json({                type: false,                data: "Error occured: " + err            })        } else {            res.json({                type: true,                data: article            })        }    })}exports.viewArticle = function(req, res, next) {    Article.findById(new ObjectId(req.params.id), function(err, article) {        if (err) {            res.status(500);            res.json({                type: false,                data: "Error occured: " + err            })        } else {            if (article) {                res.json({                    type: true,                    data: article                })            } else {                res.json({                    type: false,                    data: "Article: " + req.params.id + " not found"                })            }        }    })}exports.viewArticle_v2 = function(req, res, next) {    Article.findById(new ObjectId(req.params.id), function(err, article) {        if (err) {            res.status(500);            res.json({                type: false,                data: "Error occured: " + err            })        } else {            if (article) {                article.title = article.title + " v2"                res.json({                    type: true,                    data: article                })            } else {                res.json({                    type: false,                    data: "Article: " + req.params.id + " not found"                })            }        }    })}exports.updateArticle = function(req, res, next) {    var updatedArticleModel = new Article(req.body);    Article.findByIdAndUpdate(new ObjectId(req.params.id), updatedArticleModel, function(err, article) {        if (err) {            res.status(500);            res.json({                type: false,                data: "Error occured: " + err            })        } else {            if (article) {                res.json({                    type: true,                    data: article                })            } else {                res.json({                    type: false,                    data: "Article: " + req.params.id + " not found"                })            }        }    })}exports.deleteArticle = function(req, res, next) {    Article.findByIdAndRemove(new Object(req.params.id), function(err, article) {        if (err) {            res.status(500);            res.json({                type: false,                data: "Error occured: " + err            })        } else {            res.json({                type: true,                data: "Article: " + req.params.id + " deleted successfully"            })        }    })}</pre><p><strong></strong>Вы можете найти подробности об основных CRUD действиях Mongoose ниже:<br></p><ul><li> <strong>createArticle</strong>: простое <strong>сохранение (save)</strong> для <code class="inline">articleModel</code> посылаемое из тела запроса. Новая модель может быть создана передавая тело запроса, как конструктор для модели, такой как <code class="inline">var articleModel = newArticle(req.body)</code>. </li> <li> <strong>viewArticle</strong>: чтобы увидеть детали статьи, в качестве URL параметра нужен ID статьи. <code class="inline">findOne</code> с ID параметром, достаточно для получения деталей.</li> <li> <strong>updateArtcle</strong>: обновление статьи обычный запрос поиска и манипуляция с данными возвращённой статьи. Наконец, необходимая, обновлённая модель должна быть сохранена в базе данных с помощью команды <code class="inline">save</code>.</li> <li> <strong>deleteArticle</strong>: <code class="inline">findByIdAndRemove</code> - лучший способ удалить статьи согласно переданному ID.</li> </ul><p>Команды Mongoose упомянутые ранее - статичны, как объект Article, который также является ссылкой на схему Mongoose.</p><h4><strong>comment.js</strong></h4><pre class="brush: javascript noskimlinks noskimwords">var mongoose = require("mongoose"),    Comment = mongoose.model("Comment"),    Article = mongoose.model("Article"),    ObjectId = mongoose.Types.ObjectIdexports.viewComment = function(req, res) {    Article.findOne({"comments._id": new ObjectId(req.params.id)}, {"comments.$": 1}, function(err, comment) {        if (err) {            res.status(500);            res.json({                type: false,                data: "Error occured: " + err            })        } else {            if (comment) {                res.json({                    type: true,                    data: new Comment(comment.comments[0])                })            } else {                res.json({                    type: false,                    data: "Comment: " + req.params.id + " not found"                })            }        }    })}exports.updateComment = function(req, res, next) {    var updatedCommentModel = new Comment(req.body);    console.log(updatedCommentModel)    Article.update(        {"comments._id": new ObjectId(req.params.id)},        {"$set": {"comments.$.text": updatedCommentModel.text, "comments.$.author": updatedCommentModel.author}},        function(err) {            if (err) {                res.status(500);                res.json({                    type: false,                    data: "Error occured: " + err                })            } else {                res.json({                    type: true,                    data: "Comment: " + req.params.id + " updated"                })            }    })}exports.deleteComment = function(req, res, next) {    Article.findOneAndUpdate({"comments._id": new ObjectId(req.params.id)},        {"$pull": {"comments": {"_id": new ObjectId(req.params.id)}}},        function(err, article) {        if (err) {            res.status(500);            res.json({                type: false,                data: "Error occured: " + err            })        } else {            if (article) {                res.json({                    type: true,                    data: article                })            } else {                res.json({                    type: false,                    data: "Comment: " + req.params.id + " not found"                })            }        }    })}</pre><p><strong></strong>Когда вы делаете запрос одного из URI ресурсов, соответствующая функция описанная в контроллере будет запущена. Каждая функция внутри файла контроллера может использовать <strong>req</strong> и <strong>res</strong> объекты. Ресурс <strong>comment</strong> является под-ресурсом <strong>Article</strong>. Все действия запроса осуществляются через model статьи, чтобы найти под-документ и сделать необходимые обновления. Однако, когда вы пытаетесь посмотреть ресурс комментария, вам удастся его увидеть, даже если в MongoDB нет коллекции. </p><h2>Другие рекомендации по дизайну</h2><ul><li>Выбирайте легкий для понимания ресурс, тем самым вы облегчите процесс использования клиенту.</li> <li>Пускай бизнес логика будет реализована клиентом. К примеру, ресурс статьи имеет поле <strong>slug</strong>. Клиенту не нужно отправлять данную информацию REST API. Всё что связанно со slug должно быть обработано на стороне REST API, чтобы уменьшить сопряжение (coupling) между API и клиентом. Клиенту нужно только посылать детали заголовка и вы можете создать slug согласно бизнес потребностям на стороне REST API.</li> <li>Реализуйте уровень авторизации для конечных точек API. Неавторизированные клиенты могут получить доступ только к ограниченным данным, которые принадлежат другим пользователям. В данном туториале мы не рассмотрели ресурс User, но вы можете ознакомится с <span>Аутентификация основанная на токенах с AngularJS и NodeJS</span> для получения информации о API аутентификации.</li> <li>User URI вместо строки запроса. <code class="inline">/article/123</code> (хорошо), <code class="inline">/articles?id=12</code>3 (плохо).</li> <li>Не сохраняйте состояние; всегда используйте мгновенный ввод/вывод.</li> <li>Используйте существительные для ресурсов. Можно использовать методы HTTP для взаимодействия с ресурсами.</li> </ul><p>Ну и наконец, если разрабатывать RESTful API и следовать данным правилам, у вас всегда будет гибкая, простая в поддержке и понимании система.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Node.js" href="https://norma-studio.github.io/article5/220825452-dizajn-restful-api-c-nodejs-i-restify" class="tm-article-body__tags-item-link">Node.js</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
32089</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
302</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
