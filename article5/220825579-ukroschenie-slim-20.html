
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Slim - микрофреймворк, но в котором внутри есть много всего интересного. Он имеет невероятную систему маршрутизации и предлагает прочную базу для работы, при этом не мешая вам и не отвлекая не мелочи. Позволь мне показать тебе!...">
<meta property="og:description" content="Slim - микрофреймворк, но в котором внутри есть много всего интересного. Он имеет невероятную систему маршрутизации и предлагает прочную базу для работы, при этом не мешая вам и не отвлекая не мелочи. Позволь мне показать тебе!...">
<meta name="twitter:description" content="Slim - микрофреймворк, но в котором внутри есть много всего интересного. Он имеет невероятную систему маршрутизации и предлагает прочную базу для работы, при этом не мешая вам и не отвлекая не мелочи. Позволь мне показать тебе!...">
<meta property="aiturec:description" content="Slim - микрофреймворк, но в котором внутри есть много всего интересного. Он имеет невероятную систему маршрутизации и предлагает прочную базу для работы, при этом не мешая вам и не отвлекая не мелочи. Позволь мне показать тебе!...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/authors/gabriel-manricks/Slim_Path.png">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/authors/gabriel-manricks/Slim_Path.png">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/authors/gabriel-manricks/Slim_Path.png">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/authors/gabriel-manricks/Slim_Path.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/authors/gabriel-manricks/Slim_Path.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html" title="Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io" title="Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533ghhjgjj.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html" class="tm-user-info__username" title="
С. Парфенов" aria-label="
С. Парфенов">
С. Парфенов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Укрощение Slim 2.0...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20" class="tm-article-snippet__hubs-item-link"><span>PHP</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/authors/gabriel-manricks/Slim_Path.png">
    <meta itemprop="headline name" content="Укрощение Slim 2.0... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Slim - микрофреймворк, но в котором внутри есть много всего интересного. Он имеет невероятную систему маршрутизации и предлагает прочную базу для работы, при этом не мешая вам и не отвлекая не мелочи. Позволь мне показать тебе!...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Slim - микрофреймворк, но в котором внутри есть много всего интересного. Он имеет невероятную систему маршрутизации и предлагает прочную базу для работы, при этом не мешая вам и не отвлекая не мелочи. Позволь мне показать тебе!...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p><span>Slim</span> - микрофреймворк, но в котором внутри есть много всего интересного. Он имеет невероятную систему маршрутизации и предлагает прочную базу для работы, при этом не мешая вам и не отвлекая не мелочи. Позволь мне показать тебе!</p><p><!--more--></p> <p>Но это не означает, что у Slim нет некоторых проблем; это однофайловая настройка становится загроможденной по мере роста вашего приложения. В этой статье мы рассмотрим, как структурировать Slim-приложение, чтобы не только поддерживать, но и улучшать его функциональность и сохранять аккуратность и систематичность.</p> <hr><h2>Приступаем к Slim</h2> <p>Начнем с рассмотрения обычного кода Slim для определения проблемы. После того, как вы установили Slim через <span>Composer</span>, вам нужно создать экземпляр объекта <code>Slim</code> и определить ваши маршруты:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?php$app = new \Slim\Slim;$app-&gt;get("/", function(){    echo "Home Page";}); $app-&gt;get("/testPage", function() use ($app) {    $app-&gt;render("testpage.php");});$app-&gt;run();</pre> <blockquote class="pullquote"><p>Давайте превратим объект Slim в « controller».</p></blockquote> <p>Первый вызов метода устанавливает новый маршрут для корневого URI (<code>/</code>) и соединяет данную функцию с этим маршрутом. Это довольно многословно, но зато все легко настроить. Второй вызов метода определяет маршрут для URI <code>testPage</code>. Внутри поставляемого метода мы используем метод <code>render()</code> Slim для визуализации представления.</p> <p>Здесь первая проблема: эта функция (замыкание) не вызывается в текущем контексте и не имеет доступа к функциям Slim. Вот почему нам нужно использовать ключевое слово <code>use</code>, чтобы передать ссылку на Slim-приложение.</p> <p>Второй вопрос связан с архитектурой Slim; все должно быть определено в одном файле. Конечно, вы можете передать переменную в другой файл, но это только все запутает. В идеале нам нужна возможность добавлять контроллеры для модуляции фреймворка в отдельные компоненты. В качестве бонуса было бы неплохо, если бы эти контроллеры предлагали собственный доступ к функциям Slim, устраняя необходимость передавать ссылки в замыкания.</p> <hr><h2>Маленькая обратная инженерия</h2> <p>Спорный момент конечно изучать исходный код из проекта с открытым исходным кодом, и вообще считать ли это обратной инженерией, но это термин, которого я буду придерживаться. Мы понимаем, как использовать Slim, но что происходит под капотом? Давайте рассмотрим более сложный путь, чтобы добраться до корня этого вопроса:</p> <pre class="brush: php noskimlinks noskimwords">$app-&gt;get("/users/:name", function($name){    echo "Hello " . $name;});</pre> <p>В этом определении маршрута используется двоеточие со словом, <code>name</code>. Это местозаполнитель, и значение, используемое на его месте, передается функции. Например, <code>/users/gabriel</code> сопоставляет этот маршрут, и "gabriel" передается функции. Маршрут <code>/users</code>, с другой стороны, не соответствуют, потому что ему не хватает параметра.</p> <p>Если вы логически подумаете об этом, то для обработки маршрута необходимо выполнить несколько шагов.</p> <ul><li> <b>Шаг первый</b>: проверьте соответствие маршрута текущему URI.</li> <li> <b>Шаг второй</b>: извлеките все параметры из URI.</li> <li> <b>Шаг третий</b>: вызовите подключенное замыкание и передайте извлеченные параметры.</li> </ul><p>Чтобы оптимизировать процесс, Slim использует обратных вызовы регулярных выражений и группы - хранит заполнители, проверяя совпадения. Это объединяет два шага в один, оставляя только необходимость выполнять подключенную функцию, когда Slim готов. Становится ясно, что объект маршрута является самодостаточным, и, откровенно говоря, все, что необходимо.</p> <p>В предыдущем примере у нас был доступ к функциям Slim при разборе маршрутов, но нам нужно было передать ссылку на объект Slim, поскольку в противном случае он был бы недоступен в контексте выполнения функции. Это все, что вам нужно для большинства приложений, поскольку логика вашего приложения должна выполняться в контроллере.</p> <p>Имея это в виду, давайте извлечем часть «маршрутизации» в класс и превратим объект Slim в «контроллер».</p> <hr><h2>Начинаем</h2> <p>Для начала давайте загрузим и установим «vanilla Slim», если вы еще этого не сделали. Я предполагаю, что у вас установлен Composer, но если нет, <span>выполните следующие действия</span>.</p> <p>В новом каталоге создайте файл с именем <code>composer.json</code> и добавьте следующее:</p> <pre class="brush: js noskimlinks noskimwords">{    "name": "nettuts/slim-mvc",    "require": {        "slim/slim": "*",        "slim/extras": "*",        "twig/twig": "*"    }}</pre> <p>В окне терминала перейдите к указанному каталогу и введите <code>composer install</code>. Я проведу вас через эти пакеты, если это вы впервые используете Slim.</p> <ul><li> <b>slim/slim</b> - собственно сам фреймворк Slim.</li> <li> <b>slim/extras</b> - набор дополнительных классов для расширения Slim.</li> <li> <b>twig/twig</b> - <span>шаблонизатор Twig</span>.</li> </ul><p>Технически вам не нужны Slim extras или Twig для этого урока, но мне нравится использовать Twig вместо стандартных шаблонов PHP. Однако, если вы используете Twig, вам нужны дополнительные функции Slim, поскольку он обеспечивает интерфейс между Twig и Slim.</p> <p>Теперь добавим наши пользовательские файлы, и мы начнем с добавления каталога в папку <code>vendors</code>. Я назову свою <code>Nettuts</code>, но не стесняйтесь называть свою по своему желанию. Если вы все еще находитесь в терминале, убедитесь, что ваше окно терминала находится в каталоге проекта и введите следующее:</p> <pre class="brush: bash noskimlinks noskimwords">mkdir vendor/Nettuts</pre> <p>Теперь, отредактируйте <code>composer.json</code>, добавив ссылку на эту новую папку:</p> <pre class="brush: js noskimlinks noskimwords">{  "name": "nettuts/slim-mvc",  "require": {        "slim/slim": "*",        "slim/extras": "*",        "twig/twig": "*"  },    "autoload": {        "psr-0": {            "Nettuts": "vendor/"        }    }}</pre> <p>Мы хотим, чтобы наше приложение автоматически загружало классы из пространства имен <code>Nettuts</code>, поэтому это указывает, что Composer отображает все запросы <code>Nettuts</code> к стандарту PSR-0, начиная с папки <code>vendor</code>.</p> <p>Теперь выполните:</p> <pre class="brush: bash noskimlinks noskimwords">composer dump-autoload</pre> <p>Это перекомпилирует автозагрузчик, чтобы включить новую ссылку. Затем создайте файл с именем <code>Router.php</code> в каталоге <code>Nettuts</code> и введите следующее:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpnamespace Nettuts;Class Router{}</pre> <p>Мы видели, что каждый объект маршрута имеет автономную функцию, которая определяет, соответствует ли он предоставленному URI. Итак, нам нужен массив маршрутов и функция для их анализа. Нам также потребуется другая функция для добавления новых маршрутов и способ получения URI из текущего HTTP-запроса.</p> <p>Начнем с добавления некоторых переменных-членов и конструктора:</p> <pre class="brush: php noskimlinks noskimwords">Class Router{    protected $routes;    protected $request;    public function __construct()    {        $env = \Slim\Environment::getInstance();        $this-&gt;request = new \Slim\Http\Request($env);        $this-&gt;routes = array();    }}</pre> <p>Мы устанавливаем переменную <code>routes</code>, содержащую маршруты, и переменную <code>request</code> для хранения объекта Slim <code>Request</code>. Затем нам нужно добавить маршруты. Чтобы придерживаться лучших практик, я разобью это на два шага:</p> <pre class="brush: php noskimlinks noskimwords">public function addRoutes($routes){    foreach ($routes as $route =&gt; $path) {        $method = "any";        if (strpos($path, "@") !== false) {            list($path, $method) = explode("@", $path);        }                $func = $this-&gt;processCallback($path);        $r = new \Slim\Route($route, $func);        $r-&gt;setHttpMethods(strtoupper($method));        array_push($this-&gt;routes, $r);    }}</pre> <p>Эта публичная функция принимает ассоциативный массив маршрутов в формате <code>route =&gt; path</code>, где <code>route</code> является стандартным Slim-маршрутом, а <code>path</code> - строкой со следующим соглашением:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/authors/gabriel-manricks/Slim_Path.png" alt="Укрощение Slim 2.0..." title="Укрощение Slim 2.0..." width="50" height="50"></figure><p>При желании вы можете оставить определенные параметры для использования значения по умолчанию. Например, имя класса будет заменено на <code>Main</code>, если вы его не укажете, <code>index</code> - это значение по умолчанию для пропущенных имен функций, а по умолчанию метод HTTP - <code>any</code>. Конечно, <code>any</code> не является настоящим HTTP-методом, но это значение, которое Slim использует для соответствия всем типам методов HTTP.</p> <p>Функция <code>addRoutes</code> начинается с цикла <code>foreach</code>, который циклически проходит по маршрутам. Затем мы устанавливаем метод HTTP по умолчанию, необязательно переопределяя его с помощью предоставленного метода, если присутствует символ <code>@</code>. Затем мы передаем оставшуюся часть пути к функции для получения обратного вызова и присоединяем ее к маршруту. Наконец, мы добавляем маршрут к массиву.</p> <p>Теперь давайте посмотрим на функцию <code>processCallback()</code>:</p> <pre class="brush: php noskimlinks noskimwords">protected function processCallback($path){    $class = "Main";    if (strpos($path, ":") !== false) {        list($class, $path) = explode(":", $path);    }    $function = ($path != "") ? $path : "index";    $func = function () use ($class, $function) {        $class = "\Controllers\" . $class;        $class = new $class();        $args = func_get_args();        return call_user_func_array(array($class, $function), $args);    };    return $func;}</pre> <blockquote class="pullquote"><p>Второй вопрос связан с архитектурой Слима; все должно быть определено в одном файле.</p></blockquote> <p>Сначала мы задаем класс по умолчанию <code>Main</code> и переопределим этот класс, если найден символ двоеточия. Затем мы определяем, определена ли функция, и при необходимости используйте метод <code>index</code> по умолчанию. Затем мы передаем имена классов и функций в замыкание и возвращаем его в маршрут.</p> <p>Внутри замыкания мы добавляем имя класса в пространство имен. Затем мы создаем новый экземпляр указанного класса и извлекаем список аргументов, переданных этой функции. Если вы помните, в то время как Slim проверяет соответствие маршрута, он медленно строит список параметров, основанных на подстановках  маршрута. Эта функция (<code>func_get_args ()</code>) может использоваться для получения переданных параметров в виде массива. Затем, используя метод <code>call_user_func_array()</code>, мы можем указать класс и функцию, передавая параметры контроллеру.</p> <p>Это не очень сложная функция, как только вы ее понимаете, но это очень хороший пример того, когда замыкание нам пригодится.</p> <p>Напомним, мы добавили функцию к нашему <code>Router</code>, которая позволяет передавать ассоциативный массив, содержащий маршруты и пути, которые сопоставляются с классами и функциями. Последний шаг - обработать маршруты и выполнить любое совпадение. Сохраняя соглашение об ограничении имен, давайте назовем его <code>run</code>:</p> <pre class="brush: php noskimlinks noskimwords">public function run(){    $display404 = true;    $uri = $this-&gt;request-&gt;getResourceUri();    $method = $this-&gt;request-&gt;getMethod();    foreach ($this-&gt;routes as $i =&gt; $route) {        if ($route-&gt;matches($uri)) {            if ($route-&gt;supportsHttpMethod($method) || $route-&gt;supportsHttpMethod("ANY")) {                call_user_func_array($route-&gt;getCallable(), array_values($route-&gt;getParams()));                $display404 = false;            }        }    }    if ($display404) {        echo "404 - route not found";    }}</pre> <p>Начнем с установки переменной <code>display404</code>, отображающей не найденные маршруты, на <code>true</code>. Если мы найдем подходящий маршрут, мы установим ее в <code>false</code> и обходим сообщение об ошибке. Затем мы используем объект запроса Slim для извлечения текущего URI и HTTP метода.</p> <blockquote><p>Мы будем использовать эту информацию для прохождения и поиска совпадений из нашего массива.</p></blockquote> <p>После выполнения функции <code>matches()</code> объекта route вы можете вызвать <code>getParams()</code> для извлечения проанализированных параметров. Используя эту функцию и метод <code>getCallable()</code>, мы можем выполнить замыкание и передать необходимые параметры. Наконец, мы показываем сообщение 404, если маршрут не соответствует текущему URI.</p> <p>Давайте создадим класс контроллера, который содержит обратные вызовы для этих маршрутов. Если вы внимательно следили, то вы, возможно, заметили, что мы никогда не принуждали использовать определенный протокол или тип класса. Если вы не хотите создавать класс контроллера, то любой класс будет также работать нормально.</p> <p>Итак, зачем создавать класс контроллера? Короткий ответ: мы все еще не использовали Slim! Мы использовали части Slim для HTTP-запроса и маршрутов, но все дело в том, чтобы иметь легкий доступ ко всем свойствам Slim. Наш класс контроллера расширяет существующий класс Slim, получая доступ ко всем методам Slim.</p> <p>Вы можете так же легко пропустить этот и подкласс Slim прямо из ваших контроллеров.</p> <hr><h2>Построение контроллера</h2> <p>Этот контроллер в основном позволяет вам изменять Slim, сохраняя при всю его ванильность. Назовите файл <code>Controller.php</code> и напишите следующий код:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpnamespace Nettuts;Class Controller extends \Slim\Slim{    protected $data;    public function __construct()    {        $settings = require("../settings.php");        if (isset($settings["model"])) {            $this-&gt;data = $settings["model"];        }        parent::__construct($settings);    }}</pre> <p>Когда вы инициализируете Slim, вы можете передавать различные настройки, начиная от режима отладки приложения и заканчивая шаблоном. Вместо жесткого кодирования любых значений в конструкторе я загружаю их из файла с именем <code>settings.php</code> и передаю этот массив в конструктор родителя.</p> <blockquote><p>Поскольку мы расширяем Slim, я подумал, что было бы здорово добавить настройку «model», позволяя людям подключать свой объект данных непосредственно к контроллеру.</p></blockquote> <p>Это раздел, который вы можете увидеть в середине вышеприведенного кода. Мы проверяем, были ли установлены параметры <code>model</code> и при необходимости назначили им свойство <code>data</code> контроллера.</p> <p>Теперь создайте файл с именем <code>settings.php</code> в корневом каталоге вашего проекта (папка с файлом <code>composer.json</code>) и введите следующее:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?php$settings = array(    "view" =&gt; new \Slim\Extras\Views\Twig(),    "templates.path" =&gt; "../Views",    "model" =&gt; (Object)array(        "message" =&gt; "Hello World"    ));return $settings;</pre> <p>Это стандартные настройки Slim, за исключением модели. Любое значение, присвоенное свойству <code>model</code>, передается переменной <code>data</code>; это может быть массив, другой класс, строка и т. д. ... Я установил его для объекта, потому что мне нравится использовать нотацию <code>-&gt;</code> вместо обозначения в виде скобок (массива).</p> <p>Теперь мы можем протестировать систему. Если вы помните в классе <code>Router</code>, мы добавим имя класса в пространство имен «<code>Controller</code>». Откройте <code>composer.json</code> и добавьте следующее после определения psr-0 для пространства имен <code>Nettuts</code>:</p> <pre class="brush: js noskimlinks noskimwords">{  "name": "nettuts/slim_advanced",  "require": {        "slim/slim": "2.2.0",        "slim/extras": "*",        "twig/twig": "*"  },    "autoload": {        "psr-0": {            "Nettuts": "vendor/",            "Controller": "./"        }    }}</pre> <p>Затем, как и раньше, просто выгрузите автозагрузчик:</p> <pre class="brush: bash noskimlinks noskimwords">composer dump-autoload</pre> <p>Если мы просто установим базовый путь в корневой каталог, тогда пространство имен <code>Controller</code> будет отображено в папку с именем «<code>Controller</code>» в корне нашего приложения. Поэтому создайте эту папку:</p> <pre class="brush: bash noskimlinks noskimwords">mkdir Controller</pre> <p>Внутри этой папки создайте новый файл с именем <code>Main.php</code>. Внутри файла нам нужно объявить пространство имен и создать класс, который расширяет базовый класс <code>Controller</code>: </p><pre class="brush: php noskimlinks noskimwords">&lt;?phpnamespace Controller;Class Main extends \Nettuts\Controller{    public function index()    {        echo $this-&gt;data-&gt;message;    }    public function test()    {        echo "Test Page";    }}</pre> <p>Это не сложно. В этом классе мы определяем две функции; их имена не имеют значения, потому что мы будем их сопоставлять с маршрутами позже. Важно заметить, что я напрямую обращаюсь к свойствам от контроллера (т. е. модели) в первой функции, и на самом деле у вас будет полный доступ ко всем командам Slim.</p> <p>Давайте теперь создадим фактический публичный файл. Создайте новый каталог в корне вашего проекта и назовите его <code>public</code>. Как следует из его названия, это все, что будет в публичном доступе. Внутри этой папки создайте файл <code>index.php</code> и введите следующее:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phprequire("../vendor/autoload.php");$router = new \Nettuts\Router;$routes = array(    "/" =&gt; "Main:index@get",    "/test" =&gt; "Main:test@get");$router-&gt;addRoutes($routes);$router-&gt;run();</pre> <p>Мы включаем библиотеку автозагрузки Composer и создаем новый экземпляр нашего маршрутизатора. Затем мы определяем два маршрута, добавляем их в объект маршрутизатора и выполняем его.</p> <p>Вам также необходимо включить mod_rewrite в Apache (или эквивалент с использованием другого веб-сервера). Чтобы установить это, создайте файл с именем <code>.htaccess</code> в каталоге <code>public</code> и заполните его следующим образом:</p> <pre class="brush: bash noskimlinks noskimwords">RewriteEngine OnRewriteCond %{REQUEST_FILENAME} !-fRewriteRule ^ index.php [QSA,L]</pre> <p>Теперь все запросы к этой папке (которые не соответствуют фактическому файлу) будут перенаправлены в <code>index.php</code>.</p> <p>В своем браузере перейдите в свой каталог <code>public</code>, и вы увидите страницу с надписью «Hello World». Перейдите в «<code>/test</code>», и вы увидите сообщение «Страница тестирования». Это не очень интересно, но мы успешно перевели весь логический код в отдельные контроллеры.</p> <hr><h2>Второй раунд</h2> <blockquote class="pullquote"><p>Slim не CodeIgniter, это не Symfony, и это не Laravel.</p></blockquote> <p>Таким образом, у нас есть базовые функции, но есть несколько грубых краев. Начнем с маршрутизатора.</p> <p>На данный момент мы показываем простое сообщение об ошибке, если маршрут не существует. В реальном приложении нам нужна такая же функциональность, как и загрузка обычной страницы. Мы хотим использовать возможности Slim для загрузки представлений, а также для установки кода ошибки ответа.</p> <p>Давайте добавим новую переменную класса, которая содержит необязательный путь (как и другие маршруты). В верхней части файла добавьте следующую строку непосредственно после определения объекта запроса:</p> <pre class="brush: php noskimlinks noskimwords">protected $errorHandler;</pre> <p>Затем давайте создадим функцию, которая принимает путь и назначает ему функцию обратного вызова. Это относительно просто, потому что мы уже абстрагировали эту функциональность:</p> <pre class="brush: php noskimlinks noskimwords">public function set404Handler($path){    $this-&gt;errorHandler = $this-&gt;processCallback($path);}</pre> <p>Теперь давайте отредактируем команду <code>run</code> для необязательного выполнения обратного вызова вместо того, чтобы просто отображать сообщение об ошибке:</p> <pre class="brush: php noskimlinks noskimwords">if ($display404) {    if (is_callable($this-&gt;errorHandler)) {        call_user_func($this-&gt;errorHandler);    } else {        echo "404 - route not found";    }}</pre> <p>Откройте класс контроллера. Здесь вы можете настроить функциональность Slim на свои личные предпочтения. Например, я хотел бы, можно было опционально опусать расширение файла при загрузке представлений. Поэтому вместо написания <code>$this-&gt;render("home.php");</code>, Я просто хочу написать: <code>$this-&gt;render("home");</code>. Для этого давайте переопределим метод рендеринга:</p> <pre class="brush: php noskimlinks noskimwords">public function render($name, $data = array(), $status = null){    if (strpos($name, ".php") === false) {        $name = $name . ".php";    }    parent::render($name, $data, $status);}</pre> <p>Мы принимаем те же параметры, что и родительская функция, но проверяем, предоставлено ли расширение файла и при необходимости добавляем его. После этой модификации мы передаем файл родительскому методу для обработки.</p> <p>Это всего лишь один пример, но мы должны внести любые другие изменения в метод <code>render()</code>. Например, если вы загружаете одни и те же хедеры и футеры во все ваши документы, вы можете добавить функцию <code>renderPage()</code>. Эта функция будет загружать переданное представление между вызовами для загрузки обычного хедера и футера.</p> <p>Затем давайте посмотрим на загрузку некоторых отображений. В корне вашего проекта создайте папку с именем «<code>Views</code>» (местоположение и имя можно настроить в файле <code>settings.php</code>). Давайте просто создадим два представления с именем <code>test.php</code> и <code>error.php</code>.</p> <p>Внутри <code>test.php</code> добавьте следующее:</p> <pre class="brush: html noskimlinks noskimwords">&lt;h1&gt;{{title}}&lt;/h1&gt;&lt;p&gt;This is the {{name}} page!&lt;/p&gt;</pre> <p>И внутри файла <code>error.php</code> введите следующее:</p> <pre class="brush: html noskimlinks noskimwords">&lt;h1&gt;404&lt;/h1&gt;&lt;p&gt;The route you were looking for could not be found&lt;/p&gt;</pre> <p>Кроме того, измените <code>Main</code> контроллер, изменив функцию <code>index()</code> на следующее:</p> <pre class="brush: php noskimlinks noskimwords">public function index(){    $this-&gt;render("test", array("title" =&gt; $this-&gt;data-&gt;message, "name" =&gt; "Home"));}</pre> <p>Здесь мы визуализируем тестовое представление, которое мы только что сделали, и передаем ему данные для отображения. Затем попробуем маршрут с параметрами. Измените функцию <code>test()</code> следующим образом:</p> <pre class="brush: php noskimlinks noskimwords">public function test($title){    $this-&gt;render("test", array("title" =&gt; $title, "name" =&gt; "Test"));}</pre> <p>Здесь мы сделаем еще один шаг, извлекая заголовок страницы из самого URI. Наконец, но не в последнюю очередь, давайте добавим функцию для страницы 404:</p> <pre class="brush: php noskimlinks noskimwords">public function notFound(){    $this-&gt;render("error", array(), 404);}</pre> <p>Мы используем третий необязательный параметр функции <code>render()</code>, который устанавливает код состояния HTTP ответа.</p> <p>Осталось только отредактировать <code>index.php</code> для включения наших новых маршрутов:</p> <pre class="brush: php noskimlinks noskimwords">$routes = array(    "/" =&gt; "",    "/test/:title" =&gt; "Main:test@get");$router-&gt;addRoutes($routes);$router-&gt;set404Handler("Main:notFound");$router-&gt;run();</pre> <p>Теперь вы можете перейти к трем маршрутам и посмотреть их соответствующие отображения.</p> <hr><h2>Заключение</h2> <p>Возможно у вас есть несколько вопросов о том, почему Slim еще не предлагает все эти изменения, которые мы сделали сами. Они кажутся логичными, они не слишком отклоняются от реализации Слима, и они имеют большой смысл. <span>Джош Локхарт</span> (создатель Слима) ответил на это лучше всего:</p> <blockquote><p>«Slim это не CodeIgniter, это не Symfony, и это не Laravel. Slim это Slim. Он был построен, чтобы быть легким и веселым, но все же способен решить около 80% наиболее распространенных проблем. Вместо того, чтобы беспокоиться о краеугольных случаях, он фокусируется на том, чтобы быть простым и иметь легко читаемую кодовую базу».</p></blockquote> <p>Иногда, как разработчики, мы настолько увлечены тем, что скрываем сумасшедшие сценарии, которые мы забываем о том, что действительно важно: код. Моды, как и в этом уроке, возможны только из-за простоты и многословия кода. Так что да, могут быть какие-то краевые случаи, которые нуждаются в особом внимании, но вы получаете активное сообщество, которое, на мой взгляд, сильно снижает затраты.</p> <p>Надеюсь, вам понравилась эта статья. Если у вас есть какие-либо вопросы или комментарии, оставьте сообщение ниже. Вы также можете связаться со мной по каналу IRC на Freenode по каналу <em>#nettuts</em>.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825579-ukroschenie-slim-20" class="tm-article-body__tags-item-link">PHP</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
38495</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
407</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
