
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этом уроке вы узнаете, как создать плагин, который позволяет пользователям отправлять изображения и загружать их в медиа-библиотеку WordPress.- Вы также узнаете, как правильно удалять изображения из медиа-библиотеки WordPress, а также выполнять базовую проверку загружаемых изображений....">
<meta property="og:description" content="В этом уроке вы узнаете, как создать плагин, который позволяет пользователям отправлять изображения и загружать их в медиа-библиотеку WordPress.- Вы также узнаете, как правильно удалять изображения из медиа-библиотеки WordPress, а также выполнять базовую проверку загружаемых изображений....">
<meta name="twitter:description" content="В этом уроке вы узнаете, как создать плагин, который позволяет пользователям отправлять изображения и загружать их в медиа-библиотеку WordPress.- Вы также узнаете, как правильно удалять изображения из медиа-библиотеки WordPress, а также выполнять базовую проверку загружаемых изображений....">
<meta property="aiturec:description" content="В этом уроке вы узнаете, как создать плагин, который позволяет пользователям отправлять изображения и загружать их в медиа-библиотеку WordPress.- Вы также узнаете, как правильно удалять изображения из медиа-библиотеки WordPress, а также выполнять базовую проверку загружаемых изображений....">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=580/wp/uploads/legacy/105_UserImagesUploadTut/images/finished_form.jpg">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=580/wp/uploads/legacy/105_UserImagesUploadTut/images/finished_form.jpg">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=580/wp/uploads/legacy/105_UserImagesUploadTut/images/finished_form.jpg">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=580/wp/uploads/legacy/105_UserImagesUploadTut/images/finished_form.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=580/wp/uploads/legacy/105_UserImagesUploadTut/images/finished_form.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html" title="Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io" title="Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533jfgfsfxcv.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html" class="tm-user-info__username" title="
О. Гуськов" aria-label="
О. Гуськов">
О. Гуськов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Разрешите пользователям отправлять изображения на ваш сайт WordPress...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Plugins" href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress" class="tm-article-snippet__hubs-item-link"><span>Plugins</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=580/wp/uploads/legacy/105_UserImagesUploadTut/images/finished_form.jpg">
    <meta itemprop="headline name" content="Разрешите пользователям отправлять изображения на ваш сайт WordPress... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этом уроке вы узнаете, как создать плагин, который позволяет пользователям отправлять изображения и загружать их в медиа-библиотеку WordPress.- Вы также узнаете, как правильно удалять изображения из медиа-библиотеки WordPress, а также выполнять базовую проверку загружаемых изображений....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этом уроке вы узнаете, как создать плагин, который позволяет пользователям отправлять изображения и загружать их в медиа-библиотеку WordPress.- Вы также узнаете, как правильно удалять изображения из медиа-библиотеки WordPress, а также выполнять базовую проверку загружаемых изображений....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этом уроке вы узнаете, как создать плагин, который позволяет пользователям отправлять изображения и загружать их в медиа-библиотеку WordPress.  Вы также узнаете, как правильно удалять изображения из медиа-библиотеки WordPress, а также выполнять базовую проверку загружаемых изображений.</p><p><!--more--></p> <hr><h2>Предварительно ...</h2> <p>Этот урок создан по просьбе некоторых пользователей, которые нашли интересным <span>урок по плагинам quotes</span>, но были особенно заинтересованы в том, как использовать тот же метод для загрузки изображений из интерфейса.  Итак, вот повторение этого урока, который делает именно это.  Подробную информацию о настройке плагинов, коротких кодах и nonces см. в предыдущем учебнике.</p> <p>Плагин будет:</p> <ul><li>отображать форму загрузки изображения с использованием короткого кода</li> <li>принимать только изображения определенного типа и максимального размера</li> <li>добавлять пользовательский тип сообщения для пользовательских изображений</li> <li>добавлять изображения в медиатеку WordPress с соответствующей прикрепленной надписью </li> <li>отображать неопубликованные изображения</li> <li>позволит пользователям удалять свои неопубликованные изображения </li> </ul><p>Мы будем использовать встроенное текстовое поле для изображений в WordPress (aka Рекомендуемое изображение), чтобы удержать изображение для каждого сообщения. Это также облегчает отображение и работу с нашим изображением, так как мы можем использовать функции <span>post_thumbnail</span>.</p> <p>Вот к чему мы стремимся:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" border="0" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=580/wp/uploads/legacy/105_UserImagesUploadTut/images/finished_form.jpg" alt="Разрешите пользователям отправлять изображения на ваш сайт WordPress..." title="Разрешите пользователям отправлять изображения на ваш сайт WordPress..." width="50" height="50"></div> <p>Весь код доступен в источнике плагина в начале этого руководства.</p> <hr><h2> <span>Шаг 1</span> Настройка плагина</h2> <p>Создайте файл плагина с именем <code>submit_user_images.php</code> в каталоге <code>wp-content/plugins/submit-user-images</code>.</p> <p>Обратитесь к источнику плагина для информации заголовка плагина.</p> <hr><h2> <span>Шаг 2</span> Функция инициализации плагина</h2> <p>Мы собираемся создать <span>персонализированный тип сообщения</span> с именем user_images для хранения наших изображений пользователей и <span>пользовательской таксономии</span> с именем user_image_category. Это включит более чистое администрирование изображений, чем просто приписывать их обычным сообщениям и категориям.</p> <h3>Инициативная ловушка и функция</h3> <p>Мы будем использовать следующий код инициализации для создания нашего настраиваемого типа сообщений и пользовательской таксономии:</p> <pre class="brush: php noskimlinks noskimwords">add_action("init", "sui_plugin_init");function sui_plugin_init(){  $image_type_labels = array(    "name" =&gt; _x("User images", "post type general name"),    "singular_name" =&gt; _x("User Image", "post type singular name"),    "add_new" =&gt; _x("Add New User Image", "image"),    "add_new_item" =&gt; __("Add New User Image"),    "edit_item" =&gt; __("Edit User Image"),    "new_item" =&gt; __("Add New User Image"),    "all_items" =&gt; __("View User Images"),    "view_item" =&gt; __("View User Image"),    "search_items" =&gt; __("Search User Images"),    "not_found" =&gt;  __("No User Images found"),    "not_found_in_trash" =&gt; __("No User Images found in Trash"),     "parent_item_colon" =&gt; "",    "menu_name" =&gt; "User Images"  );    $image_type_args = array(    "labels" =&gt; $image_type_labels,    "public" =&gt; true,    "query_var" =&gt; true,    "rewrite" =&gt; true,    "capability_type" =&gt; "post",    "has_archive" =&gt; true,     "hierarchical" =&gt; false,    "map_meta_cap" =&gt; true,    "menu_position" =&gt; null,    "supports" =&gt; array("title", "editor", "author", "thumbnail")  );     register_post_type("user_images", $image_type_args);  $image_category_labels = array(    "name" =&gt; _x( "User Image Categories", "taxonomy general name" ),    "singular_name" =&gt; _x( "User Image", "taxonomy singular name" ),    "search_items" =&gt;  __( "Search User Image Categories" ),    "all_items" =&gt; __( "All User Image Categories" ),    "parent_item" =&gt; __( "Parent User Image Category" ),    "parent_item_colon" =&gt; __( "Parent User Image Category:" ),    "edit_item" =&gt; __( "Edit User Image Category" ),     "update_item" =&gt; __( "Update User Image Category" ),    "add_new_item" =&gt; __( "Add New User Image Category" ),    "new_item_name" =&gt; __( "New User Image Name" ),    "menu_name" =&gt; __( "User Image Categories" ),  );     $image_category_args = array(    "hierarchical" =&gt; true,    "labels" =&gt; $image_category_labels,    "show_ui" =&gt; true,    "query_var" =&gt; true,    "rewrite" =&gt; array( "slug" =&gt; "user_image_category" ),  );    register_taxonomy("sui_image_category", array("user_images"), $image_category_args);    $default_image_cats = array("humor", "landscapes", "sport", "people");    foreach($default_image_cats as $cat){      if(!term_exists($cat, "sui_image_category")) wp_insert_term($cat, "sui_image_category");      }    }</pre> <h3>Что делает этот код:</h3> <ul><li>использует <span>init action hook</span> WordPress для вызова функции инициализации плагина</li> <li> <span>регистрирует пользовательский тип сообщения</span> с именем user_images</li> <li> <span>регистрирует пользовательскую таксономию</span> с именем user_image_category и присваивает ее типу сообщения user_images</li> <li>добавляет некоторые категории по умолчанию в таксономию user_image_category, если они еще не существуют</li> </ul><p>Теперь у нас появится меню User Images в нашей панели управления администратора и способ администрирования изображений пользователей и их категорий.</p> <hr><h2> <span>Шаг 3</span> Настройка некоторых значений по умолчанию</h2> <p>Нам нужно сделать некоторую базовую проверку, поэтому давайте определим две константы для дальнейшего использования:</p> <pre class="brush: php noskimlinks noskimwords">define("MAX_UPLOAD_SIZE", 200000);define("TYPE_WHITELIST", serialize(array(  "image/jpeg",  "image/png",  "image/gif"  )));</pre> <hr><h2> <span>Шаг 4</span> Определите короткий код</h2> <p>Мы определим <span>короткий код</span>, который позволит нам отображать (и обрабатывать) форму отправки изображений пользователя в сообщении или на странице:</p> <pre class="brush: php noskimlinks noskimwords">add_shortcode("sui_form", "sui_form_shortcode");</pre> <hr><h2>Безопасность</h2> <p>Поскольку наш плагин принимает данные от пользователя, мы реализуем следующие механизмы безопасности:</p> <ul><li>только зарегистрированные пользователи имеют доступ к форме отправки изображения</li> <li>мы используем <span>nonces</span> для проверки того, что формы были сгенерированы нашим плагином</li> <li>изображения передаются с использованием <span>wp_insert_post</span>, который дезактивирует данные перед сохранением их в базе данных</li> <li>пользователи могут просматривать только свои собственные изображения, а nonces не позволяют им удалять сообщения других пользователей</li> </ul><hr><h2> <span>Шаг 5</span> Основная функция</h2> <p>Это функция, вызванная нашим коротким кодом. Он отображает и обрабатывает форму отправки изображения и форму для распечатки/удаления изображения. Мы будем брать его маленькими кусочками, и на шаге 6 мы рассмотрим вспомогательные функции.</p> <pre class="brush: php noskimlinks noskimwords">function sui_form_shortcode(){  if(!is_user_logged_in()){      return "&lt;p&gt;You need to be logged in to submit an image.&lt;/p&gt;";      }  global $current_user;</pre> <ul><li>проверьте, вошел ли пользователь в систему</li> <li>захватите переменную WordPress $ current_user, которую нам нужно получить для ID нашего пользователя</li> </ul><pre class="brush: php noskimlinks noskimwords">if(isset( $_POST["sui_upload_image_form_submitted"] ) &amp;&amp; wp_verify_nonce($_POST["sui_upload_image_form_submitted"], "sui_upload_image_form") ){    $result = sui_parse_file_errors($_FILES["sui_image_file"], $_POST["sui_image_caption"]);    if($result["error"]){      echo "&lt;p&gt;ERROR: " . $result["error"] . "&lt;/p&gt;";    }else{    $user_image_data = array(      "post_title" =&gt; $result["caption"],      "post_status" =&gt; "pending",      "post_author" =&gt; $current_user-&gt;ID,      "post_type" =&gt; "user_images"         );        if($post_id = wp_insert_post($user_image_data)){          sui_process_image("sui_image_file", $post_id, $result["caption"]);          wp_set_object_terms($post_id, (int)$_POST["sui_image_category"], "sui_image_category");        }  }}</pre> <ul><li>если форма изображения была отправлена, будет поле sui_upload_image_form_submitted, которое было создано нашей функцией wp_nonce_field.  Затем мы можем проверить nonce и приступить к обработке представленного изображения</li> <li>выполните проверку путем передачи входного файла (где хранятся данные загруженного изображения) и входных данных заголовка в функцию проверки, sui_parse_file_errors и отображения любых возвращенных ошибок</li> <li>постройте массив, в котором состояние сообщения должно быть отложено (администратору теперь нужно будет утвердить его для публикации), установите тип сообщения user_images (наш пользовательский тип сообщения) и установите автора сообщения с изображением в текущий вход в систему пользователя</li> <li>если сообщение об изображении было успешно вставлено, сохраните изображение в медиатеке WordPress (sui_process_image) и, наконец, установите категорию для сообщения изображения и отобразите сообщение об успешном завершении</li> </ul><pre class="brush: php noskimlinks noskimwords">if (isset( $_POST["sui_form_delete_submitted"] ) &amp;&amp; wp_verify_nonce($_POST["sui_form_delete_submitted"], "sui_form_delete")){  if(isset($_POST["sui_image_delete_id"])){      if($user_images_deleted = sui_delete_user_images($_POST["sui_image_delete_id"])){                  echo "&lt;p&gt;" . $user_images_deleted . " images(s) deleted!&lt;/p&gt;";          }  }}</pre> <ul><li>если была отправлена форма удаления изображения, будет поле sui_form_delete_submitted, которое было создано нашей функцией wp_nonce_field.  Затем мы можем проверить nonce и перейти к обработке массива изображений, проверенных для удаления</li> <li>мы проверяем, что на самом деле у нас есть некоторые изображения, проверенные для удаления, путем тестирования $ _POST ["sui_image_delete_id"].  Если это так, мы передаем их функции sui_delete_user_images (см. Шаг 6)</li> <li>если изображения были удалены, отображается сообщение об успешном завершении</li> </ul><pre class="brush: php noskimlinks noskimwords">echo sui_get_upload_image_form($sui_image_caption = $_POST["sui_image_caption"], $sui_image_category = $_POST["sui_image_category"]);if($user_images_table = sui_get_user_images_table($current_user-&gt;ID)){  echo $user_images_table;  }</pre> <ul><li>мы выводим форму загрузки изображения</li> <li>наконец, мы выводим форму списка / удаления изображений, передавая идентификатор пользователя функции sui_get_user_images_table (см. Шаг 6)</li> </ul><hr><h2> <span>Шаг 6</span> Вспомогательные функции</h2> <p>Здесь мы рассмотрим функции, которые генерируют формы, добавляют изображения в медиа-библиотеку и функцию, которая удаляет выбранные изображения. </p> <pre class="brush: php noskimlinks noskimwords">function sui_get_upload_image_form($sui_image_caption = "", $sui_image_category = 0){  $out = "";  $out .= "&lt;form id="sui_upload_image_form" method="post" action="" enctype="multipart/form-data"&gt;";  $out .= wp_nonce_field("sui_upload_image_form", "sui_upload_image_form_submitted");    $out .= "&lt;label for="sui_image_caption"&gt;Image Caption - Letters, Numbers and Spaces&lt;/label&gt;&lt;br/&gt;";  $out .= "&lt;input type="text" id="sui_image_caption" name="sui_image_caption" value="" . $sui_image_caption . ""/&gt;&lt;br/&gt;";  $out .= "&lt;label for="sui_image_category"&gt;Image Category&lt;/label&gt;&lt;br/&gt;";    $out .= sui_get_image_categories_dropdown("sui_image_category", $sui_image_category) . "&lt;br/&gt;";  $out .= "&lt;label for="sui_image_file"&gt;Select Your Image - " . MAX_UPLOAD_SIZE . " bytes maximum&lt;/label&gt;&lt;br/&gt;";    $out .= "&lt;input type="file" size="60" name="sui_image_file" id="sui_image_file"&gt;&lt;br/&gt;";      $out .= "&lt;input type="submit" id="sui_submit" name="sui_submit" value="Upload Image"&gt;";  $out .= "&lt;/form&gt;";  return $out;  }</pre> <ul><li>функция принимает 2 опциональных аргумента для повторного заполнения полей формы.  Это удобно для пользователя. </li> <li>выводится поле nonce, которое мы проверяем при отправке формы</li> <li>выводим выпадающее меню для категорий изображений, вызывая sui_get_image_categories_dropdown (см. Следующую функцию)</li> </ul><pre class="brush: php noskimlinks noskimwords">function sui_get_image_categories_dropdown($taxonomy, $selected){  return wp_dropdown_categories(array("taxonomy" =&gt; $taxonomy, "name" =&gt; "sui_image_category", "selected" =&gt; $selected, "hide_empty" =&gt; 0, "echo" =&gt; 0));}</pre> <ul><li>функция принимает 2 аргумента, включая элемент ID, выбранной в данный момент категории </li> <li>мы используем функцию WordPress <span>wp_dropdown_categories</span> для создания раскрывающегося списка, в котором перечислены категории пользовательских изображений из таксономии user_image_category (наша пользовательская таксономия). </li> </ul><pre class="brush: php noskimlinks noskimwords">function sui_get_user_images_table($user_id){  $args = array(    "author" =&gt; $user_id,    "post_type" =&gt; "user_images",    "post_status" =&gt; "pending"      );    $user_images = new WP_Query($args);  if(!$user_images-&gt;post_count) return 0;    $out = "";  $out .= "&lt;p&gt;Your unpublished images - Click to see full size&lt;/p&gt;";    $out .= "&lt;form method="post" action=""&gt;";    $out .= wp_nonce_field("sui_form_delete", "sui_form_delete_submitted");      $out .= "&lt;table id="user_images"&gt;";  $out .= "&lt;thead&gt;&lt;th&gt;Image&lt;/th&gt;&lt;th&gt;Caption&lt;/th&gt;&lt;th&gt;Category&lt;/th&gt;&lt;th&gt;Delete&lt;/th&gt;&lt;/thead&gt;";      foreach($user_images-&gt;posts as $user_image){      $user_image_cats = get_the_terms($user_image-&gt;ID, "sui_image_category");        foreach($user_image_cats as $cat){          $user_image_cat = $cat-&gt;name;        }        $post_thumbnail_id = get_post_thumbnail_id($user_image-&gt;ID);       $out .= wp_nonce_field("sui_image_delete_" . $user_image-&gt;ID, "sui_image_delete_id_" . $user_image-&gt;ID, false);            $out .= "&lt;tr&gt;";    $out .= "&lt;td&gt;" . wp_get_attachment_link($post_thumbnail_id, "thumbnail") . "&lt;/td&gt;";        $out .= "&lt;td&gt;" . $user_image-&gt;post_title . "&lt;/td&gt;";    $out .= "&lt;td&gt;" . $user_image_cat . "&lt;/td&gt;";        $out .= "&lt;td&gt;&lt;input type="checkbox" name="sui_image_delete_id[]" value="" . $user_image-&gt;ID . "" /&gt;&lt;/td&gt;";              $out .= "&lt;/tr&gt;";      }  $out .= "&lt;/table&gt;";      $out .= "&lt;input type="submit" name="sui_delete" value="Delete Selected Images" /&gt;";  $out .= "&lt;/form&gt;";      return $out;}</pre> <ul><li>принимает ID пользователя, потому что нам нужно получить список пользовательских изображений только для текущего пользователя </li> <li>создает $args, чтобы указать нашего пользователя, тип сообщения user_images и пользовательские изображения, которые находятся на рассмотрении (еще не опубликованы администратором)</li> <li>выполняет пользовательский запрос с использованием <span>WP_Query </span> </li> <li>вернуть false, если наш запрос не возвращает никакие изображения пользователя</li> <li>запустить форму и сгенерировать nonce для формы</li> <li>прокрутить записи изображений, чтобы убедиться, что мы также захватим категорию сообщения об изображении</li> <li>создайте флажок nonce для удаления изображения, присвойте уникальное имя для nonce, объединив ID сообщения изображения пользователя</li> <li>вывод строки таблицы, содержащей информацию о сообщении изображения, а также флажок удаления</li> </ul><h3>Зачем добавлять nonce для каждого изображения?</h3> <p>Формами можно манипулировать в браузере для отправки неожиданных данных.  В нашем случае каждому флажку delete присваивается значение сообщения.  Но что, если злонамеренный пользователь изменил это значение и заставил нашу функцию удаления отменить сообщение, которое на самом деле не указано?</p> <p>Один из способов избежать этого - использовать nonces для каждой строки почтовых данных, обеспечивая уникальность имени nonce, при этом значение столбца должно быть удалено. Затем мы проверяем сообщение nonce при отправке формы, чтобы убедиться, что это истинное возвращаемое значение. </p> <pre class="brush: php noskimlinks noskimwords">function sui_delete_user_images($images_to_delete){  $images_deleted = 0;  foreach($images_to_delete as $user_image){    if (isset($_POST["sui_image_delete_id_" . $user_image]) &amp;&amp; wp_verify_nonce($_POST["sui_image_delete_id_" . $user_image], "sui_image_delete_" . $user_image)){          if($post_thumbnail_id = get_post_thumbnail_id($user_image)){        wp_delete_attachment($post_thumbnail_id);            }        wp_trash_post($user_image);            $images_deleted ++;    }  }  return $images_deleted;}</pre> <ul><li>функция принимает массив ID сообщений изображения для удаления</li> <li> каждый ID сообщения изображения проверяется, чтобы узнать, было ли для него сгенерировано nonce</li> <li>если nonce проверяется, мы удаляем вложение изображения, которое существует в медиа-библиотеке, передавая ID изображения сообщения в функцию WordPress <span>wp_delete_attachment</span>  </li> <li>мы также удаляем сообщение изображения с помощью функции WordPress <span>wp_trash_post</span> </li> </ul><h3>Но не удаляется ли вложение эскизов, когда сообщение оборвано? </h3> <p>Нет, и это потому, что WordPress хранит вложения как обычные записи в таблице базы данных сообщений. Посмотрите сами: все вложения хранятся в таблице сообщений с post_type вложения. Простое удаление типа пользователя user_images не удаляет его вложение в миниатюру. Он остается в медиа-библиотеке для будущего использования, если мы специально не удалим его с помощью wp_delete_attachment. Для наших целей я подумал, что лучше удалять вложение, когда сообщение пользователя было удалено. </p> <hr><h2> <span>Шаг 7</span> Функции обработки изображений</h2> <p>Напомним, как выглядит вывод ввода файла html, когда он помещает изображение в ваш скрипт:</p> <pre class="brush: php noskimlinks noskimwords">Array(    [name] =&gt; ref_blind.jpg    [type] =&gt; image/jpeg    [tmp_name] =&gt; /tmp/php79xI4e    [error] =&gt; 0    [size] =&gt; 106290)</pre> <p>Мы передаем этот массив к функции sui_process_image вместе с идентификатором сохраненной записи изображения пользователя и заголовком подчищенного изображения. </p> <pre class="brush: php noskimlinks noskimwords">function sui_process_image($file, $post_id, $caption){   require_once(ABSPATH . "wp-admin" . "/includes/image.php");  require_once(ABSPATH . "wp-admin" . "/includes/file.php");  require_once(ABSPATH . "wp-admin" . "/includes/media.php");   $attachment_id = media_handle_upload($file, $post_id);   update_post_meta($post_id, "_thumbnail_id", $attachment_id);  $attachment_data = array(  "ID" =&gt; $attachment_id,    "post_excerpt" =&gt; $caption  );    wp_update_post($attachment_data);  return $attachment_id;}</pre> <ul><li>нам нужно включить сценарии администратора WordPress, которые обрабатывают загрузку изображений за кадром </li> <li>мы вызываем функцию <span>media_handle_upload</span> (которая является частью медиафайла .php),  передавая ему загруженный массив файлов и идентификатор сообщения</li> <li>теперь у нас есть идентификатор вложения, который мы можем использовать с помощью<span> update_post_meta</span>, чтобы назначить вложение для сообщения в виде миниатюры.  Примечание: "_thumbnail_id" ссылается на мета-поле внутреннего миниатюра (обработанное изображение).  Внутренние поля Wordpress начинаются с подчеркивания. </li> <li>затем мы используем идентификатор вложения, чтобы обновить заголовок вложения, используя функцию <span>wp_update_post</span></li> </ul><p>Поскольку вложения - это просто регулярные сообщения, если мы обновляем поле post_excerpt для вложения, мы фактически обновляем поле заголовка вложения, как показано на экране редактирования медиа-библиотеки.</p> <h3>Функция проверки</h3> <p>Мы также проверяем массив файлов и пользовательскую подпись изображения с помощью функции sui_parse_file_errors. </p> <pre class="brush: php noskimlinks noskimwords">function sui_parse_file_errors($file = "", $image_caption){  $result = array();  $result["error"] = 0;    if($file["error"]){      $result["error"] = "No file uploaded or there was an upload error!";        return $result;    }  $image_caption = trim(preg_replace("/[^a-zA-Z0-9\s]+/", " ", $image_caption));    if($image_caption == ""){    $result["error"] = "Your caption may only contain letters, numbers and spaces!";        return $result;    }    $result["caption"] = $image_caption;    $image_data = getimagesize($file["tmp_name"]);    if(!in_array($image_data["mime"], unserialize(TYPE_WHITELIST))){      $result["error"] = "Your image must be a jpeg, png or gif!";      }elseif(($file["size"] &gt; MAX_UPLOAD_SIZE)){      $result["error"] = "Your image was " . $file["size"] . " bytes! It must not exceed " . MAX_UPLOAD_SIZE . " bytes.";      }      return $result;}</pre> <ul><li>проверить элемент ошибки массива файлов для ошибки загрузки html, если он найден, возвращает массив результатов с ошибкой</li> <li>запустите некоторое регулярное выражение в заголовке изображения, чтобы удалить все, кроме буквенно-цифровых данных и пробелов, заменяя пробелы для удобства чтения</li> <li>если у нас заканчивается пустой заголовок после его очистки, мы возвращаем ошибку</li> <li>проверьте внутренний тип изображения (не доверяйте расширению файла) с помощью функции PHP <span>getimagesize </span>с постоянной TYPE_WHITELIST</li> <li>проверьте размер изображения вопреки константе MAX_UPLOAD_SIZE</li> </ul><hr><h2> <span>Шаг 8</span> Некоторые стили. </h2> <p>Просто отбросьте эту информацию  о стиле в файл style.css в папке темы:</p> <pre class="brush: css noskimlinks noskimwords">#sui_upload_image_form #sui_image_caption{  width:500px;}#user_images{  font-size:12px;}#user_images th{  text-align:left;}#user_images td{  vertical-align:middle;}#user_images td input{  margin:0px;}</pre> <hr><h2> <span>Шаг 9</span> Попробуйте </h2> <p>Активируйте плагин, введите короткий код на странице, зайдите на свой сайт и проверьте его.  Когда вы загрузите изображение, вы увидите новое сообщение в меню Пользовательские изображения.  Он будет опубликован.  Вы также увидите новое изображение, включенное в вашу медиа-библиотеку, прикрепленное к вашему новому сообщению, с заголовком, как предусмотрено.</p> <p>Полный источник кода плагина и ссылка на демо-сайт указаны в верхней части этого урока. </p> <p>Исходная папка также содержит шаблон страницы Wordpress с настраиваемым циклом, который отображает опубликованные изображения для всех пользователей.</p> <hr><h2>Последние размышления</h2> <p>Возможно, вы захотите установить более строгую проверку на загрузку изображений.  Помните, что вы принимаете данные от пользователей, которые могут случайно или злонамеренно загружать неприемлемые файлы. Проверка типа и размера файла является хорошим началом. </p> <p>Также мы создали заголовок приложения, обновив поле вложения post_excerpt. Вы также можете установить описание вложения, используя поле вложения post_content.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Plugins" href="https://norma-studio.github.io/article5/220825667-razreshite-polzovatelyam-otpravlyat-izobrazheniya-na-vash-sajt-wordpress" class="tm-article-body__tags-item-link">Plugins</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
43605</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
384</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
