
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="RabbitMQ - отличный брокер распределенных сообщений, но его не так просто администрировать программно. В этом уроке я покажу вам, как создать кластер, добавить узлы, удалить узлы, запускать их и останавливать. В качестве бонуса я поделюсь файлом Fabric, который позволит вам получить полный контроль. Код доступен на GitHub....">
<meta property="og:description" content="RabbitMQ - отличный брокер распределенных сообщений, но его не так просто администрировать программно. В этом уроке я покажу вам, как создать кластер, добавить узлы, удалить узлы, запускать их и останавливать. В качестве бонуса я поделюсь файлом Fabric, который позволит вам получить полный контроль. Код доступен на GitHub....">
<meta name="twitter:description" content="RabbitMQ - отличный брокер распределенных сообщений, но его не так просто администрировать программно. В этом уроке я покажу вам, как создать кластер, добавить узлы, удалить узлы, запускать их и останавливать. В качестве бонуса я поделюсь файлом Fabric, который позволит вам получить полный контроль. Код доступен на GitHub....">
<meta property="aiturec:description" content="RabbitMQ - отличный брокер распределенных сообщений, но его не так просто администрировать программно. В этом уроке я покажу вам, как создать кластер, добавить узлы, удалить узлы, запускать их и останавливать. В качестве бонуса я поделюсь файлом Fabric, который позволит вам получить полный контроль. Код доступен на GitHub....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html" title="Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io" title="Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543234456.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html" class="tm-user-info__username" title="
А. Гаврилов" aria-label="
А. Гаврилов">
А. Гаврилов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Управление вашим кластером RabbitMQ...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Apps" href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq" class="tm-article-snippet__hubs-item-link"><span>Web Apps</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=80/uploads/users/1199/profiles/19709/profileImage/gigi_kettlebell_400x400.jpg">
    <meta itemprop="headline name" content="Управление вашим кластером RabbitMQ... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="RabbitMQ - отличный брокер распределенных сообщений, но его не так просто администрировать программно. В этом уроке я покажу вам, как создать кластер, добавить узлы, удалить узлы, запускать их и останавливать. В качестве бонуса я поделюсь файлом Fabric, который позволит вам получить полный контроль. Код доступен на GitHub....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">RabbitMQ - отличный брокер распределенных сообщений, но его не так просто администрировать программно. В этом уроке я покажу вам, как создать кластер, добавить узлы, удалить узлы, запускать их и останавливать. В качестве бонуса я поделюсь файлом Fabric, который позволит вам получить полный контроль. Код доступен на GitHub....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p><span>RabbitMQ</span> - отличный брокер распределенных сообщений, но его не так просто администрировать программно. В этом уроке я покажу вам, как создать кластер, добавить узлы, удалить узлы, запускать их и останавливать. В качестве бонуса я поделюсь файлом Fabric, который позволит вам получить полный контроль. Код <span>доступен на GitHub</span>.</p><h2>Краткое введение в RabbitMQ</h2> <p>RabbitMQ - очень популярная очередь сообщений. У вас может быть несколько производителей, отправляющих сообщения, и потребители могут использовать эти сообщения полностью отделенным образом. RabbitMQ очень популярен по нескольким причинам:</p> <ol><li>Это быстро и надежно.</li> <li>Это <span>открытый исходный код</span>, но есть коммерческая поддержка, если вы этого хотите.</li> <li>Он работает в вашей операционной системе.</li> <li>Он активно развивается.</li> <li>Он проверен в бою.</li> </ol><p>RabbitMQ реализован на Erlang, что немного необычно, но одна из причин, по которой он так надежен.</p> <h2>Предпосылки</h2> <p>В этом руководстве я буду использовать локальный кластер Vagrant из трех узлов. Если у вас уже есть три доступные машины (виртуальные или нет), вы можете использовать их вместо этого. Обратите внимание на порты и сети.</p> <h3>Установите VirtualBox</h3> <p>Следуйте <span>инструкциям</span> по установке VirtualBox.</p> <h3>Установить Vagrant</h3> <p>Следуйте <span>инструкциям</span> по установке Vagrant</p> <h2>Создать кластер RabbitMQ</h2> <p>Вот Vagrantfile, который создаст локальный трехузловой кластер на вашем компьютере. ОС Ubuntu 14.04 (Trusty).</p> <p><code class="inline">ruby # -*- mode: ruby -*- # vi: set ft=ruby : hosts = { "rabbit-1" =&gt; "192.168.77.10", "rabbit-2" =&gt; "192.168.77.11", "rabbit-3" =&gt; "192.168.77.12" } Vagrant.configure("2") do |config| config.vm.box = "trusty64" hosts.each_with_index do |(name, ip), i| rmq_port = 5672 + i admin_port = 15672 + i config.vm.define name do |machine| machine.vm.network :private_network, ip: ip config.vm.hostname = "rabbit-%d" % [i + 1] config.vm.network :forwarded_port, guest: 5672, guest_ip: ip, host: rmq_port config.vm.network :forwarded_port, guest: 15672, guest_ip: ip, host: admin_port machine.vm.provider "virtualbox" do |v| v.name = name end end end end </code></p> <p>Чтобы создать пустой кластер, введите: <code class="inline">vagrant up</code>.</p> <h3>Настройка SSH</h3> <p>Чтобы упростить ssh для узлов кластера, введите: <code class="inline">vagrant ssh-config &gt;&gt; ~ / .ssh / config</code>.</p> <p>Если вы наберете: <code class="inline">cat ~ / .ssh / config</code>, вы должны увидеть записи для rabbit-1, rabbit-2 и rabbit-3.</p> <p>Теперь вы можете использовать ssh на каждой виртуальной машине по имени: <code class="inline">ssh rabbit-1</code>.</p> <h3>Убедитесь, что узлы достижимы по имени</h3> <p>Самый простой способ - отредактировать файл /etc/hosts. Например, для rabbit-1 добавьте адреса rabbit-2 и rabbit-3.</p> <p><code class="inline">plain 192.168.77.11 rabbit-2 192.168.77.12 rabbit-3 </code></p> <p>Повторите процесс для всех узлов.</p> <h3>Установка RabbitMQ</h3> <p>Я буду использовать apt-get здесь для операционных систем Debian/Ubuntu. Если ваш кластер работает в другой ОС, следуйте инструкциям на <span>странице установки RabbitMQ</span>.</p> <p>Обратите внимание, что иногда довольно устаревшая версия RabbitMQ доступна по умолчанию. Если вы хотите установить самую последнюю и лучшую версию, вы можете загрузить пакет .deb напрямую или добавить apt-репозиторий RabbitMQ, используя <span>эти инструкции</span>.</p> <p>Текущая версия RabbitMQ на Ubuntu 14.04 - 3.2, что достаточно для наших целей. Убедитесь сами, набрав: <code class="inline">apt-cache show rabbitmq-server</code>.</p> <p>Давайте продолжим и установим его на каждую машину:</p> <p><code class="inline">plain sudo apt-get update sudo apt-get install rabbitmq-server -y </code></p> <p>Не стесняйтесь использовать ваши любимые инструменты управления конфигурацией, такие как Chef или Ansible, если вы предпочитаете.</p> <p>Обратите внимание, что <span>Erlang</span> будет установлен первым в качестве предварительного условия.</p> <h3>Включваем плагин Management RabbitMQ</h3> <p>Плагин управления действительно классный. Он предоставляет вам API на основе HTTP, а также веб-интерфейс и инструмент командной строки для управления кластером. Вот как это сделать:</p> <p><code class="inline">plain sudo rabbitmq-plugins enable rabbitmq_management </code></p> <h3>Получаем инструмент командной строки управления</h3> <p>Загрузите его с http://192.168.77.10:15672/cli/rabbitmqadmin. Обратите внимание, что документация RabbitMQ неверна и требует загрузки с http://<server name="">:15672/cli/.</server></p> <p>Это HTTP-клиент на основе Python для API-интерфейса управления RabbitMQ. Это очень удобно для сценариев кластеров RabbitMQ.</p> <h2>Основные понятия RabbitMQ</h2> <p>RabbitMQ реализует стандарт <span>AMQP 0.9.1 (расширенный протокол очереди сообщений)</span>. Обратите внимание, что уже существует стандарт AMQP 1.0, и RabbitMQ имеет плагин для его поддержки, но он считается прототипом из-за недостаточного использования в реальных условиях.</p> <p>В модели AMQP издатели отправляют сообщения посреднику сообщений (в данном случае RabbitMQ - посредник сообщений) через обменник. Посредник сообщений распределяет сообщения в очереди на основе метаданных, связанных с сообщением. Потребители потребляют сообщения из очередей. Сообщения могут быть или не быть подтверждены. RabbitMQ поддерживает множество моделей программирования на основе этих концепций, таких как рабочие очереди, публикация-подписка и RPC.</p> <h2>Управление вашим кластером</h2> <p>Для управления кластером используются три сценария. Скрипт rabbitmq-server запускает сервер RabbitMQ (запускает его). Rabbitmqctl используется для управления кластером (остановка, сброс, объединение узлов кластера и получение статуса). Rabbitmqadmin, который вы скачали ранее, используется для настройки и администрирования кластера (объявление vhosts, пользователей, обменов и очередей). Создание кластера включает в себя только rabbitmq-server и rabbitmqctl.</p> <p>Во-первых, давайте запустим rabbitmq-сервер как сервис (демон) на каждом из наших хостов rabbit-1, rabbit-2 и rabbit-3.</p> <p><code class="inline">plain sudo service rabbitmq-server start </code></p> <p>Это запустит виртуальную машину Erlang и приложение RabbitMQ, если узел не работает. Чтобы убедиться, что он работает правильно, введите:</p> <p><code class="inline">plain sudo rabbitmqctl cluster_status </code></p> <p>Вывод должен быть таким (для rabbit-1):</p> <p><code class="inline">plain Cluster status of node "rabbit@rabbit-1" ... [{nodes,[{disc,["rabbit@rabbit-1"]}]}, {running_nodes,["rabbit@rabbit-1"]}, {partitions,[]}] ...done. </code></p> <p>Это означает, что узел еще не кластеризован ни с какими другими узлами и является дисковым узлом. Он также работает, как вы можете видеть, что он появляется в списке running_nodes.</p> <p>Чтобы остановить сервер, введите следующую команду:</p> <p><code class="inline">plain sudo rabbitmqctl stop_app </code></p> <p>Затем, если вы проверите состояние кластера:</p> <p><code class="inline">plain sudo rabbitmqctl cluster_status </code></p> <p>Вывод должен быть таким:</p> <p><code class="inline">plain Cluster status of node "rabbit@rabbit-1" ... [{nodes,[{disc,["rabbit@rabbit-1"]}]}] ...done. </code></p> <p>Нет больше работающих узлов.</p> <p>Вы можете повторить процесс для других узлов (rabbit-2 и rabbit-3) и увидеть, что они знают только себя.</p> <h3>Эрланг Cookie</h3> <p>Прежде чем вы сможете создать кластер, все узлы в кластере должны иметь один и тот же файл cookie. Файл cookie - это файл, который среда исполнения Erlang использует для идентификации узлов. Он находится в /var/lib/rabbitmq/.erlang.cookie. Просто скопируйте содержимое с rabbit-1 на rabbit-2 и rabbit-3.</p> <h3>Узлы кластеризации вместе</h3> <p>Чтобы сгруппировать эти отдельные узлы в единый кластер, требуется определенная работа. Вот процедура:</p> <ul><li>Работает один узел (например, rabbit-1).</li> <li>Остановите другой узел (например, rabbit-2).</li> <li>Сброс остановленного узла (rabbit-2).</li> <li>Кластеризация другого узла в корневой узел.</li> <li>Запустите остановленный узел.</li> </ul><p>Давай сделаем это. ssh в rabbit-2 и выполните следующие команды:</p> <p><code class="inline">plain sudo rabbitmqctl stop_app sudo rabbitmqctl reset sudo rabbitmqctl join_cluster rabbit@rabbit-1 </code></p> <p>Теперь наберите: <code class="inline">sudo rabbitmqctl cluster_status</code>.</p> <p>Вывод должен быть следующим:</p> <p>```plain Cluster status of node ‘rabbit@rabbit-2’ … [{nodes,[{disc,[‘rabbit@rabbit-1’,’rabbit@rabbit-2’]}]}] …Done. As you can see both nodes are now clustered. If you repeat this on rabbit-1 you’ll get following output:</p> <pre class="noskimlinks noskimwords">Cluster status of node "rabbit@rabbit-1" ...[{nodes,[{disc,["rabbit@rabbit-1","rabbit@rabbit-2"]}]}, {running_nodes,["rabbit@rabbit-1"]}, {partitions,[]}]...done.  ```</pre> <p>Теперь вы можете начать rabbit-2.</p> <p><code class="inline">plain sudo rabbitmqctl start_app </code></p> <p>Если вы проверите статус снова, оба узла будут работать:</p> <p><code class="inline">plain Cluster status of node "rabbit@rabbit-2" ... [{nodes,[{disc,["rabbit@rabbit-1","rabbit@rabbit-2"]}]}, {running_nodes,["rabbit@rabbit-1","rabbit@rabbit-2"]}, {partitions,[]}] ...done. </code></p> <p>Обратите внимание, что оба узла являются узлами диска, что означает, что они хранят свои метаданные на диске. Давайте добавим rabbit-3 в качестве узла RAM. ssh to rabbit-3 и выполните следующие команды:</p> <p><code class="inline">plain sudo rabbitmqctl stop_app sudo rabbitmqctl reset sudo rabbitmqctl join_cluster --ram rabbit@rabbit-2 sudo rabbitmqctl start_app </code></p> <p>Проверка состояния показывает:</p> <p><code class="inline">plain Cluster status of node "rabbit@rabbit-3" ... [{nodes,[{disc,["rabbit@rabbit-2","rabbit@rabbit-1"]}, {ram,["rabbit@rabbit-3"]}]}, {running_nodes,["rabbit@rabbit-1","rabbit@rabbit-2","rabbit@rabbit-3"]}, {partitions,[]}] ...done. </code></p> <p>Все узлы кластера работают. Узлы диска - это rabbit-1 и rabbit-2, а узел ОЗУ - rabbit-3.</p> <p>Поздравляем! У вас есть работающий кластер RabbitMQ.</p> <h3>Реальные осложнения</h3> <p>Что произойдет, если вы захотите изменить конфигурацию своего кластера? Вам придется использовать хирургическую точность при добавлении и удалении узлов из кластера.</p> <p>Что произойдет, если узел еще не перезапущен, но вы пытаетесь продолжить с помощью <code class="inline">stop_app</code>, <code class="inline">reset</code> и <code class="inline">start_app</code>? Что ж, команда stop_app якобы будет успешной и вернет «готово», даже если целевой узел не работает. Однако последующая команда сброса завершится неудачно с неприятным сообщением. Я потратил много времени ломая голову, пытаясь понять это, поскольку предполагал, что проблема заключается в некотором параметре конфигурации, который влияет только на сброс.</p> <p>Другой недостаток заключается в том, что если вы хотите сбросить последний узел диска, вы должны использовать <code class="inline">force_reset</code>. Попытка выяснить в общем случае, какой узел был последним узлом диска, не тривиальна.</p> <p>RabbitMQ также поддерживает кластеризацию через файлы конфигурации. Это замечательно, когда ваши дисковые узлы работают, потому что перезапущенные узлы ОЗУ будут просто кластеризоваться на основе файла конфигурации без необходимости их явной кластеризации. Опять же, это не взлетит, когда вы пытаетесь восстановить сломанный кластер.</p> <h3>Надежная кластеризация RabbitMQ</h3> <p>Это сводится к следующему: вы не знаете, какой последний дисковый узел вышел из строя. Вы не знаете метаданные кластеризации каждого узла (возможно, они были сброшены во время сброса). Чтобы запустить все узлы, я использую следующий алгоритм:</p> <ul><li>Запустите все узлы (по крайней мере, последний дисковый узел должен быть в состоянии начать).</li> <li>Если даже ни один узел не может запуститься, вы попали в точку. Просто выручите.</li> <li>Отслеживайте все узлы, которые не удалось запустить.</li> <li>Попробуйте запустить все неисправные узлы.</li> <li>Если некоторые узлы не удалось запустить во второй раз, вы попали в шланг. Просто выручите.</li> </ul><p>Этот алгоритм будет работать до тех пор, пока ваш последний узел диска физически исправен.</p> <p>После того, как все узлы кластера подключены, вы можете переконфигурировать их (помните, что вы не уверены, на каком узле какие метаданные). Ключ заключается в принудительном сбросе <em>каждого</em> узла. Это гарантирует, что любой след предыдущей конфигурации кластера будет удален со всех узлов. Сначала сделайте это для одного дискового узла:</p> <p><code class="inline">plain stop_app force_reset start_app </code></p> <p>Затем для каждого другого узла (диска или ОЗУ):</p> <p><code class="inline">plain stop_app force_reset join_cluster [list of disc nodes] start_app </code></p> <h2>Удаленное управление кластером</h2> <p>Вы можете ввести SSH в каждый блок и выполнить вышеупомянутые шаги для каждого блока вручную. Это работает, но очень быстро устаревает. Кроме того, это нецелесообразно, если вы хотите построить и разрушить кластер как часть автоматизированного теста.</p> <p>Одним из решений является использование <span>Fabric</span>. Одна серьезная ошибка, с которой я столкнулся, заключается в том, что когда я выполнял алгоритм кластера сборки вручную, он работал отлично, но когда я использовал Fabric, он таинственным образом не работал. После некоторой отладки я заметил, что узлы запустились успешно, но к тому времени, когда я попытался stop_app, узлы были недоступны. Это оказалось ошибкой новичка Fabric с моей стороны. Когда вы запускаете удаленную команду с помощью Fabric, она запускает новую оболочку на удаленном компьютере. Когда команда завершена, оболочка закрывается, отправляя сигнал SIGHUP (сигнал зависания) всем его подпроцессам, включая узел Erlang. Использование <span>nohup</span> позаботится об этом. Другой более надежный вариант - запуск RabbitMQ в качестве службы (демона).</p> <h2>Программное администрирование кластера</h2> <p>Администрирование означает создание виртуальных хостов, пользователей, бирж и очередей, настройку разрешений и привязку очередей к биржам. Первое, что вы должны сделать, если вы еще этого не сделали, это установить плагины управления. Я не уверен, почему вы должны включить его самостоятельно. Это должно быть включено по умолчанию.</p> <p>Веб-интерфейс фантастический, и вы должны обязательно ознакомиться с ним. Однако для удаленного администрирования кластера можно использовать API-интерфейс управления RESTful. Существует также инструмент командной строки Python с именем rabbitmqadmin, для которого требуется Python 2.6+. Использовать rabbitmqadmin довольно просто. Единственная проблема, которую я обнаружил, это то, что я мог использовать только гостевую учетную запись по умолчанию для администрирования кластера. Я создал другого пользователя-администратора с именем «admin», установил его разрешения для всех (настройка/чтение/запись) и присвоил ему тег «администратор» (дополнительное требование API управления), но я продолжал получать ошибки разрешения.</p> <p>Проект <span>Elmer</span> позволяет вам указать конфигурацию кластера как структуру данных Python (см. sample_config.py) и настроит все для вас.</p> <h2>Выводы</h2> <ol><li>RabbitMQ это круто.</li> <li>История администратора кластера не герметична.</li> <li>Программное администрирование является ключевым.</li> <li>Fabric - отличный инструмент для удаленного управления несколькими Unix-системами.</li> </ol>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Apps" href="https://norma-studio.github.io/article5/220825284-upravlenie-vashim-klasterom-rabbitmq" class="tm-article-body__tags-item-link">Web Apps</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
44753</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
490</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
