
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Приложение, которое мы создаем, будет простая доска объявлений, в которой пользователи могут регистрировать, публиковать задания и предлагать вознаграждение за их завершение. Другие пользователи могут видеть существующие задачи, назначать задачу себе и получать предложенную награду....">
<meta property="og:description" content="Приложение, которое мы создаем, будет простая доска объявлений, в которой пользователи могут регистрировать, публиковать задания и предлагать вознаграждение за их завершение. Другие пользователи могут видеть существующие задачи, назначать задачу себе и получать предложенную награду....">
<meta name="twitter:description" content="Приложение, которое мы создаем, будет простая доска объявлений, в которой пользователи могут регистрировать, публиковать задания и предлагать вознаграждение за их завершение. Другие пользователи могут видеть существующие задачи, назначать задачу себе и получать предложенную награду....">
<meta property="aiturec:description" content="Приложение, которое мы создаем, будет простая доска объявлений, в которой пользователи могут регистрировать, публиковать задания и предлагать вознаграждение за их завершение. Другие пользователи могут видеть существующие задачи, назначать задачу себе и получать предложенную награду....">
<meta property="og:image" content="//www.gravatar.com/avatar/fc9be0b82895e59e00a5e9ac20563ad6?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="aiturec:image" content="//www.gravatar.com/avatar/fc9be0b82895e59e00a5e9ac20563ad6?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta name="twitter:image" content="//www.gravatar.com/avatar/fc9be0b82895e59e00a5e9ac20563ad6?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="vk:image" content="//www.gravatar.com/avatar/fc9be0b82895e59e00a5e9ac20563ad6?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:type" content="article">
<link image_src="image" href="//www.gravatar.com/avatar/fc9be0b82895e59e00a5e9ac20563ad6?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html" title="Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io" title="Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543234456.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html" class="tm-user-info__username" title="
А. Гаврилов" aria-label="
А. Гаврилов">
А. Гаврилов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создание веб-приложения CodeIgniter с нуля...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya" class="tm-article-snippet__hubs-item-link"><span>PHP</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya.html" />
    <link itemprop="image" href="//www.gravatar.com/avatar/fc9be0b82895e59e00a5e9ac20563ad6?s=200&d=https%3A%2F%2Fassets.tutsplus.com%2Fimages%2Fhub%2Favatar_default.png&r=PG">
    <meta itemprop="headline name" content="Создание веб-приложения CodeIgniter с нуля... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Приложение, которое мы создаем, будет простая доска объявлений, в которой пользователи могут регистрировать, публиковать задания и предлагать вознаграждение за их завершение. Другие пользователи могут видеть существующие задачи, назначать задачу себе и получать предложенную награду....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Приложение, которое мы создаем, будет простая доска объявлений, в которой пользователи могут регистрировать, публиковать задания и предлагать вознаграждение за их завершение. Другие пользователи могут видеть существующие задачи, назначать задачу себе и получать предложенную награду....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Приложение, которое мы создаем, будет простая доска объявлений, в которой пользователи могут регистрировать, публиковать задания и предлагать вознаграждение за их завершение. Другие пользователи могут видеть существующие задачи, назначать задачу себе и получать предложенную награду.<br></p><p>Задачи будут иметь базовые данные, такие как заголовок, описание и вознаграждение (в соответствии с требуемыми параметрами), а так же необязательная дата и примечания. Профиль пользователя будет состоять только из имени пользователя, электронной почты и веб-сайта. Давайте начнем.</p> <hr><h2>Настройка базы данных</h2> <p>Во-первых, для данных приложения мы собираемся использовать <span>MongoDB</span> в качестве сервера базы данных. MongoDB - это документно-ориентированная база данных и самая популярная база данных NoSQL. Она хорошо масштабируется и быстрая, что позволяет управлять огромными объемами данных.</p> <blockquote> <p>MongoDB - это документально ориентированная база данных и ведущая база данных NoSQL.</p> </blockquote> <p>Чтобы использовать MongoDB в этом приложении, я собираюсь использовать драйвер MongoDB CodeIgniter, который я написал некоторое время назад и это всего лишь оболочка драйвера PHP MongoDB для имитации SQL ActiveRecord. Вы можете найти исходные файлы для этого драйвера в <span>моем публичном репозитории</span>. Чтобы этот драйвер работал правильно, убедитесь, что у вас установлен драйвер MongoDB PHP, если вы этого не сделали, выполните <span>следующие действия</span>, чтобы заставить его работать.</p> <p>Обратите внимание, что объяснение драйверов в CodeIgniter и т.д. выходит за рамки данной статьи, обратитесь к <span>документации</span>, если у вас есть какие-либо сомнения. Вам просто нужно переместить <code>"mongo_db.php"</code> из папки <code>"config"</code> в папку <code>"config"</code>  вашего приложения и папку <code>"Mongo_db"</code> из папки <code>"libraries"</code> в папку <code>"libraries"</code> в вашем приложении.</p> <h3>Настройка базы данных</h3> <p>Единственным файлом, который нам нужно отредактировать на данный момент, является <code>"mongo_db.php"</code> файл в папке <code>"config"</code>, так как моя установка <code>mongo</code> имеет все параметры по умолчанию, я просто отредактирую строку 40 и оставлю имя базы данных, которую я хочу использовать:</p> <pre class="brush: php noskimlinks noskimwords">$config["mongo_db"] = "billboard";</pre> <p>Одно из многих преимуществ MongoDB заключается в том, что у документов нет предопределенной структуры, поэтому она работает без необходимости устанавливать что-либо перед использованием, наша база данных даже не должна существовать, MongoDB создаст ее на лету, когда нам это будет нужно.</p> <hr><h2>Глобальная конфигурация</h2> <p>Помимо обычных параметров конфигурации, которые должны включать <code>base_url</code> и <code>index_page</code>, если таковые имеются, нам нужно установить <span>string</span> и <span>date</span> хелперы для <span>автозагрузки</span>. Я не буду здесь демонстрировать, как это делается, так как у нас впереди еще много всего, что нужно рассмотреть. Если у вас есть какие-либо сомнения, то лучше обратитесь к <span>документации</span>.</p> <p>Помимо хелперов, нам нужно настроить <span>класс шифрования</span>, поскольку мы будем использовать его для нашего приложения.</p> <hr><h2>Обработка URL-адресов</h2> <p>Это будет <span>RESTful</span>  сервис и нам нужен способ принимать запросы, поступающие на сервер, и обработать их соответствующим образом. Мы могли бы использовать <span>существующую библиотеку</span> (кстати, это классная), но для целей этой статьи я собираюсь создать необходимые функции, используя основные возможности CodeIgniter.</p> <h3>Обработка RESTful запросов</h3> <p>В частности, мы будем использовать возможность расширения <span>core классов</span>. Мы начнем с контроллера, для основной части этого расширения мы используем метод <code>"_remap"</code> в базовом контроллере, чтобы все контроллеры нашего приложения могли его использовать. Начните с создания файла <code>MY_Controller.php</code> внутри папки <code>"core"</code> в папке <code>"application"</code>, мы создаем его, как и любой другой контроллер CodeIgniter, следующим образом:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpif( !defined( "BASEPATH" ) ) exit( "No direct script access allowed" );class MY_Controller extends CI_Controller {}</pre> <p>Теперь в этом контроллере мы будем использовать метод CodeIgniter <span>_remap</span> для предварительной обработки каждого запроса на сервер. Внутри класса, который мы только что создали, добавьте следующий метод:</p> <pre class="brush: php noskimlinks noskimwords">public function _remap( $param ) {    $request = $_SERVER["REQUEST_METHOD"];    switch( strtoupper( $request ) ) {        case "GET":            $method = "read";            break;        case "POST":            $method = "save";            break;        case "PUT":            $method = "update";            break;        case "DELETE":            $method = "remove";            break;        case "OPTIONS":            $method = "_options";            break;    }    $this-&gt;$method( $id );}</pre> <p>Несколько вещей, которые следует здесь отметить: во-первых, есть некоторые глаголы REST, которые мы игнорируем (например, PATCH), так как я демонстрирую создание приложения REST, я не хочу добавлять вещи, которые могут сделать его еще более сложным, чем оно должно быть. Во-вторых, мы не учитываем тот случай, когда контроллер не реализует определенный метод, что вполне вероятно может произойти. Теперь мы можем добавить метод по умолчанию для обработки таких запросов, но чтобы не добавлять слишком много сложностей, давайте оставим его так. В-третьих, мы получаем переменную <code>param</code> в объявлении метода, давайте обратимся к ней, а затем я объясню запрос <code>OPTIONS</code>. Выше оператора switch добавьте следующий код:</p> <pre class="brush: php noskimlinks noskimwords">if ( preg_match( "/^(?=.*[a-zA-Z])(?=.*[0-9])/", $param ) ) {    $id = $param;} else {    $id = null;}</pre> <p>Это регулярное выражение соответствует любой строке, состоящей из прописных и строчных букв и любых чисел. Это используется, чтобы проверить, указана ли строка MongoDB _id в качестве параметра, опять же, это не самый безопасный способ и самая тщательная проверка, но для простоты мы сохраним ее как есть.</p> <h3>Запрос OPTIONS</h3> <p>Поскольку мы создаем веб-сервис и клиентское приложение как отдельные части, имеет смысл, что оба они будут размещаться в разных доменах, поэтому мы включим <span>CORS</span> на back-end, а это означает, среди прочего, что наше приложение будет правильно отвечать на запросы <code>OPTIONS</code>.</p> <p>Когда веб-приложение, созданное с помощью BackboneJS (и некоторых других фреймворков), пытается выполнить асинхронный запрос на удаленный сервер, он отправляет запрос <code>OPTIONS</code> перед отправкой фактического запроса, который он должен отправить. Среди прочего, клиент сообщает серверу, откуда он отправляет запрос, какой тип запроса он собирается отправить и ожидаемый контент. После этого сервер должен отправить ответ клиенту, где он подтверждает запрос или отклоняет его.</p> <p>Поскольку наша внутренняя служба, независимо от того, какой контроллер вызывается, собирается получить этот запрос <code>OPTIONS</code>, имеет смысл реализовать метод ответа на него в нашем базовом контроллере. Добавьте следующий метод ниже (или выше) метода <code>_remap</code> в нашем контроллере.</p> <pre class="brush: php noskimlinks noskimwords">private function _options() {    $this-&gt;output-&gt;set_header( "Access-Control-Allow-Origin: *" );    $this-&gt;output-&gt;set_header( "Access-Control-Allow-Methods: POST, GET, PUT, DELETE, OPTIONS" );    $this-&gt;output-&gt;set_header( "Access-Control-Allow-Headers: content-type" );    $this-&gt;output-&gt;set_content_type( "application/json" );    $this-&gt;output-&gt;set_output( "*" );}</pre> <p>В идеале мы бы разрешали только некоторым доменам отправлять запросы нам, мы бы проверили заголовок <code>request_headers</code>, чтобы узнать, принимаем ли мы его, и мы бы проверяли ожидаемый тип содержимого, чтобы клиент мог убедиться, поддерживаем ли мы его, но опять же, это это не очень сложное приложение, и мы пропускаем эти нюансы.</p> <hr><h2>Управление выводом</h2> <p>Чтобы закончить наш базовый контроллер, давайте создадим метод, который каждый контроллер будет использовать для отправки своих результатов обратно клиенту. В классе базового контроллера добавьте следующий метод:</p> <pre class="brush: php noskimlinks noskimwords">protected function _format_output( $output = null ) {    $this-&gt;output-&gt;set_header( "Access-Control-Allow-Origin: *" );    if( isset( $output-&gt;status ) &amp;&amp; $output-&gt;status == "error" ) {        $this-&gt;output-&gt;set_status_header( 409, $output-&gt;desc );    }    $this-&gt;_parse_data( $output );    $this-&gt;output-&gt;set_content_type( "application/json" );    $this-&gt;output-&gt;set_output( json_encode( $output ) );}</pre> <p>Опять же, чтобы BackboneJS обрабатывал ответ сервера, он должен знать, что его хост принят сервером, следуя заголовку <code>Allow-Origin</code>, а затем, если результат является невалидным, то мы устанавливаем заголовок состояния, указывающий на это. Этот <code>status</code> станет более понятным, когда мы будем создавать модели на бэкенде. Затем мы используем хелпер <code>parse_data</code>, который будет частным методом (который мы скоро напишем), затем мы устанавливаем тип содержимого как JSON и, наконец, мы конвертируем ответ в объект JSON , Опять же, здесь мы могли (и должны) поддерживать другие выходные форматы (например, XML).</p> <p>Теперь давайте создадим вспомогательный метод <code>parse_data</code> (и я объясню его позже), добавьте следующий код в базовый контроллер:</p> <pre class="brush: php noskimlinks noskimwords">private function _parse_data( &amp;$data ) {    if ( ! is_array( $data ) &amp;&amp; ! is_object( $data ) )        return $data;    foreach ( $data as $key =&gt; $value ) {        if ( is_object( $value ) || is_array( $value ) ) {            if( is_object( $data ) ) {                $data-&gt;{$key} = $this-&gt;_parse_data( $value );            } else {                $data[ $key ] = $this-&gt;_parse_data( $value );            }        }        if ( isset( $value-&gt;sec ) ) {            if( is_object( $data ) ) {                $data-&gt;{$key} = date( "d.m.Y", $value-&gt;sec );            } else {                $data[ $key ] = date( "d.m.Y", $value-&gt;sec );            }        }        if ( is_object( $value ) &amp;&amp; isset( $value-&gt;{"$id"} ) ) {            if( is_object( $data ) ) {                $data-&gt;{$key} = $value-&gt;__toString();            } else {                $data[ $key ] = $value-&gt;__toString();            }        }    }    return $data;}</pre> <p>Во-первых, обратите внимание, что мы анализируем данные только для массивов и объектов, и мы делаем это рекурсивно. Этот предварительный анализ имеет отношение к тому факту, что MongoDB использует даты и идентификаторы как объекты, но нашим клиентам эта информация не нужна. Теперь для случая идентификаторов нам просто нужно его строковое значение, поэтому для свойства <span>"$id"</span> мы вызываем метод <code>toString</code>. Впоследствии мы преобразуем даты в формат <code>day.month.year</code>, это делается для удобства в дизайне клиентского приложения, опять же, не самый гибкий подход, но он работает для этого примера.</p> <hr><h2>Обработка ввода</h2> <p>Поскольку мы отправляем JSON обратно в клиентское приложение, логично, что мы также принимаем данные в формате JSON. CodeIgniter не поддерживает это по умолчанию, как например <span>Laravel</span>, на самом деле CodeIgniter даже не поддерживает <code>put</code> и <code>delete</code> параметры. Это связано главным образом с тем, что фреймворк не предназначен для создания RESTful сервиса, однако усилия, которые необходимо предпринять для его адаптации, минимальны по сравнению с получаемыми преимуществами, по крайней мере, с моей точки зрения.</p> <p>Поэтому мы начнем с поддержки данных JSON, которые посылает BackboneJS. Создайте новый файл внутри папки <code>"core"</code>, на этот раз он будет называться <code>"MY_Input.php"</code> и он будет иметь следующую основную структуру:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpif( !defined( "BASEPATH" ) ) exit( "No direct script access allowed" );class MY_Input extends CI_Input {}</pre> <p>Теперь каждый раз, когда мы используем <code>$this-&gt;input</code> в нашем приложении, мы будем ссылаться на этот класс, мы создадим несколько новых методов и переопределим несколько существующих. Прежде всего, мы добавим поддержку данных JSON, добавим следующий метод в новый класс.</p> <pre class="brush: php noskimlinks noskimwords">public function json() {    if ( !self::$request_params ) {        $payload    = file_get_contents( "php://input" );        if ( is_array( $payload ) ) {            self::$request_params   = $payload;        } else if ( ( substr( $payload, 0, 1 ) == "{" ) &amp;&amp; ( substr( $payload, ( strlen( $payload ) - 1 ), 1 ) == "}" ) ) {            self::$request_params   = json_decode( $payload );        } else {            parse_str( $payload, self::$request_params );        }    }    return (object) self::$request_params;}</pre> <p><code>$request_params</code> - статическая переменная, используемая для хранения строки запроса/данных, отправленных клиентом. Она статична, чтобы сделать объект независимым, чтобы мы могли получить доступ к нему с любого контроллера в любой момент времени. Данные получены из <code>php://input</code>, а не из глобальной переменной <code>$_POST</code>. Это делается для получения данных, отправленных через запросы <code>PUT</code> и <code>DELETE</code>. Наконец, полученный пейлоад проверяется, является ли массивом, объектом, закодированным JSON, или строкой запроса, и обрабатывается соответствующим образом. Затем результат возвращается как объект.</p> <p>Чтобы этот метод работал, нам нужно создать статическую переменную <code>$request_params</code> и добавить ее объявление в начало класса.</p> <pre class="brush: php noskimlinks noskimwords">private static $request_params  = null;</pre> <h3>Обработка регулярных запросов</h3> <p>Затем нам нужно переопределить метод <code>post</code> обычного класса ввода и использовать новый JSON место глобальной переменной <code>$ _POST</code>, добавим следующий метод в новый класс ввода.</p> <pre class="brush: php noskimlinks noskimwords">public function post( $index = NULL, $xss_clean = FALSE ) {    $request_vars   = ( array ) $this-&gt;json();    if ( $index === NULL &amp;&amp; !empty( $request_vars ) ) {        $post       = array();        foreach( array_keys( $request_vars ) as $key ) {            $post[$key]  = $this-&gt;_fetch_from_array( $request_vars, $key, $xss_clean );        }        return $post;    }    return $this-&gt;_fetch_from_array( $request_vars, $index, $xss_clean );}</pre> <p>Это почти то же самое, что и метод <code>post</code> из исходного класса <code>CI_Input</code>, с той лишь разницей, что он использует наш новый метод JSON вместо глобальной переменной <code>$_POST</code> для получения данных из post запроса. Теперь давайте сделаем то же самое для метода <code>PUT</code>.</p> <pre class="brush: php noskimlinks noskimwords">public function put( $index = NULL, $xss_clean = FALSE ) {    $request_vars   = ( array ) $this-&gt;json();    if ( $index === NULL &amp;&amp; !empty( $request_vars ) ) {        $put = array();        foreach( array_keys( $request_vars ) as $key ) {            $put[$key]   = $this-&gt;_fetch_from_array( $request_vars, $key, $xss_clean );        }        return $put;    }    return $this-&gt;_fetch_from_array( $request_vars, $index, $xss_clean );}</pre> <p>А затем нам также нужен метод <code>DELETE</code>:</p> <pre class="brush: php noskimlinks noskimwords">public function delete( $index = NULL, $xss_clean = FALSE ) {    $request_vars   = ( array ) $this-&gt;json();    if ( $index === NULL &amp;&amp; !empty( $request_vars ) ) {        $delete = array();        foreach( array_keys( $request_vars ) as $key ) {            $delete[$key]   = $this-&gt;_fetch_from_array( $request_vars, $key, $xss_clean );        }        return $delete;    }    return $this-&gt;_fetch_from_array( $request_vars, $index, $xss_clean );}</pre> <p>Теперь технически нет необходимости в дополнительных методах, поскольку метод <code>post</code> может обрабатывать параметры в запросах <code>PUT</code> и <code>DELETE</code>, но семантически так лучше (на мой взгляд).</p> <p>Это все, что нам нужно для нашего пользовательского класса ввода. Опять же, здесь мы игнорируем крайние случаи, такие как multipart запросы, хотя это не очень сложно обрабатывать их и при этом поддерживать уже имеющийся функционал, но для простоты мы сохраним все так, как есть.</p> <hr><h2>Базовая модель</h2> <p>Чтобы завершить расширение основных классов, давайте создадим базовую модель, от которой будет наследоваться каждая модель приложения, просто, чтобы избежать повторения общих задач для каждой модели. Как и любое другое расширение основного класса, вот каркас нашей базовой модели:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpif( !defined( "BASEPATH" ) ) exit( "No direct script access allowed" );class MY_Model extends CI_Model {}</pre> <p>Эта базовая модель будет служить только для установки и получения ошибок. Добавьте следующий метод для установки ошибки модели:</p> <pre class="brush: php noskimlinks noskimwords">protected function _set_error( $desc, $data = null ) {    $this-&gt;_error           = new stdClass();    $this-&gt;_error-&gt;status   = "error";    $this-&gt;_error-&gt;desc     = $desc;    if ( isset( $data ) ) {        $this-&gt;_error-&gt;data = $data;    }}</pre> <p>Как вы можете видеть, этот метод использует переменную экземпляра <code>$error</code>, поэтому давайте добавим ее объявление в начало нашего базового класса модели.</p> <pre class="brush: php noskimlinks noskimwords">protected $_error;</pre> <p>Наконец, чтобы сохранить структуру, давайте создадим метод getter для этого свойства.</p> <pre class="brush: php noskimlinks noskimwords">public function get_error() {    return $this-&gt;_error;}</pre> <hr><h2>Обработка сеансов</h2> <h3>Контроллер сеанса</h3> <p>В последней части этого руководства мы создадим контроллер и модель для обработки пользовательских сеансов.</p> <p>Контроллер для нашего сеанса будет отвечать на любой запрос <code>POST</code>, сделанный для нашего ресурса <code>Session</code>, поскольку сеанс не может быть восстановлен после создания или обновлен напрямую, этот контроллер будет отвечать только на запросы <code>POST</code> и <code>DELETE</code>. Обратите внимание, что отправка любого другого запроса на ресурс приведет к ошибке сервера, но этого можно было бы легко избежать, проверяя, существует ли вызванный метод в нашем файле <code>MY_Controller</code>, и задав имя метода по умолчанию если ресурс не поддерживает данный запрос.</p> <p>Ниже вы найдете структуру для нашего контроллера <code>Session</code>:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpif ( !defined( "BASEPATH" ) ) exit( "No direct script access allowed" );class Session extends MY_Controller {    public function __construct() {}    public function save() {}    public function remove( $id = null ) {}}</pre> <p>Обратите внимание, что этот контроллер расширяет класс <code>MY_Controller</code> вместо обычного класса <code>CI_Controller</code>, мы делаем это, чтобы использовать метод <code>_remap</code> и другие функциональные возможности, которые мы создали ранее. Итак, давайте начнем с конструктора.</p> <pre class="brush: php noskimlinks noskimwords">public function __construct() {    parent::__construct();    $this-&gt;load-&gt;model( "session_model", "model" );}</pre> <p>Этот простой конструктор просто вызывает свой родительский конструктор (как и каждый контроллер в CodeIgniter), а затем загружает модель контроллера. Код для метода <code>save</code> выглядит следующим образом.</p> <pre class="brush: php noskimlinks noskimwords">public function save() {    $result = $this-&gt;model-&gt;create();    if ( !$result ) {        $result = $this-&gt;model-&gt;get_error();    }    $this-&gt;_format_output( $result );}</pre> <p>А вот код для метода <code>remove</code>:</p> <pre class="brush: php noskimlinks noskimwords">public function remove( $id = null ) {    $result = $this-&gt;model-&gt;destroy( $id );    if ( !$result ) {        $result = $this-&gt;model-&gt;get_error();    }    $this-&gt;_format_output( $result );}</pre> <p>Оба метода просто делегируют задание модели, которая обрабатывает фактические манипуляции с данными. В реальном мире в контроллере будет выполняться необходимая проверка данных и проверка сеанса, а общие задачи, такие как проверка сеанса, должны быть реализованы в базовом контроллере.</p> <h3>Модель сеанса</h3> <p>Теперь перейдем к модели сеанса. Вот ее основная структура:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpif ( !defined( "BASEPATH" ) ) exit( "No direct script access allowed" );class Session_Model extends MY_Model {    public function __construct() {}    public function create() {}    public function destroy( $id ) {}}</pre> <p>Подобно контроллеру, эта модель расширяет класс <code>MY_Model</code> вместо обычного класса <code>CI_Model</code>, это делается для того, чтобы использовать общие методы, которые мы создали ранее. Опять же, давайте начнем с конструктора.</p> <pre class="brush: php noskimlinks noskimwords">public function __construct() {    $this-&gt;load-&gt;driver( "mongo_db" );}</pre> <p>В этом случае мы просто загружаем драйвер Mongodb, о котором мы говорили ранее. Теперь мы перейдем к методу, который отвечает за уничтожение сеанса.</p> <pre class="brush: php noskimlinks noskimwords">public function destroy( $id ) {    $filters    = array( "_id" =&gt; $this-&gt;mongo_db-&gt;gen_id( $id ) );    $query     = $this-&gt;mongo_db-&gt;get_where( "sessions", $filters );    if ( $query-&gt;num_rows() == 0 ) {        $this-&gt;_set_error( "INVALID_CREDENTIALS" );        return false;    }    $this-&gt;mongo_db-&gt;remove( "sessions", $filters );    return "SESSION_TERMINATED";}</pre> <p>В этом методе мы проверяем, есть ли сеанс для данного session_id, и если так, то мы попытаемся удалить его, отправив сообщение об успешном завершении, если все будет хорошо, или установим ошибку и вернем false, если что-то пойдет не так. Обратите внимание, что при использовании session_id мы используем специальный метод <code>$this-&gt;mongo_db-&gt;gen_id</code>, так как, как я уже упоминал ранее, идентификаторы в MongoDB являются объектами, поэтому мы используем строку id для его создания.</p> <p>Наконец, давайте напишем метод <code>create</code>, который завершит первую часть этой серии уроков.</p> <pre class="brush: php noskimlinks noskimwords">public function create() {    $query      = $this-&gt;mongo_db-&gt;get_where( "users", array( "email" =&gt; $this-&gt;input-&gt;post( "email" ) ) );    if ( $query-&gt;num_rows() != 1 ) {        $this-&gt;_set_error( "INVALID_CREDENTIALS" );        return false;    }    $this-&gt;load-&gt;library( "encrypt" );    $user   = $query-&gt;row();    $salt   = $this-&gt;encrypt-&gt;decode( $user-&gt;salt );    if ( $user-&gt;pass != sha1( $this-&gt;input-&gt;post( "pass" ) . $salt ) ) {        $this-&gt;_set_error( "INVALID_CREDENTIALS" );        return false;    }    $this-&gt;mongo_db-&gt;remove( "sessions", array( "user_id" =&gt; $user-&gt;_id-&gt;__toString() ) );    $session    = array(        "timestamp"     =&gt; now(),        "user_id"       =&gt; $user-&gt;_id-&gt;__toString(),        "persistent"    =&gt; $this-&gt;input-&gt;post( "persistent" )    );    if ( !$this-&gt;mongo_db-&gt;insert( "sessions", $session ) ) {        $this-&gt;_set_error( "ERROR_REGISTERING_SESSION" );        return false;    }    $result                 = new stdClass();    $result-&gt;id             = $this-&gt;mongo_db-&gt;insert_id();    $result-&gt;user_id        = $user-&gt;_id-&gt;__toString();    return $result;}</pre> <p>Прежде всего, мы проверяем, есть ли пользователь, связанный с данным email. Затем мы декодируем связанную с пользователем <code>salt</code> (которую я объясню во второй части этой серии, когда мы рассмотрим регистрацию пользователя) и проверяем, что данный пароль соответствует сохраненному паролю пользователя.</p> <p>Затем мы удаляем любой предыдущий сеанс, связанный с пользователем, и создаем новый объект сеанса. Если бы мы более тщательно проверяли сеанс, то можно было добавить к этому объекту еше такие вещи, как user_agent, ip_address, last_activity и т.д. Наконец, мы отправляем клиенту сеанс и идентификатор пользователя для нового сеанса.</p> <hr><h2>Заключение</h2> <p>Это был довольно длинный урок, мы рассмотрели множество тем, и у нас осталось еще больше для будущего урока. Надеюсь, что к настоящему времени у вас будет лучшее представление о RESTful сервисах или сервисах без состояния и о том, как создать такой сервис с помощью CodeIgniter, и, возможно, вы также смогли уяснить для себя некоторые новые идеи касательно фреймворка.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825558-sozdanie-veb-prilozheniya-codeigniter-s-nulya" class="tm-article-body__tags-item-link">PHP</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40033</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
438</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
