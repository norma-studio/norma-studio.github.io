
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В моем предыдущем учебном пособии я рассказал вам, как начать работу с созданием и безопасным с точки зрения производства сайтом WordPress, используя трехмерную среду «Dev-Test-Live» на Pantheon. В такой конфигурации вы всегда обновляете свой код в среде Dev, затем тестируете его в тестовой среде, и только после того, как все выглядит хорошо, выкла...">
<meta property="og:description" content="В моем предыдущем учебном пособии я рассказал вам, как начать работу с созданием и безопасным с точки зрения производства сайтом WordPress, используя трехмерную среду «Dev-Test-Live» на Pantheon. В такой конфигурации вы всегда обновляете свой код в среде Dev, затем тестируете его в тестовой среде, и только после того, как все выглядит хорошо, выкла...">
<meta name="twitter:description" content="В моем предыдущем учебном пособии я рассказал вам, как начать работу с созданием и безопасным с точки зрения производства сайтом WordPress, используя трехмерную среду «Dev-Test-Live» на Pantheon. В такой конфигурации вы всегда обновляете свой код в среде Dev, затем тестируете его в тестовой среде, и только после того, как все выглядит хорошо, выкла...">
<meta property="aiturec:description" content="В моем предыдущем учебном пособии я рассказал вам, как начать работу с созданием и безопасным с точки зрения производства сайтом WordPress, используя трехмерную среду «Dev-Test-Live» на Pantheon. В такой конфигурации вы всегда обновляете свой код в среде Dev, затем тестируете его в тестовой среде, и только после того, как все выглядит хорошо, выкла...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut1.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut1.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut1.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut1.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut1.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html" title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io" title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/63456435436.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html" class="tm-user-info__username" title="
М. Старостенко" aria-label="
М. Старостенко">
М. Старостенко</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon" class="tm-article-snippet__hubs-item-link"><span>WordPress</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut1.png">
    <meta itemprop="headline name" content="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В моем предыдущем учебном пособии я рассказал вам, как начать работу с созданием и безопасным с точки зрения производства сайтом WordPress, используя трехмерную среду «Dev-Test-Live» на Pantheon. В такой конфигурации вы всегда обновляете свой код в среде Dev, затем тестируете его в тестовой среде, и только после того, как все выглядит хорошо, выкла...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В моем предыдущем учебном пособии я рассказал вам, как начать работу с созданием и безопасным с точки зрения производства сайтом WordPress, используя трехмерную среду «Dev-Test-Live» на Pantheon. В такой конфигурации вы всегда обновляете свой код в среде Dev, затем тестируете его в тестовой среде, и только после того, как все выглядит хорошо, выкла...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В моем <span>предыдущем учебном пособии</span> я рассказал вам, как начать работу с созданием и безопасным с точки зрения производства сайтом WordPress, используя трехмерную среду «Dev-Test-Live» на <span>Pantheon</span>. В такой конфигурации вы всегда обновляете свой код в среде Dev, затем тестируете его в тестовой среде, и только после того, как все выглядит хорошо, выкладываете его на Live сервер.<br></p><p>Хотя это значительное улучшение по сравнению с запуском установки WordPress в одной только среде и загрузкой изменений прямо на сервер в реальном времени, мы можем добиться большего!</p><blockquote>«Просить экспертов делать скучные и повторяющиеся, но вместе с тем технически сложные задания - это самый верный способ обеспечить человеческую ошибку, о которой мы можем думать, лишая себя сна». </blockquote><p>Эта цитата из Дэвида Фарли подводит итог этой проблемы с нашей текущей установкой: имея три среды и процесс их использования, мы все еще выполняем всю работу вручную, что может легко привести к ошибкам.</p><p>В этом учебном пособии, чтобы помочь устранить эту проблему в максимально возможной степени, я сначала покажу вам, как вы можете выполнять некоторые повторяющиеся задачи быстрее, используя инструменты командной строки Pantheon, а затем посмотрим на автоматизацию. Более конкретно, мы рассмотрим автоматизацию ваших приемочных тестов с использованием сервера непрерывной интеграции и платформы тестирования <span>Behat</span>.</p><p>После завершения учебного курса вы получите полное представление о принципах разработки и создания надежного и легкого в обслуживании сайта WordPress в Пантеоне. Вы также будете иметь много идей о том, как сделать вашу конфигурацию еще лучше, делая небольшое улучшение за раз.</p><p>Давайте начнем!<br></p><h2> <span class="sectionnum">1.</span> Использование инструмента командной строки Terminus для управления сайтом Pantheon</h2><p>В то время как Pantheon"s Web Dashboard дает вам ясное визуальное представление о том, что происходит на ваших трех серверах, и отличные инструменты для управления ими, бывают случаи, когда вы предпочитаете инструмент командной строки.</p><p>Это может быть экономия времени: когда вы работаете на своем сайте, вы скоро заметите, что время, потраченное на выполнение простой, но повторяющейся задачи, например, фиксация изменений или развертывание их в тестовой среде, накапливается и становится важной частью, которую вы делаете каждый день. Или это может быть просто потому, что вам нравится работать в командной строке. Или, может быть, вы хотите создать скрипт, который связывает несколько действий, таких как передача вашего кода, развертывание его в Test и очистка кеша в одной команде.</p><p>Инструмент командной строки Pantheon, <span>Terminus</span>, позволяет делать все это - и многое другое.</p><h3>Шаг 1. Установка Terminus </h3><p>Прежде чем вы сможете начать использовать Terminus, вам необходимо установить его на свой компьютер. </p><p>Инструкции по установке и использованию, представленные в этом руководстве, предназначены для Unix-систем (таких как Mac OS X или Linux). Если вы работаете в Windows, команды немного отличаются - обратитесь к официальным <span>инструкциям по установке Terminus</span> за дополнительной информацией.<br></p><p>Terminus имеет следующие системные требования, поэтому перед началом работы убедитесь, что у вас установлены следующие компоненты:</p><ul><li>PHP версии 5.5.9 или новее</li> <li><span>PHP-CLI</span></li> <li><span>PHP-CURL</span></li> </ul><p>Хотя это и не обязательно для Terminus, я рекомендую вам также установить <span>Composer</span> для завершения урока. Я также предполагаю, что вы уже используете Git, о чем мы говорили в предыдущем уроке.</p><p>Существует несколько способов установки Terminus (подробности см. В инструкциях по установке), но давайте рассмотрим простой пример, который не требует много дополнительных инструментов для запуска.<br></p><p>В окне консоли введите:</p><pre class="brush: bash noskimlinks noskimwords">$ curl https://github.com/pantheon-systems/terminus/releases/download/0.11.1/terminus.phar -L -o /usr/local/bin/terminus &amp;&amp; chmod +x /usr/local/bin/terminus</pre><p>Команда устанавливает Terminus в <code class="inline">/usr/local/bin/terminus</code> на вашем компьютере.</p><p>По завершении установки вы можете протестировать его, выполнив следующую команду:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus art</pre><p>Должен появиться один из нескольких различных логотипов ASCII. Вот значок кулака молнии Terminus, например:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut1.png" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><h3>Шаг 2. Войдите в Terminus.</h3><p>Прежде чем вы сможете использовать Terminus для управления вашей учетной записью Pantheon и связанными с ней сайтами, вам нужно будет войти в систему.</p><p>Это можно сделать двумя способами: вы можете войти в систему, используя свой адрес электронной почты и пароль Pantheon, или использовать машинный токен, чтобы идентифицировать компьютер, на котором вы выполняете вход.</p><p>Мы подойдем к подходу машинного токена, поскольку он обеспечивает дополнительный уровень безопасности. Если ваш компьютер скомпрометирован и вам нужно отключить логин для него, вы можете отозвать маркер машины, и никто больше не сможет получить доступ к вашей учетной записи с этого компьютера. Машинные токены также полезны, если вы запускаете Terminus на нескольких машинах и автоматизированных сценариях, например, на сервере непрерывной интеграции.</p><p>Каждый созданный вами токен дает пользователям машины тот же доступ к вашей учетной записи Pantheon, какой есть у вас. Поэтому обязательно отмените любые токены, которые вы больше не используете.</p><p>Чтобы создать свой первый машинный токен, войдите в свою учетную запись Pantheon. Затем на вкладке <strong>Account</strong> выберите пункт меню <strong>Machine Tokens</strong>.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut2b.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Нажмите <strong>Создать маркер</strong>. Затем на следующем экране введите описательное имя и нажмите «<strong>Создать токен</strong>».</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut3.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Затем вы увидите всплывающее окно с отображением только что созданного токена вместе с командой для его сохранения в Terminus на вашем компьютере.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut4.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Скопируйте <strong>команду Terminus</strong> и запустите ее в командной строке.<br></p><pre class="brush: bash noskimlinks noskimwords">$ terminus auth login --machine-token=TOKEN</pre><p>Как только команда завершится, Terminus готов к использованию на вашем компьютере. </p><p>Давайте посмотрим, что вы можете с ним сделать!</p><h3>Шаг 3. Обзор команд Terminus</h3><p>В оставшейся части руководства мы будем использовать команды Terminus здесь и там, где мы настроили автоматическое тестирование вашего сайта WordPress. А теперь давайте взглянем на некоторые из команд и как вы можете узнать о них больше.</p><p>Таким образом, как только вы закончите обучение, у вас появятся указатели, которые вы можете использовать, чтобы узнать больше и улучшить свой рабочий процесс в соответствии с вашими предпочтениями.</p><p>Вы можете найти обновленный список команд Terminus в <span>Terminus Wiki</span>. </p><p>Список не содержит документации для команд, поэтому, когда вы видите команду, которую вы, возможно, захотите использовать, используйте инструмент Terminus, чтобы узнать больше об этом, набрав:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus help &lt;command&gt; &lt;subcommand&gt;</pre><p>Если вы не укажете <code class="inline">&lt;subcommand&gt;</code>, Terminus покажет вам список подкоманд, доступных для указанной команды.</p><p>Теперь давайте взглянем на <em>некоторые</em> полезные команды, которые вы можете использовать для выполнения действий из предыдущего учебника непосредственно в командной строке.</p><h4>Управление вашими сайтами</h4><p>Чтобы просмотреть список всех ваших сайтов в Пантеоне, введите: </p><pre class="brush: bash noskimlinks noskimwords">$ terminus sites show</pre><p>Существуют также команды для создания нового сайта (<code class="inline">terminus sites create</code>) и импорта сайта (<code class="inline">terminus sites import</code>) без использования личного кабинета. Это может быть полезно, если вы являетесь агентством и часто создаете новые сайты. Для остальных из нас приборная панель отлично подойдет.</p><p>Еще одна полезная команда <code class="inline">terminus sites mass-update</code>  это массовое обновление конечных сайтов, которое вы можете использовать, чтобы обновить все ваши dev-сайты с помощью доступного upstream-обновления (в нашем случае - новой версии WordPress).</p><h4>Выкатывание и развертывание ваших изменений</h4><p>Большая часть работы при разработке нового сайта - это написание, развертывание и тестирование кода. Таким образом, независимо от того, работаете ли вы в режиме Git или SFTP, вы будете постоянно это делать. Именно поэтому это также одна из областей, в которой вы больше всего выиграете от использования интерфейса командной строки, вместо использования веб-панели.</p><p>Эти действия сгруппированы под командой <code class="inline">site</code> - вы можете увидеть полный список, набрав:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus help site</pre><p>Поскольку именно здесь происходит большинство действий в Pantheon, вы увидите, что есть много подкоманд. Потратьте время, чтобы изучить их, когда вы работаете на своем сайте, но сейчас давайте посмотрим на некоторые из самых полезных.</p><p>Если вы работаете в режиме SFTP, как мы это делали в большинстве предыдущих уроков, вам придется зафиксировать изменения в управлении версиями, чтобы хранить их и иметь возможность развёртывать их в тестовые и живые среды.</p><p>Вы можете сделать это через CLI, используя следующую команду:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus site code commit --site=&lt;site&gt; --message=&lt;message&gt;</pre><p>Замените <code class="inline">&lt;site&gt;</code> идентификатором вашего сайта (например,<code class="inline"> tutorial-example-site</code>) и <code class="inline">&lt;message&gt;</code> с описательным сообщением о фиксации. </p><p>Вы также можете использовать команду <code class="inline">site code</code> для других функций, связанных с контролем версий. Дополнительную информацию см. На странице справки команды.</p><p>После того как вы зафиксировали свои изменения (или перенесли их прямо в систему управление версиями, если вы находитесь в режиме Git), вы можете развернуть их в Test and Live среду, используя команду <code class="inline">site deploy</code>:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus site deploy --site=&lt;site&gt; --env=&lt;test|live&gt; [--sync-content] [--cc] [--note=&lt;note&gt;]</pre><p>С помощью этой команды вы можете выполнить развертывание от Dev до Test или Test to Live. Чтобы указать, что вы делаете, установите для атрибута <code class="inline">--env</code> правильное значение (<code class="inline">test</code> или <code class="inline">live</code>). При развертывании в Test у вас также есть возможность автоматически клонировать данные из Live-среды (<code class="inline">--sync-content</code>) - оставьте этот флаг, если вы не хотите синхронизировать данные. Если вы укажете флаг <code class="inline">--cc</code>, Pantheon очистит кеш после развертывания. Если вы хотите добавить примечание развертывания, вы можете сделать это, используя параметр <code class="inline">--note</code>. </p><p>Чтобы обновить восходящий поток одного сайта (в нашем случае, базовую установку WordPress) до его последней версии, вы можете использовать команду:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus site upstream-updates &lt;list|apply&gt; --site=&lt;site&gt;</pre><p>Выберите любой <code class="inline">list</code>, чтобы просто перечислить обновления или <code class="inline">apply</code>, чтобы фактически заставить их произойти.</p><p>В дополнение к этим действиям вы можете использовать команду <code class="inline">terminus site</code> для выполнения многих других задач, таких как запуск резервных копий, очистка кеша вручную, клонирование содержимого между средами и работа с средами <em>Multidev</em>. Проверьте страницу справки для получения полного списка команд и параметров.<br></p><h4>Управление сайтом WordPress</h4><p>Для разработчиков WordPress, таких как вы и я, большая часть возможностей Terminus заключается в том, что они позволяют нам запускать команды WP-CLI в целевой среде. Таким образом, вы можете, например, установить и обновить плагины на своих сайтах клиентов, не посещая панель инструментов WordPress вообще.</p><p>Команда запуска команды WP-CLI на сервере Pantheon Dev:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus wp &lt;commands&gt;... [--site=&lt;site&gt;]</pre><p>Так, например, чтобы вносить изменения в конфигурацию из WP-CFM на Dev в Git, а затем в среду тестирования (отличный пример повторяющейся задачи, ожидающей автоматизации) с помощью Terminus, вы можете использовать следующие команды:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus wp "config push site_options" --site=tutorial-example-site --env=dev$ terminus site code commit --site=tutorial-example-site --env=dev --message="Pushed configuration changes to site_options.json"$ terminus site deploy --site=tutorial-example-site --env=test --cc --note="Deploy code for options.json configuration"$ terminus wp "config pull site_options" --site=tutorial-example-site --env=test</pre><p>Замените <code class="inline">tutorial-example-site</code> фактическим идентификатором сайта и <code class="inline">site_options</code> идентификатором набора параметров, который вы создали на WP-CFM. </p><p>Продолжая работать с Pantheon и Terminus, я уверен, что вы найдете все больше и больше способов использовать интерфейс командной строки для ускорения и автоматизации вашей работы. </p><p>Так что, продолжайте экспериментировать!</p><h2> <span class="sectionnum">2</span>. Начало работы с тестированием сайта WordPress</h2><p>В <span>предыдущем уроке</span> вы видели, как вы можете использовать среду тестирования для тщательного тестирования вашего кода, прежде чем перейти на Live-сервер для использования. Хотя это отличная идея, убедитесь, что вы проверили все - это работа, которая включает контрольные списки и многократные прокликивания. Другими словами, это очень вероятное место для промахов.<br></p><p>Вот почему это идеальный шаг в вашем процессе для некоторой автоматизации!<br></p><p>В оставшейся части урока мы создадим простую тестовую установку с использованием инструмента тестирования Behat и заставим его автоматически запускаться каждый раз, когда вы разворачиваете свой код из Dev в Test на Pantheon. Для этого мы будем использовать комбинацию скриптового инструмента Quicksilver на сервере Pantheon и сервер непрерывной интеграции, работающий в облаке.</p><p>Мы начнем с настройки тестов и запуска их на вашем компьютере.</p><h3>Шаг 1. Создайте новый проект для проведения тестов Behat.<br></h3><p><span>Behat</span> - это свободно распространяемая среда разработки с открытым исходным кодом для PHP, которая позволяет вам писать тестовые примеры для проверки того, что фактический пользовательский интерфейс соответствует тому, что вы ожидаете.</p><p>Давайте начнем с настройки Behat в новом каталоге, который мы позже можем развернуть на сервере непрерывной интеграции. Тесты Behat будут запускаться локально (позже на сервере CI), тестируя сайт Pantheon, запущенный в вашей тестовой среде. </p><p>Мы начнем настройку Behat, загрузив шаблон быстрого запуска из GitHub, а затем настроив его для наших нужд. В подходящем каталоге на вашем компьютере выполните следующие команды для загрузки пакета:</p><pre class="brush: bash noskimlinks noskimwords">$ curl https://codeload.github.com/ari-gold/WordPress-Behat-Quickstart/zip/master &gt; WordPress-Behat-Quickstart.zip$ unzip WordPress-Behat-Quickstart.zip$ rm WordPress-Behat-Quickstart.zip</pre><p>При распаковке пакета создается новый каталог <code class="inline">WordPress-Behat-Quickstart-master</code>. Переименуйте директорию на то, что лучше соответствует нашему использованию:</p><pre class="brush: bash noskimlinks noskimwords">$ mv WordPress-Behat-Quickstart-master wp-pantheon-behat</pre><p>Затем перейдите в этот каталог:</p><pre class="brush: bash noskimlinks noskimwords">$ cd wp-pantheon-behat</pre><p>В этом каталоге вы найдете несколько шаблонов конфигурации и две <em>функции</em> для старта, которые вы можете построить, чтобы создать свои тесты Behat.</p><p>Но прежде чем мы посмотрим на них, давайте закончим установку. Установка выполняется с помощью Composer, поэтому, если у вас еще нет установленного Composer, загрузите и установите его перед продолжением.</p><p>Поскольку пакет быстрого запуска уже содержит конфигурацию <code class="inline">composer.json</code> и <code class="inline">composer.lock</code> для установки Behat, все, что вам нужно сделать, - это ввести следующую команду в командной строке:</p><pre class="brush: bash noskimlinks noskimwords">$ composer install</pre><p>Composer загрузит необходимые пакеты и сохранит их в нужном месте. Когда установка запустится и, наконец, завершится, вы увидите что-то вроде этого:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut5.png" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Чтобы запустить Behat, вам понадобятся два файла конфигурации: <code class="inline">behat.yml</code> и <code class="inline">behat.local.yml</code>. </p><p>Проект быстрого запуска уже содержит файлы по умолчанию для обоих, но файл для <code class="inline">behat.local.yml</code> хранится как <code class="inline">behat.local.yml.sample</code>, чтобы запретить вам передавать вашу локальную конфигурацию (например, пароли) в Git. Проект также содержит файл <code class="inline">.gitignore</code> с именем <code class="inline">behat.local.yml</code>.</p><p>Скопируйте образец конфигурации:</p><pre class="brush: bash noskimlinks noskimwords">$ cp behat.local.yml.sample behat.local.yml</pre><p>Вы можете использовать этот файл для хранения любой среды или пользовательской конфигурации, которые не должны быть привязаны к фактическому файлу <code class="inline">behat.yml</code>. В этом уроке наши тесты настолько просты, что нам нужно только убедиться, что файл присутствует.</p><p>Далее, давайте посмотрим на второй файл конфигурации, <code class="inline">behat.yml</code>. </p><p>Измените файл, заменив URL, указанный с идентификатором <code class="inline">base_url</code>, URL-адресом тестовой среды. В конце файл должен выглядеть следующим образом: <span>http://test-tutorial-example-site.pantheonsite.io</span> - URL-адрес тестового сервера:</p><pre class="brush: plain noskimlinks noskimwords"># behat.ymldefault:    extensions:        Behat\MinkExtension\Extension:            base_url: http://test-tutorial-example-site.pantheonsite.io/            goutte: ~            selenium2: ~            show_cmd: "/Applications/Firefox.app/Contents/MacOS/firefox %s"imports:  - behat.local.yml  </pre><p>После того, как вы обновили конфигурацию, проверьте, что все работает, перечислив тестовые сценарии, доступные в каталоге:<br></p><pre class="brush: bash noskimlinks noskimwords">$ bin/behat -dl</pre><p>Вы увидите длинный список регулярных выражений, описывающих тестовые сценарии из каталога ваших функций: </p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut6.png" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Далее давайте более подробно рассмотрим тесты и запустим их на ваш тестовый сервер.</p><h3>Шаг 2. Запустите свой первый тест</h3><p>Тесты в Behat называются <em>features</em>  и, как я кратко упомянул выше, они хранятся в текстовых файлах в каталоге <code class="inline">features</code> - по одному файлу на каждую тестируемую функцию.<br></p><p>Если вы посмотрите в каталоге, вы найдете две функции, указанные в пакете быстрого запуска: <code class="inline">homepage_works.feature</code> и <code class="inline">blog.feature</code>. Вы можете использовать их в качестве отправной точки для ваших тестов, а затем добавить столько, сколько захотите, при создании полного набора тестов для вашего сайта WordPress.</p><p>Начнем с <code class="inline">homepage_works.feature</code>, быстрого теста, который проверяет, может ли посетитель, прибывающий на ваш сайт, загрузить домашнюю страницу:</p><pre class="brush: plain noskimlinks noskimwords">@smokeFeature: As a visitor I should be able to load the home pageScenario: Home page loads    Given I am on the homepage    Then I should see "Test with Robots"</pre><p>Функции Behat написаны в формате <em>Gherkin</em>, который, как вы можете видеть из этого фрагмента, выглядит как простой английский - чуть более тщательно сформулированный, чем заметка между нами двумя. Или, как говорится в документации Behat, «форма, понятная для бизнеса и разработчиков».</p><p>В этом уроке я не буду углубляться в объяснение того, как использовать Behat для создания тестов. Для этого я рекомендую <span>прочитать документацию по началу работы Behat</span>.</p><p>Для наших потребностей на данный момент достаточно понять, что feature состоит из одного или нескольких <em>сценариев</em>, которые описывают, как пользователь действует и что должно произойти в результате. Это выглядит как волшебство, это не так. За кулисами Behat использует регулярные выражения для сопоставления шагов сценария с функциями PHP, определенными либо в вашем наборе тестов (см. <code class="inline">features/bootstrap</code>), либо в библиотеке, такой как <span>Mink</span>, которую мы используем для моделирования пользователя, просматривающего Интернет.</p><p>Например, строка «<code class="inline">I am on the homepage</code>» переводит функцию <code class="inline">iAmOnHomepage()</code> в библиотеку Mink и переводит виртуальный браузер Mink в корень веб-сайта, указанный в файле <code class="inline">behat.yml</code>-ваш тестовый сервер.</p><p>Теперь давайте настроим тест так, чтобы он прошел на вашем тестовом сервере. На данный момент тест предполагает найти текст <code class="inline">«Test with Robots»</code> на вашей домашней странице. Другими словами, если у вас нет текста, написанного там, тест не будет выполнен. </p><p>Поэтому замените этот фрагмент предложением, которое вы знаете на первой странице (например, названием своего сайта) и сохраните изменения.</p><p>Затем запустите следующую команду, чтобы запустить все тесты, помеченные <code class="inline">@smoke</code>. В этом случае просто этот тест.</p><pre class="brush: bash noskimlinks noskimwords">$ bin/behat --tags=smoke</pre><p>Вы должны увидеть тест:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut7.png" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Теперь вы настроили тест, который успешно проходит на вашей машине разработки, тестируя сайт WordPress в среде Pantheon Test. </p><p>Набор тестов по-прежнему очень ограничен, и для реального сервера это только начало. Итак, после завершения учебного курса, вернитесь к этому шагу и углубитесь в Behat, чтобы создать тесты, которые действительно поставят ваш сервер на проверку, проверив все те мелочи, которые вы бы проверили сами, проверяя сайт вручную.</p><p>Но теперь перейдем к следующему шагу в нашем пути к автоматическому приемочному тестированию и пробному запуску в облаке.</p><h2> 3. Выполнение тестов Behat в облаке </h2><p><span>Непрерывная интеграция</span> (CI) - это практика разработки программного обеспечения, где код объединяется с основной веткой несколько раз в день и автоматически проверяется при каждом нажатии. Сегодня это обычно означает, что у вас есть непрерывный интеграционный сервис, работающий в облаке, следящий за вашим репозиторием Git. Затем, каждый раз, когда вы вставляете новый контроль в версию, служба CI запускается, вытягивает код из Git и строит и тестирует его.</p><p>В этом учебном курсе мы будем использовать части этого подхода для разработки установки, которая лучше подходит для трех рабочих процессов среды Pantheon: вместо запуска тестов при каждом <code class="inline">git push</code> мы запустим их, когда новый код будет развернут на тестовом сервере.</p><p>Мы будем использовать <span>Circle CI</span> в качестве нашего сервера непрерывной интеграции, поскольку он имеет свободный уровень, который достаточно силен для удовлетворения потребностей учебника и API, который мы можем вызвать из Пантеона, чтобы начать сборку. В вашей собственной реализации вы также можете использовать другой сервер непрерывной интеграции, такой как Travis CI или Jenkins, с некоторыми изменениями в процессе, описанном в учебнике.</p><h3>Шаг 1: выложите ваши тесты на Git</h3><p>Большинство услуг непрерывной интеграции в облаке тесно связаны с контролем версий, поддерживая либо Bitbucket, либо GitHub. Некоторые поддерживают оба. Но если вы не настроите свой собственный сервер CI, например, используя Jenkins, вам придется поддерживать репозиторий отдельно от вашей учетной записи Pantheon для установки непрерывной интеграции.<br></p><p>Одним из вариантов является поддержка всего сайта в GitHub или Bitbucket и развертывание его с сервера непрерывной интеграции в Pantheon с использованием Terminus. Хотя это было бы ближе к идеалу непрерывной интеграции, это также довольно сложная настройка и, на мой взгляд, нарушает идею рабочего процесса Pantheon.</p><p>Именно поэтому в нашей настройке мы храним только тестовую установку в репозитории GitHub, связанную с сервисом CI, и поддерживаем код сайта в Pantheon, как мы это делали до сих пор.</p><p>Сначала зарегистрируйтесь в GitHub и создайте новый репозиторий:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut8.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Затем в каталоге <code class="inline">wp-pantheon-behat</code> инициализируйте Git и зафиксируйте изменения:</p><pre class="brush: bash noskimlinks noskimwords">$ git init$ git add .gitignore behat.yml composer.json composer.lock features$ git commit -m "First commit"</pre><p>Обратите внимание, что файлы, установленные Composer, не хранятся в git. Они будут автоматически установлены на сервере CI в составе тестового скрипта.</p><p>Затем переместите данные в новый репозиторий GitHub:</p><pre class="brush: bash noskimlinks noskimwords">$ git remote add origin https://github.com/jarkkolaine/wp-pantheon-behat.git$ git push -u origin master</pre><p>Теперь ваша тестовая установка доступна на GitHub. Давайте подключим его к серверу непрерывной интеграции!</p><h3>Шаг 2. Настройка сервера непрерывной интеграции </h3><p>Сначала зарегистрируйтесь для бесплатной учетной записи <span>Circle CI</span>, используя учетную запись GitHub.</p><p>После того, как вы войдете в систему, Circle предложит вам выбрать проект из вашей учетной записи GitHub для сборки. Например, здесь вы можете увидеть проект <code class="inline">wp-pantheon-behat</code> в верхней части списка справа.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut9b.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Нажмите кнопку «<strong>Создать проект</strong>» рядом с проектом.</p><p>Кружок CI немедленно начинает сборку. Он клонирует проект из Git, устанавливает все зависимости Composer - в этом случае - инструменты тестирования Behat, - а затем запускает тесты. </p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut10.png" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>В вашей первой сборке Circle CI вызовет ошибку:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut11b.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>По умолчанию Circle CI запускает PHP версию <code class="inline">5.3.10</code>, которая слишком стара для некоторых библиотек, используемых Behat. К счастью, это легко исправить.</p><p>В каталоге <code class="inline">wp-pantheon-behat</code> создайте новый файл <code class="inline">circle.yml</code>. Этот файл будет содержать любые настройки, которые мы хотим внести в нашу конфигурацию Circle CI.</p><p>В файле введите следующее:</p><pre class="brush: plain noskimlinks noskimwords">machine:  php:    version: 5.5.11</pre><p>Зафиксируйте файл в Git и вставьте его в репозиторий GitHub.</p><pre class="brush: bash noskimlinks noskimwords">$ git add circle.yml$ git commit -m "Added PHP version requirement"$ git push origin master</pre><p>Затем вернитесь в Circle CI, где вы увидите, что система непрерывной интеграции снова запустила тест.</p><p>На этот раз шаг Composer должен выполняться успешно. Но еще есть какая-то конфигурация: пока сборка прошла, Circle CI не нашёл наши тесты!</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut12.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Чтобы исправить это, давайте расскажем Circle, как запускать наши тесты Behat.</p><p>В <code class="inline">circle.yml</code> добавьте новый раздел <code class="inline">test</code> прямо под конфигурацией версии PHP, которую мы только что создали:</p><pre class="brush: plain noskimlinks noskimwords">machine:  php:    version: 5.5.11test:  pre:    - mv behat.local.yml.sample behat.local.yml  override:    - mkdir $CIRCLE_TEST_REPORTS/behat    - ./bin/behat --format junit --out $CIRCLE_TEST_REPORTS/behat --tags=smoke</pre><p>Давайте взглянем на фрагмент.</p><p>Во-первых, в предварительном разделе мы сообщаем Circle CI создать файл конфигурации <code class="inline">behat.local.yml</code> с использованием шаблона до того, как он попытается запустить тесты.</p><p>Затем в разделе, отмеченном <code class="inline">override</code>, мы определяем последовательность действий, которые Circle CI должен выполнять, когда пришло время запускать тесты. </p><p>Команда Behat немного отличается от того, что мы использовали при локальном выполнении тестов. Это потому, что мы хотим напечатать результаты тестов в формате JUnit-подобного XML, который может быть проанализирован сервером CI. Переменная $<code class="inline">CIRCLE_TEST_REPORTS</code> является ссылкой на каталог, в котором Circle CI ожидает найти отчеты об испытаниях.</p><p>Зафиксируйте и снова нажмите изменения и вернитесь в Circle CI, чтобы проверить, что тесты теперь успешно запущены.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut13.png" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><h2> 4. Использование Quicksilver для запуска тестов при развертывании времени</h2><p>Теперь, когда вы настроили свои тесты Behat и запустили их на сервере непрерывной интеграции, последний оставшийся шаг - это подключение этой установки к рабочему процессу Pantheon, заставляя Pantheon запускать новую сборку на Circle CI каждый раз, когда вы развертываете свои изменения в Test Окружающая среда.</p><p>Мы сделаем это, используя Pantheon Quicksilver Platform Hooks, систему, которая дает разработчикам возможность связывать скрипты с событиями в рабочем процессе Pantheon.</p><p>Запуск новой сборки на Circle CI - это лишь один из примеров того, что вы можете достичь, используя хуки Quicksilver, поэтому я рекомендую вам изучить ее <span>документацию и примеры</span> и придумать больше собственных методов, как только это будет сделано с учебником.</p><h3>Шаг 1. Определение действия Quicksilver<br></h3><p>Quicksilver уже установлен в среде Pantheon, поэтому вы можете начать использовать его, только определив свое первое действие Quicksilver. </p><p>Конфигурация Quicksilver на сайте Pantheon состоит из конфигурационного файла <code class="inline">pantheon.yml,</code> размещенного в корневом каталоге сайта <code class="inline">code</code>, и реальных скриптов, написанных на PHP. </p><p>Вы можете загрузить эти файлы с помощью SFTP, как мы это делали в предыдущем уроке, или использовать режим Git. </p><p>Чтобы выполнить изменения в режиме Git, сначала установите <strong>режим подключения</strong> сайта в <strong>Git</strong>:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut14.png" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Нажмите <strong>Git Connection Info</strong>, чтобы скопировать команду для клонирования вашего git-репозитория и запустить ее в подходящем каталоге в командной строке:</p><pre class="brush: bash noskimlinks noskimwords">$ git clone ssh://codeserver.dev.XXX@codeserver.dev.XXX.drush.in:2222/~/repository.git tutorial-example-site</pre><p>Как только команда clone завершится, добавьте файл <code class="inline">pantheon.yml</code> в каталог, используя ваш любимый текстовый редактор, со следующим содержимым:</p><pre class="brush: plain noskimlinks noskimwords">api_version: 1workflows:  deploy:    after:        - type: webphp          description: Initiate a new build at Circle CI          script: private/scripts/circle_ci_notify.php</pre><p>В этом файле конфигурации вы перечислите все скрипты, которые вы хотите перехватить в своих рабочих процессах Pantheon, определяя, хотите ли вы запускать скрипт до или после этого события. Для любого события вы можете добавить столько скриптов, сколько вам нужно.</p><p>В настоящее время доступны следующие рабочие процессы для подключения к:</p><ul><li> <code>deploy</code>: запускается, когда ваш код развертывается в Test или Live. Скрипты запускаются в целевой среде.</li> <li> <code>sync_code</code>: запускается при выкладывании кода через Git или в Pantheon Dashboard. Сценарии выполняются в среде, к которой применяется commit.</li> <li> <code>сlone_database</code>: запускается, когда данные клонируются между средами. Скрипты запускаются в целевой среде.</li> <li> <code>сlear_cache</code>: запускается при очистке кеша. Сценарии выполняются в очищенной среде.</li> </ul><p>Каждый сценарий или действие состоит из <code class="inline">type</code> (в настоящее время поддерживается только <code class="inline">webphp</code>, что означает поддержку PHP-кода в целевой среде), <code class="inline">description</code> и <code class="inline">script</code>, путь к файлу сценария относительно вашего репозитория кода.<br></p><p>Итак, посмотрев файл <code class="inline">pantheon.yml</code> выше, вы увидите, что мы хотим запустить скрипт, <code class="inline">private/scripts/circle_ci_notify.php</code>, сразу <em>после</em> события <em>deploy</em>.</p><h3>Шаг 2. Создание сценария PHP для вашего действия Quicksilver</h3><p>Чтобы функционировать, наш хук действий Quicksilver по-прежнему нуждается в скрипте. </p><p>Наш скрипт вызовет <span>новое действие сборки</span> Circle CI API для повторного запуска тестов. Для этого нам нужно безопасным образом получить и сохранить учетные данные API-интерфейса Circle CI в среде Pantheon Test. </p><p>На панели инструментов Circle CI нажмите «<strong>Настройки учетной записи</strong>» в меню слева, а затем выберите вкладку «<strong>Токены API</strong>», чтобы создать новый токен API.<br></p><p>Введите новый токен описательного имени и нажмите «<strong>Создать новый токен</strong>».</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/343/posts/26551/image/tut15.jpg" alt="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." title="Как автоматизировать и оптимизировать разработку и тестирование WordPress в Pantheon..." width="50" height="50"></figure><p>Теперь у вас есть токен API, который вы можете использовать, чтобы поговорить с Circle CI API. </p><p>Передача секретов API или других конфиденциальных данных для контроля версий считается плохой практикой. Поэтому давайте использовать более безопасный способ передать учетные данные API в свой сценарий, создав файл конфигурации и загрузив его в безопасное место на тестовом сервере.<br></p><p>В каталоге вне экспортируемого репозитория кода создайте файл с именем <code class="inline">secrets.json</code>. В этот файл поместите следующее содержимое:</p><pre class="brush: javascript noskimlinks noskimwords">{ "username":"YOUR USER NAME", "project":"wp-pantheon-behat", "token":"YOUR API KEY" }</pre><p>Затем загрузите его в тестовую среду в каталоге с именем <code class="inline">files/private</code>, используя SFTP. Обратите внимание, что файловая система (каталог <code class="inline">files</code> на вашем сервере) отделена от кода, а файлы в ней никогда не переходят в управление версиями.<br></p><p>Командна Terminus <code class="inline">site connection-info</code> выводит информацию для подключения к вашей среде на основе метода сайта, среды и подключения, который вы передаете в качестве параметров.<br></p><p>Итак, чтобы подключиться к файловой системе вашей тестовой среды с использованием SFTP, вы можете использовать эту команду - как небольшой трюк, окружающий команду символами backtick (<i>`</i>) запускает команду print out вместо того, чтобы просто показывать ее вам (естественно, вы можете Также используйте ваш любимый SFTP-клиент):</p><pre class="brush: bash noskimlinks noskimwords">$ `terminus site connection-info --env=test --site=tutorial-example-site --field=sftp_command`</pre><p>Теперь, когда вы подключены к серверу, пришло время загрузить файл конфигурации:</p><pre class="brush: plain noskimlinks noskimwords">sftp&gt; cd filessftp&gt; mkdir privatesftp&gt; put secrets.jsonsftp&gt; exit</pre><p>Учетные данные уже установлены. Давайте создадим скрипт.</p><p>В вашем репозитории кода создайте каталог <code class="inline">private/scripts</code>, а внутри него добавьте новый скрипт PHP <code class="inline">circle_ci_notify.php</code>.</p><p>Это обычный PHP-скрипт, который запускается в целевой среде события - в случае события <code class="inline">deploy</code> - либо Test, либо Live.</p><pre class="brush: php noskimlinks noskimwords">&lt;?php// Check environmentif ( ! isset( $_ENV["PANTHEON_ENVIRONMENT"] ) || $_ENV["PANTHEON_ENVIRONMENT"] !== "test" ) {        die( "Automatic tests should only be run on the Test environment" );}// Load a secrets file$secrets = _get_secrets("secrets.json");// Use a curl POST request to trigger the Circle CI API action$url = "https://circleci.com/api/v1/project/";$url = $url . $secrets["username"] . "/" . $secrets["project"] . "?circle-token=" . $secrets["token"];$curl = curl_init( $url );// Declare request as a post and setup the fieldscurl_setopt( $curl, CURLOPT_POST, true );// All parameters are optional, so we can send an empty arraycurl_setopt( $curl, CURLOPT_POSTFIELDS, json_encode( array() ) );// Execute the request $response = curl_exec( $curl );if ( $response ) {        echo "Build Queued";} else {        echo "Build Failed";}/** * Get secrets from secrets file. * * @param string $file path within files/private that has your json */function _get_secrets( $file ) {    $secrets_file = $_SERVER["HOME"] . "/files/private/" . $file;    if ( ! file_exists( $secrets_file ) ) {        die( "No secrets file found. Aborting!" );    }      $secrets_json = file_get_contents( $secrets_file );    $secrets = json_decode( $secrets_json, 1 );        if ( $secrets == FALSE ) {        die( "Could not parse json in secrets file. Aborting!" );    }    return $secrets;}</pre><p>Давайте пройдем по сценарию построчно.</p><p>В строках <strong>2-5</strong> сценарий проверяет, что он запускается в тестовой среде.</p><p>Затем в <strong>строке 8</strong> он считывает параметры API из файла JSON, который вы только что загрузили в файловую систему, с помощью вспомогательной функции <code class="inline">_get_secrets</code>, указанной в конце файла, в строках <strong>37-50</strong>.</p><p>Затем в <strong>строках 10-22</strong> скрипт выдает HTTP-запрос Circle CI API для инициализации сборки.</p><p>Наконец, в <strong>строках 24-28</strong> скрипт проверяет ответ от вызова API и выводит простое сообщение об успешном завершении. Если хотите, это хорошее место для дальнейшего развития: вы могли бы, например, сделать скрипт, отправляющий уведомление каналу Slack вашей команды!</p><p>Теперь все готово. Зафиксируйте и вставьте свои изменения в репозиторий Git.<br></p><p>Как только выполнение <code class="inline">git push</code> завершится, вы увидите следующий результат: Pantheon сообщит вам, что он обнаружил ваш вновь созданный файл <code class="inline">pantheon.yml</code> и применил его действия к среде Dev.</p><pre class="brush: plain noskimlinks noskimwords">remote: remote: PANTHEON NOTICE:remote: remote: Changes to `pantheon.yml` detected.remote: remote: Successfully applied `pantheon.yml` to the "dev" environment.remote: remote: </pre><p>Однако, как я упоминал ранее, задача <code class="inline">deploy</code> запускается в целевой среде. Поэтому перед запуском нашего скрипта нам необходимо развернуть изменения в Test.</p><p>Давайте сделаем это, используя интерфейс командной строки Terminus (вы также можете использовать Web Dashboard, если хотите):</p><pre class="brush: bash noskimlinks noskimwords">$ terminus site deploy --site=tutorial-example-site --env=test --sync-content --note="Added Quicksilver event for Circle CI"</pre><p>Наш скрипт Quicksilver теперь доступен в тестовой среде. <br></p><p>Чтобы увидеть его в действии, внесите изменения в кодовую базу среды разработки (например, установив новый плагин или изменив свою дочернюю тему) и зафиксируйте и развесьте свои изменения в Test.</p><p>Когда вы заходите в панель управления Circle CI, вы увидите, что новая сборка была запущена и запущена, проверяя, что первая страница вашего тестового сайта может быть загружена в порядке.</p><p>Вы также можете использовать Terminus для проверки правильности работы сценария. Для этого перед развертыванием изменений в командной строке выполните команду:</p><pre class="brush: bash noskimlinks noskimwords">$ terminus workflows watch --site=tutorial-example-site </pre><p>Теперь, когда развертывание завершится, вы увидите нечто подобное, рассказывая о вашем действии Quicksilver: </p><pre class="brush: bash noskimlinks noskimwords">[2016-05-19 13:01:24] [info] Finished workflow b532f7fe-1dc1-11e6-9914-bc764e10b0ce Deploy code to "test" (test) at 2016-05-19 13:01:10    id: "b532f7fe-1dc1-11e6-9914-bc764e10b0ce"    description: "Deploy code to "test""    env: "test"    time: "2016-05-19 13:01:10"[2016-05-19 13:01:26] [info] ------ Operation: Initiate a new build at Circle CI finished in 3s (test) ------{  "compare" : null,  "previous_successful_build" : {    "build_num" : 9,    "status" : "success",    "build_time_millis" : 55657  },  ...</pre><h2>Заключение<br></h2><p>Теперь установка автоматизированного тестирования завершена: всякий раз, когда вы развертываете код из среды <span>Pantheon</span> Dev для тестирования, новая сборка запускается на Circle CI и запускает тесты Behat для вашей тестовой среды. Если что-то пойдет не так, Circle отправит вам сообщение по электронной почте о сломанной сборке, чтобы вы могли исправить это и попробовать еще раз.</p><p>Но это только начало.</p><p>Во-первых, вам нужно будет написать больше тестов. Подумайте обо всех вещах, которые вы проверяете, чтобы убедиться, что ваш сайт работает правильно, а затем напишите функции Behat для их тестирования. Затем подумайте о том, как ваши посетители и клиенты могут использовать сайт, и напишите тесты для этих прецедентов.</p><p>Вы также можете улучшить конфигурацию Circle CI, например, добавив уведомление Slack об успешном тестировании. Таким образом, вы будете знать, что ваши автоматические тесты проходят и могут сделать окончательную проверку, прежде чем нажать изменения вживую. Позже, когда вы почувствуете уверенность в своих тестах, вы можете даже подумать об изменении вашего <code class="inline">circle.yml</code>, чтобы использовать Terminus для автоматического развертывания кода из Test to Live после успешной сборки!</p><p>Однако возможности здесь не заканчиваются! Вы также можете использовать Quicksilver для добавления автоматизированных сценариев в свой рабочий процесс. Взгляните на <span>некоторые примеры от инженеров Pantheon</span>. И создайте свои собственные!</p><p>Постепенно, когда вы автоматизируете свой процесс тестирования и разработки, вы создаете все более безопасный рабочий процесс.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825215-kak-avtomatizirovat-i-optimizirovat-razrabotku-i-testirovanie-wordpress-v-pantheon" class="tm-article-body__tags-item-link">WordPress</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40651</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
566</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
