
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Этот учебник является частью серии статей-Tuts +-по созданию вашего стартапа на PHP. В этой серии я расскажу вам о запуске стартапа из концепции в реальность, используя приложение «Планировщик встреч» в качестве примера из реальной жизни. На каждом шаге по пути, мы выпустим код планировщика собраний как примеры с открытым исходным кодом, из которых...">
<meta property="og:description" content="Этот учебник является частью серии статей-Tuts +-по созданию вашего стартапа на PHP. В этой серии я расскажу вам о запуске стартапа из концепции в реальность, используя приложение «Планировщик встреч» в качестве примера из реальной жизни. На каждом шаге по пути, мы выпустим код планировщика собраний как примеры с открытым исходным кодом, из которых...">
<meta name="twitter:description" content="Этот учебник является частью серии статей-Tuts +-по созданию вашего стартапа на PHP. В этой серии я расскажу вам о запуске стартапа из концепции в реальность, используя приложение «Планировщик встреч» в качестве примера из реальной жизни. На каждом шаге по пути, мы выпустим код планировщика собраний как примеры с открытым исходным кодом, из которых...">
<meta property="aiturec:description" content="Этот учебник является частью серии статей-Tuts +-по созданию вашего стартапа на PHP. В этой серии я расскажу вам о запуске стартапа из концепции в реальность, используя приложение «Планировщик встреч» в качестве примера из реальной жизни. На каждом шаге по пути, мы выпустим код планировщика собраний как примеры с открытым исходным кодом, из которых...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/final_image/user-setting-update.jpeg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/final_image/user-setting-update.jpeg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/final_image/user-setting-update.jpeg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/final_image/user-setting-update.jpeg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/final_image/user-setting-update.jpeg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html" title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io" title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/542343243.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html" class="tm-user-info__username" title="
А. Анискин" aria-label="
А. Анискин">
А. Анискин</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Yii" href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye" class="tm-article-snippet__hubs-item-link"><span>Yii</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/final_image/user-setting-update.jpeg">
    <meta itemprop="headline name" content="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Этот учебник является частью серии статей-Tuts +-по созданию вашего стартапа на PHP. В этой серии я расскажу вам о запуске стартапа из концепции в реальность, используя приложение «Планировщик встреч» в качестве примера из реальной жизни. На каждом шаге по пути, мы выпустим код планировщика собраний как примеры с открытым исходным кодом, из которых...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Этот учебник является частью серии статей-Tuts +-по созданию вашего стартапа на PHP. В этой серии я расскажу вам о запуске стартапа из концепции в реальность, используя приложение «Планировщик встреч» в качестве примера из реальной жизни. На каждом шаге по пути, мы выпустим код планировщика собраний как примеры с открытым исходным кодом, из которых...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Этот учебник является частью серии статей Tuts + <span>по созданию вашего стартапа на PHP</span>. В этой серии я расскажу вам о запуске стартапа из концепции в реальность, используя приложение <span>«Планировщик встреч»</span> в качестве примера из реальной жизни. На каждом шаге по пути, мы выпустим код планировщика собраний как примеры с открытым исходным кодом, из которых вы многое сможете узнать. Мы также рассмотрим связанные с со стартапом бизнес-вопросы по мере их возникновения.</p><p>В этом уроке мы будем строить ключевые области вокруг собственных данных пользователя для их более широкого использования в приложении:</p><ol><li>Контактная информация: номер телефона пользователя и адреса видеоконференций для виртуальных встреч</li> <li>Настройки пользователя: для отслеживания пользовательских настроек в приложении</li> <li>Изображения профиля: чтобы пользователь мог загрузить фотографию, которую мы можем использовать на страницах собраний</li> </ol><p>Весь код Планировщика собраний написан в Yii2 Framework для PHP, который имеет встроенную поддержку I18n. Если вы хотите узнать больше о Yii2, ознакомьтесь с нашей параллельной серией <span>Программирование с Yii2</span> на Tuts +.</p><p>Напоминаю, что я участвую в комментариях ниже. Меня особенно интересует, если у вас разные подходы, дополнительные идеи или вы хотите предложить темы для будущих учебников.</p><h2>Контактная информация</h2><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/contact-index.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><p>Целью контактной информации является предоставление пользователям номера телефонов и адресов видеоконференций для виртуальных встреч. Телефон также будет полезен до и после собрания.</p><p>Написание этой функции относительно простое. Как и в предыдущих учебниках, мы использовали генератор кода Yii, Gii, для создания модели для файлов UserContact и CRUD.</p><p>Мы также обновили навигационную панель, чтобы включить ссылку на функцию «Пользовательский контакт». В файле frontend/views/layouts/main.php:</p><pre class="brush: php noskimlinks noskimwords">$menuItems[] = [                  "label" =&gt; "Account",    "items" =&gt; [       [          "label" =&gt; Yii::t("frontend","Friends"),          "url" =&gt; ["/friend"],      ],         [            "label" =&gt; Yii::t("frontend","Contact information"),            "url" =&gt; ["/user-contact"],        ],         [            "label" =&gt; Yii::t("frontend","Settings"),            "url" =&gt; ["/user-setting"],        ],         [            "label" =&gt; Yii::t("frontend","Logout")." (" . Yii::$app-&gt;user-&gt;identity-&gt;username . ")",            "url" =&gt; ["/site/logout"],            "linkOptions" =&gt; ["data-method" =&gt; "post"]        ],    ],];      echo Nav::widget([    "options" =&gt; ["class" =&gt; "navbar-nav navbar-right"],    "items" =&gt; $menuItems,]);</pre><p>Вы также можете увидеть ссылку, приведенную выше, на функцию «Параметры пользователя», которая будет описана ниже.</p><p>Добавление раскрывающегося списка для типов - это распространенное расширение модели, которое мы используем, чтобы сделать формы более дружественными. Раскрывающийся список <strong>Тип контакта</strong>:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/add-contact-form.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><p>Ниже приведены определения типа модели и вспомогательные методы для обеспечения удобного раскрывающегося списка для служб типа контакта:</p><pre class="brush: php noskimlinks noskimwords">class UserContact extends \yii\db\ActiveRecord{    const TYPE_OTHER = 0;    const TYPE_PHONE = 10;    const TYPE_SKYPE = 20;    const TYPE_FACEBOOK = 30;    const TYPE_GOOGLE = 40;    const TYPE_MSN = 50;    const TYPE_AIM = 60;    const TYPE_YAHOO = 70;    const TYPE_ICQ = 80;    const TYPE_JABBER = 90;    const TYPE_QQ = 100;    const TYPE_GADU = 110;        ...        public function getUserContactType($data) {      $options = $this-&gt;getUserContactTypeOptions();      return $options[$data];    }    public function getUserContactTypeOptions()    {      return array(          self::TYPE_PHONE =&gt; "Phone",          self::TYPE_SKYPE =&gt; "Skype",          self::TYPE_OTHER =&gt; "Other",          self::TYPE_FACEBOOK =&gt; "Facebook Messenger",          self::TYPE_GOOGLE =&gt; "Google Talk",          self::TYPE_MSN =&gt; "MSN Messenger",          self::TYPE_AIM =&gt; "AIM",          self::TYPE_YAHOO =&gt; "Yahoo! Messenger",          self::TYPE_ICQ =&gt; "ICQ",          self::TYPE_JABBER =&gt; "Jabber",          self::TYPE_QQ =&gt; "QQ",          self::TYPE_GADU =&gt; "Gadu-Gadu",         );     }</pre><p>Ниже приведен выпадающий список в форме:</p><pre class="brush: php noskimlinks noskimwords">&lt;div class="user-contact-form"&gt;    &lt;?php $form = ActiveForm::begin(); ?&gt;    &lt;?= $form-&gt;field($model, "contact_type")            -&gt;dropDownList(                $model-&gt;getUserContactTypeOptions(),                       ["prompt"=&gt;Yii::t("frontend","What type of contact is this?")]             )-&gt;label(Yii::t("frontend","Type of Contact")) ?&gt;</pre><p>Эти помощники типа являются общими конструкциями в Планировщике собраний.</p><p>Теперь давайте перейдем к пользовательским настройкам.</p><h2>Пользовательские настройки</h2><p>По мере расширения функциональности планировщика собраний будет важно, чтобы пользователи могли настраивать функциональность с помощью набора настроек. Мы создаем подсистему пользовательских настроек для управления этими настройками в приложении.</p><p>Таблица UserSetting немного отличается от других моделей тем, что каждый пользователь имеет только одну запись, и каждая запись имеет много полей, которые представляют определенные настройки пользователя. Это отличается от того, когда пользователи добавляют записи контактов, где каждый пользователь имеет много записей, каждый из которых представляет контактную запись. </p><p>Когда пользователи меняют свои настройки, мы обновляем их индивидуальные записи настроек. Мы также можем расширить поля таблицы с течением времени для поддержки дополнительных параметров.</p><p>Нам нужно будет создать вспомогательные функции, которые загружают пользовательские настройки и создают для них запись по умолчанию, если она не существуют.</p><p>Нам также необходимо создать форму, чтобы упростить процесс настройки параметров. Мы можем использовать макеты Bootstrap и расширения виджета Yii2.</p><h3>Выбор наших первых настроек пользователя</h3><p>Пока количество настроек будет увеличиваться с течением времени, давайте рассмотрим несколько из тех, с которыми мы могли бы начать:</p><ul><li>Фото профиля пользователя (путь к файлу, который они загружают)</li> <li>Получение напоминаний за день до собрания</li> <li>Получение напоминаний в дни, предшествующие встрече</li> <li>Поделиться контактными данными с участниками собрания</li> <li>Блокировать всю электронную почту из системы</li> </ul><p>Мы можем создать таблицу User Setting с помощью миграции Active Record и расширить ее позже с помощью обновленных миграций.</p><pre class="brush: bash noskimlinks noskimwords">./yii migrate/create create_user_setting_table</pre><p>Вот миграция с полями для наших настроек - обратите внимание на отношение к таблице User:</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpuse yii\db\Schema;use yii\db\Migration;class m150124_003721_create_user_setting_table extends Migration{  public function up()  {      $tableOptions = null;      if ($this-&gt;db-&gt;driverName === "mysql") {          $tableOptions = "CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB";      }      $this-&gt;createTable("{{%user_setting}}", [          "id" =&gt; Schema::TYPE_PK,          "user_id" =&gt; Schema::TYPE_BIGINT." NOT NULL",          "filename" =&gt; Schema::TYPE_STRING." NOT NULL",          "avatar" =&gt; Schema::TYPE_STRING." NOT NULL",          "reminder_eve" =&gt; Schema::TYPE_SMALLINT." NOT NULL",          "reminder_hours" =&gt; Schema::TYPE_INTEGER." NOT NULL",          "contact_share" =&gt; Schema::TYPE_SMALLINT." NOT NULL",          "no_email" =&gt; Schema::TYPE_SMALLINT." NOT NULL",          "created_at" =&gt; Schema::TYPE_INTEGER . " NOT NULL",          "updated_at" =&gt; Schema::TYPE_INTEGER . " NOT NULL",      ], $tableOptions);      $this-&gt;addForeignKey("fk_user_setting_user_id", "{{%user_setting}}", "user_id", "{{%user}}", "id", "CASCADE", "CASCADE");  }  public function down()  {      $this-&gt;dropForeignKey("fk_user_setting_user_id", "{{%user_setting}}");          $this-&gt;dropTable("{{%user_setting}}");  }}</pre><p>Запустите миграцию:</p><pre class="brush: bash noskimlinks noskimwords">./yii migrate/upYii Migration Tool (based on Yii v2.0.2)Total 1 new migration to be applied:    m150124_003721_create_user_setting_tableApply the above migration? (yes|no) [no]:yes*** applying m150124_003721_create_user_setting_table    &gt; create table {{%user_setting}} ... done (time: 0.017s)    &gt; add foreign key fk_user_setting_user_id: {{%user_setting}} (user_id) references {{%user}} (id) ... done (time: 0.009s)*** applied m150124_003721_create_user_setting_table (time: 0.031s)Migrated up successfully.</pre><h3>Пишем код</h3><p>Мы можем использовать Gii для создания файлов модели и CRUD. Конечно, нам придется изменить CRUD, чтобы отображать только запись текущего пользователя.</p><p>Ниже приведены настройки генератора моделей:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/gii-user-settings.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><p>Вот настройки для контроллера CRUD:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/gii-crud-user-setting.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><p>Когда пользователь нажимает «Настройки» на панели навигации, мы хотим отобразить страницу настроек обновлений. Давайте создадим некоторых помощников для проверки записи настроек пользователя и создания новых, если их не существует.</p><p>Здесь индекс перенаправляется на действие обновления:</p><pre class="brush: php noskimlinks noskimwords">/**     * Default path - redirect to update     * @return mixed     */    public function actionIndex()    {      // returns record id not user_id      $id = UserSetting::initialize(Yii::$app-&gt;user-&gt;getId());      return $this-&gt;redirect(["update", "id" =&gt; $id]);    }</pre><p>Метод Initialize создает запись для активного пользователя и устанавливает все настройки по умолчанию:</p><pre class="brush: php noskimlinks noskimwords"> public static function initialize($user_id) {      $us = UserSetting::find()-&gt;where(["user_id"=&gt;$user_id])-&gt;one();      if (is_null($us)) {        $us=new UserSetting;        $us-&gt;user_id = $user_id;        $us-&gt;filename="";        $us-&gt;avatar="";        $us-&gt;reminder_eve = self::SETTING_YES;        $us-&gt;no_email = self::SETTING_NO;        $us-&gt;contact_share = self::SETTING_YES;        $us-&gt;reminder_hours = 48;        $us-&gt;save();      }      return $us-&gt;id;    }</pre><h3>Кастомизация формы настроек</h3><p>Мы должны заменить часть кода с автоматической сгенерированной формой, чтобы включить флажки и другой раскрывающийся список (как это было в случае с типом UserContact выше). Мне нравится, что функциональность флажка Yii включает в себя возможность указывать заданные и неустановленные значения. Как правило, флажки веб-формы возвращают пустой элемент (существует) для true или ничего не возвращают (не существует) для false.</p><pre class="brush: php noskimlinks noskimwords">&lt;?= $form-&gt;field($model, "reminder_eve")-&gt;checkBox(["label" =&gt; Yii::t("frontend","Send final reminder the day before a meeting"), "uncheck" =&gt;  $model::SETTING_NO, "checked" =&gt; $model::SETTING_YES]); ?&gt;          &lt;?= $form-&gt;field($model, "reminder_hours")                 -&gt;dropDownList(                     $model-&gt;getEarlyReminderOptions(),                            ["prompt"=&gt;Yii::t("frontend","When would you like your early reminder?")]                  )-&gt;label(Yii::t("frontend","Early reminders")) ?&gt;            &lt;?= $form-&gt;field($model, "contact_share")-&gt;checkbox(["label" =&gt;Yii::t("frontend","Share my contact information with meeting participants"),"uncheck" =&gt;  $model::SETTING_NO, "checked" =&gt; $model::SETTING_YES]); ?&gt;             &lt;?= $form-&gt;field($model, "no_email")-&gt;checkbox(["label" =&gt;Yii::t("frontend","Turn off all email"),"uncheck" =&gt;  $model::SETTING_NO, "checked" =&gt; $model::SETTING_YES]); ?&gt;</pre><p>Вот конечный результат:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/update-settings.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><p>Давайте продолжим и расширим UserSetting для поддержки фотографий профиля.</p><h2>Изображения профиля</h2><p>Чтобы отображать фотографии пользователей на страницах собраний, мы должны добавить поддержку загрузки фотографий. В качестве альтернативы, по крайней мере, для дефолта, мы можем использовать сервис Gravatar, который связывает фотографию профиля с адресом электронной почты пользователя. Загрузка и сохранение файлов на сервере всегда представляет собой детальную и деликатную задачу веб-разработки, которую мы вскоре проведем.</p><h3>Настройка вкладок для загрузки</h3><p>Во-первых, давайте начнем с добавления вкладок в форму пользовательских настроек, которая отделяет общие настройки от изображений профиля. Используя определения стиля <span>навигационной навигации Bootstrap</span>, мы получаем следующее:</p><pre class="brush: php noskimlinks noskimwords">&lt;!-- Nav tabs --&gt;&lt;ul class="nav nav-tabs" role="tablist"&gt;  &lt;li class="active"&gt;&lt;a href="#general" role="tab" data-toggle="tab"&gt;Settings&lt;/a&gt;&lt;/li&gt;  &lt;li&gt;&lt;a href="#photo" role="tab" data-toggle="tab"&gt;Upload Photo&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;!-- Tab panes --&gt;&lt;div class="tab-content"&gt;  &lt;div class="tab-pane active vertical-pad" id="general"&gt;      &lt;?= $form-&gt;field($model, "reminder_eve")-&gt;checkBox(["label" =&gt; Yii::t("frontend","Send final reminder the day before a meeting"), "uncheck" =&gt;  $model::SETTING_NO, "checked" =&gt; $model::SETTING_YES]); ?&gt;       &lt;?= $form-&gt;field($model, "reminder_hours")              -&gt;dropDownList(                  $model-&gt;getEarlyReminderOptions(),                         ["prompt"=&gt;Yii::t("frontend","When would you like your early reminder?")]               )-&gt;label(Yii::t("frontend","Early reminders")) ?&gt;         &lt;?= $form-&gt;field($model, "contact_share")-&gt;checkbox(["label" =&gt;Yii::t("frontend","Share my contact information with meeting participants"),"uncheck" =&gt;  $model::SETTING_NO, "checked" =&gt; $model::SETTING_YES]); ?&gt;          &lt;?= $form-&gt;field($model, "no_email")-&gt;checkbox(["label" =&gt;Yii::t("frontend","Turn off all email"),"uncheck" =&gt;  $model::SETTING_NO, "checked" =&gt; $model::SETTING_YES]); ?&gt;       &lt;/div&gt;  &lt;div class="tab-pane vertical-pad" id="photo"&gt;    &lt;?= $form-&gt;field($model, "image")-&gt;widget(FileInput::classname(), [        "options" =&gt; ["accept" =&gt; "image/*"],         "pluginOptions"=&gt;["allowedFileExtensions"=&gt;["jpg","gif","png"]],    ]);   ?&gt;  &lt;/div&gt; &lt;!-- end of upload photo tab --&gt;&lt;/div&gt;</pre><p>Это выглядит так:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/tabbed-settings.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><p>По умолчанию, если нет загруженного изображения, мы попытаемся отобразить Gravatar пользователя.</p><h3>Полезные расширения Yii2 для изображений профиля</h3><p>Есть четыре расширения Yii2, которые я хочу включить для поддержки пользовательских изображений:</p><ol><li> <span>Граватар</span> Карстен Брандт для отображения граватаров</li> <li> <span>Kartik Visweswaran File Input</span> для поддержки загрузки файлов изображений<br></li> <li> <span>Yii Imagine</span>, чтобы масштабировать изображения до разных размеров</li> <li> <span>2Amigos Resource Manager</span> для последующей поддержки хранилища Amazon S3</li> </ol><p>Visweswaran и 2Amigos выпустили ряд расширений Yii2, которые являются супер полезными, и они, как правило, также обеспечивают прекрасную документацию.</p><p>Итак, добавьте эти расширения в свой файл composer.json:</p><pre class="brush: php noskimlinks noskimwords">        "cebe/yii2-gravatar": "*",        "kartik-v/yii2-widget-fileinput": "*",        "yiisoft/yii2-imagine": "*",        "2amigos/yii2-switch-widget": "0.1.*",        "2amigos/yii2-resource-manager-component": "0.1.*"</pre><p>И обновите композитор:</p><pre class="brush: bash noskimlinks noskimwords">composer update</pre><h3>Использование изображений Gravatar</h3><p>Если изображение профиля не настроено, мы отобразим граватар пользователя. Служба Gravatar ссылается на адрес электронной почты зарегистрированного пользователя. Вот код для отображения Gravatar:</p><pre class="brush: php noskimlinks noskimwords">echo \cebe\gravatar\Gravatar::widget([     "email" =&gt; common\models\User::find()-&gt;where(["id"=&gt;Yii::$app-&gt;user-&gt;getId()])-&gt;one()-&gt;email,     "options" =&gt; [         "class"=&gt;"profile-image",         "alt" =&gt; common\models\User::find()-&gt;where(["id"=&gt;Yii::$app-&gt;user-&gt;getId()])-&gt;one()-&gt;username,     ],     "size" =&gt; 128, ]);              </pre><p>Это будет выглядеть примерно так. Если пользователь настроил Gravatar, вы увидите их изображение.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/display-gravatar.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><h3>Загрузка изображения профиля</h3><p>Для загрузки изображений мы будем использовать отличный виджет<span> ввода файлов от Kartik</span>. Он также предоставляет очень хорошую документацию о том, <span>как его использовать</span>.</p><p>Вот код нашей формы для обновления, отображающий виджет на панели «Загрузить фото»:</p><pre class="brush: php noskimlinks noskimwords">&lt;div class="tab-pane vertical-pad" id="photo"&gt;   &lt;?= $form-&gt;field($model, "image")-&gt;widget(FileInput::classname(), [       "options" =&gt; ["accept" =&gt; "image/*"],        "pluginOptions"=&gt;["allowedFileExtensions"=&gt;["jpg","gif","png"]],   ]);   ?&gt; &lt;/div&gt; &lt;!-- end of upload photo tab --&gt;</pre><p>Верхняя часть формы включает enctype для данных с несколькими частями:</p><pre class="brush: php noskimlinks noskimwords">&lt;div class="user-setting-form"&gt;    &lt;?php     $form = ActiveForm::begin([        "options"=&gt;["enctype"=&gt;"multipart/form-data"]]); // important                  ?&gt;</pre><p>Форма выглядит так:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/file-upload-select.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><p>Мы также добавляем правила  валидации в модель UserSetting для ограничения загрузки файлами с расширениями jpg, gif и png и для ограничения размера загрузки до 100 кб.</p><pre class="brush: php noskimlinks noskimwords">public function rules()    {        return [            [["user_id", ], "required"],            [["user_id", ], "unique"],            [["image"], "safe"],            [["image"], "file", "extensions"=&gt;"jpg, gif, png"],            [["image"], "file", "maxSize"=&gt;"100000"],             [["filename", "avatar"], "string", "max" =&gt; 255],            [["user_id", "reminder_eve", "reminder_hours", "contact_share", "no_email", "created_at", "updated_at"], "integer"],        ];    }</pre><p>Кстати, <span>валидаторы Yii2</span> обладают удивительной широтой возможностей для многих обычных операций, которые веб-разработчики обычно создают сами. Я попытаюсь рассмотреть это в будущей статье серии <span>Программирование с Yii2</span>.</p><p>Вот код, который обрабатывает сообщение из формы обновления. В целом, вероятно, неплохо было бы переработать больше этого кода в методах модели и уменьшить сложность контроллеров.</p><pre class="brush: php noskimlinks noskimwords">if ($model-&gt;load(Yii::$app-&gt;request-&gt;post())) {           $image = UploadedFile::getInstance($model, "image");           if (!is_null($image)) {             // save with image              // store the source file name             $model-&gt;filename = $image-&gt;name;             $ext = end((explode(".", $image-&gt;name)));             // generate a unique file name to prevent duplicate filenames             $model-&gt;avatar = Yii::$app-&gt;security-&gt;generateRandomString().".{$ext}";             // the path to save file, you can set an uploadPath             // in Yii::$app-&gt;params (as used in example below)             Yii::$app-&gt;params["uploadPath"] = Yii::$app-&gt;basePath . "/web/uploads/avatar/";             $path = Yii::$app-&gt;params["uploadPath"] . $model-&gt;avatar;             $model-&gt;user_id = Yii::$app-&gt;user-&gt;getId();             if($model-&gt;update()){               $image-&gt;saveAs($path); </pre><p>Изображения должны храниться там, где они могут быть просмотрены веб-сервером. Я создал каталог uploads/avatar в дереве /frontend/web.</p><h3>Масштабирование изображений с помощью Imagine</h3><p>На самом деле мы хотим сохранить изображение в трех разных размерах: полный размер, один маленький квадрат для отображения в навигационной панели или списках, а также один квадрат среднего размера для встреч.</p><p>Мы будем использовать расширение <span>Yii2 Imagine</span> для масштабирования изображений; оно расширяет библиотеку <span>манипуляции изображения Imagine для PHP</span>.</p><p>Вот код, который масштабирует и сохраняет дополнительные размеры изображения:</p><pre class="brush: php noskimlinks noskimwords">$image-&gt;saveAs($path);            Image::thumbnail(Yii::$app-&gt;params["uploadPath"].$model-&gt;avatar, 120, 120)    -&gt;save(Yii::$app-&gt;params["uploadPath"]."sqr_".$model-&gt;avatar, ["quality" =&gt; 50]);Image::thumbnail(Yii::$app-&gt;params["uploadPath"].$model-&gt;avatar, 30, 30)        -&gt;save(Yii::$app-&gt;params["uploadPath"]."sm_".$model-&gt;avatar, ["quality" =&gt; 50]);</pre><p>Вот готовая форма, отображающая квадратное изображение на странице профиля пользователя:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/317/posts/23196/image/user-setting-update.jpeg" alt="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." title="Создание вашего стартапа на PHP: настройки пользователя, изображения профиля и контактные данные..." width="50" height="50"></figure><h3>Очистка неиспользуемых изображений</h3><p>Когда пользователи загружают новую фотографию, нам нужно удалить старое изображение и его сопровождающие масштабированные копии. Мы разберем контроллер для вызова нового метода удаления:</p><pre class="brush: php noskimlinks noskimwords">$image = UploadedFile::getInstance($model, "image");           if (!is_null($image)) {             // path to existing image for post-delete             $image_delete = $model-&gt;avatar;                          ...                          $model-&gt;deleteImage(Yii::$app-&gt;params["uploadPath"],$image_delete);</pre><p>Вот метод deleteImage в UserSetting:</p><pre class="brush: php noskimlinks noskimwords">public function deleteImage($path,$filename) {           $file =array();                      $file[] = $path.$filename;           $file[] = $path."sqr_".$filename;           $file[] = $path."sm_".$filename;           foreach ($file as $f) {             // check if file exists on server             if (!empty($f) &amp;&amp; file_exists($f)) {               // delete file               unlink($f);             }                        }       }</pre><h3>Использование Amazon S3 для сохранения изображений</h3><p>Сохранение загруженных пользователем изображений на нашем веб-сервере может создавать сложности. Это означает, что в дополнение к резервному копированию MySQL мы должны всегда резервировать часть файловой системы. Это может усложнить операции восстановления сервера и миграции. Это также загружает наш стек LAMP при загрузке изображений. </p><p>Использование Amazon S3 отделяет эту задачу от основного веб-сервера и может повысить производительность и упростить управление сервером с течением времени, особенно в отношении переносимости, масштабируемости и обновлений. Я рассмотрю загрузку и доступ к файлам из Amazon S3 в будущем учебнике.</p><h2>Что дальше?</h2><p>Надеюсь, вы изучили некоторые прикладные аспекты Yii, ActiveRecord, Bootstrap, формы, загрузку файлов и манипуляцию с изображениями. Мне понравилось работать с некоторыми новыми виджетами JQuery, доступными как расширения Yii. Следите за предстоящими учебниками в нашей серии статей <span>Пишем свой стартап на PHP</span> - впереди есть еще много интересных функций. Фактически, мы приближаемся к возможности планировать нашу первую встречу!</p><p>Пожалуйста, не стесняйтесь оставлять свои вопросы и комментарии ниже; Я обычно участвую в обсуждениях. Вы также можете связаться со мной в Twitter <span>@reifman</span> или отправить мне <span>электронное письмо</span>.</p><h2>Ссылки по теме</h2><ul><li><span>Программирование с помощью Yii2: Начало работы</span></li> <li><span>Введение во фреймворк Yii</span></li> <li> <span>The Yii2 Developer Exchange</span>, авторский сайт по Yii2</li> </ul>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Yii" href="https://norma-studio.github.io/article5/220825408-sozdanie-vashego-startapa-na-php-nastrojki-polzovatelya-izobrazheniya-profilya-i-kontaktnye-dannye" class="tm-article-body__tags-item-link">Yii</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
35287</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
547</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
