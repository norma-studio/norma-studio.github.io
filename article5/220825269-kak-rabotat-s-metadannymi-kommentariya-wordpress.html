
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этой серии мы рассмотрели ряд API-интерфейсов метаданных, предлагаемых WordPress. Это включает Post Meta API и User Meta API. Сегодня мы собираемся завершить серию, посмотрев на WordPress Comment Meta API....">
<meta property="og:description" content="В этой серии мы рассмотрели ряд API-интерфейсов метаданных, предлагаемых WordPress. Это включает Post Meta API и User Meta API. Сегодня мы собираемся завершить серию, посмотрев на WordPress Comment Meta API....">
<meta name="twitter:description" content="В этой серии мы рассмотрели ряд API-интерфейсов метаданных, предлагаемых WordPress. Это включает Post Meta API и User Meta API. Сегодня мы собираемся завершить серию, посмотрев на WordPress Comment Meta API....">
<meta property="aiturec:description" content="В этой серии мы рассмотрели ряд API-интерфейсов метаданных, предлагаемых WordPress. Это включает Post Meta API и User Meta API. Сегодня мы собираемся завершить серию, посмотрев на WordPress Comment Meta API....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/01-commentmeta.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/01-commentmeta.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/01-commentmeta.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/01-commentmeta.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/01-commentmeta.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html" title="Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io" title="Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64535356345.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html" class="tm-user-info__username" title="
В. Чендылов" aria-label="
В. Чендылов">
В. Чендылов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Как работать с метаданными комментария WordPress...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress" class="tm-article-snippet__hubs-item-link"><span>WordPress</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/01-commentmeta.png">
    <meta itemprop="headline name" content="Как работать с метаданными комментария WordPress... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этой серии мы рассмотрели ряд API-интерфейсов метаданных, предлагаемых WordPress. Это включает Post Meta API и User Meta API. Сегодня мы собираемся завершить серию, посмотрев на WordPress Comment Meta API....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этой серии мы рассмотрели ряд API-интерфейсов метаданных, предлагаемых WordPress. Это включает Post Meta API и User Meta API. Сегодня мы собираемся завершить серию, посмотрев на WordPress Comment Meta API....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этой серии мы рассмотрели ряд API-интерфейсов метаданных, предлагаемых WordPress. Это включает Post Meta API и User Meta API. Сегодня мы собираемся завершить серию, посмотрев на WordPress Comment Meta API.</p><p>Обратите внимание, что это последний API метаданных WordPress. Начиная с WordPress 4.4, теперь появился API метаданных Term. Чтобы полностью понять это, важно понять таксономию, термины и их отношения в контексте WordPress. В следующей серии я расскажу именно об этом.</p><p>Но сегодня мы собираемся сосредоточиться на управлении метаданными, связанными с комментариями. Если вы до сих пор не читали ничего в этой серии, я рекомендую ознакомиться с тем,<span> что мы рассмотрели до сих пор</span>.</p><p>Если вы все увязли, тогда давайте начнем.</p><h2>Мета-API комментария WordPress</h2><p>В этой серии мы использовали определение метаданных WordPress в качестве основы для понимания того, как эта информация представляется в контексте нашей среды.</p><p>В частности, <span>мы говорили</span>:</p><blockquote>Метаданные обрабатываются с помощью пар ключ/значение. Ключ - это имя элемента метаданных. Значение - это информация, которая будет отображаться в списке метаданных для каждой отдельной записи, с которой связана информация.<br></blockquote><p>В соответствии с остальным содержанием, которое мы видели в этой серии, это определение справедливо для метаданных комментариев, как это было с метаданными и метаданными.</p><p>Положительным моментом является то, что как только вы освоили различные API-интерфейсы метаданных, которые мы рассмотрели, не должно быть ничего удивительного в том, как работают другие функции метаданных. В зависимости от того, какой API вы используете, могут быть разные вещи, но суть функциональности будет одинаковой.</p><p>И, как вы увидите, это по-прежнему имеет место с API метаданных комментариев.</p><h2>Работа с API метаданных комментариев</h2><p>Как и в других API, рассмотренных в этой серии, мы рассмотрим четыре основные функции:<br></p><ul><li><code class="inline">add_comment_meta</code></li> <li><code class="inline">update_comment_meta</code></li> <li><code class="inline">get_comment_meta</code></li> <li><code class="inline">delete_comment_meta</code></li> </ul><p>К настоящему времени вы, вероятно, знаете, чего ожидать, когда речь идет, скажем, о различиях между добавлением метаданных комментариев и обновлением метаданных комментариев. Или, скажем, работа с удалением метаданных комментариев. </p><p>Это не меняет того факта, что стоит подробно изучить каждую из этих функций API, чтобы убедиться, что мы рассмотрели все, что нужно знать при работе с ними.</p><p>В остальной части этой статьи я предполагаю следующее:</p><ul><li>У вас локальная среда разработки с веб-сервером, сервером базы данных и PHP.</li> <li>У вас установлена копия WordPress.</li> <li>У вас есть копия<code class="inline"> tutsplus-metadata.php</code>, созданная в каталоге вашей темы, и она включена в файл <code class="inline">functions.php</code> вашей темы.</li> <li>У вас есть готовый доступ к вашей IDE и доступному интерфейсу базы данных.</li> </ul><p>Как я уже говорил в предыдущих статьях, я использую следующие приложения:</p><ul><li><span>MAMP</span></li> <li><span>Atom</span></li> <li><span>Sequel Pro</span></li> <li><span>twentysixteen</span></li> </ul><p>Наконец, все метаданные, с которыми мы будем работать, хранятся в таблице базы данных <code class="inline">wp_commentmeta</code>, поэтому все скриншоты, которые вы видите в базе данных, будут этой конкретной таблицы.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/01-commentmeta.png" alt="Как работать с метаданными комментария WordPress..." title="Как работать с метаданными комментария WordPress..." width="50" height="50"></figure><p>В отличие от некоторых других таблиц метаданных, которые мы видели, таблица <code class="inline">wp_commentmeta</code> создается пустой (если вы работаете с относительно новой версией WordPress).</p><p>Это хорошо, так как это даст нам чистый список, который можно использовать при изучении различных функций API. Обратите внимание, что для всех приведенных ниже примеров мы собираемся удостовериться, что все это происходит в посте <strong>Hello World!</strong>. Этот пост имеет идентификатор <strong>1</strong>. Если вы хотите использовать другую страницу, просто замените <strong>1</strong> на идентификатор сообщения, о котором идет речь.</p><p>Когда все готово, давайте начнем смотреть на то, что доступно.</p><h3>Добавление комментария Мета</h3><p>Чтобы начать добавлять метаданные в наши комментарии, важно посмотреть таблицу wp_comments, чтобы увидеть, какие комментарии уже существуют. Если вы работаете со свежей установкой WordPress, вы, скорее всего, увидите одну запись:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/02-comments.png" alt="Как работать с метаданными комментария WordPress..." title="Как работать с метаданными комментария WordPress..." width="50" height="50"></figure><p>Это комментарий по умолчанию, который поставляется с WordPress, и он прекрасно подойдет для примеров, которые мы будем использовать. </p><p>Если, с другой стороны, вы работаете с базой данных, полной комментариев, никаких проблем! Все, что вам нужно знать - это комментарий, с которым вы работаете (через его идентификатор), и убедитесь, что вы согласны с кодом, который мы используем ниже.</p><p>Как и в других API, рассмотренных в этой серии, добавление метаданных к комментариям происходит в двух формах: уникальном и неуникальном. Мы рассмотрим оба варианта.<br></p><h4>Добавление уникальных метаданных</h4><p>Функция <code class="inline">add_comment_meta</code> принимает три параметра и необязательный четвертый параметр. Если вы передаете true как четвертый параметр, метаданные будут добавляться только в том случае, если указанный мета-ключ не существует.</p><p>Поняно? Давайте взглянем. Сначала мы настроим функцию, которая добавит некоторые метаданные, связанные с первым комментарием (но будет делать это только для сообщения, имеющего идентификатор 1):</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_add_unique_comment_meta" );function tutsplus_add_unique_comment_meta( $content ) {    if ( 1 === get_the_ID() ) {  add_comment_meta( 1, "twitter_handle", "tommcfarlin", true );}return $content;}</pre><p>Заметьте, что я передал параметр true. Поэтому каждый раз, когда я обновляю страницу, WordPress увидит, что я хочу, чтобы это значение было уникальным, чтобы он не добавлял больше информации в таблицу базы данных, связанную с этим мета-ключом.</p><h4>Добавление неуникальных метаданных</h4><p>Если, с другой стороны, я хочу связать несколько значений с одним и тем же мета ключом, я бы удалил параметр true. Например, используйте следующий код:</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_add_comment_meta" );function tutsplus_add_comment_meta( $content ) {    if ( 1 === get_the_ID() ) {add_comment_meta( 1, "random_value", rand() );}return $content;}</pre><p>А затем обновите страницу, скажем, три раза. Если все идет как положено, вы можете увидеть три новые записи, каждая из которых содержит случайное число, генерируемое вызовом <code class="inline">rand()</code> в аргументе meta value.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/03-multiple-values.png" alt="Как работать с метаданными комментария WordPress..." title="Как работать с метаданными комментария WordPress..." width="50" height="50"></figure><p>Достаточно легко двигаемся, да? Если вам нужно одно значение, связанное с одним ключом, то передайте <code class="inline">true</code> как необязательный четвертый аргумент; В противном случае не указывайте ничего.</p><h3>Обновление комментариев</h3><p>Если вы хотите обновить существующие метаданные комментариев, важно знать идентификатор комментария, мета-ключ и метазначение. Это означает, что WordPress будет смотреть на указанный мета-ключ и связывать его с указанным значением meta.</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_update_comment_meta" );function tutsplus_update_comment_meta( $content ) {    if ( 1 === get_the_ID() ) {update_comment_meta( 1, "unique_value", time() );}return $content;}</pre><p>Если метазначение существует, оно будет перезаписано. Если метазначение не существует, оно будет создано. Обратите внимание, что в последнем предложении есть немного функциональности, которую вы можете использовать при добавлении метаданных: если вы хотите иметь уникальную часть информации, записанной в таблицу метаданных, вы можете использовать <code class="inline">update_comment_meta</code>, и она будет записывать ее как уникальное значение.</p><p>Это может привести к путанице в коде (поскольку он читается так, как если бы он обновлял то, что не существует), но также позволяет вам обеспечить, чтобы для данного мета-ключа существовала только одна запись.</p><p>Что происходит, когда есть мета-ключ, связанный с несколькими мета-значениями? В этом случае вам нужно знать значение, которое вы хотите заменить. В некоторых случаях вы можете точно знать, что это такое. В других случаях вам может понадобиться получить информацию, чтобы найти ее (об этом мы расскажем в следующем разделе).</p><p>Предполагая, что мы хотим обновить одну из созданных нами записей, например один из случайных чисел, указанных в приведенном выше примере, мы можем найти его с использованием интерфейса базы данных:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/05-updated-value.png" alt="Как работать с метаданными комментария WordPress..." title="Как работать с метаданными комментария WordPress..." width="50" height="50"></figure><p>И укажите это как предыдущее значение в следующем коде:</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_update_specific_meta" );function tutsplus_update_specific_meta( $content ) {    if ( 1 === get_the_ID() ) {update_comment_meta( 1, "unique_value", time(), "17123683" );}return $content;}</pre><p>После этого мы можем обновить страницу, посмотреть нашу базу данных и увидеть изменения. Обратите внимание, что работа, которую мы только что сделали, имеет отношение к среде разработки и не является способом, которым вы могли бы заняться этим в процессе производства.</p><p>Вместо этого вам может потребоваться запустить запрос или получить набор значений перед их обновлением. Это приводит нас к следующей теме.</p><h3>Получение метаданных комментария</h3><p>Всякий раз, когда вы извлекаете метаданные комментариев, вам нужно решить, хотите ли вы получить одно значение или все значения, связанные с указанным мета ключом.</p><p>Возможно, можно взглянуть на это следующим образом: если несколько метаданных были добавлены с тем же мета-ключом (который мы рассмотрели в разделе <strong>«Добавление уникальных метаданных»</strong> выше), то скорее всего вы захотите получить всю коллекцию записей.</p><p>Если, с другой стороны, вы хотите получить только одну запись, потому что знаете, что она уникальна или потому, что она была создана с помощью функции update_comment_meta, тогда вы хотите, чтобы WordPress возвращал ее вам в одном значении.</p><p>Функция <code class="inline">get_comment_meta</code> требует три аргумента и необязательный четвертый в зависимости от того, что вы хотите получить.<br></p><h4>Получение массива</h4><p>Предположим, вы хотите получить коллекцию всех значений, связанных с одним мета-ключом. Чтобы сделать это, вы должны были сделать вызов <code class="inline">get_comment_meta</code> и указать идентификатор комментария и мета-ключ.</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_get_comment_meta" );function tutsplus_get_comment_meta( $content ) {    if ( 1 === get_the_ID() ) {$arr_metadata = get_comment_meta( 1, "unique_value", true );var_dump( $arr_metadata );}return $content;}</pre><p>В приведенном выше коде мы печатаем его в веб-браузере, но вы сможете работать с этими данными любым удобным для вас способом, как только вы его получите. Самое важное, что нужно заметить, это то, что значение возвращается как массив.</p><h4>Получение единственного значения</h4><p>Если вы хотите получить одно значение, вам нужно указать идентификатор комментария и мета-ключ в функции <code class="inline">get_comment_meta</code>. Если вам приходится иметь дело с мета-ключом с несколькими значениями, тогда первое значение, которое было создано, является тем, что будет возвращено.</p><p>Например, предположим, что есть три записи, связанные с одним мета-ключом, и вы хотите только получить одно значение. Ваш код будет выглядеть следующим образом: </p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_get_one_comment_meta" );function tutsplus_get_one_comment_meta( $content ) {    if ( 1 === get_the_ID() ) {$arr_metadata = get_comment_meta( 1, "random_value", true );var_dump( $arr_metadata );}return $content;}</pre><p>И итоговое значение будет выглядеть примерно так:</p><pre class="brush: plain noskimlinks noskimwords">string(9) "967432645"</pre><p>Кроме того, если вы знаете, что данные уникальны, то код будет по-прежнему выглядеть так же, как и возвращаемое значение.</p><p>Единственное отличие состоит в том, что первый пример был получен из набора из нескольких записей, а второй был извлечен из одной записи. Также обратите внимание, что если вы имеете дело со уникальным значением, то оно все равно будет возвращено вам как массив, но только один индексный массив. </p><p>Это важно отметить, потому что, если вы планируете делать какие-либо сравнения, особенно значения другого типа, такие как целое число, вам нужно будет получить значение из массива, и вы, вероятно, захотите сделать приведение типов перед сравнением.</p><h3>Удаление метаданных комментария</h3><p>Удаление метаданных - это простая операция: требуется идентификатор комментария, мета-ключ и необязательное метазначение.</p><p>Если вы не укажете мета-значение, все записи, связанные с мета-ключом, будут удалены. Если, однако, вы указываете метазначение, то только одна запись будет удалена.</p><h4>Удаление уникальных значений</h4><p>Для целей этого примера предположим, что мы знаем, что для данного мета-ключа существует один фрагмент метаданных. Это означает, что мета-ключ должен быть уникальным для каждого пользователя, поэтому, возможно, он использует что-то вроде уникально сгенерированного идентификатора, отметки времени или чего-то подобного.</p><p>Чтобы удалить уникальное значение, мы просто передаем идентификатор комментария и мета-ключ:</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_remove_unique_comment_meta" );function tutsplus_remove_unique_comment_meta( $content ) {    if ( 1 === get_the_ID() ) {delete_comment_meta( 1, "unique_value" );}return $content;}</pre><p>Прежде чем запускать этот код, база данных должна выглядеть примерно так:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/06-metadata-before.png" alt="Как работать с метаданными комментария WordPress..." title="Как работать с метаданными комментария WordPress..." width="50" height="50"></figure><p>После обновления страницы просмотрите базу данных и вы увидите, что запись была удалена, а база данных должна выглядеть так:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/03-multiple-values.png" alt="Как работать с метаданными комментария WordPress..." title="Как работать с метаданными комментария WordPress..." width="50" height="50"></figure><p>Мы поговорим немного подробнее о мерах предосторожности при удалении данных в следующем разделе.</p><h4>Удаление неуникальных значений</h4><p>В других ситуациях, скажем, существует несколько значений, связанных с одним мета-ключом. Мы видели это много раз в этой статье. Если вы хотите удалить все записи, связанные с мета-ключом, вам не нужно указывать метазначение.</p><p>То есть, если вы просто передадите ID комментария и мета-ключ функции <code class="inline">delete_comment_meta</code>, он удалит все части метаданных комментария. Напишите и выполните следующий код:</p><pre class="brush: php noskimlinks noskimwords">&lt;?phpadd_filter( "the_content", "tutsplus_remove_comment_metadata" );function tutsplus_remove_comment_metadata( $content ) {    if ( 1 === get_the_ID() ) {delete_comment_meta( 1, "random_value" );}return $content;}</pre><p>Обновите страницу и просмотрите базу данных. Если не было проблем, ваша база данных должна быть свободна от всех записей, которые имели предыдущий мета-ключ:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/34/posts/25885/image/07-no-random-values.png" alt="Как работать с метаданными комментария WordPress..." title="Как работать с метаданными комментария WordPress..." width="50" height="50"></figure><p>Но помните, что удаление данных из базы данных может быть опасным, особенно если вы случайно удалите то, что вы никогда не хотели удалить. Для этого важно сохранить резервные копии базы данных в производственных средах, чтобы вы всегда могли восстановить ее, если что-то пойдет не так.</p><p>Кроме того, это демонстрирует, почему так важно иметь локальную среду разработки и промежуточную среду для тестирования перед развертыванием кода в боевой среде.</p><h2>Полный исходный код</h2><p>Как показано во всей этой серии, вот копия всего исходного кода, который мы рассмотрели в этой статье. Он полностью документирован и включает комментарии, не показанные в некоторых разделах выше.</p><pre class="brush: php noskimlinks noskimwords">&lt;?php/** * This file shows how to work with the common Comment Meta API functions. * * Namely, it demonstrates how to use: * - add_comment_meta * - update_comment_meta * - get_comment_meta * - delete_comment_meta * * Each function is hooked to "the_content" so that line will need to be * commented out depending on which action you really want to test. * * Also note, from the tutorial linked below, that this file is used form * demonstration purposes only and should not be used in a production * environment. * * Tutorial: * https://code.tutsplus.com/tutorials/how-to-work-with-wordpress-post-metadata--cms-25715 * * @version    1.0.0 * @authorTom McFarlin * @packagetutsplus_wp_metadata *//* add_filter( "the_content", "tutsplus_add_unique_comment_meta" ); *//** * Adds a unique meta key and meta value for a user"s Twitter handle * to the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_add_unique_comment_meta( $content ) {if ( 1 === get_the_ID() ) {add_comment_meta( 1, "twitter_handle", "tommcfarlin", true );}return $content;}/* add_filter( "the_content", "tutsplus_add_comment_meta" ); *//** * Adds a unique meta key and random meta value * to the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_add_comment_meta( $content ) {if ( 1 === get_the_ID() ) {add_comment_meta( 1, "random_value", rand() );}return $content;}/* add_filter( "the_content", "tutsplus_update_comment_meta" ); *//** * Updates unique meta key and unique meta value for * to the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_update_comment_meta( $content ) {if ( 1 === get_the_ID() ) {update_comment_meta( 1, "unique_value", time() );}return $content;}/* add_filter( "the_content", "tutsplus_update_specific_meta" ); *//** * Updates a unique meta key and random meta value with a specified value * to the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_update_specific_meta( $content ) {if ( 1 === get_the_ID() ) {update_comment_meta( 1, "random_value", time(), "17123683" );}return $content;}/* add_filter( "the_content", "tutsplus_get_comment_meta" ); *//** * Gets an array of the comment metadata associated with the meta key * in the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_get_comment_meta( $content ) {if ( 1 === get_the_ID() ) {$arr_metadata = get_comment_meta( 1, "unique_value" );var_dump( $arr_metadata );}return $content;}/* add_filter( "the_content", "tutsplus_get_all_comment_meta" ); *//** * Gets an array of all the meta values associated with the specified meta key * in the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_get_all_comment_meta( $content ) {if ( 1 === get_the_ID() ) {$arr_metadata = get_comment_meta( 1, "random_value" );var_dump( $arr_metadata );}return $content;}/* add_filter( "the_content", "tutsplus_get_one_comment_meta" ); *//** * Gets a single value from a set of values associated with a meta key * in the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_get_one_comment_meta( $content ) {if ( 1 === get_the_ID() ) {$arr_metadata = get_comment_meta( 1, "random_value", true );var_dump( $arr_metadata );}return $content;}/* add_filter( "the_content", "tutsplus_remove_unique_comment_meta" ); *//** * Removes a unique meta value associated with the specified key * to the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_remove_unique_comment_meta( $content ) {if ( 1 === get_the_ID() ) {delete_comment_meta( 1, "unique_value" );}return $content;}/* add_filter( "the_content", "tutsplus_remove_comment_metadata" ); *//** * Removes all meta values associated with the specified key * to the comment metadata table associated with the comment having * the ID of 1. * * @param  string $content The content of the post. * @return string $content THe content of the post. */function tutsplus_remove_comment_metadata( $content ) {if ( 1 === get_the_ID() ) {delete_comment_meta( 1, "random_value" );}return $content;}</pre><p>Обратите внимание, что если вы включите это с кодом из остальных статей в серии, вам нужно быть осторожным. Поскольку все зарегистрировано с одним и тем же хуком, вы можете получить странные результаты.</p><p>Для борьбы с этим я рекомендую один из двух следующих сценариев:</p><ol><li>Создайте три отдельных файла: по одному для каждого из рассмотренных типов API метаданных.</li> <li>Комментируйте вызовы <code class="inline">add_filter</code>, за исключением тех, с которыми вы работаете в настоящее время.</li> </ol><p>Любой из них облегчит работу со всем кодом, который мы рассмотрели до сих пор.</p><h2>Заключение </h2><p>Независимо от того, работаете ли вы с API метаданных или одним из других API, каждый разработчик WordPress должен всегда иметь быстрый доступ к WordPress <span>Codex</span> для быстрого изучения того, какие API-интерфейсы доступны и как их использовать.</p><p>Поскольку мы работали с этой серией, вы должны увидеть, как API, разработанный вокруг метаданных, является последовательным. Это делает простой в использовании мощный API для расширения некоторых основных функций WordPress.</p><p>Кроме того, я упомянул, что в WordPress 4.4 появился еще один API метаданных. Я планирую рассказать об этом в следующей серии, но для этого потребуется изучить некоторые другие функции, основанные на ней. </p><p>На данный момент мы рассмотрели много материала, чтобы помочь вам повысить ваши существующие навыки WordPress. До следующей статьи помните, что все мои курсы и учебники доступны на <span>моей странице в профиле</span>, и вы можете прочитать больше статей о разработке WordPress и WordPress <span>в моем блоге</span>. </p><p>WordPress имеет активную экосистему. Есть темы, плагины, библиотеки и многие другие продукты, которые помогут вам построить ваш сайт и проект. Открытый исходный характер платформы также делает его отличным вариантом, с помощью которого вы можете улучшить свои навыки программирования. В любом случае вы можете посмотреть, что у нас <span>есть на рынке Envato</span>.<br></p><p>Не стесняйтесь следовать за мной в Twitter, а также в <span>@tommcfarlin</span>, где я рассказываю о различных практиках разработки программного обеспечения, многие из которых имеют отношение к веб-разработке, и многие из них специально ориентированы на WordPress.</p><p>Как и все мои статьи, пожалуйста, не стесняйтесь оставлять любые вопросы или комментарии в фиде ниже, и я постараюсь ответить на каждый из них.</p><h2>Ресурсы</h2><ul><li><span>Custom Fields</span></li> <li><span>add_comment_meta</span></li> <li><span>update_comment_meta</span></li> <li><span>get_comment_meta</span></li> <li><span>delete_comment_meta</span></li> <li><span>rand</span></li> <li><span>echo</span></li> <li><span>var_dump</span></li> </ul>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825269-kak-rabotat-s-metadannymi-kommentariya-wordpress" class="tm-article-body__tags-item-link">WordPress</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40657</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
401</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
