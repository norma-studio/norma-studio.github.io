
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В прошлом декабре состоялся релиз PHP 7. Пора обновлять продакшн-сервер, чтобы перенести туда уже протестированный код. Если говорить обобщённо, то мои сайты на новой конфигурации работают отлично....">
<meta property="og:description" content="В прошлом декабре состоялся релиз PHP 7. Пора обновлять продакшн-сервер, чтобы перенести туда уже протестированный код. Если говорить обобщённо, то мои сайты на новой конфигурации работают отлично....">
<meta name="twitter:description" content="В прошлом декабре состоялся релиз PHP 7. Пора обновлять продакшн-сервер, чтобы перенести туда уже протестированный код. Если говорить обобщённо, то мои сайты на новой конфигурации работают отлично....">
<meta property="aiturec:description" content="В прошлом декабре состоялся релиз PHP 7. Пора обновлять продакшн-сервер, чтобы перенести туда уже протестированный код. Если говорить обобщённо, то мои сайты на новой конфигурации работают отлично....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/final_image/logo.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/final_image/logo.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/final_image/logo.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/final_image/logo.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/final_image/logo.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html" title="Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io" title="Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/ded38a8520cf75a955c11fc92a1a403e.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html" class="tm-user-info__username" title="
В. Самсонов" aria-label="
В. Самсонов">
В. Самсонов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Обновление Linux сервера для поддержки PHP 7.0...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70" class="tm-article-snippet__hubs-item-link"><span>PHP</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/final_image/logo.jpg">
    <meta itemprop="headline name" content="Обновление Linux сервера для поддержки PHP 7.0... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В прошлом декабре состоялся релиз PHP 7. Пора обновлять продакшн-сервер, чтобы перенести туда уже протестированный код. Если говорить обобщённо, то мои сайты на новой конфигурации работают отлично....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В прошлом декабре состоялся релиз PHP 7. Пора обновлять продакшн-сервер, чтобы перенести туда уже протестированный код. Если говорить обобщённо, то мои сайты на новой конфигурации работают отлично....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Cover image via <span>PONTIER</span></p><h2>Вступление</h2><p>В прошлом декабре состоялся релиз PHP 7. Пора обновлять продакшн-сервер, чтобы перенести туда уже протестированный код. Если говорить обобщённо, то мои сайты на новой конфигурации работают отлично.</p><p>Несмотря на это у меня есть подозрение, что далеко не все обновили начинку своих серверов. Зачастую проще остаться на более стабильном релизе. Именно поэтому статистика работы сайтов на WordPress показывает следующие цифры:</p><blockquote>"По состоянию на Ноябрь 2016, 52.9% WordPress проектов работают на PHP 5.5 и ниже. И только 3.4% сайтов из указанной категории переехали на PHP 7, текущую версия языка." Информация со страницы плагина <span>PHP Compatibility Checker</span>.<br></blockquote><p>Всё это при том, что с момента выхода PHP 7 уже прошло больше года. </p><p>В этом уроке я бы хотел поделиться своими рекомендациями по обновлению до PHP 7 на Ubuntu 14.x, а также рассказать о том как наладить работу PHPMyAdmin.</p><p>Если вы работаете с WordPress, установите плагин <span>PHP Compatibility Checker</span> чтобы убедиться, что все ваши плагины полностью совместимы с новой версией языка, и дополнительных проблем не возникнет.</p><p>Буду признателен за ваш отзыв. Все ваши мысли, вопросы и предложения можете оставлять в комментариях.</p><p>Также вы можете связаться со мной напрямую через Twitter по логину <span>@reifman</span>. Таким образом мы всегда сможем поддерживать актуальность информации.</p><h2>Обновление вашего сервера<br></h2><p>В процессе обновления до PHP 7, я столкнулся с несколькими трудностями.  Именно поэтому сценарий действий, который я сформировал, прогонялся раз за разом пока не стал стабильным.</p><p>В очередной раз хотел бы отметить отличную работу <span>Digital Ocean</span>, которая позволяет сделать резервную копию сервера и добавить тестовые машины для организации процесса обновления с нуля.</p><p>Итак, начнём.</p><h3>Сделайте копии специальных настроек PHP 5</h3><p>В первую очередь вам необходимо выписать все директивы, которые были добавлены в PHP .ini. Впоследствии подключим их к PHP 7.</p><p>Следующая команда поможет найти местоположение .ini файла:</p><pre class="brush: bash noskimlinks noskimwords">$ php --ini</pre><p>Результат работы команды:</p><pre class="brush: bash noskimlinks noskimwords">$ php --iniPHP Warning:  PHP Startup: Unable to load dynamic library "/usr/lib/php5/20121212/newrelic.so" - /usr/lib/php5/20121212/newrelic.so: cannot open shared object file: No such file or directory in Unknown on line 0Configuration File (php.ini) Path: /etc/php5/cliLoaded Configuration File:         /etc/php5/cli/php.iniScan for additional .ini files in: /etc/php5/cli/conf.d...</pre><p>В случае работы с Apache, путь на моей машине такой: <code class="inline">/etc/php5/apache2</code>.</p><h3>Удаление PHP5 и связных пакетов</h3><p>Для начала давайте почистим систему от PHP пакетов.  Опираясь на свой опыт сразу скажу, что сделать это лучше не только для PHP5, но и для 5.5 и 5.6.</p><pre class="brush: php noskimlinks noskimwords">$ sudo apt-get -y purge php php-common php-mcrypt php-mbstring$ sudo apt-get -y purge php5 php5-common php5-cli libapache2-mod-php5 php5-curl php5-gd php5-imap php5-intl php5-json php5-mcrypt php5-mysql php5-pspell php5-readline php5-sqlite$ sudo apt-get -y purge php5.5 php5.5-common php5.5-mcrypt php5.5-mbstring$ sudo apt-get -y purge php5.6 php5.6-common$ sudo apt-get autoremove</pre><p>Если не очистить систему от пакетов всех установленных версий PHP, то при конфигурации PHP 7 могут возникнуть дополнительные проблемы. Если на этот счёт у вас есть своё мнение, то не забудьте поделиться им в комментариях.</p><h3>Подготовка к установке PHP7 и PHPMyAdmin</h3><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/image/ppa.jpg" alt="Обновление Linux сервера для поддержки PHP 7.0..." title="Обновление Linux сервера для поддержки PHP 7.0..." width="50" height="50"></figure><pre class="brush: bash noskimlinks noskimwords">$ sudo add-apt-repository ppa:ondrej/php Co-installable PHP versions: PHP 5.5, 5.6, PHP 7.0 and batteries included.You can get more information about the packages at https://deb.sury.orgFor PHP 5.4 on Ubuntu 12.04 use: ppa:ondrej/php5-oldstableBUGS&amp;FEATURES: This PPA now has a issue tracker: https://deb.sury.org/#bug-reportingPLEASE READ: If you like my work and want to give me a little motivation, please consider donating regularly: https://donate.sury.org/WARNING: add-apt-repository is broken with non-UTF-8 locales, see https://github.com/oerdnj/deb.sury.org/issues/56 for workaround:# LC_ALL=C.UTF-8 add-apt-repository ppa:ondrej/php More info: https://launchpad.net/~ondrej/+archive/ubuntu/phpPress [ENTER] to continue or ctrl-c to cancel adding itgpg: keyring `/tmp/tmpj6czswxr/secring.gpg" createdgpg: keyring `/tmp/tmpj6czswxr/pubring.gpg" createdgpg: requesting key E5267A6C from hkp server keyserver.ubuntu.comgpg: /tmp/tmpj6czswxr/trustdb.gpg: trustdb createdgpg: key E5267A6C: public key "Launchpad PPA for Ondřej Surý" importedgpg: Total number processed: 1gpg:               imported: 1  (RSA: 1)OK</pre><p>После этого запускаем обновление пакетов и дистрибутивов. Затем подчищаем оставшиеся файлы:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo apt-get update$ sudo apt-get dist-upgrade$ sudo apt-get autoremove</pre><p>Вы можете столкнуться с подобной ошибкой:</p><pre class="brush: bash noskimlinks noskimwords">The link /vmlinuz.old is a damaged linkRemoving symbolic link vmlinuz.old  you may need to re-run your boot loader[grub]</pre><p>После выполнения подобных действия я предпочитаю перезагрузить систему:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo reboot</pre><h3>Установка PHP7</h3><p>Теперь давайте установим PHP7 и все зависимые пакеты:</p><pre class="brush: bash noskimlinks noskimwords">sudo apt-get install php7.0 php7.0-mysql libapache2-mod-php7.0 php-apcu php7.0-gd php7.0-mcrypt php-memcache php7.0-curl php7.0-tidy php-xml php-json php7.0-mbstring php-gettext libmcrypt-dev mcrypt php-gd libmcrypt4 libmhash2 libtidy5 libxslt1.1 php-apcu-bc php-pear php7.0-mbstring php7.0-xml</pre><p>На данном этапе нам нужно переместить все наши настройки в новый файл конфигурации <code class="inline">/etc/php/7.0/apache2/php.ini</code>.</p><p>Также добавим запись <code class="inline">extension=apc.so</code> в php.ini:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo nano /etc/php/7.0/apache2/php.ini</pre><p>Я добавил следующий текст:</p><pre class="brush: bash noskimlinks noskimwords">;extension=php_openssl.dll;extension=php_pdo_firebird.dll;extension=php_pdo_mysql.dll;extension=php_pdo_oci.dll;extension=php_pdo_odbc.dll;extension=php_pdo_pgsql.dll;extension=php_pdo_sqlite.dll;extension=php_pgsql.dll;extension=php_shmop.dllextension=apc.so</pre><h4>Отключение PHPMyAdmin</h4><p>Для того чтобы завести PHPMyAdmin, нужно перезапустить Apache.  Отключить на время PHPMyAdmin:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo nano /etc/apache2/apache2.conf</pre><p>Закомментируйте последнюю строчку:</p><pre class="brush: bash noskimlinks noskimwords"># Include of directories ignores editors" and dpkg"s backup files, # see README.Debian for details. # Include generic snippets of statements IncludeOptional conf-enabled/*.conf # Include the virtual host configurations: IncludeOptional sites-enabled/*.conf # vim: syntax=apache ts=4 sw=4 sts=4 sr noet # Include /etc/phpmyadmin/apache.conf</pre><p>Далее я активирую <code class="inline">mcrypt</code> и <code class="inline">mbstring</code> и перезапускаю Apache:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo phpenmod mcrypt$ sudo phpenmod mbstring$ sudo service apache2 restart</pre><p>Я тестировал эту конфигурацию на сайтах, созданных на HTML, PHP и Yii1.x. Всё работало хорошо.</p><h3>Переустановка PHPMyAdmin</h3><p>Следующим шагом будет “оживление” PHPMyAdmin.  Множество людей наступали на эти грабли.</p><p>Для начала добавим <span>репозиторий пакетов от nijel</span>:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo add-apt-repository ppa:nijel/phpmyadmin Latest phpMyAdmin packages - https://www.phpmyadmin.net/. Based on packages available in Debian.There are some notable changes:* it currently requires updated PHP packages, you can get packages from https://launchpad.net/~ondrej/+archive/ubuntu/php/* it does include embedded copies of PHP librariesIf you like phpMyAdmin, you can support it"s further development at https://www.phpmyadmin.net/donate/ or https://www.phpmyadmin.net/sponsors/, thanks! More info: https://launchpad.net/~nijel/+archive/ubuntu/phpmyadminPress [ENTER] to continue or ctrl-c to cancel adding itgpg: keyring `/tmp/tmp6zix40vr/secring.gpg" createdgpg: keyring `/tmp/tmp6zix40vr/pubring.gpg" createdgpg: requesting key 06ED541C from hkp server keyserver.ubuntu.comgpg: /tmp/tmp6zix40vr/trustdb.gpg: trustdb createdgpg: key 06ED541C: public key "Launchpad PPA for Michal Čihař" importedgpg: no ultimately trusted keys foundgpg: Total number processed: 1gpg:               imported: 1  (RSA: 1)OK</pre><p>Далее обновляем пакеты и устанавливаем PHPMyAdmin:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo apt-get update$ sudo apt-get install phpmyadmin</pre><p>Заметка: данный процесс затронет несколько пакетов PHP 5.x, но работе PHPMyAdmin это не помешает.</p><p>Теперь раскомментируем строчку, затронутую ранее.</p><pre class="brush: bash noskimlinks noskimwords">$ sudo nano /etc/apache2/apache2.conf</pre><p>Вот так:</p><pre class="brush: bash noskimlinks noskimwords"># Include of directories ignores editors" and dpkg"s backup files, # see README.Debian for details. # Include generic snippets of statements IncludeOptional conf-enabled/*.conf # Include the virtual host configurations: IncludeOptional sites-enabled/*.conf # vim: syntax=apache ts=4 sw=4 sts=4 sr noet Include /etc/phpmyadmin/apache.conf</pre><p>Перезапускаем Apache:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo service apache2 restart</pre><h4>Повышение уровня защиты PHPMyAdmin</h4><p>Мы установили PHPMyAdmin, поместив его код во всем известный каталог, что нехорошо с точки зрения безопасности.  Чтобы это исправить можете прочесть статью <span>Установка и работа PHPMyAdmin в связке с WordPress</span>.</p><h3>Проверяем работу PHP 7</h3><p>Создайте файл и поместите туда вызов <code class="inline">phpinfo();</code> чтобы проверить активность PHP 7:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/image/phpinfo.jpg" alt="Обновление Linux сервера для поддержки PHP 7.0..." title="Обновление Linux сервера для поддержки PHP 7.0..." width="50" height="50"></figure><h2>Завершение</h2><p>В моём случае обновление PHP до седьмой версии на Ubuntu 14.x проходило не очень гладко. Именно поэтому я решил собрать и записать список последовательных действий.  Надеюсь, что сегодняшний урок оказался полезен.</p><p>Если вам понравился данный материал, советую взглянуть на уроки из серий: <span>Разработка на базе Yii2</span> и <span>Организация стартапа на PHP</span>, где я подробным образом пишу об организации стартапа <span>Meeting Planner</span>.</p><p>Для того чтоб держать руку на пульсе данной темы подписывайтесь на мой Twitter <span>@reifman</span> и <span>персональную страницу</span>. </p><h2>Похожие материалы</h2><ul><li> <span>Пакет PPA для PHP (5.5, 5.6, 7.0) с множеством PECL расширений (Ondřej Surý)</span><br></li> <li><span>WordPress дополнение для проверки совместимости плагинов с версией PHP</span></li> <li> <span>Установка и работа PHPMyAdmin в связке с WordPress (Envato Tuts+)</span><br></li> </ul><p>PHP 7 was released last December. Once you"ve tested your code locally to run on it, it"s time to upgrade your production server. Generally, I found that most of my sites run well on it.</p><p>However, I suspect that not many sites have upgraded yet. It"s often safer and easier to stay on older releases. In fact, a survey of WordPress sites showed that few have:</p><blockquote>  "As of November 2016, 52.9% of WordPress websites run a PHP version less PHP 5.5. Only 3.4% of WordPress websites run PHP 7, the current main version of PHP." via  <span>PHP Compatibility Checker</span>  .  </blockquote><p>But PHP 7 has now been out for nearly a year. </p><p>In today"s episode, I"ll walk you through my recommended approach to upgrading to PHP 7 on Ubuntu 14.x and resolving problems with PHPMyAdmin, which a lot of early upgraders ran into.</p><p>At this time, if you are using WordPress, install the <span>PHP Compatibility Checker</span> plugin to ensure that you won"t run into any unexpected problems with your array of plugins.</p><p>I am always appreciative of your ideas and feedback. If you have a question or topic suggestion, please post your thoughts in the comments below.</p><p>You can also reach me on Twitter <span>@reifman</span> directly. This is especially true with popular upgrade scripts like this one—where users" own experience and input will be unique and valuable.</p><h2>Upgrading Your Server</h2><p>I tried using some standard guides to upgrading PHP 7 and ran into a series of different problems. So the scripts I share with you below have been tested repeatedly, and I believe what I"m presenting will work well for you.</p><p>Again, I greatly appreciated <span>Digital Ocean</span>, which makes it easy to back up my server and repeatedly create test instances for running through upgrade steps from scratch.</p><p>Let"s get started.</p><h3>Note Any Customizations to PHP 5</h3><p>At this point you may want to make note of your PHP .ini customizations and possibly back up your php.ini file as you will later need to migrate these to PHP 7.</p><p>This should help you find your .ini file:</p><pre class="brush: bash noskimlinks noskimwords">$ php --ini</pre><p>This showed me:</p><pre class="brush: bash noskimlinks noskimwords">$ php --iniPHP Warning:  PHP Startup: Unable to load dynamic library "/usr/lib/php5/20121212/newrelic.so" - /usr/lib/php5/20121212/newrelic.so: cannot open shared object file: No such file or directory in Unknown on line 0Configuration File (php.ini) Path: /etc/php5/cliLoaded Configuration File:     /etc/php5/cli/php.iniScan for additional .ini files in: /etc/php5/cli/conf.d...</pre><p>For Apache, mine was in <code class="inline">/etc/php5/apache2</code>.</p><h3>Remove PHP5 and Related Packages</h3><p>First, let"s purge all our older PHP packages. I found it was best to do this thoroughly, covering not only PHP5 but also 5.5 and 5.6, which I had experimented with on my server.</p><pre class="brush: php noskimlinks noskimwords">$ sudo apt-get -y purge php php-common php-mcrypt php-mbstring$ sudo apt-get -y purge php5 php5-common php5-cli libapache2-mod-php5 php5-curl php5-gd php5-imap php5-intl php5-json php5-mcrypt php5-mysql php5-pspell php5-readline php5-sqlite$ sudo apt-get -y purge php5.5 php5.5-common php5.5-mcrypt php5.5-mbstring$ sudo apt-get -y purge php5.6 php5.6-common$ sudo apt-get autoremove</pre><p>When I didn"t purge all these variations of PHP, I ran into problems later trying to configure PHP 7. If you have a simple approach, please share it in the comments.</p><h3>Adding a Personal Package Archive for PHP7 and PHPMyAdmin</h3><figure>  <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/image/ppa.jpg" alt="Обновление Linux сервера для поддержки PHP 7.0..." title="Обновление Linux сервера для поддержки PHP 7.0..." width="50" height="50"></figure><pre class="brush: bash noskimlinks noskimwords">$ sudo add-apt-repository ppa:ondrej/php Co-installable PHP versions: PHP 5.5, 5.6, PHP 7.0 and batteries included.You can get more information about the packages at https://deb.sury.orgFor PHP 5.4 on Ubuntu 12.04 use: ppa:ondrej/php5-oldstableBUGS&amp;FEATURES: This PPA now has a issue tracker: https://deb.sury.org/#bug-reportingPLEASE READ: If you like my work and want to give me a little motivation, please consider donating regularly: https://donate.sury.org/WARNING: add-apt-repository is broken with non-UTF-8 locales, see https://github.com/oerdnj/deb.sury.org/issues/56 for workaround:# LC_ALL=C.UTF-8 add-apt-repository ppa:ondrej/php More info: https://launchpad.net/~ondrej/+archive/ubuntu/phpPress [ENTER] to continue or ctrl-c to cancel adding itgpg: keyring `/tmp/tmpj6czswxr/secring.gpg" createdgpg: keyring `/tmp/tmpj6czswxr/pubring.gpg" createdgpg: requesting key E5267A6C from hkp server keyserver.ubuntu.comgpg: /tmp/tmpj6czswxr/trustdb.gpg: trustdb createdgpg: key E5267A6C: public key "Launchpad PPA for Ondřej Surý" importedgpg: Total number processed: 1gpg:           imported: 1  (RSA: 1)OK</pre><p>And then I updated my packages and distribution and cleansed any remaining files:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo apt-get update$ sudo apt-get dist-upgrade$ sudo apt-get autoremove</pre><p>You may see errors like this:</p><pre class="brush: bash noskimlinks noskimwords">The link /vmlinuz.old is a damaged linkRemoving symbolic link vmlinuz.old  you may need to re-run your boot loader[grub]</pre><p>I chose to reboot at this point, and that seemed to work:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo reboot</pre><h3>Install PHP7</h3><p>Next, we install PHP7 and all of its packages:</p><pre class="brush: bash noskimlinks noskimwords">sudo apt-get install php7.0 php7.0-mysql libapache2-mod-php7.0 php-apcu php7.0-gd php7.0-mcrypt php-memcache php7.0-curl php7.0-tidy php-xml php-json php7.0-mbstring php-gettext libmcrypt-dev mcrypt php-gd libmcrypt4 libmhash2 libtidy5 libxslt1.1 php-apcu-bc php-pear php7.0-mbstring php7.0-xml</pre><p>At this point you will want to migrate any changed settings in your configuration files to <code class="inline">/etc/php/7.0/apache2/php.ini</code>.</p><p>I also needed to add <code class="inline">extension=apc.so</code> to my php.ini file:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo nano /etc/php/7.0/apache2/php.ini</pre><p>I pasted that here:</p><pre class="brush: bash noskimlinks noskimwords">;extension=php_openssl.dll;extension=php_pdo_firebird.dll;extension=php_pdo_mysql.dll;extension=php_pdo_oci.dll;extension=php_pdo_odbc.dll;extension=php_pdo_pgsql.dll;extension=php_pdo_sqlite.dll;extension=php_pgsql.dll;extension=php_shmop.dllextension=apc.so</pre><h4>Disabling PHPMyAdmin</h4><p>At this point, if you"re running PHPMyAdmin, you"ll run into problems reloading Apache. If so, you"ll need to disable PHPMyAdmin:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo nano /etc/apache2/apache2.conf</pre><p>Comment out the line that loads it at the bottom:</p><pre class="brush: bash noskimlinks noskimwords"># Include of directories ignores editors" and dpkg"s backup files, # see README.Debian for details. # Include generic snippets of statements IncludeOptional conf-enabled/*.conf # Include the virtual host configurations: IncludeOptional sites-enabled/*.conf # vim: syntax=apache ts=4 sw=4 sts=4 sr noet # Include /etc/phpmyadmin/apache.conf</pre><p>Then, I enabled <code class="inline">mcrypt</code> and <code class="inline">mbstring</code> and then restarted Apache:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo phpenmod mcrypt$ sudo phpenmod mbstring$ sudo service apache2 restart</pre><p>I tested this on a server running apps built on only HTML, for PHP and for Yii1.x, and all of them worked.</p><h3>Reinstalling PHPMyAdmin</h3><p>Next, let"s repair the PHPMyAdmin installation. A lot of people struggled with this.</p><p>First, I added <span>the package repository by nijel</span>:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo add-apt-repository ppa:nijel/phpmyadmin Latest phpMyAdmin packages - https://www.phpmyadmin.net/. Based on packages available in Debian.There are some notable changes:* it currently requires updated PHP packages, you can get packages from https://launchpad.net/~ondrej/+archive/ubuntu/php/* it does include embedded copies of PHP librariesIf you like phpMyAdmin, you can support it"s further development at https://www.phpmyadmin.net/donate/ or https://www.phpmyadmin.net/sponsors/, thanks! More info: https://launchpad.net/~nijel/+archive/ubuntu/phpmyadminPress [ENTER] to continue or ctrl-c to cancel adding itgpg: keyring `/tmp/tmp6zix40vr/secring.gpg" createdgpg: keyring `/tmp/tmp6zix40vr/pubring.gpg" createdgpg: requesting key 06ED541C from hkp server keyserver.ubuntu.comgpg: /tmp/tmp6zix40vr/trustdb.gpg: trustdb createdgpg: key 06ED541C: public key "Launchpad PPA for Michal Čihař" importedgpg: no ultimately trusted keys foundgpg: Total number processed: 1gpg:           imported: 1  (RSA: 1)OK</pre><p>Then, I updated the packages and installed PHPMyAdmin:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo apt-get update$ sudo apt-get install phpmyadmin</pre><p>Note, this will still reload a bunch of older PHP 5.x packages, but PHPMyAdmin will ultimately work.</p><p>Then, I uncommented the PHPMyAdmin line we commented above.</p><pre class="brush: bash noskimlinks noskimwords">$ sudo nano /etc/apache2/apache2.conf</pre><p>Here:</p><pre class="brush: bash noskimlinks noskimwords"># Include of directories ignores editors" and dpkg"s backup files, # see README.Debian for details. # Include generic snippets of statements IncludeOptional conf-enabled/*.conf # Include the virtual host configurations: IncludeOptional sites-enabled/*.conf # vim: syntax=apache ts=4 sw=4 sts=4 sr noet Include /etc/phpmyadmin/apache.conf</pre><p>And, I restarted Apache:</p><pre class="brush: bash noskimlinks noskimwords">$ sudo service apache2 restart</pre><h4>Secure Your PHPMyAdmin Installation</h4><p>This installed PHPMyAdmin back into the default location, which is very insecure and hackable. Please follow <span>Installing and Using PHPMyAdmin With WordPress</span> to better secure your installation.</p><h3>Verify PHP 7 Is Running</h3><p>Afterwards, I built a small <code class="inline">phpinfo();</code> file to verify PHP 7 was active:</p><figure>  <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27583/image/phpinfo.jpg" alt="Обновление Linux сервера для поддержки PHP 7.0..." title="Обновление Linux сервера для поддержки PHP 7.0..." width="50" height="50"></figure><h2>In Closing</h2><p>Upgrading to PHP 7 on my existing Ubuntu 14.x was problematic and required a lot of changes from the published scripts to get right. I hope you find today"s tutorial helpful.</p><p>If you enjoyed this, please watch for upcoming tutorials in our <span>Programming With Yii2 series</span> and the <span>Building Your Startup With PHP series</span>, which documents the process of building my startup, <span>Meeting Planner</span>.</p><p>You can also follow me <span>@reifman</span> on Twitter or <span>check my instructor page</span> for updates. </p><h2>Related Links</h2><ul>  <li><span>The main PPA for PHP (5.5, 5.6, 7.0) with many PECL extensions (Ondřej Surý)</span></li>  <li><span>WordPress Plugin PHP Compatibility Checker</span></li>  <li><span>Installing and Using PHPMyAdmin with WordPress (Envato Tuts+)</span></li></ul>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825092-obnovlenie-linux-servera-dlya-podderzhki-php-70" class="tm-article-body__tags-item-link">PHP</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
32049</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
445</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
