
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Я видел несколько вводных руководств для Codeigniter и надеялся показать вам что-то более продвинутое. В этом уроке вы узнаете, как создать мощное веб-приложение для размещения изображений, используя гибкость Codeigniter. В этом учебном пособии вы узнаете о философии MVC, которая является неотъемлемой частью создания веб приложений....">
<meta property="og:description" content="Я видел несколько вводных руководств для Codeigniter и надеялся показать вам что-то более продвинутое. В этом уроке вы узнаете, как создать мощное веб-приложение для размещения изображений, используя гибкость Codeigniter. В этом учебном пособии вы узнаете о философии MVC, которая является неотъемлемой частью создания веб приложений....">
<meta name="twitter:description" content="Я видел несколько вводных руководств для Codeigniter и надеялся показать вам что-то более продвинутое. В этом уроке вы узнаете, как создать мощное веб-приложение для размещения изображений, используя гибкость Codeigniter. В этом учебном пособии вы узнаете о философии MVC, которая является неотъемлемой частью создания веб приложений....">
<meta property="aiturec:description" content="Я видел несколько вводных руководств для Codeigniter и надеялся показать вам что-то более продвинутое. В этом уроке вы узнаете, как создать мощное веб-приложение для размещения изображений, используя гибкость Codeigniter. В этом учебном пособии вы узнаете о философии MVC, которая является неотъемлемой частью создания веб приложений....">
<meta property="og:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="aiturec:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta name="twitter:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="vk:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html" title="Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io" title="Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/63456435436.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html" class="tm-user-info__username" title="
М. Старостенко" aria-label="
М. Старостенко">
М. Старостенко</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создание сайта для хостинга файлов с помощью CodeIgniter...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter" class="tm-article-snippet__hubs-item-link"><span>PHP</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter.html" />
    <link itemprop="image" href="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
    <meta itemprop="headline name" content="Создание сайта для хостинга файлов с помощью CodeIgniter... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Я видел несколько вводных руководств для Codeigniter и надеялся показать вам что-то более продвинутое. В этом уроке вы узнаете, как создать мощное веб-приложение для размещения изображений, используя гибкость Codeigniter. В этом учебном пособии вы узнаете о философии MVC, которая является неотъемлемой частью создания веб приложений....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Я видел несколько вводных руководств для Codeigniter и надеялся показать вам что-то более продвинутое. В этом уроке вы узнаете, как создать мощное веб-приложение для размещения изображений, используя гибкость Codeigniter. В этом учебном пособии вы узнаете о философии MVC, которая является неотъемлемой частью создания веб приложений....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Я видел несколько вводных руководств для Codeigniter и надеялся показать вам что-то более продвинутое. В этом уроке вы узнаете, как создать мощное веб-приложение для размещения изображений, используя гибкость Codeigniter. В этом учебном пособии вы узнаете о философии MVC, которая является неотъемлемой частью создания веб приложений.</p><p></p> <div> <span><br><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg" class="lazy07" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></span> </div> <h3>Шаг 1: Настройка</h3> <p>Прежде чем мы отправимся писать код, нам нужно сделать некоторые настройки. Запустите свой любимый редактор базы данных (я буду использовать <span>SQLBuddy</span>) и создаю новую базу данных под названием "uploadr". В этом случае создайте две таблицы: « users» и « files». Настройте пользователей, чтобы они имели первичный ключ, авто-нумерованный столбец «id», а также два столбца varchar: «password» и «username». Таблице файлов нужен столбец «id» (опять-таки первичный ключ и авто-нумерованный), а также столбец «owner» и столбец «name» varchar.</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/1.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>Поскольку этот урок сосредоточен на изучении программирования Codeigniter и MVC, мы собираемся отказаться от всех стилей (например, CSS, photoshop). С этой целью я создал для вас специальную установку Codeigniter, со всеми созданными файлами и представлениями (в основном) HTML-d и CSS-d. Две вещи, которые вам нужно изменить, - это настройки конфигурации и базы данных. Я даже включил штамп «Бета», поэтому проект еще больше будет походить на реальный веб-запуск!</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/2.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <h3>Шаг 2: Регистрация</h3> <p>Теперь наш первый кусочек мяса! Откройте "login.php" контроллер и создайте функцию под названием «register». Она будет контролировать весь процесс регистрации. Во-первых, нам нужно проверить, были ли отправлены запросы POST на сервер. В этом случае это означают, что кто-то пытается зарегистрироваться. Мы можем это сделать, проверив, установлен ли $ _POST["username"]. Если это так, то мы знаем, что кто-то пытался зарегистрироваться, и может добавить его в БД.</p> <pre class="brush: php noskimlinks noskimwords">  function register(){if(isset($_POST["username"])){// User has tried registering, insert them into database.$username = $_POST["username"];$password = $_POST["password"];$this-&gt;users-&gt;register($username, $password);redirect("login");}else{//User has not tried registering, bring up registration information.$this-&gt;load-&gt;view("register");}}</pre> <p>Если пользователь еще не попытался зарегистрироваться, метод обнаруживает это и автоматически отправляет их в представление «register», которое я уже добавил для вас. Вы видите строку: </p> <pre class="brush: php noskimlinks noskimwords">$this-&gt;users-&gt;register($username,$password);</pre> <p>Это вызывает функцию «register» в модели users. На данный момент это не сработает, так как мы не загрузили модель. Мы делаем это так же, как и с загрузкой видов, но поскольку мы будем широко использовать эту модель в этом классе, мы загрузим ее в конструкторе (функция с тем же именем, что и класс), так что она будет всегда загружена и доступна:</p> <pre class="brush: php noskimlinks noskimwords">function Login(){parent::Controller();$this-&gt;load-&gt;model("users");}</pre> <p>Вероятно, вы заинтересованы в том, что фактически содержится в функции регистрации. Ну, она просто использует пару функций Codeigniter Active Record, которые позволяют манипулировать БД. Большое преимущество использования встроенных функций Codeigniter Active Record (помимо того, что они приятные и простые) заключается в том, что они не привязаны к конкретной базе данных: вы можете легко переключаться между разными типами баз данных (например, mySQL, SQLite), не влияя на приложение. В случае нашей регистрации мы добавляем запись в таблицу пользователей. Создайте эту функцию в "users.php" модель:</p> <pre class="brush: php noskimlinks noskimwords">function register($username, $password){    $new_user = array (    "username"=&gt;$username,    "password"=&gt;$password    );    $this-&gt;db-&gt;insert("users", $new_user);return true;}</pre> <p>Единственное, что стоит заметить в представлении регистрации, это функции site_url() и base_url(). Они соответственно дают URL вашего сайта с и без index.php/ суффикса. Наибольшее преимущество в их использовании состоит в том, что вы можете изменить структуру URL своего сайта, не переходя через все ссылки: это просто одно изменение в вашем файле конфигурации.</p> <p>Как только все будет установлено, мы можем попытаться зарегистрировать учетную запись. Функция нашего контроллера должна перенаправить нас на страницу входа после создания нашей учетной записи.</p> <h3>Шаг 3: Вход</h3> <p>Теперь, когда у нас настроено несколько пользователей, нам нужен способ фактически позволить им попасть на сайт. Для этого мы будем использовать класс сессии Codeigniter. Хотя это фактически использует куки-файлы, его работа очень похожа на обычные PHP-сессии, просто с большим количеством опций (я рекомендую вам проверить userguide).</p> <p>Для начала нам нужно создать функцию, на которую на данный момент указывает кнопка входа в систему, "go". Эта функция должна будет собирать информацию, которую отправила форма, а затем проверить ее в БД с использованием модели. Если все правильно, он начнет сеанс и перенаправит пользователя на свои файлы. Если данные введены неверно, пользователь будет перенаправлен на страницу входа в систему.</p> <pre class="brush: php noskimlinks noskimwords">function go(){$username = $_POST["username"];$password = $_POST["password"];//Returns userid if successful, false if unsuccessful$results = $this-&gt;users-&gt;login($username,$password);if ($results==false) redirect("login");else {$this-&gt;session-&gt;set_userdata(array("userid"=&gt;$results));redirect("profile");}}</pre> <p>Части этой функции должны быть хорошо знакомы вам из функции register: она собирает $username и $password, прежде чем отправлять их в модель (на этот раз «login»). После этого, однако, начинают возникать различия.</p> <p>Затем функция проверяет, не удалось ли войти в систему; если не удалось, то пользователь перенаправляется обратно на страницу входа. Однако, если вход успешно завершен, сценарий создает сеанс, устанавливая «userid» для идентификатора пользователя. Все, что нам нужно для скрипта входа в систему, - это модель. Добавьте эту функцию в модель users , которую мы использовали ранее:</p> <pre class="brush: php noskimlinks noskimwords">function login($username, $password){$query = $this-&gt;db-&gt;get_where("users", array("username"=&gt;$username, "password"=&gt;$password));if ($query-&gt;num_rows()==0) return false;else{$result = $query-&gt;result();$first_row = $result[0];$userid = $first_row-&gt;id;return $userid;}}</pre> <p>Быстро пробежимся по коду: во-первых, она запрашивает базу данных, ища при этом пользователей с точно такими же именем пользователя и паролем. Если она ничего не найдет, то число строк будет равно 0, а функция вернет false. Если кто-то был найден, она использует другую функцию Codeigniter Active Record для загрузки этой записи в качестве объекта. Эти объекты появляются как массив строк БД, каждый из которых содержит объект с информацией об этих строках. Поскольку нам нужна первая и единственная строка, мы берем ее из $result, а затем возвращаем идентификатор.</p> <p>На странице профиля нам нужно будет проверить, вошел ли пользователь. Для этого мы просто вставляем две строки кода в конструктор контроллера профиля. Это проверит, что сеанс содержит идентификатор пользователя. Если это не так, перейдите на страницу входа. Если да, то все нормально, и он превращается в общедоступную переменную. Пока мы меняем конструктор, мы загрузим две модели, которые нам понадобятся для страницы профиля:</p> <pre class="brush: php noskimlinks noskimwords">function Profile(){parent::Controller();$this-&gt;load-&gt;model("users");$this-&gt;load-&gt;model("files");$this-&gt;userid = $this-&gt;session-&gt;userdata("userid");if (!isset($this-&gt;userid) or $this-&gt;userid=="") redirect("login");}</pre> <p>Последнее, что нам нужно сделать, это сделать возможным выход из системы. Это достигается простой установкой идентификатора пользователя на null, удаляя его. Все, что требуется, - одна простая функция:</p> <pre class="brush: php noskimlinks noskimwords">function logout(){$this-&gt;session-&gt;set_userdata(array("userid"=&gt;""));redirect("login");}</pre> <h3>Шаг 4: Просмотр и загрузка файлов</h3> <p>Итак, мы только что вошли в систему в первый раз. С чем мы встречаемся?</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/3.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>Неплохо, неплохо, хотя этот «образец файла» не создается из нашей базы данных, он статичен. Мы скоро исправим это, но сначала нам нужно изменить разрешения папки «файл», чтобы Codeigniter мог читать и писать в нем. Я изменил на 777:</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.tutsplus.com/net/uploads/legacy/237_uploadr/4.png" class="lazy07" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>Теперь, когда все в порядке, давайте вернемся к коду! Нам нужно загрузить все файлы пользователей из базы данных, и для этого нам понадобится ...</p> <p>... модель! Однако на этот раз мы создадим ее в файле files.php , чтобы разделить таблицы users и files.. Вставьте эту функцию:</p> <pre class="brush: php noskimlinks noskimwords">function get($userid){    $query = $this-&gt;db-&gt;get_where("files", array("owner"=&gt;$userid));    return $query-&gt;result();}</pre> <p>Это было проиллюстрировано в предыдущих разделах этого руководства, поэтому вы должны все понимать. В основном, функция получает все строки, в которых владелец = идентификатор пользователя, и возвращает их в симпатичном массиве объектов. Давайте создадим что-то в контроллере профилей для взаимодействия с ним и передадим информацию на просмотр. Измените функцию index следующим образом:</p> <pre class="brush: php noskimlinks noskimwords">function index(){$data["files"] = $this-&gt;files-&gt;get($this-&gt;userid);$this-&gt;load-&gt;view("profile", $data);}</pre> <p>Опять же, очень простая функция. Она принимает результаты, переданные ей из модели файлов, и упаковывает их в представление. Codeigniter передает данные в представление обычно через массив (в данном случае данные). Затем он автоматически раскладывает массив на множество переменных, поэтому, когда мы перейдем к представлению, он сможет получить доступ к результатам базы данных через $file, а не $data["file"]. Давайте поместим этот прекрасный результат базы данных в представление! Вставьте это в "profile.php", заменяя код, о котором говорит вам комментарий HTML.</p> <pre class="brush: php noskimlinks noskimwords">&lt;?php foreach($files as $file): ?&gt;&lt;div class="section"&gt;&lt;span&gt;&lt;?=$file-&gt;name?&gt;&lt;/span&gt;&lt;div style="float: right;"&gt;&lt;span&gt;&lt;a href="&lt;?=base_url()?&gt;files/&lt;?=$file-&gt;name?&gt;"&gt;View&lt;/a&gt;&lt;/span&gt;&lt;span&gt;&lt;a href="&lt;?=site_url("profile/delete/".$file-&gt;id)?&gt;"&gt;Delete&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;?php endforeach; ?&gt;</pre> <p>Цикл foreach загружает каждую строку массива поочередно и делает ее доступной через объект $file. Затем, используя образец «section» в качестве шаблона, заполните все ссылки и имя с информацией для нового объекта $file. Мы увидим как работает как функция удаления чуть позже, и как работает ссылка просмотра после того, как мы что-то загрузили.</p> <p>Если вы откроете это в своем браузере сейчас, вы ничего не увидите. Это потому, что у нас нет загруженных файлов! Ну, нам нужно это исправить, поэтому нам нужно создать форму для загрузки. Давайте сначала сделаем контроллер; откройте "profile.php" и добавьте эту функцию:</p> <pre class="brush: php noskimlinks noskimwords">function upload(){if(isset($_FILES["file"])){$file = read_file($_FILES["file"]["tmp_name"]);$name = basename($_FILES["file"]["name"]);write_file("files/".$name, $file);$this-&gt;files-&gt;add($name);redirect("profile");}else $this-&gt;load-&gt;view("upload");}</pre> <p>Эта функция добавляет немало новых вещей: особенно обработка файлов Codeigniter. Все начинается довольно просто, проверяя, была ли форма отправлена путем поиска файла. Если файл не существует, он просто показывает представление загрузки (которое мы будем обновлять далее). Если файл существует, то он считывает временный файл, который был сгенерирован сервером. Каталог временного файла можно найти в $_FILES["<em>your_file</em>"]["tmp_name"], и файл можно прочитать из этого каталога через функцию read_file Codeigniter. Она загружает всю информацию о файлах в переменную $file. </p> <p>Следующая строка получает имя файла из глобальной переменной $_FILES аналогично получению временного каталога. Вооружившись этими двумя частями информации, codeigniter записывает файл в папку с файлами в том же каталоге, что и файл index. Наконец, файл необходимо добавить в базу данных. Опять же, мы собираемся сделать это с помощью модели, на этот раз функция add в модели files. Мы скоро увидим, как это работает, но теперь нам нужно создать форму загрузки в представлении. Добавьте это в "upload.php" где комментарий HTML говорит вам:</p> <pre class="brush: php noskimlinks noskimwords">&lt;form enctype="multipart/form-data" action="&lt;?=site_url("profile/upload")?&gt;" method="post"&gt;&lt;div id="boxtop"&gt;&lt;/div&gt;&lt;div id="boxmid"&gt;&lt;div class="section"&gt;&lt;span&gt;File:&lt;/span&gt;&lt;input type="file" name="file" /&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id="boxbot"&gt;&lt;/div&gt;&lt;div class="text" style="float: left;"&gt;&lt;p&gt;Before uploading, check out&lt;/p&gt;&lt;p&gt;the &lt;a href=#&gt;Terms of Service&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;   &lt;div class="text" style="float: right;"&gt;&lt;input type="submit" value="Upload" name="upload" class="submit" /&gt;&lt;/div&gt;&lt;br style="clear:both; height: 0px;" /&gt;&lt;/form&gt;</pre> <p>Замените текущий HTML этим. Важно отметить, что при загрузке файлов мы используем файл input type=file, который позволяет нам выбирать файл для загрузки. Кроме того, мы должны указать enctype в нашем теге формы, чтобы сервер знал, что он получает файл и сохраняет его. Для нас это не слишком интересные нюансы, но это очень важно! Давайте быстро посмотрим, что мы создали:</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/5.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>Теперь мы переходим к финальному сценарию загрузки файлов, к модели. Это добавляет файл в базу данных с его именем и владельцем, чтобы сервер знал, кому какие файлы принадлежат. Давайте взглянем; добавьте это в свою модель файлов:</p> <pre class="brush: php noskimlinks noskimwords">function add($file){    $this-&gt;db-&gt;insert("files", array("owner"=&gt;$this-&gt;session-&gt;userdata("userid"),"name"=&gt;$file ));}</pre> <p>Снова используя Codeigniter Active Record, мы добавляем строку в базу данных с именем файла и владельца. Мы получаем владельца путем получения идентификатора пользователя из данных сеанса, которые мы сохранили ранее при входе в систему. В целом, довольно простая функция. Попробуем загрузить красивую фотографию, а?</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/6.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>И вуаля!</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/7.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>Просматривая папку «files», мы видим, что файл, который мы загрузили, появился там, как по волшебству (магия Codeigniter!), И мы видим, почему работает ссылка просмотра, поскольку она просто указывает непосредственно на файл в каталоге. При этом все, что осталось сделать в этой статье - это удаление файлов.</p> <h3>Шаг 5: Удаление файлов</h3> <p>Хорошо, последний бит. Это не займет много времени, так как вы сможете использовать идеи, которые вы узнали ранее. Сначала мы добавим этот код в наш контроллер профилей:</p> <pre class="brush: php noskimlinks noskimwords">function delete($id){//This deletes the file from the database, before returning the name of the file.$name = $this-&gt;files-&gt;delete($id);unlink("files/".$name);redirect("profile");}</pre> <p>И этот код для нашей модели файлов:</p> <pre class="brush: php noskimlinks noskimwords">function delete($fileid){$query = $this-&gt;db-&gt;get_where("files",array("id"=&gt;$fileid));$result = $query-&gt;result();$query = $this-&gt;db-&gt;delete("files", array("id"=&gt;$fileid));return $result[0]-&gt;name;}</pre> <p>Первый контроллер должен быть очень понятен. Он вызывает функцию удаления из модели файлов (которую мы определили), которая генерирует имя файла. Затем он использует базовую функцию PHP для удаления файла с этим именем в каталоге файлов. Наконец, он отправляется обратно в профиль пользователя (у которого теперь минус один файл).</p> <p>Модель немного сложнее. Она должна вернуть имя файла, а также удалить его, поэтому сначала она запрашивает базу данных для получения сведений о файлах. Затем загружает это в переменную $result, а затем переходит к удалению файла. Затем она возвращает столбец «имя» первой строки массива (единственная строка, возвращаемая запросом), которая затем используется в вышеуказанном контроллере.</p> <p>Попробуем удалить файл:</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/8.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>И нажмите delete ...</p> <div><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/237_uploadr/9.png" alt="Создание сайта для хостинга файлов с помощью CodeIgniter..." title="Создание сайта для хостинга файлов с помощью CodeIgniter..." width="50" height="50"></div> <p>Ура! Это сработало. Наверное, мы все закончили!</p> <h3>Последние мысли</h3> <p>Удаление файлов</p> <p>Конечно, этот код не должен запускаться на сервере без каких-либо серьезных улучшений. Вот несколько основных проблем:</p> <ul><li>  Все пароли незашифрованы. Это означает, что если кто-то сможет проникнуть в вашу базу данных, они с минимальными усилиями смогут украсть все данные ваших пользователей. Уверен,  что вы все согласитесь, что это нехорошо. Это легко решить, добавив несколько простых функций хэширования к паролям.  </li> <li>  Файлы не являются частными. Пользователь может захотеть убедиться, что файлы, которые они загружают, видны только им, а не кем-то, кто просто может угадать кучу URL-адресов. Для этого, вероятно, потребуется другой контроллер для обслуживания файлов (который проверяет данные сеанса).  </li> <li>  Сценарий не проверяет наличие файлов перед записью файлов. Это может привести к конфликтам с вашими файлами или может привести к перезаписи файлов. Как бы то ни было: это нехорошо. Это можно решить с помощью простой проверки БД, чтобы убедиться, что файл не был занят или можно предоставить пользователям собственные каталоги в папке с файлами.  </li> <li>  Никакие ошибки не генерируется. Это не помогает пользователю узнать, что они делают неправильно, и хотя это не слишком большая проблема на таком маленьком сайте с таким ограниченным функционалом, это все равно можно улучшить.  </li> </ul><p>В общем, вы создали довольно мощное небольшое веб-приложение, особенно благодаря небольшому количества кода, который вам нужно было написать. По своей природе Codeigniter довольно просто расширить, как для решения вышеуказанных проблем, так и для добавления новых функций, таких как переименование файлов. Я также надеюсь, что в этом уроке вы немного научились использовать концепции MVC и силу, которую они приносят: просто скорректировав модели в нашем приложении, мы можем обменять нашу БД на текстовые файлы, XML или что угодно, а также изменив представления , мы можем полностью поменять внешний вид без нарушения функциональности. Удивительно!</p> <ul class="webroundup"><li>Подпишитесь на <span>RSS-канал NETTUTS</span> для получения ежедневных новостей о веб-разработке.</li> </ul><p> <br></p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825759-sozdanie-sajta-dlya-hostinga-fajlov-s-pomoschyu-codeigniter" class="tm-article-body__tags-item-link">PHP</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
41937</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
612</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
