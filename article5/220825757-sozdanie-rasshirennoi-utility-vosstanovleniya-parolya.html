
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В моем последнем учебнике «Лучший Логин входа в систему» ​​несколько человек прокомментировали, как они хотели бы видеть учебник по восстановлению пароля, который вы не всегда видите в учебниках по доступу пользователей. Учебник, который я привожу вам сегодня, будет иметь дело только с этим. Используя mySQLi, мы научимся восстанавливать незашиф...">
<meta property="og:description" content="В моем последнем учебнике «Лучший Логин входа в систему» ​​несколько человек прокомментировали, как они хотели бы видеть учебник по восстановлению пароля, который вы не всегда видите в учебниках по доступу пользователей. Учебник, который я привожу вам сегодня, будет иметь дело только с этим. Используя mySQLi, мы научимся восстанавливать незашиф...">
<meta name="twitter:description" content="В моем последнем учебнике «Лучший Логин входа в систему» ​​несколько человек прокомментировали, как они хотели бы видеть учебник по восстановлению пароля, который вы не всегда видите в учебниках по доступу пользователей. Учебник, который я привожу вам сегодня, будет иметь дело только с этим. Используя mySQLi, мы научимся восстанавливать незашиф...">
<meta property="aiturec:description" content="В моем последнем учебнике «Лучший Логин входа в систему» ​​несколько человек прокомментировали, как они хотели бы видеть учебник по восстановлению пароля, который вы не всегда видите в учебниках по доступу пользователей. Учебник, который я привожу вам сегодня, будет иметь дело только с этим. Используя mySQLi, мы научимся восстанавливать незашиф...">
<meta property="og:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="aiturec:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta name="twitter:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="vk:image" content="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html" title="Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io" title="Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/65404fb3f3f8602d7f5b3bdc85cbef02.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html" class="tm-user-info__username" title="
А. Крайнов" aria-label="
А. Крайнов">
А. Крайнов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создание расширенной утилиты восстановления пароля...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya" class="tm-article-snippet__hubs-item-link"><span>PHP</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya.html" />
    <link itemprop="image" href="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg">
    <meta itemprop="headline name" content="Создание расширенной утилиты восстановления пароля... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В моем последнем учебнике «Лучший Логин входа в систему» ​​несколько человек прокомментировали, как они хотели бы видеть учебник по восстановлению пароля, который вы не всегда видите в учебниках по доступу пользователей. Учебник, который я привожу вам сегодня, будет иметь дело только с этим. Используя mySQLi, мы научимся восстанавливать незашиф...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В моем последнем учебнике «Лучший Логин входа в систему» ​​несколько человек прокомментировали, как они хотели бы видеть учебник по восстановлению пароля, который вы не всегда видите в учебниках по доступу пользователей. Учебник, который я привожу вам сегодня, будет иметь дело только с этим. Используя mySQLi, мы научимся восстанавливать незашиф...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В моем последнем учебнике <span>«Лучший Логин входа в систему»</span> ​​несколько человек прокомментировали, как они хотели бы видеть учебник по восстановлению пароля, который вы не всегда видите в учебниках по доступу пользователей. Учебник, который я привожу вам сегодня, будет иметь дело только с этим. Используя mySQLi, мы научимся восстанавливать незашифрованные и (односторонние) зашифрованные пароли.</p> <p><!--more--></p> <div class="tutorial_image"> <span><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://net.tutsplus.com/wp-content/themes/nettuts/site_images/button_src_nm.jpg" class="lazy07" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></span> </div> <h3>Введение</h3> <p>Восстановление пароля всегда полезная функция для вашего сайта; однако многие учебники, касающиеся аутентификации пользователей, пренебрегают этой темой. В этом уроке я расскажу об обработке зашифрованных и незашифрованных паролей, основных функциях mySQLi, и мы также встроим временную блокировку, если пользователь слишком много раз неправильно ответит на вопрос безопасности. Я надеюсь, что к концу этого урока вы будете лучше понимать восстановление паролей и интерфейс mySQLi.</p> <p>Для незашифрованных паролей мы создадим электронное письмо, которое отправит пароль на зарегистрированный адрес электронной почты пользователя.</p> <p>При работе с зашифрованными паролями все немного сложнее. Когда пароль зашифрован с помощью <strong>md5 ()</strong>, он не может быть расшифрован. В связи с этим мы отправим пользователю электронное письмо со ссылкой, которая позволит ему сбросить пароль. Чтобы обезопасить этот процесс, мы будем использовать уникальный ключ электронной почты, который будет проверен, когда пользователь вернется на страницу пароля. Наши пароли будут зашифрованы <span>солью</span> для повышения безопасности.</p> <p><strong>ВАЖНОЕ ПРИМЕЧАНИЕ.</strong> В этом руководстве вместо mysql используется интерфейс mysqli. Хотя в документации PHP написано, что она должна работать, я не смог успешно использовать классы mysqli, пока не обновился с 5.1.4 до 5.2.9. Если вы получаете ошибки об использовании «неподдерживаемого буфера», попробуйте обновить. Вам также может понадобиться изменить файл php.ini для загрузки расширения mysqli, если вы видите ошибки, связанные с отсутствием поиска класса mysqli.</p> <p>В зависимости от того, использует ли ваш сайт зашифрованные или незашифрованные пароли пользователей, вы должны следовать указаниям немного по-разному. Направления в целом для зашифрованных паролей; но здесь и там есть специальные примечания для работы с обычными паролями.</p> <h3>Шаг 1: Таблицы базы данных</h3> <p>После создания новой базы данных нам нужно создать три таблицы:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=548/net/uploads/legacy/315_passwordRecovery/1.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Таблица <strong>recoveryemails_enc</strong> содержит информацию об электронных письмах, которые отправляются, чтобы позволить пользователям сбросить пароли (например, ключ безопасности, идентификатор пользователя и срок действия). Таблицы <strong>пользователей</strong> содержат информацию о пользователях. Если вы следуете зашифрованному примеру, используйте таблицу <strong>users_enc</strong>, в противном случае используйте таблицу <strong>users</strong>.</p> <p>Если у вас уже есть таблица пользователей, вам нужно будет добавить поля контрольного вопроса и ответа. Поле вопроса будет содержать целое число, равное контрольному вопросу в массиве, а поле ответа содержит ответ типа varchar. Секретный вопрос используется как подтверждение перед отправкой пароля по электронной почте. Вот код, который вы должны запустить для создания таблиц (также доступен в sql.txt в загрузке):</p> <pre class="brush: sql noskimlinks noskimwords">CREATE TABLE IF NOT EXISTS `recoveryemails_enc` (  `ID` bigint(20) unsigned zerofill NOT NULL auto_increment,  `UserID` bigint(20) NOT NULL,  `Key` varchar(32) NOT NULL,  `expDate` datetime NOT NULL,  PRIMARY KEY  (`ID`)) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;CREATE TABLE IF NOT EXISTS `users` (  `ID` bigint(20) unsigned zerofill NOT NULL auto_increment,  `Username` varchar(20) NOT NULL,  `Email` varchar(255) NOT NULL,  `Password` varchar(20) NOT NULL,  `secQ` tinyint(4) NOT NULL,  `secA` varchar(30) NOT NULL,  PRIMARY KEY  (`ID`)) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=5 ;INSERT INTO `users` (`ID`, `Username`, `Email`, `Password`, `secQ`, `secA`) VALUES (00000000000000000002, "jDoe", "jDoe@gmail.com", "johnDoe2009", 0, "Smith"),(00000000000000000003, "envato", "webmaster@envato.com", "envatouser", 1, "Sydney"),(00000000000000000004, "sToaster", "toast@yahoo.com", "toastrules", 3, "2001");CREATE TABLE IF NOT EXISTS `users_enc` (  `ID` bigint(20) unsigned zerofill NOT NULL auto_increment,  `Username` varchar(20) NOT NULL,  `Password` char(32) NOT NULL,  `Email` varchar(255) NOT NULL,  `secQ` tinyint(4) NOT NULL default "0",  `secA` varchar(32) NOT NULL,  PRIMARY KEY  (`ID`)) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=4 ;INSERT INTO `users_enc` (`ID`, `Username`, `Password`, `Email`, `secQ`, `secA`) VALUES (00000000000000000001, "jDoe", "fd2ba57673c57ac5a0650c38fe60b648", "jDoe@gmail.com", 0, "Smith"),(00000000000000000002, "envato", "1ecc663314777c8e3c2328027447f194", "webmaster@envato.com", 1, "Sydney"),(00000000000000000003, "sToaster", "e05fd29cbca7ea9add48ba6dafc300e8", "toast@yahoo.com", 3, "2001");</pre> <h3>Шаг 2: База данных включает</h3> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=491/net/uploads/legacy/315_passwordRecovery/2.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Нам нужно создать включаемый файл, чтобы мы могли подключиться к нашей базе данных. Для взаимодействия с базой данных мы будем использовать mysqli, который обеспечивает объектно-ориентированный подход к взаимодействию с базой данных. Создайте файл под названием assets / php / database.php. Мы добавим следующий код (заменим значения переменных информацией, подходящей для вашей ситуации с хостингом):</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpsession_start();ob_start();$hasDB = false;$server = "localhost";$user = "user";$pass = "password";$db = "db";$mySQL = new mysqli($server,$user,$pass,$db);if ($mySQL-&gt;connect_error){    die("Connect Error (" . $mySQL-&gt;connect_errno . ") ". $mySQL-&gt;connect_error);}?&gt;</pre> <p>В первой строке кода мы вызываем <strong>session_start ()</strong>, на самом деле мы не будем использовать переменные сеанса, но вам понадобится сеанс как часть системы входа пользователя. Затем мы вызываем <strong>ob_start ()</strong> для запуска буфера вывода.</p> <p>Строки 4-8 настраивают наши переменные для подключения к серверу. Затем мы создаем новый объект <strong>mysqli</strong>, передавая ему наши переменные. В оставшейся части нашего скрипта <strong>$ mySQL</strong> позволит нам взаимодействовать с базой данных по мере необходимости.</p> <p>Mysqli обрабатывает события ошибок немного по-другому, поэтому мы должны проверить свойство <strong>connect_error</strong> после подключения и вывести сообщение об ошибке, если что-то пошло не так. То же самое относится и к выполнению запросов; мы должны проверить свойство <strong>error</strong> (ошибка)нашего запроса или объекта соединения, чтобы проверить наличие ошибок.</p> <h3>Шаг 3: Создайте страницу забытого пароля</h3> <p>Давайте начнем с этого шага, создав файл ForgotPass.php. Затем мы добавим этот код к нему:</p> <pre class="brush: html noskimlinks noskimwords">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;&lt;title&gt;Password Recovery&lt;/title&gt;&lt;link href="assets/css/styles.css" rel="stylesheet" type="text/css"&gt;&lt;/head&gt;&lt;body&gt;&lt;div id="header"&gt;&lt;/div&gt;&lt;div id="page"&gt;&lt;!--PAGE CONTENT--&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</pre> <p>Этот HTML дает нам хорошую основу для дальнейшего развития и дает нам следующее:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/315_passwordRecovery/3.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Затем добавьте этот код в самый верх страницы, над HTML, который мы только что ввели:</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpinclude("assets/php/database.php"); include("assets/php/functions.php");$show = "emailForm"; //which form step to show by defaultif ($_SESSION["lockout"] == true &amp;&amp; (mktime() &gt; $_SESSION["lastTime"] + 900)){  $_SESSION["lockout"] = false;$_SESSION["badCount"] = 0;}if (isset($_POST["subStep"]) &amp;&amp; !isset($_GET["a"]) &amp;&amp; $_SESSION["lockout"] != true){switch($_POST["subStep"]){case 1://we just submitted an email or username for verification$result = checkUNEmail($_POST["uname"],$_POST["email"]);if ($result["status"] == false ){$error = true;$show = "userNotFound";} else {$error = false;$show = "securityForm";$securityUser = $result["userID"];}break;case 2://we just submitted the security question for verificationif ($_POST["userID"] != "" &amp;&amp; $_POST["answer"] != ""){$result = checkSecAnswer($_POST["userID"],$_POST["answer"]);if ($result == true){//answer was right$error = false;$show = "successPage";$passwordMessage = sendPasswordEmail($_POST["userID"]);$_SESSION["badCount"] = 0;} else {//answer was wrong$error = true;$show = "securityForm";$securityUser = $_POST["userID"];$_SESSION["badCount"]++;}} else {$error = true;$show = "securityForm";}break;case 3://we are submitting a new password (only for encrypted)if ($_POST["userID"] == "" || $_POST["key"] == "") header("location: login.php");if (strcmp($_POST["pw0"],$_POST["pw1"]) != 0 || trim($_POST["pw0"]) == ""){$error = true;$show = "recoverForm";} else {$error = false;$show = "recoverSuccess";updateUserPassword($_POST["userID"],$_POST["pw0"],$_POST["key"]);}break;}}</pre> <p>Первое, что мы делаем, это включаем файл базы данных и файл функций, который мы вскоре создадим. Затем мы создаем переменную с именем <strong>$ show</strong>, которая определяет, какой элемент интерфейса отображать, по умолчанию мы хотим показать форму ввода электронной почты.</p> <p>После этого мы проверяем некоторые переменные сессии. Если переменная блокировки сеанса имеет значение true, и с момента ее блокировки прошло более 900 секунд (15 минут), мы хотим завершить блокировку, что для нас делают строки 7 и 8.</p> <p>Затем мы создаем блок if, который проверяет, было ли что-либо опубликовано на странице. Вы также можете видеть, что мы проверяем, чтобы <strong>$ _GET ["a"] </strong>не был установлен, эта переменная будет установлена, когда пользователь нажимает на ссылку в своем электронном письме восстановления, поэтому, если это происходит, мы можем пропустить после проверки. Также в логическом блоке мы гарантируем, что для переменной блокировки не установлено значение true.</p> <p>Оказавшись внутри блока if, мы используем <strong>переключатель ($ _ POST ["subStep"])</strong>, чтобы проверить, какой этап формы был отправлен. Мы выполним три этапа: Шаг 1 означает, что мы только что ввели имя пользователя или адрес электронной почты, для которого мы хотим сбросить пароль. Для этого мы вызываем функцию <strong>checkUNEmail (</strong>), которую мы напишем сейчас. Эта функция возвращает массив, который имеет логическое значение для определения, был ли пользователь найден, и целое число userID, если пользователь был найден. Строка 17 проверяет, вернула ли пользовательская проверка ложь (пользователь не был найден), если так, мы устанавливаем флаг ошибки и переменную <strong>$ show (показывать)</strong>, чтобы увидеть сообщение «Пользователь не найден». Если пользователь был найден, мы должны показать форму с вопросом о безопасности и установить <strong>$ securityUser (безопасный пользователь)</strong>, чтобы мы знали, для какого пользователя загружать вопрос.</p> <p>На втором этапе мы представили секретный вопрос. Первое, что мы делаем здесь, это проверяем, чтобы были возвращены и идентификатор пользователя, и ответ. Если какой-либо из них был опущен, мы снова отображаем форму секретного вопроса. Если оба значения были включены, мы вызываем функцию, чтобы проверить ответ по базе данных. Эта функция возвращает простое логическое значение. Если на вопрос был дан правильный ответ, мы покажем страницу успеха, отправим электронное письмо с сбросом и установим счетчик неверных записей равным 0. Если на вопрос был получен неправильный ответ, мы снова отобразим страницу вопроса, а также увеличим счетчик неверных ответов.</p> <p>Третий этап происходит после того, как пользователь получил электронное письмо для сброса пароля, щелкнул ссылку и отправил форму для сброса пароля. Во-первых, либо идентификатор пользователя, либо ключ безопасности пусты, мы перенаправляем на домашнюю страницу. Затем мы проверяем, чтобы оба пароля совпадали и не были пустыми. Если они не совпадают, мы снова показываем форму сброса пароля. Если они совпадают, мы показываем сообщение об успехе и вызываем функцию для сброса пароля пользователя.</p> <p><strong>ПРИМЕЧАНИЕ.</strong> Если вы используете незашифрованные пароли, вы можете пропустить <strong>случай 3</strong> выше. Это метод, который сохраняет новый пароль после его сброса. Поскольку мы можем отправлять незашифрованные пароли по электронной почте, им не нужно их сбрасывать.</p> <p>Теперь мы добавим блок else к этому же блоку if сверху:</p> <pre class="brush: php noskimlinks noskimwords">elseif (isset($_GET["a"]) &amp;&amp; $_GET["a"] == "recover" &amp;&amp; $_GET["email"] != "") {$show = "invalidKey";$result = checkEmailKey($_GET["email"],urldecode(base64_decode($_GET["u"])));if ($result == false){$error = true;$show = "invalidKey";} elseif ($result["status"] == true) {$error = false;$show = "recoverForm";$securityUser = $result["userID"];}}if ($_SESSION["badCount"] &gt;= 3){$show = "speedLimit";$_SESSION["lockout"] = true;$_SESSION["lastTime"] = "" ? mktime() : $_SESSION["lastTime"];}?&gt;</pre> <p>Этот блок ещё определяет, установлен ли <strong>$ _GET ["a"]</strong>, что означает, что пользователь зашел на страницу по ссылке сброса электронной почты. Если мы выяснили, что они нажали на ссылку, мы хотим проверить, является ли ключ электронной почты действительным, используя <strong>checkEmailKey ()</strong> (проверка емейл вводов). Если ключ не найден или недействителен, это возвращает логическую ложь, и мы показываем нетрудоспособное ключевое сообщение. Если ключ действителен, однако, это возвращает массив, вне (так мы знаем который пароль пользователя снова для установки) которого мы можем схватить userid.</p> <p><strong>ПРИМЕЧАНИЕ.</strong> Если вы используете незашифрованные пароли, вы можете пропустить блок <strong>elseif</strong>. Это имеет дело с показом формы изменения пароля после щелкания по связи в электронной почте.</p> <p>Второй, если там проверка по блокам, чтобы посмотреть, если пользователь ответил на вопрос безопасности неправильно более чем 3 раза. Если они имеют, мы устанавливаем lockout переменную к истине, и устанавливаем lockout время, которое является временем, когда блокировка вступила в силу. Заметьте, что, если lockout время уже определено, мы будем пользоваться этой переменной, но в противном случае, мы будем производить новое время.</p> <p>Урегулирование speedlimit важно для безопасности. По большей части это будет служить, чтобы удерживать людей только, сидя там и пробуя догадаться ответ на вопросы безопасности. Это может также помочь воспрепятствовать ботам передача формы снова и снова. Главный недостаток этого метода есть, что пользователь может только удалить домашнее печенье Phpsess_id, а затем они могут начать. Если вы хотите очень безопасного решения, вы смогли добавить, что "lockout" флаг к пользовательскому столу, и когда они ответили неправильно 3 разам, устанавливает, что флаг к истине. Затем вы можете написать код для блокировки, если они попытаются получить доступ к учетной записи.</p> <h3>Шаг 4: Функциональный файл</h3> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/315_passwordRecovery/4.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Теперь давайте создадим файл assets / php / functions.php для хранения всех функций, на которые мы ссылались ранее. Теперь давайте рассмотрим их по несколько раз:</p> <p><strong>ПРИМЕЧАНИЕ.</strong> В примерах файлов в зашифрованном примере используется таблица<em> "users_enc</em>", в то время как в незашифрованном примере используется таблица <em>"users"</em>, поэтому имя таблицы будет изменяться в ваших функциях в зависимости от используемой версии.</p> <pre class="brush: php noskimlinks noskimwords">&lt;?phpdefine(PW_SALT,"(+3%_");function checkUNEmail($uname,$email){global $mySQL;$error = array("status"=&gt;false,"userID"=&gt;0);if (isset($email) &amp;&amp; trim($email) != "") {//email was enteredif ($SQL = $mySQL-&gt;prepare("SELECT `ID` FROM `users_enc` WHERE `Email` = ? LIMIT 1")){$SQL-&gt;bind_param("s",trim($email));$SQL-&gt;execute();$SQL-&gt;store_result();$numRows = $SQL-&gt;num_rows();$SQL-&gt;bind_result($userID);$SQL-&gt;fetch();$SQL-&gt;close();if ($numRows &gt;= 1) return array("status"=&gt;true,"userID"=&gt;$userID);} else { return $error; }} elseif (isset($uname) &amp;&amp; trim($uname) != "") {//username was enteredif ($SQL = $mySQL-&gt;prepare("SELECT `ID` FROM `users_enc` WHERE Username = ? LIMIT 1")){$SQL-&gt;bind_param("s",trim($uname));$SQL-&gt;execute();$SQL-&gt;store_result();$numRows = $SQL-&gt;num_rows();$SQL-&gt;bind_result($userID);$SQL-&gt;fetch();$SQL-&gt;close();if ($numRows &gt;= 1) return array("status"=&gt;true,"userID"=&gt;$userID);} else { return $error; }} else {//nothing was entered;return $error;}}</pre> <p>В верхней части файла мы хотим определить <strong>PW_SALT</strong>, который является соль, которую мы будем использовать для шифрования паролей во всем. Первая функция берет значения имени пользователя и пароля из $ _POST и проверяет, существует ли соответствующий пользователь в базе данных. Первое, что нам нужно сделать, это сделать <strong>$ mySQL </strong>глобальным, чтобы мы могли получить доступ к базе данных. Мы также создаем общий массив ошибок, который мы будем возвращать, если пользователь не найден. Затем мы проверяем, есть ли значение для письма. Если это так, мы создаем подготовленный оператор MySQLi. Преимуществом использования готовых операторов является безопасность, особенно когда речь идет о пользовательском вводе, весь процесс аналогичен использованию <strong>sprintf ()</strong>.</p> <p>Обратите внимание, что мы вызываем метод <strong>-&gt; prepare ()</strong> (подготовка) с нашим SQL-запросом в качестве параметра, и используем вопросительные знаки, куда будут идти наши переменные. Также обратите внимание, что мы <strong>не</strong> ставим кавычки вокруг вопросительных знаков (даже для строки). Это то, что позволяет нам параметризировать оператор. <strong>mySQLi :: prepare ()</strong> вернет правильно, если инструкция была успешно создана. Если он был создан, нам нужно привязать параметры к нашему запросу, используя <strong>mySQLi :: bind_param ()</strong>. Эта функция принимает как минимум два аргумента. Первая - это строка букв, которые представляют типы данных данных, которые будут связаны. Остальные аргументы - это переменные, которые вы хотите видеть в каждом параметре. В нашем случае мы используем <strong>"s"</strong> (для строки) и <strong>$ email</strong>, поскольку эта переменная имеет адрес электронной почты. Обратите внимание, что порядок важен, поэтому первый знак вопроса в вашем запросе соответствует первой букве в строке формата и первой переменной.</p> <p>Затем нам нужно вызвать<strong> -&gt; execute ()</strong> и <strong>-&gt; store_result (</strong>). Эти два метода запускают подготовленный запрос и сохраняют его в памяти до освобождения. Затем мы проверяем количество возвращаемых строк, чтобы убедиться, что пользователь был найден. <strong>-&gt; bind_result (</strong>) очень похож на <strong>-&gt; bind_param (</strong>) за исключением противоположного направления. Это позволяет нам взять возвращенное значение из результата и отобразить его в локальной переменной. Переменные присваиваются в зависимости от их порядка в наборе результатов. Локальная переменная фактически не записывается, пока мы не вызовем <strong>-&gt; fetch ()</strong>, после того как мы вызовем -&gt; <strong>fetch ()</strong>, переменная <strong>$ userID</strong> будет содержать переменную из базы данных. Затем мы используем <strong>-&gt; close ()</strong> для запроса, чтобы освободить результат. Наконец, мы вернем массив, который содержит логическое значение для успеха и целое число для идентификатора пользователя.</p> <pre class="brush: php noskimlinks noskimwords">function getSecurityQuestion($userID){global $mySQL;$questions = array();$questions[0] = "What is your mother"s maiden name?";$questions[1] = "What city were you born in?";$questions[2] = "What is your favorite color?";$questions[3] = "What year did you graduate from High School?";$questions[4] = "What was the name of your first boyfriend/girlfriend?";$questions[5] = "What is your favorite model of car?";if ($SQL = $mySQL-&gt;prepare("SELECT `secQ` FROM `users_enc` WHERE `ID` = ? LIMIT 1")){$SQL-&gt;bind_param("i",$userID);$SQL-&gt;execute();$SQL-&gt;store_result();$SQL-&gt;bind_result($secQ);$SQL-&gt;fetch();$SQL-&gt;close();return $questions[$secQ];} else {return false;}}function checkSecAnswer($userID,$answer){global $mySQL;if ($SQL = $mySQL-&gt;prepare("SELECT `Username` FROM `users_enc` WHERE `ID` = ? AND LOWER(`secA`) = ? LIMIT 1")){$answer = strtolower($answer);$SQL-&gt;bind_param("is",$userID,$answer);$SQL-&gt;execute();$SQL-&gt;store_result();$numRows = $SQL-&gt;num_rows();$SQL-&gt;close();if ($numRows &gt;= 1) { return true; }} else {return false;}}</pre> <p><strong>getSecurityQuestion ()</strong> принимает идентификатор пользователя и возвращает его контрольный вопрос в виде строки. Еще раз, мы делаем глобальный <strong>$ mySQL</strong>. Затем мы создаем массив из 6 различных возможных вопросов безопасности. Используя метод, аналогичный описанному выше, мы видим, какой секретный вопрос выбрал пользователь, затем возвращаем этот индекс из массива.</p> <p><strong>checkSecAnswer ()</strong> принимает идентификатор пользователя и строковый ответ и проверяет базу данных, чтобы убедиться, что это правильно. Обратите внимание, что мы преобразуем переданный ответ и ответ базы данных в нижний регистр, чтобы увеличить шансы на совпадение (необязательно для вас). Это отличный пример многопараметрического оператора. Обратите внимание на порядок аргументов в методе <strong>bind_param ()</strong>. Эта функция вернет истину, если найдет запись, в которой идентификатор пользователя и ответ совпадают с тем, что было передано. В противном случае он вернет false.</p> <pre class="brush: php noskimlinks noskimwords">function sendPasswordEmail($userID){global $mySQL;if ($SQL = $mySQL-&gt;prepare("SELECT `Username`,`Email`,`Password` FROM `users_enc` WHERE `ID` = ? LIMIT 1")){$SQL-&gt;bind_param("i",$userID);$SQL-&gt;execute();$SQL-&gt;store_result();$SQL-&gt;bind_result($uname,$email,$pword);$SQL-&gt;fetch();$SQL-&gt;close();$expFormat = mktime(date("H"), date("i"), date("s"), date("m")  , date("d")+3, date("Y"));$expDate = date("Y-m-d H:i:s",$expFormat);$key = md5($uname . "_" . $email . rand(0,10000) .$expDate . PW_SALT);if ($SQL = $mySQL-&gt;prepare("INSERT INTO `recoveryemails_enc` (`UserID`,`Key`,`expDate`) VALUES (?,?,?)")){$SQL-&gt;bind_param("iss",$userID,$key,$expDate);$SQL-&gt;execute();$SQL-&gt;close();$passwordLink = "&lt;a href=\"?a=recover&amp;email=" . $key . "&amp;u=" . urlencode(base64_encode($userID)) . "\"&gt;http://www.oursite.com/forgotPass.php?a=recover&amp;email=" . $key . "&amp;u=" . urlencode(base64_encode($userID)) . "&lt;/a&gt;";$message = "Dear $uname,\r\n";$message .= "Please visit the following link to reset your password:\r\n";$message .= "-----------------------\r\n";$message .= "$passwordLink\r\n";$message .= "-----------------------\r\n";$message .= "Please be sure to copy the entire link into your browser. The link will expire after 3 days for security reasons.\r\n\r\n";$message .= "If you did not request this forgotten password email, no action is needed, your password will not be reset as long as the link above is not visited. However, you may want to log into your account and change your security password and answer, as someone may have guessed it.\r\n\r\n";$message .= "Thanks,\r\n";$message .= "-- Our site team";$headers .= "From: Our Site &lt;webmaster@oursite.com&gt; \n";$headers .= "To-Sender: \n";$headers .= "X-Mailer: PHP\n"; // mailer$headers .= "Reply-To: webmaster@oursite.com\n"; // Reply address$headers .= "Return-Path: webmaster@oursite.com\n"; //Return Path for errors$headers .= "Content-Type: text/html; charset=iso-8859-1"; //Enc-type$subject = "Your Lost Password";@mail($email,$subject,$message,$headers);return str_replace("\r\n","&lt;br/ &gt;",$message);}}}</pre> <p>Эта функция заботится об отправке электронного письма для сброса пароля. Мы начинаем с выполнения запроса SQL, чтобы получить имя пользователя и адрес электронной почты переданного пользователя. После привязки параметров и результата мы закрываем запрос. В целях безопасности мы хотим, чтобы сгенерированная нами ссылка работала в течение 3-х  дней. Для этого мы создаем новую дату, которая будет через 3-и дня. Их, используя несколько значений, которые передаются, дату, случайное число и нашу соль, мы генерируем хеш MD5, который будет нашим ключом безопасности. Из-за каждой изменяющейся будущей даты и случайного числа мы должны быть уверены, что каждый раз мы получаем абсолютно случайный ключ. Затем мы строим запрос SQL, чтобы вставить его в базу данных. После выполнения запроса мы создаем ссылку, которая будет отправлена ​​в электронном письме. Мы хотим включить "a = recovery" и наш ключ, а также userID, который мы <strong>base64_encode ()</strong> и <strong>urlencode ()</strong>, чтобы сделать его недоступным для чтения. Как только ссылка сгенерирована, мы создаем оставшуюся часть нашего электронного письма и отправляем его.</p> <p><strong>ПРИМЕЧАНИЕ.</strong> Если вы используете незашифрованный пример, вы хотите изменить текст сообщения, чтобы вместо него распечатать переменную <strong>$ pword</strong> вместо ссылки для сброса пароля.</p> <p><strong>ПРИМЕЧАНИЕ.</strong> Если вы разрабатываете это на локальном сервере, маловероятно, что у вас установлен SMTP, поэтому вы не сможете отправлять почту. Вот почему мы используем команду <strong>@mail ()</strong> (для предотвращения сообщений об ошибках). Также по этой причине эта функция возвращает строку сообщения, чтобы его можно было распечатать на экране. Теперь для последних 3 функций:</p> <pre class="brush: php noskimlinks noskimwords">function checkEmailKey($key,$userID){global $mySQL;$curDate = date("Y-m-d H:i:s");if ($SQL = $mySQL-&gt;prepare("SELECT `UserID` FROM `recoveryemails_enc` WHERE `Key` = ? AND `UserID` = ? AND `expDate` &gt;= ?")){$SQL-&gt;bind_param("sis",$key,$userID,$curDate);$SQL-&gt;execute();$SQL-&gt;execute();$SQL-&gt;store_result();$numRows = $SQL-&gt;num_rows();$SQL-&gt;bind_result($userID);$SQL-&gt;fetch();$SQL-&gt;close();if ($numRows &gt; 0 &amp;&amp; $userID != ""){return array("status"=&gt;true,"userID"=&gt;$userID);}}return false;}function updateUserPassword($userID,$password,$key){global $mySQL;if (checkEmailKey($key,$userID) === false) return false;if ($SQL = $mySQL-&gt;prepare("UPDATE `users_enc` SET `Password` = ? WHERE `ID` = ?")){$password = md5(trim($password) . PW_SALT);$SQL-&gt;bind_param("si",$password,$userID);$SQL-&gt;execute();$SQL-&gt;close();$SQL = $mySQL-&gt;prepare("DELETE FROM `recoveryemails_enc` WHERE `Key` = ?");$SQL-&gt;bind_param("s",$key);$SQL-&gt;execute();}}function getUserName($userID){global $mySQL;if ($SQL = $mySQL-&gt;prepare("SELECT `Username` FROM `users_enc` WHERE `ID` = ?")){$SQL-&gt;bind_param("i",$userID);$SQL-&gt;execute();$SQL-&gt;store_result();$SQL-&gt;bind_result($uname);$SQL-&gt;fetch();$SQL-&gt;close();}return $uname;}</pre> <p>Первая функция проверяет ключ электронной почты, который был передан. Мы создаем строку даты для представления сегодняшней даты (поэтому мы знаем, истек ли срок действия ключа). Затем наш SQL проверяет, существуют ли какие-либо записи для ключа, который соответствует переданному пользователю, ключу безопасности и что срок действия истек уже сейчас. Если такой ключ существует, мы возвращаем массив с идентификатором userID или false в противном случае.</p> <p>Функция<strong> updateUserPassword ()</strong> заботится об изменении действительного пароля в базе данных. Сначала мы проверяем ключ электронной почты на соответствие переданной информации о пользователе и ключе, чтобы убедиться в безопасности. Мы генерируем новый пароль, комбинируя переданный пароль и ранее определенную соль, а затем запускаем <strong>md5 ()</strong> для этой строки. Затем мы выполняем наше обновление. После этого мы удаляем запись ключа восстановления из базы данных, чтобы его нельзя было использовать снова.</p> <p><strong>ПРИМЕЧАНИЕ.</strong> Функция <strong>updateUserPassword ()</strong> не требуется в незашифрованном примере, поскольку мы не меняем их пароль.</p> <p><strong>getUserName () </strong>- это просто служебная функция для получения имени пользователя с идентифицированным идентификатором пользователя. Он использует базовый оператор SQL, как и другие.</p> <h3>Шаг 5: заполните страницу забытого пароля</h3> <p>Теперь, когда у нас есть функции, которые нам нужны, мы добавим еще несколько в ForgotPass.php. Добавьте этот код внутри div с идентификатором "page":</p> <pre class="brush: php noskimlinks noskimwords">&lt;?php switch($show) {case "emailForm": ?&gt;&lt;h2&gt;Password Recovery&lt;/h2&gt;    &lt;p&gt;You can use this form to recover your password if you have forgotten it. Because your password is securely encrypted in our database, it is impossible actually recover your password, but we will email you a link that will enable you to reset it securely. Enter either your username or your email address below to get started.&lt;/p&gt;    &lt;?php if ($error == true) { ?&gt;&lt;span class="error"&gt;You must enter either a username or password to continue.&lt;/span&gt;&lt;?php } ?&gt;    &lt;form action="&lt;?= $_SERVER["PHP_SELF"]; ?&gt;" method="post"&gt;        &lt;div class="fieldGroup"&gt;&lt;label for="uname"&gt;Username&lt;/label&gt;&lt;div class="field"&gt;&lt;input type="text" name="uname" id="uname" value="" maxlength="20"&gt;&lt;/div&gt;&lt;/div&gt;        &lt;div class="fieldGroup"&gt;&lt;label&gt;- OR -&lt;/label&gt;&lt;/div&gt;        &lt;div class="fieldGroup"&gt;&lt;label for="email"&gt;Email&lt;/label&gt;&lt;div class="field"&gt;&lt;input type="text" name="email" id="email" value="" maxlength="255"&gt;&lt;/div&gt;&lt;/div&gt;        &lt;input type="hidden" name="subStep" value="1" /&gt;        &lt;div class="fieldGroup"&gt;&lt;input type="submit" value="Submit" style="margin-left: 150px;" /&gt;&lt;/div&gt;        &lt;div class="clear"&gt;&lt;/div&gt;    &lt;/form&gt;    &lt;?php break; case "securityForm": ?&gt;    &lt;h2&gt;Password Recovery&lt;/h2&gt;    &lt;p&gt;Please answer the security question below:&lt;/p&gt;    &lt;?php if ($error == true) { ?&gt;&lt;span class="error"&gt;You must answer the security question correctly to receive your lost password.&lt;/span&gt;&lt;?php } ?&gt;    &lt;form action="&lt;?= $_SERVER["PHP_SELF"]; ?&gt;" method="post"&gt;        &lt;div class="fieldGroup"&gt;&lt;label&gt;Question&lt;/label&gt;&lt;div class="field"&gt;&lt;?= getSecurityQuestion($securityUser); ?&gt;&lt;/div&gt;&lt;/div&gt;        &lt;div class="fieldGroup"&gt;&lt;label for="answer"&gt;Answer&lt;/label&gt;&lt;div class="field"&gt;&lt;input type="text" name="answer" id="answer" value="" maxlength="255"&gt;&lt;/div&gt;&lt;/div&gt;        &lt;input type="hidden" name="subStep" value="2" /&gt;        &lt;input type="hidden" name="userID" value="&lt;?= $securityUser; ?&gt;" /&gt;        &lt;div class="fieldGroup"&gt;&lt;input type="submit" value="Submit" style="margin-left: 150px;" /&gt;&lt;/div&gt;        &lt;div class="clear"&gt;&lt;/div&gt;    &lt;/form&gt; &lt;?php break; case "userNotFound": ?&gt;&lt;br&gt;    &lt;h2&gt;Password Recovery&lt;/h2&gt;&lt;br&gt;    &lt;p&gt;The username or email you entered was not found in our database.&lt;br /&gt;&lt;br /&gt;&lt;a href="?"&gt;Click here&lt;/a&gt; to try again.&lt;/p&gt;&lt;br&gt;    &lt;?php break; case "successPage": ?&gt;&lt;br&gt;    &lt;h2&gt;Password Recovery&lt;/h2&gt;&lt;br&gt;    &lt;p&gt;An email has been sent to you with instructions on how to reset your password. &lt;strong&gt;(Mail will not send unless you have an smtp server running locally.)&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;&lt;a href="login.php"&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;&lt;br&gt;    &lt;p&gt;This is the message that would appear in the email:&lt;/p&gt;&lt;br&gt;    &lt;div class="message"&gt;&lt;?= $passwordMessage;?&gt;&lt;/div&gt;&lt;br&gt;    &lt;?php break;</pre> <p>Этот код будет иметь дело с отображением всех элементов интерфейса. Мы начнем с изучения переменной <strong>$ show</strong>, описанной ранее, с помощью <strong>switch ()</strong>. Как вы, возможно, помните из предыдущего, существует множество различных значений, которые может иметь <strong>$ show</strong>, поэтому мы должны создать регистр для каждого из них. В первом случае, «emailForm», пользователь вводит либо имя пользователя, либо адрес электронной почты, для которого он хочет восстановить пароль. В основном нам нужны два текстовых поля и скрытый ввод, чтобы мы знали, какой шаг мы отправили. Существует также блок if <strong>($ error == true)</strong>, который будет отображать сообщение об ошибке, если флаг <strong>$ error</strong> имеет значение true.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/315_passwordRecovery/5.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Второй случай - «securityForm». Это где секретный вопрос будет отображаться. Вы можете видеть, что у нас также есть сообщение об ошибке, и мы используем <span class="php"><strong>getSecurityQuestion ()</strong></span>, чтобы напечатать контрольный вопрос. Затем у нас есть вход для ответа, а также шаг и идентификатор пользователя.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/315_passwordRecovery/6.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Сообщение для «userNotFound» - это просто текстовое сообщение, которое сообщает пользователю, что запись не была найдена.</p> <p>«SuccessPage» отображается, когда на секретный вопрос был дан правильный ответ и электронное письмо было отправлено. Обратите внимание, что мы распечатали сообщение электронной почты в нижней части этого приглашения, вы не будете делать это в производственной среде, потому что тогда вы даете человеку мгновенный доступ к коду безопасности, предназначенному только для зарегистрированного пользователя.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/315_passwordRecovery/7.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Давайте продолжим с этим кодом:</p> <pre class="brush: php noskimlinks noskimwords">case "recoverForm": ?&gt;    &lt;h2&gt;Password Recovery&lt;/h2&gt;    &lt;p&gt;Welcome back, &lt;?= getUserName($securityUser=="" ? $_POST["userID"] : $securityUser); ?&gt;.&lt;/p&gt;    &lt;p&gt;In the fields below, enter your new password.&lt;/p&gt;    &lt;?php if ($error == true) { ?&gt;&lt;span class="error"&gt;The new passwords must match and must not be empty.&lt;/span&gt;&lt;?php } ?&gt;    &lt;form action="&lt;?= $_SERVER["PHP_SELF"]; ?&gt;" method="post"&gt;        &lt;div class="fieldGroup"&gt;&lt;label for="pw0"&gt;New Password&lt;/label&gt;&lt;div class="field"&gt;&lt;input type="password" class="input" name="pw0" id="pw0" value="" maxlength="20"&gt;&lt;/div&gt;&lt;/div&gt;        &lt;div class="fieldGroup"&gt;&lt;label for="pw1"&gt;Confirm Password&lt;/label&gt;&lt;div class="field"&gt;&lt;input type="password" class="input" name="pw1" id="pw1" value="" maxlength="20"&gt;&lt;/div&gt;&lt;/div&gt;        &lt;input type="hidden" name="subStep" value="3" /&gt;        &lt;input type="hidden" name="userID" value="&lt;?= $securityUser=="" ? $_POST["userID"] : $securityUser; ?&gt;" /&gt;        &lt;input type="hidden" name="key" value="&lt;?= $_GET["email"]=="" ? $_POST["key"] : $_GET["email"]; ?&gt;" /&gt;        &lt;div class="fieldGroup"&gt;&lt;input type="submit" value="Submit" style="margin-left: 150px;" /&gt;&lt;/div&gt;        &lt;div class="clear"&gt;&lt;/div&gt;    &lt;/form&gt;    &lt;?php break; case "invalidKey": ?&gt;    &lt;h2&gt;Invalid Key&lt;/h2&gt;    &lt;p&gt;The key that you entered was invalid. Either you did not copy the entire key from the email, you are trying to use the key after it has expired (3 days after request), or you have already used the key in which case it is deactivated.&lt;br /&gt;&lt;br /&gt;&lt;a href="login.php"&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;    &lt;?php break; case "recoverSuccess": ?&gt;    &lt;h2&gt;Password Reset&lt;/h2&gt;    &lt;p&gt;Congratulations! your password has been reset successfully.&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;a href="login.php"&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;    &lt;?php break; case "speedLimit": ?&gt;    &lt;h2&gt;Warning&lt;/h2&gt;    &lt;p&gt;You have answered the security question wrong too many times. You will be locked out for 15 minutes, after which you can try again.&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;a href="login.php"&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;    &lt;?php break; }ob_flush();$mySQL-&gt;close();?&gt;</pre> <p>Продолжая оператор switch, у нас есть «coverForm », который отображает форму для изменения пароля. Мы распечатываем имя пользователя и сообщение об ошибке, если это необходимо. Затем у нас есть поля ввода для пароля и пароля подтверждения, шага отправки, идентификатора пользователя и ключа безопасности из электронного письма. Для ключа и идентификатора пользователя e использует специальный синтаксис <strong>if ()</strong>, чтобы убедиться, что мы получаем переменную из правильного места. Если переменная querystring равна нулю, мы посмотрим на переменные post, чтобы убедиться, что здесь у нас всегда есть значение.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/315_passwordRecovery/8.jpg" alt="Создание расширенной утилиты восстановления пароля..." title="Создание расширенной утилиты восстановления пароля..." width="50" height="50"></div> <p>Затем «invalidKey» означает, что предоставленный ключ не существует или срок его действия истек. Сообщение «speedLimit» отображается, если пользователь заблокирован из-за слишком большого количества неправильных ответов. Наконец, мы вызываем <strong>ob_flush ()</strong> для отправки страницы в браузер и <strong>$ mySQL-&gt; close (</strong>) для отключения от базы данных.</p> <p><strong>ПРИМЕЧАНИЕ.</strong> Сообщения «recoveryForm» и «invalidKey», описанные выше, не нужны для незашифрованных паролей.</p> <h3>Заключение</h3> <p>В этой статье мы рассмотрели добавление чрезвычайно полезной функции для любого сайта членства. Независимо от того, храните ли вы пароли в виде простого текста или в зашифрованном виде, это руководство должно было помочь вам добавить функцию восстановления пароля. Мы рассмотрели логику шифрования паролей, отправки электронных писем для восстановления паролей и некоторые проблемы безопасности при этом.</p> <p>Кроме того, мы рассмотрели использование mysqli для улучшения нашего взаимодействия с базой данных. Хотя этот урок не был настолько углублен в mysqli, он должен сделать вас немного лучше, чем вы были раньше.</p> <p>Я надеюсь, что вы можете использовать методы, обсуждаемые здесь, чтобы добавить эту чрезвычайно полезную функцию на ваш следующий пользовательский сайт.</p> <p><strong>Примечание к загрузке.</strong> В загружаемых файлах я реализовал зашифрованные и незашифрованные версии в двух разных папках.</p> <ul class="webroundup"><li>Подпишитесь на нас в <span>Твиттере</span> или подпишитесь на <span>RSS-канал NETTUTS</span>, чтобы получать ежедневные обзоры и статьи о веб-разработке.</li> </ul><p> <br></p> 

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="PHP" href="https://norma-studio.github.io/article5/220825757-sozdanie-rasshirennoi-utility-vosstanovleniya-parolya" class="tm-article-body__tags-item-link">PHP</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
36880</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
583</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
