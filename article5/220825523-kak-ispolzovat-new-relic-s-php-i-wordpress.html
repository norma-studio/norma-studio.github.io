
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Ранее мы рассмотрели, как настроить New Relic для приложения Rails, а также потратили много времени на то, как использовать New Relic UI. И хотя пользовательский интерфейс очень похож, независимо от языка и фреймворка, которые вы используете, на самом деле настройка New Relic может радикально отличаться. Сегодня мы рассмотрим, как мониторить-PHP-пр...">
<meta property="og:description" content="Ранее мы рассмотрели, как настроить New Relic для приложения Rails, а также потратили много времени на то, как использовать New Relic UI. И хотя пользовательский интерфейс очень похож, независимо от языка и фреймворка, которые вы используете, на самом деле настройка New Relic может радикально отличаться. Сегодня мы рассмотрим, как мониторить-PHP-пр...">
<meta name="twitter:description" content="Ранее мы рассмотрели, как настроить New Relic для приложения Rails, а также потратили много времени на то, как использовать New Relic UI. И хотя пользовательский интерфейс очень похож, независимо от языка и фреймворка, которые вы используете, на самом деле настройка New Relic может радикально отличаться. Сегодня мы рассмотрим, как мониторить-PHP-пр...">
<meta property="aiturec:description" content="Ранее мы рассмотрели, как настроить New Relic для приложения Rails, а также потратили много времени на то, как использовать New Relic UI. И хотя пользовательский интерфейс очень похож, независимо от языка и фреймворка, которые вы используете, на самом деле настройка New Relic может радикально отличаться. Сегодня мы рассмотрим, как мониторить-PHP-пр...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/security-rules.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/security-rules.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/security-rules.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/security-rules.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/security-rules.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html" title="Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io" title="Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543234456.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html" class="tm-user-info__username" title="
А. Гаврилов" aria-label="
А. Гаврилов">
А. Гаврилов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Как использовать New Relic с PHP и WordPress
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress" class="tm-article-snippet__hubs-item-link"><span>Web Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/security-rules.jpg">
    <meta itemprop="headline name" content="Как использовать New Relic с PHP и WordPress
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Ранее мы рассмотрели, как настроить New Relic для приложения Rails, а также потратили много времени на то, как использовать New Relic UI. И хотя пользовательский интерфейс очень похож, независимо от языка и фреймворка, которые вы используете, на самом деле настройка New Relic может радикально отличаться. Сегодня мы рассмотрим, как мониторить-PHP-пр...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Ранее мы рассмотрели, как настроить New Relic для приложения Rails, а также потратили много времени на то, как использовать New Relic UI. И хотя пользовательский интерфейс очень похож, независимо от языка и фреймворка, которые вы используете, на самом деле настройка New Relic может радикально отличаться. Сегодня мы рассмотрим, как мониторить-PHP-пр...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Ранее мы рассмотрели, <span>как настроить New Relic для приложения Rails</span>, а также потратили много времени на то, <span>как использовать New Relic UI</span>. И хотя пользовательский интерфейс очень похож, независимо от языка и фреймворка, которые вы используете, на самом деле настройка <span>New Relic</span> может радикально отличаться. Сегодня мы рассмотрим, как мониторить PHP приложение с помощью New Relic. В частности, мы рассмотрим базовую установку <span>WordPress</span> и получим некоторые данные о производительности в панелях инструментов New Relic.<br></p><p>Настройка New Relic для Ruby практически не привязана к окружению. Мы просто добавляем gem агента к нашему приложению, независимо от того, как мы развертываем наше приложение (<span>Passenger</span> + <span>Apache</span>, <span>Thin</span> + <span>Nginx</span> и т.д.), gem выполнит оставшуюся часть работы, чтобы мы получили наши показатели производительности. С PHP-версией агента среда намного важнее, поскольку агент установлен и живет в боксе, где приложение будет развернуто, а не является частью какого-либо конкретного приложения. <br></p><p>Давайте создадим для этого песочницу (используя экземпляр <span>EC2</span>) и разверните базовую установку WordPress.<br></p><h2>Настройка нашей песочницы<br></h2><p>Здесь мы не будем вдаваться в подробности, поскольку большинство вещей, которые нам нужно сделать, хорошо документированы в других местах. Но вот основной план.<br></p><p>Нам нужно запустить экземпляр <span>EC2 с Ubuntu Server 12.04 LTS</span>. Если вы не хотите настраивать экземпляр EC2, вы можете просто создать виртуальную машину, вместо этого используя <span>VirtualBox</span> (или ваш VM инструмент на выбор). Если вы настраиваете экземпляр EC2, вам необходимо запомнить следующее:<br></p><ul><li>загрузите свой ключ (если вы создали новый в процессе настройки), чтобы вы могли использовать SSH в своем экземпляре</li> <li>добавьте дополнительное правило в любую группу безопасности, которую вы даете вашему экземпляру, чтобы разрешить HTTP-подключения к экземпляру (чтобы позже мы могли фактически получить доступ к нашему блогу WordPress через браузер позже)</li> </ul><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/security-rules.jpg" alt="Как использовать New Relic с PHP и WordPress..." title="Как использовать New Relic с PHP и WordPress..." width="50" height="50"></figure><p>Помимо этого, все остальное должно быть довольно прямолинейным, и вы должны закончить работающий экземпляр (или виртуальную машину), готовую к следующему шагу.<br></p><p>Теперь нам нужно установить Apache, PHP и <span>MySQL</span>. С Ubuntu Server необходимо просто выполнить следующие команды:</p><pre class="brush: bash noskimlinks noskimwords">sudo apt-get install taskselsudo tasksel install lamp-server</pre><p>Вам нужно будет выбрать LAMP в пользовательском интерфейсе, и вам также потребуется ввести MySQL пароль, когда будет предложено это сделать (я просто оставляю его пустым, так как мы не заботимся о том, чтобы этот бокс был защищен каким-либо образом). По завершении установки мы можем запустить несколько команд, чтобы убедиться, что все было установлено без проблем. </p><p>Сначала проверьте, установлен ли Apache:</p><pre class="brush: bash noskimlinks noskimwords">ubuntu@ip-10-145-246-196:~$ apache2 -VServer version: Apache/2.2.22 (Ubuntu)Server built:   Jul 12 2013 13:37:10Server"s Module Magic Number: 20051115:30Server loaded:  APR 1.4.6, APR-Util 1.3.12Compiled using: APR 1.4.6, APR-Util 1.3.12Architecture:   64-bitServer MPM:     Prefork  threaded:     no    forked:     yes (variable process count)...</pre><p>Во-вторых, убедитесь, что у нас есть PHP:</p><pre class="brush: bash noskimlinks noskimwords">ubuntu@ip-10-145-246-196:~$ php -iphpinfo()PHP Version =&gt; 5.3.10-1ubuntu3.10System =&gt; Linux ip-10-145-246-196 3.2.0-58-virtual #88-Ubuntu SMP Tue Dec 3 17:58:13 UTC 2013 x86_64Build Date =&gt; Feb 28 2014 23:13:16Server API =&gt; Command Line InterfaceVirtual Directory Support =&gt; disabledConfiguration File (php.ini) Path =&gt; /etc/php5/cliLoaded Configuration File =&gt; /etc/php5/cli/php.ini...</pre><p>И затем проверьте, что у нас есть MySQL:</p><pre class="brush: bash noskimlinks noskimwords">ubuntu@ip-10-145-246-196:~$ mysql --versionmysql  Ver 14.14 Distrib 5.5.35, for debian-linux-gnu (x86_64) using readline 6.2</pre><p>Нам также может потребоваться проверить, действительно ли PHP включен в нашей конфигурации Apache, но поскольку мы установили <code class="inline">lamp-server</code> с помощью <code class="inline">tasksel</code>, мы можем быть уверены, что это так (и мы всегда можем сделать быстрый скрипт <code class="inline">phpinfo()</code>, если мы все же захотим проверить).</p><p>Теперь мы можем установить WordPress. Прежде чем мы загрузим его, нам нужно настроить для него базу данных. Мы можем просто <span>следовать инструкциям Codex</span>:</p><pre class="brush: bash noskimlinks noskimwords">ubuntu@ip-10-145-246-196:~$ mysqlWelcome to the MySQL monitor.  Commands end with ; or \g.Your MySQL connection id is 103Server version: 5.5.35-0ubuntu0.12.04.2 (Ubuntu)Type "help;" or "\h" for help. Type "\c" to clear the current input statement. mysql&gt; CREATE DATABASE myblog1;Query OK, 1 row affected (0.00 sec) mysql&gt; GRANT ALL PRIVILEGES ON myblog1.* TO "myblog1_user"@"localhost" IDENTIFIED BY "abc123";Query OK, 0 rows affected (0.00 sec)  mysql&gt; FLUSH PRIVILEGES;Query OK, 0 rows affected (0.01 sec)mysql&gt; EXITBye</pre><p>Я собираюсь назвать нашу новую установку <code class="inline">myblog1</code> (так что для нее база данных также будет называться <code class="inline">myblog1</code>). Теперь нам нужно выполнить следующие команды, чтобы запустить наш блог (не забудьте, если нужно, <code class="inline">sudo</code>):</p><pre class="brush: bash noskimlinks noskimwords">cd /var/wwwwget http://wordpress.org/latest.tar.gztar -xzvf latest.tar.gz mv wordpress myblog1cd myblog1mv wp-config-sample.php wp-config.php</pre><p>Теперь введите имя базы данных, имя пользователя и пароль в файл конфигурации (имя хоста - <code class="inline">localhost</code>, которое указано по умолчанию). На этом этапе вы сможете перейти в свой браузер, ввести нужный URL (в моем случае <span><code class="inline">http://ec2-107-20-122-116.compute-1.amazonaws.com/myblog1</code></span>), и WordPress готов (перед этим рекомендуется перезапускать Apache <code class="inline">sudo apache2 service restart</code>).</p><p>Теперь наша песочница завершена, и мы можем начать с установки New Relic.<br></p><h2>Установка New Relic<br></h2><p>Как я упоминал ранее, агент PHP New Relic находится в боксе, поэтому вы можете установить его с помощью диспетчера пакетов операционной системы (<code class="inline">apt-get</code>, так как мы используем Ubuntu). Первое, что нужно сделать, это импортировать ключ репозитория New Relic:</p><pre class="brush: bash noskimlinks noskimwords">wget -O - https://download.newrelic.com/548C16BF.gpg | sudo apt-key add -</pre><p>Теперь мы добавляем в систему репозиторий New Relic: </p><pre class="brush: bash noskimlinks noskimwords">sudo sh -c "echo "deb http://apt.newrelic.com/debian/ newrelic non-free" &gt; /etc/apt/sources.list.d/newrelic.list"</pre><p>На данный момент мы можем использовать стандартные команды <code class="inline">apt</code> для установки агента:</p><pre class="brush: bash noskimlinks noskimwords">sudo apt-get updatesudo apt-get install newrelic-php5</pre><p>Это извлекает пакет агента PHP из репозитория и помещает скрипт установки агента в систему. Сценарий называется <code class="inline">newrelic-install</code>, и он располагается в <code class="inline">/usr/bin</code>, поэтому вы можете выполнить его в любом месте. Сценарий, к сожалению, назван так как, что вы можете использовать его как для установки так и для удаления New Relic из вашей системы. Чтобы установить New Relic, нам нужно запустить:</p><pre class="brush: bash noskimlinks noskimwords">newrelic-install install</pre><p>Сценарий является интерактивным и попросит вас ввести свой лицензионный ключ. Вы можете найти его, нажав <b>большую красную кнопку</b>, когда вы настраиваете новое приложение PHP в новом пользовательском интерфейсе Relic.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/license-key.jpg" alt="Как использовать New Relic с PHP и WordPress..." title="Как использовать New Relic с PHP и WordPress..." width="50" height="50"></figure><p>Если у вас более одной установки PHP в вашей системе, она также попросит вас выбрать, для какой установки New Relic должен быть установлен (вы можете выбрать любое количество установок, включая все). Если в вашей системе есть только один PHP, сценарий будет использовать только его. Стоит отметить, что если ваша версия PHP старше 5.2, скрипт завершится неудачей, поскольку более старые версии не поддерживаются.<br></p><p>Если все пройдет хорошо, вы увидите следующее сообщение:</p><pre class="brush: bash noskimlinks noskimwords">New Relic is now installed on your system. Congratulations!</pre><p>Затем скрипт распечатает дополнительную информацию для вас, включая расположение файлов журнала:</p><pre class="brush: bash noskimlinks noskimwords">/var/log/newrelic/newrelic-daemon.log/var/log/newrelic/php_agent.log</pre><p>Кроме того, что вам необходимо будет перезагрузить веб-сервер (и PHP-FPM, если вы его используете).</p><p>Если вы перезагрузите свой сервер и просмотрите журнал демона, вы увидите что-то вроде этого:</p><pre class="brush: bash noskimlinks noskimwords">ubuntu@ip-10-145-246-196:/var/www/myblog1$ cat /var/log/newrelic/newrelic-daemon.log2014-03-23 05:30:41.063 (2008/main) warning: current file limit of 1024 is too low - attempting to increase it2014-03-23 05:30:41.064 (2008/main) info: increased file limit to 20482014-03-23 05:30:41.064 (2008/main) info: New Relic 4.6 (release build 40 - "quetzalcoatlus" - "e3d29c5a2e5dc1ee455e831d589ecf5e18c7d6f0") [workers=1 listen="/tmp/.newrelic.sock"  pid=2008 ppid=2007 uid=0 euid=0 gid=0 egid=0 backtrace=no os="Linux" rel="3.2.0-58-virtual" mach="x86_64" ver="#88-Ubuntu SMP Tue Dec 3 17" node="ip-10-145-246-196" startup=agent]2014-03-23 05:30:41.069 (2008/main) info: RPM config: proto="https" collector="collector.newrelic.com" proxy="none" certfile="/etc/ssl/certs/ca-certificates.crt" certdir="/etc/ssl/certs"2014-03-23 05:35:14.928 (2008/connector) info: ["PHP Application"] "Reporting to: https://rpm.newrelic.com/accounts/232928/applications/3262356"</pre><p>То, что называется <i>PHP Application</i>, пишет данные. Это что-то общее и полностью не похоже на наш блог WordPress, но это уже хорошее начало. Это означает, что все приложения на вашем веб-сервере запускаются и сообщают данные в New Relic в виде одного приложения. Это приложение имеет имя по умолчанию <i>PHP Application</i>. </p><p>В нашем случае, поскольку мы запускаем только одно приложение (наша установка WordPress), мы могли бы перейти в New Relic UI и получить хорошую статистику для нашего блога. Но, конечно, мы хотим дать нашему блогу лучшее имя и на всякий случай, мы хотим, чтобы наш сервер обслуживал более одного приложения. Мы также хотим понять, как отделять приложения друг от друга. Мы рассмотрим, как это сделать в ближайшее время, но прежде чем мы это сделаем, давайте посмотрим, что на самом деле представляет из себя агент PHP.</p><h2>Как выглядит установка<br></h2><p>В агенте New Relic PHP есть две части. Первая - это расширение PHP, это общий объект, называемый <code class="inline">newrelic.so</code>. Если мы посмотрим на файл конфигурации агента:</p><pre class="brush: bash noskimlinks noskimwords">/etc/php5/cli/conf.d/newrelic.ini</pre><p>Мы можем видеть, что он перечислен справа вверху:</p><pre class="brush: bash noskimlinks noskimwords">; This file contains the various settings for the New Relic PHP agent. There; are many options, all of which are described in detail at the following URL:; https://newrelic.com/docs/php/php-agent-phpini-settings;; If you use a full path to the extension you insulate yourself from the; extension directory changing if you change PHP installations or versions.; If you do not use an absolute path then the file must be installed in the; active configuration"s extension directory.extension = "newrelic.so"</pre><p>Это то, что на самом деле собирает статистику из ваших приложений, но не отправляет статистику в New Relic, это уже задание прокси-сервера.</p><p>Демон агента является прокси-сервером между расширением PHP и серверами New Relic. По сути, расширение PHP дает данные, которые оно собирает для демона, а демон будет делать что-то вроде пакетной работы и выяснить, когда отправить данные на сервер. Вы должны всегда быть убеждены, что демон запущен, иначе данные в New Relic не будут отправлены. К счастью, по умолчанию, всякий раз, когда вы перезагружаете свой сервер, расширение PHP будет пытаться определить, работает ли демон и запустит его, если это не так.<br></p><p>У работающего прокси-сервера есть два процесса. Один - это процесс мониторинга, а второй - рабочий. Рабочий фактически выполняет работу по обмену данными с серверами New Relic, а процесс мониторинга просто наблюдает за воркером, и если тот умирает, по какой-то причине он будет порождать новый. Вы можете остановить демона, выполнив:</p><pre class="brush: bash noskimlinks noskimwords">/etc/init.d/newrelic-daemon stop</pre><p>Эта команда отправит сигнал останова в процесс мониторинга. Затем процесс мониторинга убьет рабочий процесс, а затем отключится. Если вам когда-либо понадобится убить демона вручную, убедитесь, что вы сначала прекратили процесс мониторинга, прежде чем убить работника (в противном случае новый работник будет порожден - это очевидно).</p><h2>Настройка агента (и прокси-сервера)<br></h2><p>Мы уже видели файл конфигурации агента New Relic PHP <code class="inline">/etc/php5/cli/conf.d/newrelic.ini</code>. И агент, и демон настроены с использованием этого файла.<br></p><p>Этот файл очень хорошо документирован со всеми параметрами и указанными по умолчанию значениями. Давайте поговорим о формате этого файла. Агент New Relic для Ruby можно настроить через <span>YAML</span>, который является широко известным форматом. Агент PHP - это просто текстовый файл, но нам нужна небольшая структура. Каждая переменная в файле имеет один из четырех типов (String, Boolean, Number, Duration). Строка и число не требуют пояснений, логические значения могут быть <code class="inline">true</code>, on или <code class="inline">1</code>, чтобы указать правду и <code class="inline">false</code>, off или <code class="inline">0</code>, чтобы указать на неверно. Длительность - это строки с определенным форматом, например: «<code class="inline">1w3d23h10m</code>» обозначает одну неделю, три дня, 23 часа и десять минут. Значения длительности могут быть очень детальными аж дл микросекунды.<br></p><p>Все переменные в файле также имеют «область». Существует три возможных области: SYSTEM, PERDIR и SCRIPT. Переменные, имеющие область SYSTEM, могут быть установлены только в глобальном файле конфигурации. Переменные с областью PERDIR могут быть установлены в глобальном файле конфигурации и также могут быть переопределены для каждого каталога. Переменные с областью сценария могут быть глобальными, для каждого каталога и также могут быть переопределены программно.<br></p><p>Например, наиболее распространенной конфигурационной переменной является <code class="inline">`newrelic.appname`</code>. Эта переменная является строковым типом, она имеет значение по умолчанию <i>PHP Application</i> (теперь мы знаем, почему мы увидели это значение в файле журнала после того, как мы установили агент и перезапустили сервер). Область этой переменной - PERDIR, которая дает нам представление о том, как переопределить имя приложения для нашего блога WordPress. <br></p><p>Есть много других переменных, контролирующих такие вещи, как расположение файлов журнала, писать или нет sql запросы, уровень детальности журнала и т.д. Я рекомендую вам изучить файл <code class="inline">newrelic.ini</code>, чтобы ознакомиться с этими параметрами.<br></p><h2>Настройка отдельного приложения для нашего блога WordPress <br></h2><p>Мы хотим увидеть отдельное приложение в New Relic UI для нашего блога WordPress, поэтому давайте посмотрим, как мы можем это сделать. Ваши параметры для каждой конфигурации каталога различаются в зависимости от вашего стека, если вы используете <span>PHP-FPM</span>, шаги будут отличаться от того, если бы вы использовали Nginx. В нашем случае, поскольку мы запускаем Apache, у нас есть два варианта.<br></p><p>Во-первых, если у нас есть виртуальный хост для нашего приложения, мы можем вставить блок <code class="inline">IfModule</code> в наш виртуальный хост-блок и изменить там имя приложения:</p><pre class="brush: bash noskimlinks noskimwords">...&lt;IfModule php5_module&gt;  php_value newrelic.appname "My Blog 1"&lt;/IfModule&gt;...</pre><p>Но у меня нет специального виртуального хоста отдельно для блога, поэтому другой вариант - использовать файл <code class="inline">.htaccess</code>. Убедитесь, что вы действительно разрешаете файлы <code class="inline">.htaccess</code>, добавив следующее на ваш основной виртуальный хост:</p><pre class="brush: bash noskimlinks noskimwords">&lt;Directory /var/www/myblog1&gt;  Options Indexes FollowSymLinks MultiViews  AllowOverride All  Order allow,deny  allow from all&lt;/Directory&gt;</pre><p>Теперь мы можем поместить файл <code class="inline">.htaccess</code> в каталог верхнего уровня нашего блога и поместить в него следующее:</p><pre class="brush: bash noskimlinks noskimwords">php_value newrelic.appname "My Blog 1"</pre><p>Формат точно такой же, как если бы я помещал его в блок <code class="inline">IfModule</code>. Теперь нам просто нужно отделиться от нашего сервера. Если мы закроем журналы демона при перезапуске сервера, мы увидим следующее:</p><pre class="brush: bash noskimlinks noskimwords">ubuntu@ip-10-145-246-196:/var/www/myblog1$ cat /var/log/newrelic/newrelic-daemon.log2014-03-23 05:30:41.063 (2008/main) warning: current file limit of 1024 is too low - attempting to increase it2014-03-23 05:30:41.064 (2008/main) info: increased file limit to 20482014-03-23 05:30:41.064 (2008/main) info: New Relic 4.6 (release build 40 - "quetzalcoatlus" - "e3d29c5a2e5dc1ee455e831d589ecf5e18c7d6f0") [workers=1 listen="/tmp/.newrelic.sock"  pid=2008 ppid=2007 uid=0 euid=0 gid=0 egid=0 backtrace=no os="Linux" rel="3.2.0-58-virtual" mach="x86_64" ver="#88-Ubuntu SMP Tue Dec 3 17" node="ip-10-145-246-196" startup=agent]2014-03-23 05:30:41.069 (2008/main) info: RPM config: proto="https" collector="collector.newrelic.com" proxy="none" certfile="/etc/ssl/certs/ca-certificates.crt" certdir="/etc/ssl/certs"2014-03-23 05:35:14.928 (2008/connector) info: ["PHP Application"] "Reporting to: https://rpm.newrelic.com/accounts/232928/applications/3262356"2014-03-23 06:07:58.768 (2008/connector) info: ["My Blog 1"] "Reporting to: https://rpm.newrelic.com/accounts/232928/applications/3262424"</pre><p><i>PHP Application</i> все еще существует, но теперь у него есть друг, который является нашим блогом WordPress. И вот он в пользовательском интерфейсе:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/2/posts/20465/image/dashboard.jpg" alt="Как использовать New Relic с PHP и WordPress..." title="Как использовать New Relic с PHP и WordPress..." width="50" height="50"></figure><p>Теперь мы будем получать показатели при просмотре нашего блога, как для фронтенда, так и для интерфейса администратора. Так как New Relic поддерживает WordPress из коробки, метрики будут грамотно разделены (когда фреймворк не поддерживается, метрики будут сгруппированы вместе).<br></p><h2>Обновление агента и демонов<br></h2><p>New Relic - сложная часть программного обеспечения, и хорошо держать ее постоянно обновленной, поскольку ошибки исправляются регулярно, а новые функции добавляются. Поскольку мы установили все, используя <code class="inline">apt-get</code>, то будет очень просто обновиться. Мы просто делаем то же самое, что делали при установке:</p><pre class="brush: bash noskimlinks noskimwords">apt-get updateapt-get install newrelic-php5</pre><p>Если мы не установили еще один PHP в системе, нам просто нужно перезагрузить наш сервер, и мы на самой последней версии. Если есть новый PHP, нам может понадобиться перезапустить скрипт <code class="inline">newrelic-install</code>.</p><p>Это всего лишь одно предостережение. В определенных ситуациях вы можете запускать демон прокси-сервера New Relic отдельно от агента, а это означает, что перезапуск сервера автоматически не запускает демона, если он не работает (это называется режимом внешнего демона). Могут быть несколько причин, по которым вы хотели бы это сделать, например, вам может понадобиться, чтобы другой пользователь владел процессом демона, поэтому логи будут доступны только для этого пользователя. В этой ситуации вы должны помнить, что нужно перезапустить как сервер, так и демона прокси. Если вы этого не сделаете, вы увидите ошибки несоответствия протокола в логах.<br></p><h2>Вывод<br></h2><p>Как вы можете видеть, установка New Relic, настроенного для приложения PHP, сильно отличается от настройки для Ruby, ваше фактическое приложение даже не учитывает этот процесс, в то время как среда, в которой вы развертываете, является центральной. К счастью, это означает, что если вы используете какой-либо поддерживаемый фреймворк PHP, процесс настройки New Relic будет точно такой же. Помимо WordPress поддерживается большинство популярных фреймворков PHP, включая <span>Cake</span>, <span>Symphony</span> и <span>Laravel</span> (версия 4 и выше). Также возможно использовать New Relic и с неподдерживаемым фреймворком, но вам придется приложить некоторые серьезные усилия, чтобы получить метрику.<br></p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825523-kak-ispolzovat-new-relic-s-php-i-wordpress" class="tm-article-body__tags-item-link">Web Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
31893</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
703</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
