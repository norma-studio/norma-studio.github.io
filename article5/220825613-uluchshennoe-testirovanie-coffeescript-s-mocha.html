
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Недавно я занимался значительным количеством работы CoffeeScript. Одна из проблем, с которой я столкнулся в начале, было тестирование: я не хотел вручную преобразовывать свой CoffeeScript в JavaScript, прежде чем я смог бы его протестировать. Вместо этого я хотел протестировать с CoffeeScript напрямую. Как я это сделал? Читай дальше что бы узнать!...">
<meta property="og:description" content="Недавно я занимался значительным количеством работы CoffeeScript. Одна из проблем, с которой я столкнулся в начале, было тестирование: я не хотел вручную преобразовывать свой CoffeeScript в JavaScript, прежде чем я смог бы его протестировать. Вместо этого я хотел протестировать с CoffeeScript напрямую. Как я это сделал? Читай дальше что бы узнать!...">
<meta name="twitter:description" content="Недавно я занимался значительным количеством работы CoffeeScript. Одна из проблем, с которой я столкнулся в начале, было тестирование: я не хотел вручную преобразовывать свой CoffeeScript в JavaScript, прежде чем я смог бы его протестировать. Вместо этого я хотел протестировать с CoffeeScript напрямую. Как я это сделал? Читай дальше что бы узнать!...">
<meta property="aiturec:description" content="Недавно я занимался значительным количеством работы CoffeeScript. Одна из проблем, с которой я столкнулся в начале, было тестирование: я не хотел вручную преобразовывать свой CoffeeScript в JavaScript, прежде чем я смог бы его протестировать. Вместо этого я хотел протестировать с CoffeeScript напрямую. Как я это сделал? Читай дальше что бы узнать!...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/errors.png">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/errors.png">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/errors.png">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/errors.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/errors.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html" title="Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io" title="Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64535356345.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html" class="tm-user-info__username" title="
В. Чендылов" aria-label="
В. Чендылов">
В. Чендылов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Улучшенное тестирование CoffeeScript с-Mocha
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha" class="tm-article-snippet__hubs-item-link"><span>Web Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/errors.png">
    <meta itemprop="headline name" content="Улучшенное тестирование CoffeeScript с-Mocha
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Недавно я занимался значительным количеством работы CoffeeScript. Одна из проблем, с которой я столкнулся в начале, было тестирование: я не хотел вручную преобразовывать свой CoffeeScript в JavaScript, прежде чем я смог бы его протестировать. Вместо этого я хотел протестировать с CoffeeScript напрямую. Как я это сделал? Читай дальше что бы узнать!...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Недавно я занимался значительным количеством работы CoffeeScript. Одна из проблем, с которой я столкнулся в начале, было тестирование: я не хотел вручную преобразовывать свой CoffeeScript в JavaScript, прежде чем я смог бы его протестировать. Вместо этого я хотел протестировать с CoffeeScript напрямую. Как я это сделал? Читай дальше что бы узнать!...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Недавно я занимался значительным количеством работы <span>CoffeeScript</span>. Одна из проблем, с которой я столкнулся в начале, было тестирование: я не хотел вручную преобразовывать свой CoffeeScript в JavaScript, прежде чем я смог бы его протестировать. Вместо этого я хотел протестировать с CoffeeScript напрямую. Как я это сделал? Читай дальше что бы узнать!</p><p><!--more--></p> <div class="republished-shortcode"> <strong>Переизданный учебник</strong> <p>Каждые несколько недель мы пересматриваем некоторые из любимых статей нашего читателя на протяжении всей истории сайта. Этот учебник был впервые опубликован в ноябре 2012 года.</p> </div> <hr><blockquote class="pullquote"> <p>Вам необходимо установить <span>Node.js</span> и <span>Node Package Manager</span>.</p> </blockquote> <p>Прежде чем мы продолжим, я укажу, что вам нужно иметь приличное знание <span>CoffeeScript</span> для этого урока; Я не буду объяснять здесь мелкие кусочки кода. Если вы заинтересованы в CoffeeScript, вы должны ознакомиться со <span>статьями о CoffeeScript</span>, которые можно найти здесь, на Nettuts + или <span>документацией CoffeeScript</span>.</p> <p>Кроме того, для этого учебника вам понадобится Node.js и диспетчер пакетов node (npm). Если у вас их нет, не беспокойтесь: перейдите к <span>nodejs.org</span> и скачайте программу установки для своей платформы; и установите его!</p> <hr><h2>Встречаем Mocha и Chai</h2> <p>Мы будем строить начало приложения списка задач (клише, я знаю). Это будут классы CoffeeScript. Затем мы напишем некоторые тесты с <span>Mocha</span> и Chai, чтобы проверить эту функциональность.</p> <p>Почему и Mocha и Chai? Ну, Mocha - это среда тестирования, но она не включает в себя действительный компонент утверждений. Это может показаться странным: ведь в тестовой библиотеке не так много, не так ли? Ну, в случае Mocha есть. Функции, которые привели меня в библиотеку: возможность запуска тестов из командной строки (вместо того, чтобы иметь HTML-страницу для запуска их в браузере) и возможность запуска теста в CoffeeScripts без необходимости конвертировать этот код для JavaScript (как минимум вручную: Mocha делает все это за кулисами). Есть и другие особенности, о которых я не буду говорить, в том числе:</p> <ul><li>Вы можете легко протестировать асинхронный код.</li> <li>Вы можете следить за особенно медленными тестами.</li> <li>Вы можете выводить результаты в разных форматах.</li> </ul><p>И так далее. Подробнее см. <span>на домашней странице Mocha</span>. Чтобы установить Mocha, просто запустите <code>npm install -g mocha</code>, и готово.</p> <p>Что касается Chai: это отличная библиотека утверждений, которая предлагает интерфейсы для работы как <span>BDD</span>, так и <span>TDD</span>; вы можете использовать его как в браузере, так и в командной строке через node, так как мы будем использовать его сегодня. Установите его для node, с помощью команды <code>npm install -g chai</code>.</p> <p>Теперь, когда у нас установлены наши библиотеки, давайте начнем писать код.</p> <hr><h2>Настройка нашего проекта</h2> <p>Начнем с создания мини-проекта. Создайте папку проекта. Затем создайте еще две папки: <code>src</code> и <code>test</code>. Наш код CoffeeScript пойдет в папку <code>src</code>, и наши тесты, как вы догадались, в папку <code>tests</code>. Mocha по умолчанию ищет папку <code>test</code>.</p> <blockquote class="pullquote"> <p>По умолчанию Mocha ищет папку <code>test</code>.</p> </blockquote> <p>Мы собираемся создать два класса CoffeeScript: <code>Task</code>, который будет элементом todo, и <code>TaskList</code>, который будет списком предметов todo (да, это больше, чем массив). Мы поместим их оба в файл <code>src/task.coffee</code>. Тогда тесты для этого будут в <code>test/taskTest.coffee</code>. Конечно, мы могли бы разбить их на свои собственные файлы, но сегодня мы не собираемся этого делать.</p> <p>Мы должны начать с импорта библиотеки Chai и включения синтаксиса BDD. Вот как:</p> <pre class="brush: js noskimlinks noskimwords">chai = require "chai"chai.should()</pre> <p>Вызывая метод <code>chai.should</code>, мы фактически добавляем свойство <code>should</code> в <code>Object.prototype</code>. Это позволяет нам писать тесты, которые читаются следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">task.name.should.equal "some string"</pre> <p>Если вы предпочитаете синтаксис TDD, вы можете сделать это:</p> <pre class="brush: js noskimlinks noskimwords">expect = chai.expect</pre> <p>... что позволяет вам писать тесты следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">expect(task.name).to.equal "some string"</pre> <p>На самом деле нам придется использовать оба варианта, как вы увидите; однако мы будем использовать синтаксис BDD как можно чаще.</p> <p>Теперь нам нужно будет импортировать классы <code>Task</code> и <code>TaskList</code>:</p> <pre class="brush: js noskimlinks noskimwords">{TaskList, List} = require "../src/task"</pre> <p>Если вы не знакомы с этим синтаксисом, это деструктивное назначение CoffeeScript, а также некоторые из его объектов синтаксического сахара. В основном, наш вызов <code>require</code> возвращает объект с двумя свойствами, которые являются нашими классами. Эта строка вытаскивает их из этого объекта и дает нам две переменные с именем <code>Task</code> и <code>TaskList</code>, каждая из которых указывает на соответствующий класс.</p> <hr><h2>Написание наших первых тестов</h2> <p>Прекрасно! Теперь, как насчет теста? Красота синтаксиса Mocha заключается в том, что его блоки (<code>describe</code> и <code>it</code>) идентичны <span>Jasmine"s</span> (оба очень похожи на RSpec). Вот наш первый тест:</p> <pre class="brush: js noskimlinks noskimwords">describe "Task instance", -&gt;    task1 = task2 = null    it "should have a name", -&gt;        task1 = new Task "feed the cat"        task1.name.should.equal "feed the cat"</pre> <p>Начнем с вызова <code>describe</code>: все эти тесты предназначены для экземпляра Test. Установив <code>test1 = test2 = null</code> вне наших отдельных тестов, мы можем использовать эти значения для нескольких тестов.</p> <p>Затем, в нашем первом тесте, мы просто создаем задачу и проверяем, имеет ли ее свойство name правильное значение. Прежде чем писать код для этого, давайте добавим еще два теста:</p> <pre class="brush: js noskimlinks noskimwords">it "should be initially incomplete", -&gt;    task1.status.should.equal "incomplete"it "should be able to be completed", -&gt;    task1.complete().should.be.true    task1.status.should.equal "complete"</pre> <p>Хорошо, давайте проведем эти тесты, чтобы убедиться, что они терпят неудачу. Для этого откройте командную строку и <code>cd</code> в папку проекта. Затем запустите эту команду:</p> <pre class="brush: js noskimlinks noskimwords">mocha --compilers coffee:coffee-script</pre> <p>Mocha по умолчанию не проверяет CoffeeScript, поэтому мы должны использовать флаг <code>--compilers</code>, чтобы сообщить Mocha, какой компилятор использовать, если он найдет файл с расширением файла <code>coffee</code>. Вы должны получить ошибки, которые выглядят следующим образом:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/errors.png" alt="Улучшенное тестирование CoffeeScript с Mocha..." title="Улучшенное тестирование CoffeeScript с Mocha..." width="50" height="50"></div> <p>Если вместо этого вы получите ошибку <code>Cannot find module "../src/task"</code>, то это потому что ваш файл <code>src/task.coffee</code> еще не существует.  Создайте указанный файл, и вы должны получить указанную ошибку.</p> <hr><h2>Кодирование наших первых функций</h2> <p>Ну, теперь, когда у нас заканчиваются тесты, пришло время написать код, правильно? Откройте этот файл <code>src/task.coffee</code> и начнем.</p> <pre class="brush: js noskimlinks noskimwords">class Task    constructor: (@name) -&gt;</pre> <p>Просто этого достаточно, чтобы пройти наш первый тест. Если вы не знакомы с синтаксисом этого параметра, это просто устанавливает любое значение, переданное <code>new Task</code>, в свойство <code>@name</code> (или <code>this.name</code>). Однако добавим еще одну строку к этому конструктору:</p> <pre class="brush: js noskimlinks noskimwords">@status = "incomplete"</pre> <p>Хорошо. Теперь вернитесь в терминал и повторите тесты. Вы найдете это - подождите секунду, ничего не изменилось! Почему наши первые два теста не проходят?</p> <p>Напротив, простая проблема. Поскольку компилятор CoffeeScript обертывает код в каждом файле в <span>IIFE</span> (или самозаверяющей анонимной функции), нам нужно «экспортировать» все, что мы хотим получить из других файлов. В браузере вы бы сделали что-то вроде <code>window.Whatever = Whatever</code>. Для node можно использовать <code>global</code> или <code>exports</code>. Мы будем использовать <code>exports</code>, так как 1) это считается лучшей практикой, и 2) это то, что мы подготовили для настройки наших тестов (помните вызов <code>require</code>?). Поэтому, в конце нашего <code>файла task.coffee</code>, добавьте следующее:</p> <pre class="brush: js noskimlinks noskimwords">root = exports ? windowroot.Task = Task</pre> <p>При этом вы должны обнаружить, что два из наших трех тестов проходят:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/two_passing.png" alt="Улучшенное тестирование CoffeeScript с Mocha..." title="Улучшенное тестирование CoffeeScript с Mocha..." width="50" height="50"></div> <p>Чтобы пройти последний тест, нам нужно будет добавить метод <code>complete</code>. Попробуйте это:</p> <pre class="brush: js noskimlinks noskimwords">complete: -&gt;    @status = "complete"    true</pre> <p>Теперь все тесты проходят:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/all_passing.png" alt="Улучшенное тестирование CoffeeScript с Mocha..." title="Улучшенное тестирование CoffeeScript с Mocha..." width="50" height="50"></div> <p>Теперь самое время упомянуть, что у Mocha есть несколько различных отчетов: это просто разные способы вывода результатов теста. Вы можете запустить <code>mocha --reporters</code>, чтобы просмотреть свои варианты:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=445/net/uploads/legacy/2028_coffeeScriptAndMocha/reporters.png" alt="Улучшенное тестирование CoffeeScript с Mocha..." title="Улучшенное тестирование CoffeeScript с Mocha..." width="50" height="50"></div> <p>По умолчанию Mocha использует репортер точек. Тем не менее, я предпочитаю репортер спецификации, поэтому я использую <code>-R spec</code> в конце команды (<code>-R</code> - это флаг настройки репортера).</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=504/net/uploads/legacy/2028_coffeeScriptAndMocha/spec_reporter.png" alt="Улучшенное тестирование CoffeeScript с Mocha..." title="Улучшенное тестирование CoffeeScript с Mocha..." width="50" height="50"></div> <hr><h2>Добавление функции</h2> <p>Давайте добавим функцию в наш класс <code>Task</code>: мы будем задавать задачи в зависимости от других задач. Если «родительская» задача не завершена, «дочерняя» задача не может быть выполнена. Мы сделаем эту функцию простой и позволять задачам иметь только одну подзадачу. Мы также не будем проверять рекурсивность, так что, хотя можно будет установить две задачи как родительские и дочерние, то обе задачи будут неполными.</p> <p>Сначала тесты!</p> <pre class="brush: js noskimlinks noskimwords">it "should be able to be dependent on another task", -&gt;    task1 = new Task "wash dishes"    task2 = new Task "dry dishes"        task2.dependsOn task1    task2.status.should.equal "dependent"    task2.parent.should.equal task1    task1.child.should.equal task2it "should refuse completion it is dependent on an uncompleted task", -&gt;    (-&gt; task2.complete()).should.throw "Dependent task "wash dishes" is not completed."</pre> <p>У экземпляров <code>Task</code> будет метод <code>dependOn</code>, который задает задачу, которая станет их родителем. Задачи с родительской задачей должны иметь статус «зависимый». Также обе задачи получают либо <code>parent</code>, либо <code>child</code> свойство, которое указывает на соответствующий экземпляр задачи.</p> <p>Во втором тесте мы говорим, что задача с неполной родительской задачей должна вызывать ошибку при вызове ее метода <code>complete</code>. Обратите внимание, как работает тестовый синтаксис: нам нужно вызывать <code>should</code>, а не результат функции: поэтому мы завершаем функцию в круглых скобках. Таким образом, тестовая библиотека может вызывать функцию и проверять наличие ошибки.</p> <p>Запустите эти тесты, и вы увидите, что оба они не работают. Время писать код!</p> <pre class="brush: js noskimlinks noskimwords">dependsOn: (@parent) -&gt;    @parent.child = @    @status = "dependent"</pre> <p>Опять же, очень просто: мы просто устанавливаем параметр задачи родительской задаче и предоставляем ему дочернее свойство, которое указывает на <code>this</code> экземпляр задачи. Затем мы устанавливаем статус <code>this</code> задачи как «зависимый».</p> <p>Если вы запустите это сейчас, вы увидите, что один из наших тестов проходит, а второй - нет: это потому, что наш метод <code>complete</code> не проверяет незавершенную родительскую задачу. Давайте изменим это.</p> <pre class="brush: js noskimlinks noskimwords">complete: -&gt;    if @parent? and @parent.status isnt "completed"        throw "Dependent task "#{@parent.name}" is not completed."    @status = "complete"    true</pre> <p>Вот завершенный метод <code>complete</code>: если есть родительская задача, и она не завершена, мы выдаем ошибку. В противном случае мы выполним задачу. Теперь все тесты должны пройти.</p> <hr><h2>Создание TaskList</h2> <p>Затем мы создадим класс <code>TaskList</code>. Опять же, мы начнем с теста:</p> <pre class="brush: js noskimlinks noskimwords">describe "TaskList", -&gt;    taskList = null    it "should start with no tasks", -&gt;        taskList = new TaskList        taskList.tasks.length.should.equal 0        taskList.length.should.equal 0</pre> <p>Это к вам уже знакомо: мы создаем объект <code>TaskList</code> и проверяем его <code>tasks</code> и свойство <code>length</code>, чтобы убедиться, что оба они равны нулю. Как вы могли догадаться, <code>tasks</code> - это массив, который содержит задачи, а <code>length</code> - просто удобное свойство, которое мы будем обновлять при добавлении или удалении задач; это просто избавляет нас от необходимости писать <code>list.tasks.length</code>.</p> <p>Чтобы пройти этот тест, мы создадим этот конструктор:</p> <pre class="brush: js noskimlinks noskimwords">class TaskList    constructor: () -&gt;        @tasks = []        @length = 0</pre> <p>Хорошее начало, и наш тест проходит.</p> <p>Мы хотим иметь возможность добавлять задачи в список задач, правильно? У нас будет метод <code>add</code>, который может принимать либо экземпляр <code>Task</code>, либо строку, которая будет преобразована в экземпляр <code>Task</code>.</p> <p>Наши тесты:</p> <pre class="brush: js noskimlinks noskimwords">it "should accept new tasks as tasks", -&gt;    task = new Task "buy milk"    taskList.add task    taskList.tasks[0].name.should.equal "buy milk"    taskList.length.should.equal 1it "should accept new tasks as string", -&gt;    taskList.add "take out garbage"    taskList.tasks[1].name.should.equal "take out garbage"    taskList.length.should.equal 2</pre> <p>Во-первых, мы добавляем фактический объект <code>Task</code> и проверяем массив <code>taskList.tasks</code>, чтобы убедиться, что он был добавлен. Затем добавим строку и убедитесь, что объект <code>Task</code> с правильным именем был добавлен в массив <code>tasks</code>. В обоих случаях мы также проверяем длину <code>taskList</code>, чтобы убедиться, что она обновляется.</p> <p>И функция:</p> <pre class="brush: js noskimlinks noskimwords">add: (task) -&gt;    if typeof task is "string"        @tasks.push new Task task     else         @tasks.push task    @length = @tasks.length</pre> <p>Тут все довольно понятно. И теперь наши тесты проходят:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/tasklist_tests.png" alt="Улучшенное тестирование CoffeeScript с Mocha..." title="Улучшенное тестирование CoffeeScript с Mocha..." width="50" height="50"></div> <p>Конечно, мы могли бы удалить задачи из нашего списка, не так ли?</p> <pre class="brush: js noskimlinks noskimwords">it "should remove tasks", -&gt;    i = taskList.length - 1    taskList.remove taskList.tasks[i]    expect(taskList.tasks[i]).to.not.be.ok</pre> <p>Во-первых, мы называем метод <code>remove</code> (который еще не написан, конечно), передавая ему последнюю задачу, находящуюся в списке. Конечно, мы могли бы просто скопировать индекс <code>1</code>, но я сделал это так, потому что это делает этот тест гибким: если мы изменили наши предыдущие тесты или добавили больше тестов выше этого, это может измениться. Конечно, мы должны удалить последнюю, потому что иначе задача после нее займет свое место, и в этом индексе будет ничего не будет.</p> <p>И, говоря об ожиданиях, обратите внимание, что мы используем функцию <code>expect</code> и синтаксис здесь вместо нашего <code>should</code>. Это связано с тем, что <code>taskList.tasks[i]</code> будет <code>undefined</code>, что не наследуется от <code>Object.prototype</code>, и поэтому мы не можем использовать <code>should</code>.</p> <p>Ах, да, и нам все равно нужно написать эту функцию <code>remove</code>:</p> <pre class="brush: js noskimlinks noskimwords">remove: (task) -&gt;     i = @tasks.indexOf task    @tasks = @tasks[0...i].concat @tasks[i+1..] if i &gt; -1    @length = @tasks.length</pre> <p>Некоторая причудливая работа с массивом в сочетании с диапазонами CoffeeScript и сокращением сращивания массива и готово. Мы просто раскалываем все элементы перед тем, который нужно удалить, и все после него; мы <code>concat</code> эти два массива вместе. Конечно, мы обновим <code>@length</code> соответственно. Можете ли вы сказать «прохождение тестов»?</p> <p>Давайте сделаем еще одну вещь. Мы хотим напечатать наш (относительно) красивый список текущих задач. Это будет наш самый сложный (или, по крайней мере, наш самый длинный) тест:</p> <pre class="brush: js noskimlinks noskimwords">    it "should print out the list", -&gt;        taskList = new TaskList        task0 = new Task "buy milk"        task1 = new Task "go to store"        task2 = new Task "another task"        task3 = new Task "sub-task"        task4 = new Task "sub-sub-task"        taskList.add task0        taskList.add task1        taskList.add task2        taskList.add task3        taskList.add task4        task0.dependsOn task1        task4.dependsOn task3        task3.dependsOn task2        task1.complete()        desiredOutput = """Tasks- buy milk (depends on "go to store")- go to store (completed)- another task- sub-task (depends on "another task")- sub-sub-task (depends on "sub-task")"""        taskList.print().should.equal desiredOutput</pre> <p>Что тут происходит? Во-первых, мы создаем новый объект <code>TaskList</code>, чтобы начать с нуля. Затем мы создаем пять задач и добавляем их в <code>taskList</code>. Затем мы установили несколько зависимостей. Наконец, мы завершаем одну из наших задач.</p> <p>Мы используем синтаксис heredoc от CoffeeScript для создания многострочной строки. Как вы можете видеть, мы сохраняем это довольно простым. Если задача имеет родительскую задачу, она упоминается в скобках после имени задачи. Если задание будет завершено, мы также это сделаем.</p> <p>Готовы написать функцию?</p> <pre class="brush: js noskimlinks noskimwords">print: -&gt;    str = "Tasks\n\n"    for task in @tasks        str += "- #{task.name}"        str += " (depends on "#{task.parent.name}")" if task.parent?        str += " (complete)" if task.status is "complete"        str += "\n"    str</pre> <p>На самом деле это довольно просто: мы просто просматриваем массив <code>@tasks</code> и добавляем их в строку. Если у них есть родительский элемент, мы добавим это, и если они будут заполнены, мы добавим это тоже. Обратите внимание, что мы используем форму модификатора оператора <code>if</code>, чтобы затянуть наш код. Затем мы возвращаем строку.</p> <p>Теперь все наши тесты должны пройти:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/legacy/2028_coffeeScriptAndMocha/all_tests.png" alt="Улучшенное тестирование CoffeeScript с Mocha..." title="Улучшенное тестирование CoffeeScript с Mocha..." width="50" height="50"></div> <hr><h2>Подведем итоги</h2> <blockquote class="pullquote"> <p>Попробуйте добавить несколько функций, чтобы проверить все это.</p> </blockquote> <p>Это масштаб нашего маленького проекта на сегодня. Вы можете загрузить код в верхней части этой страницы; на самом деле, почему бы вам не попробовать добавить несколько функций, чтобы все это проверить? Вот несколько идей:</p> <ul><li>Предотвратить возможность экземпляров <code>Task</code> от зависимости друг от друга (рекурсивные зависимости).</li> <li>Сделать так чтобы метод <code>TaskList::add</code> кидал ошибку, если он получает что-то другое, кроме строки или объекта <code>Task</code>.</li> </ul><p>В эти дни я нахожу CoffeeScript все более привлекательным, но самым большим недостатком этого является то, что он должен быть скомпилирован в JavaScript до того, как он будет полезен. Я благодарен любым инструментам, которые помогают исключить этот этап из рабочего процесса, а Mocha определенно это делает. Конечно, все не идеально (поскольку он компилируется JS перед запуском кода, номера строк в ошибках не совпадают с вашими номерами строк в CoffeeScript), но это шаг в правильном направлении для меня!</p> <p>Как насчет вас? Если вы используете CoffeeScript, как вы тестируете код? Дайте мне знать в комментариях.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825613-uluchshennoe-testirovanie-coffeescript-s-mocha" class="tm-article-body__tags-item-link">Web Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
32700</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
423</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
