
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этом уроке мы глубоко погрузимся в OpenShift, чтобы понять процесс сборки и развертывания. Мы также изучим инструмент командной строки для ведения логов и устранения неполадок, когда наше приложение не работает....">
<meta property="og:description" content="В этом уроке мы глубоко погрузимся в OpenShift, чтобы понять процесс сборки и развертывания. Мы также изучим инструмент командной строки для ведения логов и устранения неполадок, когда наше приложение не работает....">
<meta name="twitter:description" content="В этом уроке мы глубоко погрузимся в OpenShift, чтобы понять процесс сборки и развертывания. Мы также изучим инструмент командной строки для ведения логов и устранения неполадок, когда наше приложение не работает....">
<meta property="aiturec:description" content="В этом уроке мы глубоко погрузимся в OpenShift, чтобы понять процесс сборки и развертывания. Мы также изучим инструмент командной строки для ведения логов и устранения неполадок, когда наше приложение не работает....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/build_phase.png">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/build_phase.png">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/build_phase.png">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/build_phase.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/build_phase.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html" title="Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io" title="Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/636536435.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html" class="tm-user-info__username" title="
С. Торгашев" aria-label="
С. Торгашев">
С. Торгашев</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Запуск WordPress на OpenShift Часть 2...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2" class="tm-article-snippet__hubs-item-link"><span>WordPress</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/build_phase.png">
    <meta itemprop="headline name" content="Запуск WordPress на OpenShift Часть 2... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этом уроке мы глубоко погрузимся в OpenShift, чтобы понять процесс сборки и развертывания. Мы также изучим инструмент командной строки для ведения логов и устранения неполадок, когда наше приложение не работает....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этом уроке мы глубоко погрузимся в OpenShift, чтобы понять процесс сборки и развертывания. Мы также изучим инструмент командной строки для ведения логов и устранения неполадок, когда наше приложение не работает....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этом уроке мы глубоко погрузимся в OpenShift, чтобы понять процесс сборки и развертывания. Мы также изучим инструмент командной строки для ведения логов и устранения неполадок, когда наше приложение не работает.</p><p>Мы также рассмотрим некоторые бонусные советы, чтобы использовать функции SSH, предлагаемые OpenShift. Кроме того, мы рассмотрим, как синхронизировать наше локальное окружение с удаленным окружением, включая базу данных, исходные файлы и медиафайлы.</p><p><span>Первая часть этой серии</span> дала краткий обзор OpenShift. Мы обсудили, как создать приложение, получить URL-адрес сервера, имя нашей учетной записи и настроить собственный домен. </p><p>Мы выполнили почти все эти задачи, используя веб-интерфейс, который является большим и очень удобным; однако, помимо панели управления, OpenShift предлагает мощный клиентский <b>rhc client</b>. Мы можем вызвать его из командной строки для выполнения администрирования и обслуживания OpenShift. После того, как вы установили инструмент, вы можете создавать приложения, добавлять картриджи и быстро добавлять gear. Это швейцарский армейский нож. Возможно, вам это не понадобится, но это очень удобно.<br></p><h2>Установка клиента командной строки OpenShift</h2><p>В документации OpenShift очень четко сказано об <span>установке этой клиентской библиотеки</span>. Библиотека написана на Ruby, поэтому убедитесь, что у вас установлен Ruby. В принципе, вам нужно только установить <span>rhc gem</span> на Mac или Linux. Вероятнее всего Git и Ruby уже установлены, поэтому вам нужно всего лишь запустить:</p><pre class="noskimlinks noskimwords"><code>sudo gem install rhc</code></pre><p>Затем настройте его с вашим именем пользователя и паролем. Когда вас попросят <b>сгенерировать токен</b>? Введите «<b>Yes</b>».<br></p><pre class="brush: bash noskimlinks noskimwords"><code>rhc setup<br></code># Once it"s done, you should see something similar:<br>Saving configuration to /Users/kureikain/.openshift/express.conf ... doneChecking for git ... found git version 1.8.5.2 (Apple Git-48)Checking common problems .. doneChecking for a domain ... tutsplusChecking for applications ... found 2  demo2 https://demo2-tutsplus.rhcloud.com/  php   http://php-tutsplus.rhcloud.com/  You are using 3 of 3 total gears  The following gear sizes are available to you: smallYour client tools are now configured.<p></p></pre><p>Теперь, когда у нас установлена утилита, давайте немного поиграем с ней. </p><p>Прежде всего следует отметить, что команда <code class="inline">rhc</code> предоставит вам список доступных команд. Вы можете получить их список с помощью <code class="inline">rhc help</code>. Он показывает краткий обзор каждой команды. Команда <code class="inline">rhc help command_name</code> покажет вам, как использовать определенную команду.</p><pre class="brush: bash noskimlinks noskimwords">$ rhc help<br>Getting started:  setup              Connects to OpenShift and sets up your keys and domain  create-app         Create an application  apps               List all your applications  cartridges         List available cartridges  add-cartridge      Add a cartridge to your application  set-env            Set one or more environment variable(s) to your application  logout             End the current sessionWorking with apps:  tail               Tail the logs of an application  port-forward       Forward remote ports to the workstation  threaddump         Trigger a thread dump for JBoss and Ruby apps  snapshot           Save the current state of your application locally  git-clone          Clone and configure an application"s repository locallyManagement commands:  account            Display details about your OpenShift account  alias              Add or remove a custom domain name for an app  app                Commands for creating and managing applications  authorization      Manage your authorization tokens  cartridge          Manage your application cartridges  deployment         Commands for deploying and managing deployments of an                     application  domain             Add or rename the container for your apps  env                Manages user-defined environment variables set on a given                     application  member             Manage membership on domains  server             Display information about the status of the OpenShift                     service  ssh                SSH into the specified application  sshkey             Add and remove keys for Git and SSH<p>$ rhc help app</p><p>Usage: rhc app &lt;action&gt;</p><p>Creates and controls an OpenShift application.  To see the list of all applications use the rhc domain show command.  Note that delete<br>is not reversible and will stop your application and then remove the application and repo from the remote server. No local changes are<br>made.</p><p>List of Actions<br>  configure     Configure several properties that apply to an application<br>  create        Create an application<br>  delete        Delete an application from the server<br>  deploy        Deploy a git reference or binary file of an application<br>  force-stop    Stops all application processes<br>  reload        Reload the application"s configuration<br>  restart       Restart the application<br>  scale-down    Scale down the application"s web cartridge<br>  scale-up      Scale up the application"s web cartridge<br>  show          Show information about an application<br>  start         Start the application<br>  stop          Stop the application<br>  tidy          Clean out the application"s logs and tmp directories and tidy up the git repo on the server</p><p></p></pre><p>Для команды, которая взаимодействует с приложением, вы должны указать имя приложения с помощью <code class="inline">-a appname</code> или просто добавить имя приложения; однако, если вы запускаете команды внутри своего репозитория Git, который вы клонировали раньше, вы можете опустить его. Имя приложения можно увидеть с помощью команды <code class="inline">rhc app</code>. Пример с моим предыдущим приложением <i>demo2</i>. Вместо того, чтобы вводить в него имя учетной записи и имя сервера в SSH, я могу использовать эту команду:</p><br><pre class="brush: plain noskimlinks noskimwords">$ rhc ssh demo2# Output Connecting to 532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com ...</pre><br><p>Иногда может быть полезно запустить развертывание без какого-либо пуша. Предположим, мы хотим развернуть WordPress из определенного Git-commit или специальной ветки. </p><p>См. следующий пример:</p><pre class="brush: bash noskimlinks noskimwords"># Deploy branch master on demo2 app$ rhc app-deploy master -a demo2# Deploy bracch branch/deploy on demo2 app$ rhc app-deploy branch/deploy -a demo2</pre><br><p>Или показать информацию о приложении:</p><br><pre class="brush: bash noskimlinks noskimwords">demo2 [master] ⚡ rhc app-show demo2demo2 @ http://demo2-tutsplus.rhcloud.com/ (uuid: 532bd7655004468bcf0000e1)---------------------------------------------------------------------------  Domain:          tutsplus  Created:         Mar 20 11:08 PM  Gears:           1 (defaults to small)  Git URL:         ssh://532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com/~/git/demo2.git/  Initial Git URL: https://github.com/openshift/wordpress-example.git  SSH:             532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com  Deployment:      auto (on git push)  Aliases:         openshift.axcoto.com  mysql-5.5 (MySQL 5.5)  ---------------------    Gears:          Located with php-5.4, phpmyadmin-4    Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/    Database Name:  demo2    Password:       DyANqgKAFbTT    Username:       adminL1GxwjI  php-5.4 (PHP 5.4)  -----------------    Gears: Located with mysql-5.5, phpmyadmin-4  phpmyadmin-4 (phpMyAdmin 4.0)  -----------------------------    Gears:          Located with mysql-5.5, php-5.4    Connection URL: https://demo2-tutsplus.rhcloud.com/phpmyadmin/</pre><p>Вы также можете сохранить снимок текущего приложения:</p><pre class="brush: bash noskimlinks noskimwords">$ rhc snapshot-save demo2Pulling down a snapshot to demo2.tar.gz...Creating and sending tar.gzRESULT:Success</pre><p>Или вы можете добавить некоторые картриджи:</p><pre class="brush: plain noskimlinks noskimwords"># add mysql-5.5 cartridge into our app$ rhc cartridge add -a demo2 -c mysql-5.1# add php5-4  cartridge into our app$ rhc cartridge add -a demo2 -c php-5.4</pre><p>Конечно, не стесняйтесь экспериментировать с несколькими различными командами. Все довольно наглядно и легко понять, и поскольку все находится под системой контроля версий, легко отменить изменения.</p><h2>Что происходит, когда вы делаете пуш в свой репозиторий?</h2><p>В первой статье мы увидели, что всякий раз, когда запускается <code class="inline">git push</code> для развертывания ветви, приложение будет развернуто. Согласно <span>документации OpenShift</span>, вот что происходит:<br></p><ol><li>Вы запускаете <code class="inline">git push</code> на своем компьютере, ваши изменения отправляются в приложение OpenShift</li> <li>Приложение останавливается</li> <li>Ваши изменения скопированы на сервере в правильное место</li> <li>OpenShift вызывает ваши хуки сборки - файлы сценариев, которые вы разместили в своем репозитории Git</li> <li>Ваше приложение запускается <br></li> </ol><p>Шаг 4 - это обработка файлов сценариев в вашем .openshift / action_hooks. OpenShift выполнит эти файлы сценариев, которые будут проверены в вашем репозитории Git в определенных точках процесса развертывания. </p><p> Если соответствующий файл сценария не существует, процесс развертывания будет продолжаться в обычном режиме. Опять же, все хуки должны быть помещены в каталог <code>.openshift/action_hooks/</code> в репозитории приложений. Отдельные этапы каждой сборки:</p><ol><li> <strong>Предварительное получение</strong>. Во время вашего пуша OpenShift проверяет, поддерживает ли ваше приложение согласованное состояние. Для этого шага нет никакого хука.<br></li> <li> <strong>Pre-Build</strong>. Это происходит после того, как приложение остановлено, и новый репозиторий был развернут, но до сборки. Запускает сценарий <code>.openshift/action_hooks/pre_build</code></li> <li> <strong>Сборка</strong>. Этот шаг создает ваше приложение, загружает необходимую зависимость, выполняет скрипт <code>.openshift/action_hooks/build</code> и подготавливает все для развертывания. В WordPress мы не используем этот шаг, поскольку WordPress просто нужно заглянуть в корневой каталог документа и запустить веб-сервер, никаких специальных требований к сборке. Обычно мы используем этот хук для загрузки WordPress и извлекаем его в правильное место на OpenShift.<br></li> <li> <strong>Развертывание</strong>. Этот шаг происходит прямо перед запуском приложения. Любая необходимая подготовительная работа для того, чтобы приложение было готово к запуску, должна выполняться в <code>.openshift/action_hooks/deploy hook</code>. В рамках WordPress мы используем этот хук, чтобы скопировать данные вышеуказанной сборки в корень документа, скопировать плагин и тему (<code class="inline">.openshift/themes и .openshift/plugin</code>) в нужное место.<br></li> <li> <strong>Пост-Deploy</strong>. Некоторым приложениям может потребоваться взаимодействие с запущенным приложением для завершения процесса развертывания. После запуска приложения будет запущен хук <code>.openshift/action_hooks/post_deploy</code>. <br></li> </ol><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/build_phase.png" alt="Запуск WordPress на OpenShift Часть 2..." title="Запуск WordPress на OpenShift Часть 2..." width="50" height="50"></figure><p>Вы можете полностью настроить эти сценарии для своих целей. Сценарии сборки выполняются напрямую, то есть вы можете писать их на любом языке, независимо от того, что это Bash, Ruby или Python, если вы ставите правильный <span>shebang,</span> например если вы используете bash.</p><pre class="brush: bash noskimlinks noskimwords">#!/bin/bash</pre>Или Ruby<br><pre class="brush: bash noskimlinks noskimwords">#!/usr/bin/ruby</pre><p>Я предпочитаю писать простой скрипт Bash для целей сборки, и я буду использовать его в этом уроке. Bash есть где угодно, и его синтаксис настолько прост, что вам на самом деле и не нужно знать Bash, чтобы понять некоторые сценарии.</p><p>Что касается WordPress, мы не выполняем много задач в процессе сборки, потому что PHP не требует ее; однако мы используем этот процесс сборки для подготовки некоторых данных. Файл <code class="inline">.openshift/action_hooks/build</code> проверяет, создан ли WordPress на OpenShift, если он не загрузит WordPress с WordPress.org, создайте необходимый каталог, извлеките и скопируйте содержимое исходных файлов WordPress в нужное место. Со второго развертывания скрипт сборки почти ничего не делает, потому что WordPress установлен. Чтобы настроить скрипт сборки, нам нужно знать переменные среды.</p><h2>Переменные среды OpenShift</h2><p>Во время процесса сборки и документирования нам нужно знать некоторые данные OpenShift, такие как корневой путь документа, путь данных и имя приложения. Эта информация доступна в переменных окружения, для которых <span>здесь</span> есть полный список.</p><p>Некоторые переменные, которые мы будем использовать часто, следующие:</p><ol><li> <b>OPENSHIFT_HOMEDIR</b>. путь к домашней директории. На вашем локальном компьютере Linux у вас будет домашний каталог пользователя в <code class="inline">/home/username</code> или в Mac OS X это <code class="inline">/Users/username</code>. Домашний каталог - это папка, в которой вы будете находиться, когда вы заходите удаленно через SSH. Это <code class="inline">/var/ lib/openshift/user_account_id</code>. Например, мой собственный <code class="inline">/var/lib/openshift/532bd7655004468bcf0000e1</code>. </li> <li> <b>OPENSHIFT_REPO_DIR</b>. <code class="inline">$OPENSHIFT_HOMEDIR/app-root/runtime/repo/</code>.  Репозиторий, содержащий текущую развернутую версию (приложения). Это то же самое, что и в вашем репозитории на вашем локальном компьютере, за исключением того, что папка <b>php</b> теперь является символической ссылкой на документ root; поэтому <code class="inline">$OPENSHIFT_REPO_DIR/php</code> может использоваться в скрипте сборки для ссылки на корневой каталог документа. <br></li> <li> <b>OPENSHIFT_DATA_DIR</b>. $OPENSHIFT_HOMEDIR/app-root/data/ </li> <li> <b>OPENSHIFT_APP_UUID</b>. Уникальный идентификатор вашего приложения в OpenShift. UUID может быть очень удобен, когда вы начинаете генерировать пути.</li> </ol><p>Мы обращаемся к этой переменной в нашем скрипте сборки с переменной <code class="inline">$variable_name</code>.<br></p><h2>Процесс выборочной сборки и развертывания</h2><p>Остановимся на нашей текущей структуре репозитория:<br></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/hook.png" alt="Запуск WordPress на OpenShift Часть 2..." title="Запуск WordPress на OpenShift Часть 2..." width="50" height="50"></figure><p>Мы начнем с действия <i>Hello World</i>, поэтому у нас будет представление о том, что будет выводиться, когда и как мы настраиваем скрипт сборки.<br></p><h3>Ваш Hello World Build </h3><p>Давайте добавим это <code class="inline">echo "Hello world. This is invoked before building."</code> в ваш <code class="inline">./openshift/pre_build</code></p><pre class="brush: bash noskimlinks noskimwords">$ echo "echo \"Hello world. This is invoke before building.\"" &gt;&gt; .openshift/action_hooks/pre_build</pre>Сделайте пуш в репозиторий, и вы увидите следующий вывод:<br><pre class="brush: bash noskimlinks noskimwords">$ git add .openshift/action_hooks/pre_build$ git commit -m "Hello world for pre_build"$ git pushCounting objects: 9, done.Delta compression using up to 4 threads.Compressing objects: 100% (5/5), done.Writing objects: 100% (5/5), 411 bytes | 0 bytes/s, done.Total 5 (delta 4), reused 0 (delta 0)remote: Stopping MySQL 5.5 cartridgeremote: Stopping PHP 5.4 cartridge (Apache+mod_php)remote: Waiting for stop to finishremote: Stopping PHPMyAdmin cartridgeremote: Waiting for stop to finishremote: Building git ref "master", commit 1f4ef8a<b>remote: Hello world. This is invoke before building</b>remote: Checking .openshift/pear.txt for PEAR dependency..remote: Do we need to run WordPress installremote: Preparing build for deploymentremote: Deployment id is d06b1d4aremote: Activating deploymentremote: Starting MySQL 5.5 cartridgeremote: Starting PHPMyAdmin cartridgeremote: Hello world. This is invoke when deployingremote: Copying WordPress plugins from .openshift/pluginsremote: Copying WordPress themes from .openshift/themesremote: Database already configured.remote: Starting PHP 5.4 cartridge (Apache+mod_php)remote: Application directory "php/" selected as DocumentRootremote: Hello world. This is invoke after deployingremote: -------------------------remote: Git Post-Receive Result: successremote: Activation status: successremote: Deployment completed with status: successTo ssh://532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com/~/git/demo2.git/   1e7ad85..1f4ef8a  master -&gt; master</pre>Как вы видите, наше сообщение появляется во время процесса сборки. Теперь давайте сделаем реальную копию файлов во время процесса сборки.<br><h3>Копирование файла в корне документов</h3><p>Если вы вспомните предыдущий шаг, файлы в <code class="inline">.openshift/themes</code> и <code class="inline">.openshift/plugins</code> будут скопированы в <code class="inline">wp-content/themes</code> и <code class="inline">wp-content/plugins</code>. Предположим, мы хотим сделать то же самое для копирования файла в корень документа. </p><p>Вы хотите создать под папку <code class="inline">resume</code> и поместить в нее файл <code class="inline">resume/my_resume.txt</code> и сделать его доступным через <code class="inline">demo2-tutsplus.rhc-cloud.com/resume/my_resume.txt</code>. Давайте создадим каталог для хранения данных, которые мы скопируем в корень документа. Мы создаем <b>docroot</b> для вызова папки внутри <code class="inline">.openshift</code> и все, что внутри него будет скопировано. </p><p>Откроем <code class="inline">.openshift/action_hooks/deploy</code>, выделим строку 49 (я делаю ее полужирным)</p><pre class="brush: bash noskimlinks noskimwords">#!/bin/bash# This deploy hook gets executed after dependencies are resolved and the# build hook has been run but before the application has been started back# up again.  This script gets executed directly, so it could be python, php,# ruby, etc.echo "Hello world. This is invoke when deploying"dest_dir=${OPENSHIFT_DATA_DIR}currentcurrent_version=$(cat ${OPENSHIFT_BUILD_DEPENDENCIES_DIR}.current_version)install_dir=${OPENSHIFT_BUILD_DEPENDENCIES_DIR}${current_version}if [ ! -d "${dest_dir}" ]; then  mkdir -p $dest_dir  cp -rf ${install_dir}/* ${dest_dir}/fi# Replace the php/ directory with provided clean Wordpress installation#if [ -d ${OPENSHIFT_REPO_DIR}php ]; then  rm -rf ${OPENSHIFT_REPO_DIR}phpfiln -sf ${dest_dir} ${OPENSHIFT_REPO_DIR}phpif [ ! -d ${OPENSHIFT_DATA_DIR}uploads ]; then    mkdir ${OPENSHIFT_DATA_DIR}uploadsfi# If this is initial installation, copy the default themes and plugins# from official Wordpress installation#if [ ! -d ${OPENSHIFT_DATA_DIR}plugins ]; then  mv ${dest_dir}/wp-content/plugins ${OPENSHIFT_DATA_DIR}pluginsfiif [ ! -d ${OPENSHIFT_DATA_DIR}themes ]; then  mv ${dest_dir}/wp-content/themes ${OPENSHIFT_DATA_DIR}themesfi# Users can place their own plugins and themes into .openshift/ directory# inside their GIT repository.#echo "Copying WordPress plugins from .openshift/plugins"<b>cp -rf $OPENSHIFT_REPO_DIR/.openshift/plugins/* ${OPENSHIFT_DATA_DIR}plugins/ 2&gt;/dev/null</b>echo "Copying WordPress themes from .openshift/themes"<b>cp -rf $OPENSHIFT_REPO_DIR/.openshift/themes/* ${OPENSHIFT_DATA_DIR}themes/ 2&gt;/dev/null</b><br><b># We will copy file here</b><br><b>echo "Copying custom file from .openshift/docroot"</b><b>cp -rf $OPENSHIFT_REPO_DIR/.openshift/docroot/* ${OPENSHIFT_REPO_DIR}php/<br></b># Add multisite upload dir#if [ ! -d $OPENSHIFT_DATA_DIR/blogs.dir ]; then    mkdir $OPENSHIFT_DATA_DIR/blogs.dirfiln -sf ${OPENSHIFT_DATA_DIR}blogs.dir ${OPENSHIFT_REPO_DIR}php/wp-content/ln -sf ${OPENSHIFT_DATA_DIR}plugins   ${OPENSHIFT_REPO_DIR}php/wp-content/ln -sf ${OPENSHIFT_DATA_DIR}themes    ${OPENSHIFT_REPO_DIR}php/wp-content/ln -sf ${OPENSHIFT_DATA_DIR}uploads   ${OPENSHIFT_REPO_DIR}php/wp-content/set -eif [ -z "$OPENSHIFT_MYSQL_DB_HOST" ]then    echo 1&gt;&amp;2    echo "Could not find mysql database.  Please run:" 1&gt;&amp;2    echo "rhc cartridge add -a $OPENSHIFT_APP_NAME -c mysql-5.1" 1&gt;&amp;2    echo "then make a sample commit (add whitespace somewhere) and re-push" 1&gt;&amp;2    echo 1&gt;&amp;2fiif [ -z "$OPENSHIFT_MYSQL_DB_HOST" ]then    exit 5fi# Confirm database exists, if not create itif ! /usr/bin/mysql -u "$OPENSHIFT_MYSQL_DB_USERNAME" --password="$OPENSHIFT_MYSQL_DB_PASSWORD" -h "$OPENSHIFT_MYSQL_DB_HOST" -P "$OPENSHIFT_MYSQL_DB_PORT" -e "select * from wp_commentmeta;" "$OPENSHIFT_APP_NAME" &gt; /dev/null 2&gt;&amp;1then    echo    echo "Database schema not yet added, WordPress is ready for install by visiting the site."else    echo "Database already configured."fi</pre><p>После этого мы добавили эту команду.</p><pre class="brush: bash noskimlinks noskimwords"># We will copy file hereecho "Copying custom file from .openshift/docroot"cp -rf $OPENSHIFT_REPO_DIR/.openshift/docroot/* ${OPENSHIFT_REPO_DIR}php/</pre><p>Строка с # является комментарием, для нашей собственной ссылки. echo-строка - это просто вывод некоторых результатов. Реальная команда, которую мы использовали, - это <span>cp</span>, чтобы рекурсивно копировать все файлы и папки.</p><p>Теперь добавьте что-нибудь в <code class="inline">.openshift/docroot</code> и разверните приложение.</p><pre class="brush: bash noskimlinks noskimwords">☁  demo2 [master] ⚡ mkdir -p .openshift/docroot/resume/☁  demo2 [master] ⚡ echo "Hi there" &gt; .openshift/docroot/resume/my_resume.txt☁  demo2 [master] ⚡ git add .openshift/☁  demo2 [master] ⚡ git commit -m "Custom hook for file copy"[master 46235a2] Custom hook for file copy 3 files changed, 7 insertions(+), 1 deletion(-) create mode 100644 .openshift/docroot/hi.txt☁  demo2 [master] git pushCounting objects: 13, done.Delta compression using up to 4 threads.Compressing objects: 100% (6/6), done.Writing objects: 100% (8/8), 723 bytes | 0 bytes/s, done.Total 8 (delta 4), reused 0 (delta 0)remote: Stopping MySQL 5.5 cartridgeremote: Stopping PHP 5.4 cartridge (Apache+mod_php)remote: Waiting for stop to finishremote: Stopping PHPMyAdmin cartridgeremote: Waiting for stop to finishremote: Waiting for stop to finishremote: Waiting for stop to finishremote: Waiting for stop to finishremote: Waiting for stop to finishremote: Waiting for stop to finishremote: Building git ref "master", commit 46235a2remote: Hello world. This is invoke before buildingremote: Checking .openshift/pear.txt for PEAR dependency..remote: Do we need to run WordPress installremote: Preparing build for deploymentremote: Deployment id is fe0803a9remote: Activating deploymentremote: Starting MySQL 5.5 cartridgeremote: Starting PHPMyAdmin cartridgeremote: Hello world. This is invoke when deployingremote: Copying WordPress plugins from .openshift/pluginsremote: Copying WordPress themes from .openshift/themesremote: Copying custom file from .openshift/docrootremote: Database already configured.remote: Starting PHP 5.4 cartridge (Apache+mod_php)remote: Application directory "php/" selected as DocumentRootremote: Hello world. This is invoke after deployingremote: -------------------------remote: Git Post-Receive Result: successremote: Activation status: successremote: Deployment completed with status: successTo ssh://532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com/~/git/demo2.git/   1f4ef8a..46235a2  master -&gt; master☁  demo2 [master] curl http://openshift.axcoto.com/resume/my_resume.txtHi there☁  demo2 [master]</pre><br><h4>Ваше упражнение</h4><p>Используйте папку <code class="inline">php</code> в вашем репозитории, чтобы сохранить этот контент, вместо того, чтобы вводить <code class="inline">.openshift/docroot</code>. <br></p><h4>Подсказка</h4><p><code class="inline">app-deployments/current/repo</code> содержит точно такую же копию вашего репозитория. Все, что у вас есть на вашей локальной машине, будет здесь.<br></p><h2>Устранение неполадок и поддержка</h2><p>В предыдущей части вы знали, как получить удаленный доступ к вашему приложению с SSH. Как только вы входите, вы можете использовать команды Linux. <br></p><pre class="brush: plain noskimlinks noskimwords">$ ssh 532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com</pre><p>Тем не менее, rhc поставляется с командой ssh, позволяющей подключиться к приложению. Быстро и легко запомнить.<br></p><pre class="brush: bash noskimlinks noskimwords">$ rhc ssh demo2</pre><br><p>Здесь вы всегда можете использовать <code class="inline">help</code> для отображения доступных команд.</p><ol><li> <b>tail_all</b>: вывод всего вашего лога. Вы можете видеть ведение лога в реальном времени с помощью этой команды для всех gear в системе: например, журнал доступа Apache, журнал ошибок MySQL.<br></li> <li> <b>mysql</b> выводит вас в оболочку MySQL. Очень удобное сравнение с вводом длинной команды mysql с именем хоста, пользовательской строкой и паролем. <br></li> <li> <b>export</b> показать все текущие переменные среды. Во время работы со скриптом сборки вы можете использовать эту команду, чтобы просмотреть список доступных переменных среды.<br></li> <li> <b>gear</b> для управления вашим gear: запуск, остановка, перезагрузка. Так вы можете перезапустить apache, остановите mysql.</li> <li> <b>snapshot</b> полностью резервирует ваш текущий WordPress со всеми файлами, дампом базы данных и мультимедийными данными. Очень хороший способ получить полную резервную копию вашего сайта.<br></li> <li> <b>quota</b> покажите свою дисковую квоту. Полезно, когда вы больше не можете загружать в WordPress, может закончиться свободное место.</li> </ol><h3>Как сделать снимок</h3><p><code class="inline">rhc snapshot-save demo2</code> делает дамп вашей базы данных, сжимает медиа-файл и исходный код, собирает tar-файл и загружает его для вас. </p><pre class="brush: plain noskimlinks noskimwords">$ rhc snapshot-save demo2Pulling down a snapshot to demo2.tar.gz...Creating and sending tar.gz$ ls | grep tar.gzdemo2.tar.gz</pre><p>По умолчанию создается файл tar с тем же именем, что и ваше приложение. Храните его где-нибудь на всякий случай. После сохранения моментального снимка вы также можете восстановить его.</p><pre class="brush: plain noskimlinks noskimwords">$ rhc snapshot-restore demo2Restoring from snapshot demo2.tar.gz...Removing old git repo: ~/git/demo2.git/Removing old data dir: ~/app-root/data/*Restoring ~/git/demo2.git and ~/app-root/data</pre><h3>Проверка состояния gear</h3><p>Команда <code class="inline">gear</code> управляет состоянием картриджа, запуском/остановкой. Когда например вы получаете ошибку таймаута при посещении вашего домена, или ошибку 404, 503 или ошибку базы данных. Вы должны использовать SSH в своем приложении и проверить статус gear:</p><pre class="brush: bash noskimlinks noskimwords">[demo2-tutsplus.rhcloud.com 532bd7655004468bcf0000e1]\&gt; gear status<br>Cart to get the status for?<br>1. mysql-5.5<br>2. php-5.4<br>3. phpmyadmin-4<br>?  2<br>ATTR: status=ALREADY_STOPPED<br>ATTR: quota_blocks=1048576<br>ATTR: quota_files=80000<br>CLIENT_RESULT: Application is either stopped or inaccessible<br>[demo2-tutsplus.rhcloud.com 532bd7655004468bcf0000e1]\&gt;<br></pre><p>Если он говорит, что CLIENT_RESULT <i>Application is either stopped or inaccessible</i>, я должен начать с:</p><pre class="brush: bash noskimlinks noskimwords">[demo2-tutsplus.rhcloud.com 532bd7655004468bcf0000e1]\&gt; gear start --cart php-5.4Starting PHP 5.4 cartridge (Apache+mod_php)Application directory "php/" selected as DocumentRoot[demo2-tutsplus.rhcloud.com 532bd7655004468bcf0000e1]\&gt;<p></p></pre><pre class="brush: bash noskimlinks noskimwords"><br># Confirm it"s working now<br>[demo2-tutsplus.rhcloud.com 532bd7655004468bcf0000e1]\&gt; gear statusCart to get the status for?1. mysql-5.52. php-5.43. phpmyadmin-4?  2ATTR: quota_blocks=1048576ATTR: quota_files=80000CLIENT_RESULT: Application is runningCLIENT_RESULT: %<br>[demo2-tutsplus.rhcloud.com 532bd7655004468bcf0000e1]\&gt;</pre>Следующим шагом будет просмотр вашего файла с логами.<br><h3>Ведение логов</h3><p><b>tail_all</b> покажет вам логи картриджей в реальном времени. Однако, если вы хотите посмотреть отдельный лог, то вот список:</p><ol><li> <code class="inline">php/logs</code> логи посещей и ошибок Apache и MySQL</li> <li> <code class="inline">mysql/log</code> MySQL логи<br></li> </ol><h3>Перенаправление порта</h3><p>Команда <code>rhc port-forwar</code>d может помочь вам установить локальное соединение с вашим размещенным сервисом (веб-сервер, сервер базы данных ...). OpenShift автоматически проверяет доступные порты в локальной системе и перенаправляет их на удаленный порт запущенного сервиса. Через переадресацию портов вы можете работать на локальном компьютере, но соединение пересылается на удаленную машину. </p><p>Давайте попробуем с MySQL.<br></p><pre class="brush: bash noskimlinks noskimwords">$ rhc port-forward demo2Checking available ports ... doneForwarding ports ...Address already in use - bind(2) while forwarding port 8080. Trying local port 8081Address already in use - bind(2) while forwarding port 3306. Trying local port 3307To connect to a service running on OpenShift, use the Local addressService Local               OpenShift------- -------------- ---- ----------------httpd   127.0.0.1:8080  =&gt;  127.2.126.1:8080httpd   127.0.0.1:8081  =&gt;  127.2.126.3:8080mysql   127.0.0.1:3307  =&gt;  127.2.126.2:3306Press CTRL-C to terminate port forwarding</pre><p>У меня был порт 8080 и 3306 для разных приложений. Поэтому OpenShift выбрал <b>3307</b> для MySQL. Теперь я могу использовать учетные данные MySQL для подключения к нему с помощью Sequel Pro. Если вы забыли свой пароль, вы можете получить его снова на панели управления OpenShift или SSH на сервере и выпустить:</p><pre class="brush: bash noskimlinks noskimwords">[demo2-tutsplus.rhcloud.com 532bd7655004468bcf0000e1]\&gt; export | grep MYSQLdeclare -x OPENSHIFT_MYSQL_DB_HOST="127.2.126.2"declare -x OPENSHIFT_MYSQL_DB_LOG_DIR="/var/lib/openshift/532bd7655004468bcf0000e1/mysql//log/"declare -x OPENSHIFT_MYSQL_DB_PASSWORD="DyANqgKAFbTT"declare -x OPENSHIFT_MYSQL_DB_PORT="3306"declare -x OPENSHIFT_MYSQL_DB_SOCKET="/var/lib/openshift/532bd7655004468bcf0000e1/mysql//socket/mysql.sock"declare -x OPENSHIFT_MYSQL_DB_URL="mysql://adminL1GxwjI:DyANqgKAFbTT@127.2.126.2:3306/"declare -x OPENSHIFT_MYSQL_DB_USERNAME="adminL1GxwjI"declare -x OPENSHIFT_MYSQL_DIR="/var/lib/openshift/532bd7655004468bcf0000e1/mysql/"declare -x OPENSHIFT_MYSQL_IDENT="redhat:mysql:5.5:0.2.9"declare -x OPENSHIFT_MYSQL_LD_LIBRARY_PATH_ELEMENT="/opt/rh/mysql55/root/usr/lib64"</pre><p>Использование <span>Sequel Pro</span> для подключения. </p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/sql_1.jpg" alt="Запуск WordPress на OpenShift Часть 2..." title="Запуск WordPress на OpenShift Часть 2..." width="50" height="50"><figcaption>Благодаря переадресации портов вы можете легко подключиться к приложению с помощью программы GUI</figcaption><br></figure><h2>Синхронизация локальных и живых окружений</h2><p>Все любят разрабатывать на локальной машине, а не загружать на сервер для тестирования или оценки функции. Вы можете экспортировать данные с хоста и импортировать на локальный компьютер для этой цели, как в<span> этом руководстве</span>. Однако этот процесс экспорта раздражает. Данные могут быть большими, занимать все больше и больше времени при экспорте/импорте. Исправлять баги также при этом довольно трудно. Если ошибка возникает только на конкретной странице на реальном сайте, ее может быть сложно отладить в локальной среде. <br></p><p>Или, если вы - удаленная команда, и ваша команда создала множество тестовых сообщений на промежуточной/тестовой площадке (хостинг на OpenShift), будет хорошо, если у вас есть хороший способ просто синхронизировать все, особенно данные изображений ,<br></p><p>Поэтому я предлагаю метод для достижения этого с помощью: переадресации портов и редактирования файлов хоста. Используя переадресацию портов, как мы видели выше, мы можем легко получить доступ к MySQL с локальной машины. С помощью редактирования файла хоста мы можем указать домен <span>openshift.axcoto.com</span> на локальный компьютер, а не на OpenShift. В нашем клоне репозитория у нас есть пустая папка <code class="inline">php</code>. При развертывании эта папка заменяется символической ссылкой на document root Apache. Теперь мы будем использовать эту папку в качестве document root на нашей локальной машине. Вспомните структуру репозитория еще раз, на моем компьютере.</p><pre class="brush: bash noskimlinks noskimwords">☁  demo2 [master] ⚡ pwd/Users/kureikain/Sites/demo2☁  demo2 [master] ⚡ ls -latotal 24drwxr-xr-x  10 kureikain  staff   340 Mar 21 00:39 .drwxr-xr-x@ 57 kureikain  staff  1938 Mar 21 00:38 ..drwxr-xr-x  16 kureikain  staff   544 Mar 28 01:20 .git-rw-r--r--   1 kureikain  staff     9 Mar 21 00:39 .gitignoredrwxr-xr-x  11 kureikain  staff   374 Mar 25 23:42 .openshift-rw-r--r--   1 kureikain  staff  2243 Mar 21 00:39 README-rw-r--r--   1 kureikain  staff  2201 Mar 21 00:39 README.mddrwxr-xr-x   3 kureikain  staff   102 Mar 21 00:39 libsdrwxr-xr-x   3 kureikain  staff   102 Mar 21 00:39 miscdrwxr-xr-x   7 kureikain  staff   238 Mar 28 01:05 php</pre><p>Обратите внимание, что для достижения успеха в этом методе вы должны добавить все, что у вас есть в wp-content/plugins (по умолчанию плагины WordPress 3.8.1) и wp-content/themes (по умолчанию темы WordPress 3.8.1) в OpenShift в ваш репозиторий Git. Вы можете загрузить его через scp или SFTP, как мы обсудили в предыдущей статье, или вы можете просто загрузить по умолчанию из WordPress. </p><p>Просто убедитесь, что ваш локальный репозиторий <code class="inline">.openshift/themes</code> и <code class="inline">.openshift/plugins</code> имеют тот же контент что и папки <code class="inline">wp-content/themes</code> и <code class="inline">wp-content/plugins</code> приложения WordPress в OpenShift.<br></p><h3>Шаг 1: Переадресация портов</h3><p>Используя команду<code class="inline"> rhc port-forward demo2</code>, где <b>demo2</b> - мое приложение. Измените его на свое имя приложения.<br></p><h3>Шаг 2. Виртуальный хост</h3><p>Используя Apache, мы добавим еще одну запись для нашей точки домена в папку, содержащую наш WordPress. В зависимости от вашей ОС у вас может быть другое местоположение для конфигурации Apache. Это может быть <code class="inline">/etc/apache2</code> или <code class="inline">/etc/httpd</code>. </p><p>Например, на моем Mac это <code class="inline">/etc/apache2</code>. Я добавлю код ниже в свой <code class="inline">/etc/apache2/httpd.conf</code>, или <code class="inline">/etc/apache2/extra/httpd-vhosts.conf</code>, в зависимости от вашей ОС или того, где вы предпочитаете. <br></p><pre class="brush: plain noskimlinks noskimwords">&lt;VirtualHost *:80&gt;    ServerName openshift.axcoto.com    DocumentRoot "/Users/kureikain/Sites/demo2/php"    &lt;Directory "/Users/kureikain/Sites/demo2/php"&gt;      Order allow,deny      Allow from all    &lt;/Directory&gt;&lt;/VirtualHost&gt;<br></pre>Если вы не знакомы с Apache и Virtual host, вот некоторые статьи, которые вам помогут немного разобраться:<br><ol><li><span>https://code.tutsplus.com/articles/apache-2-basic-configuration-on-unix-like-systems--net-26607</span></li> <li><span>http://code.tutsplus.com/articles/how-to-setup-a-wordpress-development-environment-for-windows--wp-2...</span></li> <li><span>http://code.tutsplus.com/tutorials/wordpress-development-and-deployment-with-mamp-git-and-dropbox--w...</span></li> </ol><h3>Шаг 3: Переменная среды<br></h3><p>При запуске на вашем локальном компьютере у вас не будет доступной переменной окружения. Мы должны их где-то определить. Для простого запуска я предпочитаю поместить эту переменную непосредственно в конфигурационный файл Apache с помощью <span>SetEnv</span>. </p><p>Наш виртуальный хост становится:</p><pre class="brush: bash noskimlinks noskimwords">&lt;VirtualHost *:80&gt;<br>    SetEnv OPENSHIFT_SECRET_TOKEN  "kCsELz-GJnho4I0M9XemTiZ47Jn4_QCSONFL5We8zw3Tgg572ivNEQQgZeIKQkTo2kE&gt;<br>    SetEnv OPENSHIFT_APP_UUID 532bd7655004468bcf0000e1<br>    <br>    SetEnv OPENSHIFT_APP_NAME demo2    SetEnv OPENSHIFT_MYSQL_DB_USERNAME adminL1GxwjI    SetEnv OPENSHIFT_MYSQL_DB_PASSWORD DyANqgKAFbTT    SetEnv OPENSHIFT_MYSQL_DB_HOST "127.0.0.1"    SetEnv OPENSHIFT_MYSQL_DB_PORT 3307    ServerName openshift.axcoto.com    ServerAdmin webmaster@dummy-host2.example.com    DocumentRoot "/Users/kureikain/Sites/demo2/php"    &lt;Directory "/Users/kureikain/Sites/demo2/php"&gt;      Order allow,deny      Allow from all    &lt;/Directory&gt;        ErrorLog "/var/log/apache2/openshift.axcoto.com-error_log"    CustomLog "/var/log/apache2/openshift.axcoto.com-access_log" common&lt;/VirtualHost&gt;</pre>Я захватываю переменную среды OpenShift и просто помещаю ее в наш файл конфигурации. Но я меняю хост MySQL на 127.0.0.1 и порт MySQL на 3307, потому что раньше мы уже настроили этот порт.<h3>Шаг 4: Изменение файла хоста</h3><p><b>openshift.axcoto.com</b> настроен на OpenShift. Однако мы можем переопределить его, непосредственно отредактировав <code class="inline">/etc/hosts</code>. Откройте этот файл в любимом редакторе и добавьте <br></p><pre class="brush: plain noskimlinks noskimwords">127.0.0.1    openshift.axcoto.com</pre>Подтвердите, что он указывает на нашу локальную машину.<p></p><pre class="brush: bash noskimlinks noskimwords">☁  ~  ping openshift.axcoto.comPING openshift.axcoto.com (127.0.0.1): 56 data bytes64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.055 ms64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.165 ms^C--- openshift.axcoto.com ping statistics ---2 packets transmitted, 2 packets received, 0.0% packet lossround-trip min/avg/max/stddev = 0.055/0.110/0.165/0.055 ms</pre><p>Если вы хотите посетить реальное приложение OpenShift, закомментируйте эту строку в /etc/hosts. Поместите «#», чтобы закомментировать:</p><pre class="brush: plain noskimlinks noskimwords"># 127.0.0.1     openshift.axcoto.com</pre>Затем openshift.axcoto.com снова укажет на сайт.<h3>Шаг 5: Вытяните файлы WordPress и синхронизируйте медиа с реальным сайтом</h3><p>Наконец, мы должны скопировать медиа и файлы WordPress в нашу локальную среду. Мы также создаем символическую ссылку для указания <code class="inline">php/wp-content/themes</code> на <code class="inline">.openshift/theme</code>. Эта же концепция применяется для плагинов, <code class="inline">php/wp-content/plugins</code>, которые указывают на <code class="inline">.openshift/plugins</code>. Таким образом, мы можем работать над .openshift/themes и <code class="inline">.openshift/plugins</code> и обновлять браузер, чтобы увидеть наши изменения. <br></p><pre class="brush: bash noskimlinks noskimwords">$ cd php$ rm -rf ./*<br># make snapshot to the specified file name.<br>$ rhc snapshot save demo2 --filepath snap.tar.gz<br># extract it<br>$ tar xzf snap.tar.gz<br># we got it now<br>$ ls532bd7655004468bcf0000e1    snap.tar.gz<p># the 532bd7655004468bcf0000e1 is out extracted snapshot# it can be different on you app.$ cp -rf 532bd7655004468bcf0000e1/app-root/data/current/*<br># link the themes folder$ ln -s `pwd`/../.openshift/themes wp-content/themes<br>#link the plugin folder<br>$ ln -s `pwd`/../.openshift/plugins wp-content/plugins# Link .openshift folder itself because it has some special thing inside<br>$ ln -s `pwd`/../.openshift .openshift</p><p># copy upload files$ cp -rf 532bd7655004468bcf0000e1/app-root/data/uploads wp-content# clean up$ rm -rf 532bd7655004468bcf0000e1 snap.tar.gz</p></pre><p>В первый раз, когда вы хотите синхронизировать данные, вы запускаете эти команды; однако, поскольку второй раз мы не хотим вытаскивать все файлы. Лучшим вариантом является только файл загрузки sync. Мы можем сделать это с помощью <span>scp</span>:<br></p><pre class="brush: bash noskimlinks noskimwords">$ cd ~/Site/demo2/php$ scp -r 532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com:app-root/data/uploads wp-content/</pre><p>Или с <span>rsync</span>. Rsync намного лучше, потому что он загружает только не существующие файлы.</p><pre class="brush: bash noskimlinks noskimwords">$ cd ~/Site/demo2/php<br>$ rsync -av --partial --progress  --rsh="ssh " 532bd7655004468bcf0000e1@demo2-tutsplus.rhcloud.com:app-root/data/uploads wp-content</pre><p>Вы можете пойти еще дальше, поместить эти команды в сценарий оболочки и отслеживать их с помощью своего репозитория Git. Я оставлю эту часть для вас :)</p><p>Вы можете игнорировать файл внутри php, потому что этот файл предназначен только для нашего собственного тестирования/работы на локальном компьютере. Не нужно отслеживать их.</p><pre class="brush: bash noskimlinks noskimwords">$ echo "php/*" &gt;&gt; .gitignore</pre><h3>Шаг 6: Администрирование через SSL (необязательно)<br></h3><p>Файл <code class="inline">wp-config.php</code>, сгенерированный OpenShift, предназначенный для обслуживания <span>администратора через SSL</span></p><pre class="brush: php noskimlinks noskimwords">&lt;?php// wp-config.php//.../** * We prefer to be secure by default */define("FORCE_SSL_ADMIN", true);</pre>На вашем компьютере у вас обычно нет сертификата SSL. Вы можете отредактировать <code class="inline">wp-config.php</code> и установить <code class="inline">FORCE_SSL_ADMIN</code> в false. Если вам нужен вызов, и вы хотите попробовать запустить SSL-соединение, то вот инструкция. <p></p><h4>Создание SSL сертификата</h4><p>Это самоподписной сертификат, означающий, что браузер не доверяет ему. Это нормально, потому что мы все равно работаем на локальном уровне, и вы можете просто добавить исключение, когда браузер выдает предупреждение.</p><pre class="brush: plain noskimlinks noskimwords">$ sudo mkidr -p /etc/apache2/ssl# make sure you type correct domain$ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt</pre><p>Мы создаем папку <code class="inline">/etc/apache2/ssl</code>, затем сгенерируем сертификат и ключ в эту папку. Мы установим apache в эти два файла позже.<br></p><h4>Определение входа в виртуальный хост<br></h4><p>Откройте файл <code class="inline">/etc/apache/httpd.conf</code> (опять же, ваш файл конфигурации Apache может находиться в другой папке, например <code class="inline">/etc/httpd</code>), найдите строку <code class="inline">Listen 80</code> и добавьте <code class="inline">Listen 443</code></p><pre class="brush: plain noskimlinks noskimwords">Listen 80Listen 443</pre><p>В верхней части вашего <code class="inline">/etc/apache2/extra/httpd-vhost.conf</code> найдите строку <code class="inline">NameVirtualHost *: 80</code> и добавьте </p><pre class="brush: plain noskimlinks noskimwords">NameVirtualHost *:443</pre><p>Затем мы определяем еще одну запись в виртуальном хосте для порта 443. Мы просто дублируем предыдущее определение с портом 80, но на этот раз мы добавляем определение SSL. <br></p><pre class="brush: bash noskimlinks noskimwords">&lt;VirtualHost *:443&gt;    SetEnv OPENSHIFT_SECRET_TOKEN  "kCsELz-GJnho4I0M9XemTiZ47Jn4_QCSONFL5We8zw3Tgg572ivNEQQgZeIKQkTo2kEwUHWjpsO7fhy1FeVqDlyRzSsKg6-fWNDWJaj9hO65nwVqE5auj35R2F9RNvEk"    SetEnv OPENSHIFT_APP_UUID 532bd7655004468bcf0000e1    SetEnv OPENSHIFT_APP_NAME demo2    SetEnv OPENSHIFT_MYSQL_DB_USERNAME adminL1GxwjI    SetEnv OPENSHIFT_MYSQL_DB_PASSWORD DyANqgKAFbTT    SetEnv OPENSHIFT_MYSQL_DB_HOST "127.0.0.1"    SetEnv OPENSHIFT_MYSQL_DB_PORT 3307    ServerName openshift.axcoto.com    ServerAdmin webmaster@dummy-host2.example.com    DocumentRoot "/Users/kureikain/Sites/demo2/php"    &lt;Directory "/Users/kureikain/Sites/demo2/php"&gt;      Order allow,deny      Allow from all    &lt;/Directory&gt;        ErrorLog "/var/log/apache2/openshift.axcoto.com-error_log"    CustomLog "/var/log/apache2/openshift.axcoto.com-access_log" common    SSLEngine On    SSLCertificateFile /etc/apache2/ssl/apache.crt    SSLCertificateKeyFile /etc/apache2/ssl/apache.key    &lt;Location /&gt;        SSLRequireSSL On        SSLVerifyClient optional        SSLVerifyDepth 1        SSLOptions +StdEnvVars +StrictRequire    &lt;/Location&gt;&lt;/VirtualHost&gt;</pre><br>Обратите внимание на путь к файлу сертификата SSL. Перезапустите Apache с помощью команды sudo apachectl restart. Теперь вы можете получить доступ к панели управления через SSL. Вот моя установка WordPress, работающая полностью локально с той же базой данных с реального сайта, и данные мультимедиа синхронизируются.<br><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/162/posts/19947/image/apache_ssl.jpg" alt="Запуск WordPress на OpenShift Часть 2..." title="Запуск WordPress на OpenShift Часть 2..." width="50" height="50"></figure><h2>Вывод</h2><p>В течение этой серии мы получили много знаний об OpenShift. Вы сможете легко установить и настроить WordPress на OpenShift. С помощью удобного клиента <code class="inline">rhc</code> вы можете быстро настроить или просмотреть информацию о приложении с терминала. </p><p>Мы также рассмотрели сборку и развертывание сценариев, чтобы вы могли настроить приложение под свои нужды, например, показывать специальный баннер и отправлять сообщение в HipChat во время развертывания. Вы даже можете синхронизировать данные между вашим локальным компьютером и OpenShift. Надеюсь, вам понравится этот учебник и OpenShift. </p><p>Оставляя комментарий, сообщите нам, как ваши успехи. Если у вас возникнут проблемы, сообщите мне в комментарии, я бы хотел вам помочь.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825502-zapusk-wordpress-na-openshift-chast-2" class="tm-article-body__tags-item-link">WordPress</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
31085</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
738</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
