
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Добро пожаловать! Я знаю, что прошло некоторое время с тех пор, как я добавил нашу серию API Twitter. Я был немного занят. Сначала была опухоль головного мозга, затем роботизированная радиохирургия, затем продолжающаяся серия программирования на Yii и, наконец, запуск Meeting Planner....">
<meta property="og:description" content="Добро пожаловать! Я знаю, что прошло некоторое время с тех пор, как я добавил нашу серию API Twitter. Я был немного занят. Сначала была опухоль головного мозга, затем роботизированная радиохирургия, затем продолжающаяся серия программирования на Yii и, наконец, запуск Meeting Planner....">
<meta name="twitter:description" content="Добро пожаловать! Я знаю, что прошло некоторое время с тех пор, как я добавил нашу серию API Twitter. Я был немного занят. Сначала была опухоль головного мозга, затем роботизированная радиохирургия, затем продолжающаяся серия программирования на Yii и, наконец, запуск Meeting Planner....">
<meta property="aiturec:description" content="Добро пожаловать! Я знаю, что прошло некоторое время с тех пор, как я добавил нашу серию API Twitter. Я был немного занят. Сначала была опухоль головного мозга, затем роботизированная радиохирургия, затем продолжающаяся серия программирования на Yii и, наконец, запуск Meeting Planner....">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/final_image/twitteroauth.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/final_image/twitteroauth.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/final_image/twitteroauth.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/final_image/twitteroauth.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/final_image/twitteroauth.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html" title="Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io" title="Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/65404fb3f3f8602d7f5b3bdc85cbef02.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html" class="tm-user-info__username" title="
А. Крайнов" aria-label="
А. Крайнов">
А. Крайнов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Работа с API Twitter: создание друзей для подписки...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Twitter" href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski" class="tm-article-snippet__hubs-item-link"><span>Twitter</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/final_image/twitteroauth.jpg">
    <meta itemprop="headline name" content="Работа с API Twitter: создание друзей для подписки... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Добро пожаловать! Я знаю, что прошло некоторое время с тех пор, как я добавил нашу серию API Twitter. Я был немного занят. Сначала была опухоль головного мозга, затем роботизированная радиохирургия, затем продолжающаяся серия программирования на Yii и, наконец, запуск Meeting Planner....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Добро пожаловать! Я знаю, что прошло некоторое время с тех пор, как я добавил нашу серию API Twitter. Я был немного занят. Сначала была опухоль головного мозга, затем роботизированная радиохирургия, затем продолжающаяся серия программирования на Yii и, наконец, запуск Meeting Planner....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Добро пожаловать! Я знаю, что прошло некоторое время с тех пор, как я добавил нашу серию <span>API Twitter</span>. Я был немного занят. Сначала была <span>опухоль головного мозга</span>, затем <span>роботизированная радиохирургия</span>, затем <span>продолжающаяся серия программирования на Yi</span>i и, наконец, запуск <span>Meeting Planner</span>.</p><p>Я решил написать сегодняшнее руководство по работе с Twitter API для создания друзей (то, что Twitter называет людей, на которых вы подписаны).</p><p>Зачем? Ну, странные президентские выборы в США в 2016 году выявили некоторые из злоупотреблений и преследований, которые каждый день происходят в Твиттере. Оказалось, что компания мало сделала для фильтрации, и, как программисты, мы знаем, что это не так сложно. Она наверно просто боялась потерять свою аудиторию от ненавистных прискорбных поступлений, которые влекут за собой значительную долю доходов от рекламы.</p><p>Многие женщины покинули Twitter из-за постоянных преследований, за которые иногда приносят извинения Twitter, заявляя, что пытаются разрешить свободное выражение. Честно говоря, нет свободы выражения, когда оскорбительное преследование присутствует бесконечно.<br></p><p>Там также были статьи, в которых подчеркивается,<span> сколько последователей людей являются преимущественно мужчинами</span>. В то время как Twitter не спрашивает у пользователей их пол, он статистически анализирует пол для своих рекламодателей. </p><p>И вы можете посмотреть демографические оценки Твиттер-рекламы на своих <span>страницах аналитики</span>. Как вы можете видеть ниже, Твиттер оценивает, что 69 процентов моих последователей - мужчины.<br></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/image/analytics.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"></figure><p>Скорее всего то, что голоса женщин гораздо труднее найти в Twitter. Но они там есть. Pew <span>сообщает</span>, что 21% женщин-пользователей Интернета используют Twitter, а 25% интернет-пользователей - мужчин.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/image/pew%20research.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"></figure><p>Поэтому сегодня я продемонстрирую вам использование фреймворка Yii2 для PHP, чтобы получить доступ к API Twitter и автоматизировать добавление друзей в учетные записи пользователей Twitter. (<em>Если вы хотите узнать больше о Yii2, ознакомьтесь с нашей параллельной</em> <span>серией Программирование на Yii2</span>.)</p><p>И я создал веб-сайт <span>Twixxr.com</span>, который позволит вам продемонстрировать эту функцию, добавив видных женщин в Twitter, на которых бы смог подписаться ваш аккаунт.<br></p><p>Если у вас есть какие-либо вопросы или замечания, отправьте их ниже в комментариях или обратитесь ко мне на Twitter <span>@reifman</span>.</p><h2>Оглядываясь назад: Учебники по API Twitter</h2><p>Хотя в прошлом я написал несколько учебников по API Twitter, все они были основаны на коде Yii 1.x. Yii2 давно отсутствует, и хотя я писал об аутентификации OAuth, я не писал об аспектах API для вашей собственной учетной записи и / или от имени аутентифицированных учетных записей для обновленной инфраструктуры. И это было нелегко - для Twitter пока еще нет хороших плагинов Yii2.</p><p>Вот некоторые из моих прошлых обучающих программ:<br></p><ul class="roundup-block__contents posts--half-width roundup-block--list"><li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/317/posts/22192/preview_image/preview-a-2.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Twitter API</div> <div class="roundup-block__content-title">Работа с API Twitter: начало работы</div> <div class="roundup-block__author">Jeff Reifman</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/317/posts/22193/preview_image/preview-b.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"><div class="roundup-block__primary-category topic-code">PHP</div> <div class="roundup-block__content-title">Работа с API Twitter: OAuth, Чтение и публикация</div> <div class="roundup-block__author">Jeff Reifman</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/317/posts/22194/preview_image/preview-stream.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"><div class="roundup-block__primary-category topic-code">PHP</div> <div class="roundup-block__content-title">Работа с API Twitter: использование потоков в реальном времени</div> <div class="roundup-block__author">Jeff Reifman</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/317/posts/22490/preview_image/preview.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"><div class="roundup-block__primary-category topic-code">PHP</div> <div class="roundup-block__content-title">Работа с API Twitter: повторение твитов из группы</div> <div class="roundup-block__author">Jeff Reifman</div></span></li> <li class="roundup-block__content"><span><img class="lazy07" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/317/posts/22459/preview_image/preview.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"><div class="roundup-block__primary-category topic-code">Twitter API</div> <div class="roundup-block__content-title">Работа с API Twitter: Tweet Storms</div> <div class="roundup-block__author">Jeff Reifman</div></span></li> </ul><p>Сегодняшнее руководство поможет вам не только использовать OAuth для аутентификации учетных записей посетителей сайта, но также покажет вам, как добавить друзей в свою учетную запись, используя доступ, который они вам предоставляют. </p><h2>Использование PHP-библиотеки TwitterOAuth</h2><p>К сожалению, я не смог найти надежное рабочее расширение Twitter API для Yii2, поэтому я использовал обобщенную библиотеку <span>PHP OAuth PHP</span>, чтобы создать свою собственную модель Twitter.</p><p>Многие сложные API-интерфейсы не обеспечивают хорошей документации, и я высоко оценил пошаговое руководство по использованию TwitterOAuth. Оно невероятно полезно:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/image/twitteroauth.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"></figure><h2>Цели обслуживания продуктов<br></h2><p><span>Сервис Twixxr</span> будет аутентифицировать посетителей сайта, а затем автоматически добавлять новых друзей в свои учетные записи. Друзья будут выбраны из более чем 600 влиятельных женщин, <span>которых я нашел в Twitter</span>:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/image/twixxr%20home%20page.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"></figure><p>Давайте начнем с кода.</p><h3>Аутентификация пользователя</h3><p>Мой TwitterController.php имеет два основных метода: Request и Return. Вот метод Request:</p><pre class="brush: php noskimlinks noskimwords">public function actionRequest()  {    if (Yii::$app-&gt;user-&gt;isGuest) {      // user has not logged in to yii site      $t = new Twitter();      $url = $t-&gt;getAuthorizeUrl();      $this-&gt;redirect($url);    } else {      // already verified with us, look up their access keys      $t = new Twitter();      $t-&gt;refreshConnection(Yii::$app-&gt;user-&gt;getId());      $this-&gt;goHome();    }  }</pre><p>Модель Twitter.php вызывается в<code class="inline"> new Twitter()</code>; Получает уникальный <code class="inline">getAuthorizeURL()</code> для перенаправления посетителя сайта на страницу аутентификации Twitter, например. <span>https://api.twitter.com/oauth/authorize?oauth_token=q-7ChxxxxxxxxnpXAAABzzzzzzz6E:</span></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/317/posts/27492/image/oauthorize.jpg" alt="Работа с API Twitter: создание друзей для подписки..." title="Работа с API Twitter: создание друзей для подписки..." width="50" height="50"></figure><p>Как только пользователь авторизует ваше приложение в Twitter, он перенаправляется обратно в наш метод Return:</p><pre class="brush: php noskimlinks noskimwords">public function actionReturn()    {      // returning from authentication        /* If the oauth_token is old redirect to the connect page. */        if (isset($_REQUEST["oauth_token"]) &amp;&amp; Yii::$app-&gt;session["oauth_token"] !== $_REQUEST["oauth_token"]) {            Yii::$app-&gt;session["oauth_status"] = "oldtoken";            return $this-&gt;goHome();        }        $t = new Twitter();        $user_id = $t-&gt;getConnection($_REQUEST["oauth_verifier"]);        $person = new \common\models\User;        $identity = $person-&gt;findIdentity($user_id);        $u = User::findOne($user_id);        if ($identity-&gt;validateAuthKey($u-&gt;auth_key)) {            Yii::$app-&gt;user-&gt;login($identity);        }        $this-&gt;redirect(["twixxr/amplify"]);            }</pre><p>Модель Twitter использует ваш consumer key приложения и consumer secret, который вы получаете при <span>регистрации в сервисе</span>:</p><pre class="brush: plain noskimlinks noskimwords">&lt;?phpnamespace frontend\models;use Yii;use yii\base\Model;use common\models\User;use frontend\models\Auth;use Abraham\TwitterOAuth\TwitterOAuth;/** * This is the model class for table "payment". * * @property integer $id * @property integer $user_id * @property string $amount * @property integer $created_at * @property integer $updated_at * * @property User $user */class Twitter extends Model {   public $consumerKey;   public $consumerSecret;   public $connection;  public function init() {    $this-&gt;consumerKey = Yii::$app-&gt;components["authClientCollection"]["clients"]["twitter"]["consumerKey"];    $this-&gt;consumerSecret = Yii::$app-&gt;components["authClientCollection"]["clients"]["twitter"]["consumerSecret"];  }</pre><p>Метод Return, показанный выше, затем регистрирует пользователя и сохраняет свои долгосрочные ключи доступа к учетной записи - это позволяет вам неограниченно делать вызовы API от их имени:</p><pre class="brush: php noskimlinks noskimwords">public function getConnection($oauth_verifier="") {    $connection = new TwitterOAuth($this-&gt;consumerKey, $this-&gt;consumerSecret,Yii::$app-&gt;session["oauth_token"],Yii::$app-&gt;session["oauth_token_secret"]);    /* Create TwitteroAuth object with app key/secret and token key/secret from default phase */    $access_token = $connection-&gt;oauth("oauth/access_token", ["oauth_verifier" =&gt; $oauth_verifier]);    /* Save the access tokens. Normally these would be saved in a database for future use. */    $user_id=$this-&gt;register($access_token);    //Yii::$app-&gt;session["access_token"] = $access_token;    /* Remove no longer needed request tokens */    unset(Yii::$app-&gt;session["oauth_token"]);    unset(Yii::$app-&gt;session["oauth_token_secret"]);    $this-&gt;connection = new TwitterOAuth($this-&gt;consumerKey, $this-&gt;consumerSecret, $access_token["oauth_token"], $access_token["oauth_token_secret"]);    return $user_id;  }  public function register($access_token) {      $screen_name = $access_token["screen_name"];      $source_id = $access_token["user_id"];      $user = User::find()-&gt;where(["username"=&gt;$screen_name])-&gt;one();      if (is_null($user)) {        // sign them up        $user = new User();        $user-&gt;username = $screen_name;        $user-&gt;email = $screen_name."@twixxr.com";        $user-&gt;setPassword(Yii::$app-&gt;security-&gt;generateRandomString(12));        $user-&gt;generateAuthKey();        $user-&gt;save();      }      $auth = Auth::find()-&gt;where(["source_id"=&gt;$source_id])-&gt;one();      if (is_null($auth)) {        // add an auth entry        $auth = new Auth();        $auth-&gt;user_id = $user-&gt;id;        $auth-&gt;source = "twitter";        $auth-&gt;source_id = $source_id;        $auth-&gt;screen_name = $user-&gt;username;        $auth-&gt;oauth_token = $access_token["oauth_token"];        $auth-&gt;oauth_token_secret = $access_token["oauth_token_secret"];        $auth-&gt;x_auth_expires =0;        $auth-&gt;save();      } else {        $auth-&gt;oauth_token = $access_token["oauth_token"];        $auth-&gt;oauth_token_secret = $access_token["oauth_token_secret"];        $auth-&gt;update();      }      return $user-&gt;id;    }</pre><p>Для получения доступа на чтения и запись к их учетным записям я расширяю таблицу Auth от простого доступа к аутентификации, которая описана в нашей серии «<span>Упрощение Onramp с помощью OAuth</span>», чтобы включить эти дополнительные ключи проверки.</p><p>Я также рекомендую вам шаг за шагом пройти в живую  <span>TwitterOAuth</span>. Это отличный пример, показывающий все в действии с вашей собственной учетной записью Twitter.</p><h3>Импорт имен, биографии профиля и фотографий</h3><p>Затем я создал модель Twixxr.php, которая предоставляет множество важных функций, специфичных для сервиса. Во-первых, я создал <code class="inline">Twixxr::loadProfiles()</code> для синхронизации имен, биографий и счетчиков, связанных с Twitter, например. Фотографии профиля, статусные сообщения, подписчики для каждой женщины, указанной в моей статической базе данных.</p><pre class="brush: php noskimlinks noskimwords">public function loadProfiles() {      // clean Item table      $this-&gt;cleanup();      $t = new Twitter();      $t-&gt;refreshConnection(1); // for admin user = 1      $time_stale = time()-(24*3600);      $people = Item::find()        -&gt;where("updated_at&lt;".$time_stale)        -&gt;orWhere("updated_at=created_at")        -&gt;orderBy("rand()")-&gt;all();      $cnt=0;      foreach ($people as $i) {        // to do - or if updated at is stale        if ($i-&gt;detail=="") {            $result = $t-&gt;getUsersShow($i-&gt;path);            echo $i-&gt;path.", ";            if (isset($result-&gt;errors)) {              var_dump($result);              continue;            }            if (isset($result-&gt;name)) {              $i-&gt;title = Html::encode($this-&gt;removeEmoji($result-&gt;name));              if ($i-&gt;title=="") {                $i-&gt;title="n/a";              }            }            if (isset($result-&gt;screen_name)) {                $i-&gt;path = $result-&gt;screen_name;            }            if (isset($result-&gt;description)) {              $i-&gt;detail=Html::encode($this-&gt;removeEmoji($result-&gt;description));            }            if (isset($result-&gt;profile_image_url_https)) {              $i-&gt;image_url = $result-&gt;profile_image_url_https;            }            $i-&gt;validate();            var_dump($i-&gt;getErrors());            $i-&gt;update();           SocialProfile::fill($i-&gt;id,$result);           $cnt+=1;           if ($cnt&gt;25) exit;        }      }  }</pre><p>Это вызывается консольным заданием из cron, которое я опишу позже в <span>серии про Yii2</span>. Таким образом, эти профили синхронизируются постепенно и многократно с определенными интервалами в течение нескольких дней.</p><h3>Создание дружбы</h3><p>Я не буду подробно описывать его здесь, но в основном я создал таблицу регистрации индивидуальных запросов для каждой учетной записи пользователя и женского аккаунта. Другими словами, у Самуэля было бы 500 записей с просьбой добавить дружбу для каждой женщины в базе данных.</p><p>Во-первых, я хотел бы убедиться, что Samuel (и каждый пользователь Twixxr) <span>следует за учетной записью Twixxr_com.</span></p><pre class="brush: php noskimlinks noskimwords">$result = $t-&gt;createFriend("twixxr_com");          $total_request+=1;          if ($result !== false) {            $action-&gt;status = Log::STATUS_COMPLETE;            $action-&gt;save();          }</pre><p>Перед тем, как задание cron обрабатывает эти команды, оно обновляет авторизацию и подключение Twitter для Samuel и каждого отдельного пользователя на соответствующем этапе:</p><pre class="brush: php noskimlinks noskimwords">$t-&gt;refreshConnection($action-&gt;user_id);</pre><p>Затем вот метод <code class="inline">Twitter::createFriend($screen_name)</code></p><pre class="brush: php noskimlinks noskimwords">public function createFriend($username) {    $add = $this-&gt;connection        -&gt;post("friendships/create", ["screen_name" =&gt; $username]);    if ($this-&gt;connection-&gt;getLastHttpCode() == 200) {      // successful      return $add;    } else {        // Handle error case        return false;    }  }</pre><p>Затем он делает это для всех женщин, запрошенных Самуилом, как указано в таблице Log, и, конечно же много чего еще происходит:</p><pre class="brush: php noskimlinks noskimwords">echo "add ".$person-&gt;path." to ".$action-&gt;user_id."&lt;br /&gt;";          if ($x&gt;7) {            $mode ="limited";            echo "Limited to max requests per user&lt;br /&gt;";            // skip this user and go to next one...            continue; // on to next user          }          $followed_by = $t-&gt;getFriendshipsShow($u-&gt;username,$person-&gt;path);          if ($followed_by == -10) {            echo "rate limit error&lt;br /&gt;";            $mode ="limited";            // skip this user and go to next one...            continue; // on to next user          } else if ($followed_by==0) {            $x+=1;            echo "request follow&lt;br /&gt;";            $result = $t-&gt;createFriend($person-&gt;path);            $total_request+=1;            if ($result !== false) {              $action-&gt;status = Log::STATUS_COMPLETE;              $action-&gt;completion_at = time();              $action-&gt;save();            } else {              echo "skip due to error";              $action-&gt;status = Log::STATUS_SKIP_ERROR;              $action-&gt;completion_at = time();              $action-&gt;save();            }          } else {            echo "already followed&lt;br /&gt;&lt;br /&gt;";            $action-&gt;status = Log::STATUS_SKIPPED;            $action-&gt;save();          }        }</pre><p>API Twitter имеет ограничения, что делает использование этого API иногда весьма трудным занятием. Задание cron выше создает дружеские отношения для семи целевых учетных записей одновременно, прежде чем переключиться на запрос другого пользователя, пока он не будет вызван позже.</p><p>Вот метод <code class="inline">Twitter::getFriendshipsShow()</code>, который проверяет, соответствует ли эта учетная запись желаемой учетной записи. В приведенном выше коде он пропускает запросы, которые являются избыточными, чтобы не превышать ограничение API.</p><pre class="brush: php noskimlinks noskimwords">public function getFriendshipsShow($source_name,$target_name) {    $result = $this-&gt;connection-&gt;get("friendships/show", ["source_screen_name" =&gt; $source_name,"target_screen_name" =&gt; $target_name]);    if (isset($result-&gt;errors)) {      if ($result-&gt;errors[0]-&gt;message=="Rate limit exceeded") {        return -10;      }    } else {      if (isset($result-&gt;relationship-&gt;target-&gt;followed_by)) {        if  ($result-&gt;relationship-&gt;target-&gt;followed_by) {          return 1;        } else {          return 0;        }      }    }    return -1;  }</pre><p>В ближайшем будущем я буду реализовывать <span>массовый API Twitter</span> для этого, делая только один вызов вместо сотен на пользователя, используя <span>get/friendships/lookup</span>. Обратите внимание: для доступа к этой странице вам потребуется аккаунт разработчика.</p><h3>Удаление дружеской связи</h3><p>Вы также можете отменить эту дружбу через API:</p><pre class="brush: php noskimlinks noskimwords">$statuses = $connection-&gt;post("friendships/destroy", ["screen_name" =&gt; $u]);</pre><p>Я регистрирую каждое соединение, созданное в Twixxr, и если ограничения на API Twitter были менее обременительными и отнимающими много времени, я разрешал бы посетителям иметь функцию отмены для Twixxr, отменить подписку всем женщинам, если им не понравятся все новые аккаунты. </p><h3>Производительность</h3><p>Я многое сделал в Twixxr для управления производительностью. В принципе, я построил таблицу логов, чтобы быстро записать всю запрошенную дружбу пользователя. Но все они обрабатываются в фоновом режиме.</p><p>К сожалению, API Twitter не позволяет размещать список учетных записей, которые будут подгружаться в массовом порядке. Просто нет возможности сделать это в реальном времени, пока пользователь находится на вашем сайте.</p><p>Таким образом, пользовательский ответ на запрос Twixxr немедленный, но для всех учетных записей может потребоваться несколько часов или больше.</p><p>Вот метод followAll в TwixxrController.php:</p><pre class="brush: php noskimlinks noskimwords">public function actionAll()    {      // make request for authenticated user to follow all twitter profiles      $x = new Twixxr();      $x-&gt;followTwixxr(Yii::$app-&gt;user-&gt;getId());      $x-&gt;followAll(Yii::$app-&gt;user-&gt;getId());      Yii::$app-&gt;getSession()-&gt;setFlash("success", Yii::t("frontend","Your request has been added to our queue."));      $this-&gt;redirect(["twixxr/complete",["task"=&gt;"all"]]);      // redir home    }</pre><p>Ниже приведены методы <code class="inline">Twixxr::followAll</code> и <code class="inline">followCount</code>, которые также используются пронумерованными кнопками выше для подписки на 100, 200, 300 женщин и т.д.</p><pre class="brush: php noskimlinks noskimwords">public function followAll($user_id) {    $allWomen = Item::find()-&gt;count();    $this-&gt;followCount($user_id,$allWomen);  }  public function followCount($user_id,$cnt=100) {    $women = Item::find()-&gt;orderBy("rand()")-&gt;limit($cnt)-&gt;all();    foreach ($women as $w) {        $l = Log::find()          -&gt;where(["user_id"=&gt;$user_id,"item_id"=&gt;$w-&gt;id])          -&gt;one();        if (!is_null($l)) {          $l-&gt;status = Log::STATUS_PENDING;          $l-&gt;update();        }  else {          $l = new Log();          $l-&gt;user_id = $user_id;          $l-&gt;item_id = $w-&gt;id;          $l-&gt;event_id = Twixxr::EVENT_ADD;          $l-&gt;status = Log::STATUS_PENDING;          $l-&gt;save();        }    }  }</pre><p>Они просто создают записи в журнале для каждого запроса дружбы, чтобы задание cron обрабатывалось в фоновом режиме.</p><h2>Что дальше?<br></h2><p>Надеюсь, вам понравилось узнавать новое об использовании TwitterOAuth.php в Yii2 и о том, как авторизировать и использовать Twitter API от имени своих пользователей сайта.</p><p>Затем я бы хотел использовать API Twitter для анализа моих собственных подписчиков. У меня есть подозрение, что подавляющее большинство последователей Twitter являются спамовыми ботами, и я хотел бы использовать API, чтобы доказать это. Оставайтесь на связи.</p><p>Если у вас есть вопросы или предложения, отправьте их в комментариях. Если вы хотите продолжить читать мои будущие уроки Envato Tuts + и другие серии, пожалуйста, посетите <span>мою страницу инструктора</span> или следуйте за мной в Twitter <span>@reifman</span>. Определенно проверьте мою <span>серию про стартап</span> и <span>Планировщика Встреч</span>.</p><h2>Ссылки по теме</h2><ul><li> <span>Twixxr</span> </li> <li><span>Серия Программирование на Yii2 (Envato Tuts+)</span></li> <li> <span>Yii2 Developer Exchange</span>, мой сайт по Yii2</li> <li> <span>Как использовать yii2-authclient для связи с Twitter с использованием однонаправленного токена (Yii Documentation)</span><br></li> <li><span>Документация Разработчика Twitter</span></li> <li><span>Twitter OAuth PHP библиотека</span></li> </ul>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Twitter" href="https://norma-studio.github.io/article5/220825016-rabota-s-api-twitter-sozdanie-druzej-dlya-podpiski" class="tm-article-body__tags-item-link">Twitter</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
32337</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
615</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
