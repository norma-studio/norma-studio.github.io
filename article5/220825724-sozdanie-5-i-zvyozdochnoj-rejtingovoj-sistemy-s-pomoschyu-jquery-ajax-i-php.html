
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В этом уроке вы узнаете как создать рейтинговую систему с помощью AJAX, PHP и jQuery. Голоса будут регистрироваться и обновляться в режиме реального времени с помощью волшебства AJAX, также мы используем всю мощь PHP и вам даже не понадобится база данных!...">
<meta property="og:description" content="В этом уроке вы узнаете как создать рейтинговую систему с помощью AJAX, PHP и jQuery. Голоса будут регистрироваться и обновляться в режиме реального времени с помощью волшебства AJAX, также мы используем всю мощь PHP и вам даже не понадобится база данных!...">
<meta name="twitter:description" content="В этом уроке вы узнаете как создать рейтинговую систему с помощью AJAX, PHP и jQuery. Голоса будут регистрироваться и обновляться в режиме реального времени с помощью волшебства AJAX, также мы используем всю мощь PHP и вам даже не понадобится база данных!...">
<meta property="aiturec:description" content="В этом уроке вы узнаете как создать рейтинговую систему с помощью AJAX, PHP и jQuery. Голоса будут регистрироваться и обновляться в режиме реального времени с помощью волшебства AJAX, также мы используем всю мощь PHP и вам даже не понадобится база данных!...">
<meta property="og:image" content="https://s3.amazonaws.com/nettuts/664_rating/01.png">
<meta property="aiturec:image" content="https://s3.amazonaws.com/nettuts/664_rating/01.png">
<meta name="twitter:image" content="https://s3.amazonaws.com/nettuts/664_rating/01.png">
<meta property="vk:image" content="https://s3.amazonaws.com/nettuts/664_rating/01.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://s3.amazonaws.com/nettuts/664_rating/01.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html" title="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io" title="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/543543242.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html" class="tm-user-info__username" title="
А. Морозов" aria-label="
А. Морозов">
А. Морозов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="HTML &amp; CSS" href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php" class="tm-article-snippet__hubs-item-link"><span>HTML &amp; CSS</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php.html" />
    <link itemprop="image" href="https://s3.amazonaws.com/nettuts/664_rating/01.png">
    <meta itemprop="headline name" content="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В этом уроке вы узнаете как создать рейтинговую систему с помощью AJAX, PHP и jQuery. Голоса будут регистрироваться и обновляться в режиме реального времени с помощью волшебства AJAX, также мы используем всю мощь PHP и вам даже не понадобится база данных!...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В этом уроке вы узнаете как создать рейтинговую систему с помощью AJAX, PHP и jQuery. Голоса будут регистрироваться и обновляться в режиме реального времени с помощью волшебства AJAX, также мы используем всю мощь PHP и вам даже не понадобится база данных!...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В этом уроке вы узнаете как создать рейтинговую систему с помощью AJAX, PHP и jQuery. Голоса будут регистрироваться и обновляться в режиме реального времени с помощью волшебства AJAX, также мы используем всю мощь PHP и вам даже не понадобится база данных!</p> <p><!--more--></p> <hr><h2> <span>Шаг 1. Создание HTML</span></h2> <p>Мы создадим простую страницу, на которой будут списки двух фильмов и возможность оценить их. Это значит, что нам понадобятся звезды, чтобы показать текущий рейтинг и разрешить голосование. Нам также необходимо создать область, чтобы отобразить количество голосов и текущий рейтинг округлённый до одной десятой.</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://s3.amazonaws.com/nettuts/664_rating/01.png" class="lazy07" alt="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." title="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." width="50" height="50"></div> <p>Давайте взглянем на HTML/CSS</p> <pre class="brush: html noskimlinks noskimwords">        &lt;div class="movie_choice"&gt;            Rate: Raiders of the Lost Ark            &lt;div id="r1" class="rate_widget"&gt;                &lt;div class="star_1 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_2 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_3 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_4 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_5 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="total_votes"&gt;vote data&lt;/div&gt;            &lt;/div&gt;        &lt;/div&gt;                &lt;div class="movie_choice"&gt;            Rate: The Hunt for Red October            &lt;div id="r2" class="rate_widget"&gt;                &lt;div class="star_1 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_2 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_3 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_4 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="star_5 ratings_stars"&gt;&lt;/div&gt;                &lt;div class="total_votes"&gt;vote data&lt;/div&gt;            &lt;/div&gt;        &lt;/div&gt;</pre> <p>Вы заметили, что в нашем HTML нет графики? Она будут добавлена при помощи CSS. Мы используем HTML для создания фрэймворка в котором будет работать наш виджет. Теперь пора добавить CSS.</p> <pre class="brush: css noskimlinks noskimwords">        .rate_widget {            border:     1px solid #CCC;            overflow:   visible;            padding:    10px;            position:   relative;            width:      180px;            height:     32px;        }        .ratings_stars {            background: url("star_empty.png") no-repeat;            float:      left;            height:     28px;            padding:    2px;            width:      32px;        }        .ratings_vote {            background: url("star_full.png") no-repeat;        }        .ratings_over {            background: url("star_highlight.png") no-repeat;        }</pre> <p>Первая часть CSS будет выполнять следующее:</p> <ul><li>Создает "пустое" пространство для расположения каждой звезды</li> <li>Задает классы для заполненных звёзд и выделенных звёзд</li> <li>Определяет и стилизует контейнеры для звёзд.</li> </ul><p>Можно использовать графику размещённую в разделе загрузки создать свою. Должен быть графический объект для каждого из трех состояний объекта: пустой, заполненный и выделенный.</p> <p>Затем мы добавляем ещё немного CSS для определения места расположения общего количества голосов и центрируем виджеты, так чтобы страница соответствовала рисунку в начале урока.</p> <pre class="brush: html noskimlinks noskimwords">        .total_votes {            background: #eaeaea;            top: 58px;            left: 0;            padding: 5px;            position:   absolute;          }         .movie_choice {            font: 10px verdana, sans-serif;            margin: 0 auto 40px auto;            width: 180px;        }</pre> <hr><h2> <span>Шаг 2. Добавление интерактивности</span></h2> <p>На данный момент у нас есть кучка очень простых пустых звёзд, но они пока не <i>делают</i> ничего важного. Здесь к нам на помощь приходит jQuery.</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://s3.amazonaws.com/nettuts/664_rating/02.png" class="lazy07" alt="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." title="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." width="50" height="50"></div> <p>Нашим первым шагом будет создание mouseover и mouseout обработчиков для звезд. Нам нужно выделить звезду при наведении на неё мышью, а также все предыдущие звезды.</p> <pre class="brush: js noskimlinks noskimwords">        $(".ratings_stars").hover(            // Handles the mouseover            function() {                $(this).prevAll().andSelf().addClass("ratings_over");                $(this).nextAll().removeClass("ratings_vote");             },            // Handles the mouseout            function() {                $(this).prevAll().andSelf().removeClass("ratings_over");                set_votes($(this).parent());            }        );</pre> <p>Мы используем преимущество jQuery методов .prevAll() и .nextAll() чтобы отследить звезду на которую наведён курсор.</p> <p>Приведенный выше код добавляет и удаляет классы которые выделят звезду с наведённым на неё курсором мыши, а другие звезды останутся в обычном состоянии.</p> <h3>Как насчет set_votes()?</h3> <p>Это функция, которая проверяет, какие звезды должны быть в состоянии "заполненных", и приближает нас к следующему шагу, где мы получим данные с удалённого сервера.</p> <hr><h2> <span>Шаг 3. Получение данных с сервера</span></h2> <p>Наши звезды подсвечиваются при наведении курсора мыши, и это хорошее начало. Но как насчет красных звезд которые показывают действующие голоса? Для достижения этого шага, нам нужно получить информацию от сервера и написать код JavaScript для обработки этих данных.</p> <pre class="brush: js noskimlinks noskimwords">        $(".rate_widget").each(function(i) {            var widget = this;            var out_data = {                widget_id : $(widget).attr("id"),                fetch: 1            };            $.post(                "ratings.php",                out_data,                function(INFO) {                    $(widget).data( "fsr", INFO );                    set_votes(widget);                },                "json"            );        });</pre> <p>Этот блок кода - фактически весь написан на JavaScript - идет в блоке document.ready. Этот код выполняется сразу. Он отправляет запрос на сервер и получает информацию о каждом виджете голосования на странице.</p> <p>Сначала мы создадим объект, out_data, который содержит информацию, которую мы посылаем на сервер. Наш скрипт PHP ожидает команду "fetch" когда он будет обрабатывать данные, поэтому мы разместим её здесь. Мы также укажем ID виджета, который позволяет узнать, какие данные мы получили на стороне сервера. Когда ответ функции будет вызван, он будет содержать объект JavaScript, который выглядит следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">        {            "widget_id"     : "r1",            "number_votes"  : 129,            "total_points"  : 344,            "dec_avg"       : 2.7,            "whole_avg"     : 3        }</pre> <blockquote class="pullquote"> <p>Метод .data() это волшебство jQuery, которое позволит привязать полученные данные к DOM<br> объекту.</p> </blockquote> <p>Если вы внимательно посмотрите на код, вы увидите, что мы берем этот объект (хранящийся в переменной INFO) и<br> делаем что-то с ним с помощью .data () method.</p> <p>.data () метод - это метод, который содержит немного магии jQuery, она позволяет вам связывать произвольные данные с DOM<br> object В этом случае мы сохраняем данные в div widget. К нему можно получить доступ позже:</p> <pre class="brush: js noskimlinks noskimwords">        $("#one_of_your_widgets).data("fsr").widget_id;</pre> <h3> Наконец, set_votes().</h3> <p>После того, как данные были возвращены с сервера, они передаются косвенно на set_votes ().</p> <pre class="brush: js noskimlinks noskimwords">        function set_votes(widget) {                    var avg = $(widget).data("fsr").whole_avg;            var votes = $(widget).data("fsr").number_votes;            var exact = $(widget).data("fsr").dec_avg;                        $(widget).find(".star_" + avg).prevAll().andSelf().addClass("ratings_vote");            $(widget).find(".star_" + avg).nextAll().removeClass("ratings_vote");             $(widget).find(".total_votes").text( votes + " votes recorded (" + exact + " rating)" );        }</pre> <p>Первые три строки предназначены для чтения, так как эти имена переменных довольно длинные. Итак, давайте посмотрим, что здесь происходит.</p> <p><strong>Строка 7</strong>: "avg" - это целое число, представляющее округлённое среднее значение голосования для данного виджета. Так как, это<br> число 1-5, мы можем использовать его чтобы найти соответствующую звезду в виджете и обработать их<br> заполнив графикой в состояние "заполненных". Обратите внимание, что мы используем .andSelf() чтобы включить звезду,<br> которую мы выбрали.</p> <p><strong>Строка 8</strong>: Очень похожа на предыдущую строку, здесь мы удаляем заполненность из новых звёзд. Это<br> необходимо в случае, если среднее значение для этого виджета уменьшилось с момента последнего голосования.</p> <p><strong>Строка 9</strong>: Здесь мы обновляем серое поле под виджетом, который показывает более точное значение рейтинга,<br> и показывает посетителю, сколько голосов было учтено.</p> <hr><h2> Шаг 4. Голосование начинается</h2> <p>Последним шагом для пользовательского интерфейса является включение голосования. Мы собираемся добавить обработчик кликов к каждой из звезд. Этот обработчик кликов будет отвечать за отправку данных голосования на сервер.</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://s3.amazonaws.com/nettuts/664_rating/04.png" class="lazy07" alt="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." title="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." width="50" height="50"></div> <p>Здесь вы видите обработчик кликов.</p> <pre class="brush: js noskimlinks noskimwords">        $(".ratings_stars").bind("click", function() {            var star = this;            var widget = $(this).parent();                        var clicked_data = {                clicked_on : $(star).attr("class"),                widget_id : widget.attr("id")            };            $.post(                "ratings.php",                clicked_data,                function(INFO) {                    widget.data( "fsr", INFO );                    set_votes(widget);                },                "json"            );         });</pre> <p>В этом блоке кода мы начинаем с создания некоторых переменных не только для ясности, но и в этом случае, для использования их в обратном вызове .post. Помните, что для звезд назначен обработчик на событие нажатия, поэтому нам нужна вторая переменная, виджет, чтобы получить объект, содержащий данные.</p> <p>Сначала мы настраиваем наши исходные данные, которые мы размещаем в объекте clicked_data. Мы получаем класс, с именем в формате star_#, который определяет какой голос получен, и готовим его к отправке на сервер, а также идентифицируем виджет.</p> <p>ID виджета это краеугольный камень нашей системы. Это позволяет нам найти наши данные и легко отображать эти данные для посетителей.</p> <p>И наконец, мы отправляем эту информацию на сервер. Сервер добавит текущие итоги голосования и отправит информацию содержащую обновленные данные, обратно в браузер. Значения, отображаемые в виджете затем обновляются с помощью set_votes().</p> <hr><h2> <span>Шаг 5. PHP: Создание класса</span></h2> <p>Теперь, когда пользовательский интерфейс завершён, нам нужно создать сценарий на сервере для хранения и получения данных голосования.</p> <div class="tutorial_image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://s3.amazonaws.com/nettuts/664_rating/05.png" class="lazy07" alt="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." title="Создание 5-и звёздочной рейтинговой системы с помощью jQuery, AJAX и PHP..." width="50" height="50"></div> <p>Мы собираемся создать очень простой класс на PHP, который будет называться "Ratings", и использовать его для обработки запросов сервера в нашей рейтинговой системе. В нём будет всего два метода, а также вызов. Использование нашего класса будет выглядеть примерно так:</p> <pre class="brush: php noskimlinks noskimwords">        # New Object        $rating = new ratings($_POST["widget_id"]);            # either return ratings, or process a vote        isset($_POST["fetch"]) ? $rating-&gt;get_ratings() : $rating-&gt;vote();</pre> <p>Если мы вернёмся к четвёртому разделу, мы увидим, что набор данных полученных с переменной "fetch" - это то, что мы ищем здесь, в пятой строке. Если этого нет, мы обрабатываем голос.</p> <p>Первое, на что мы обратим внимание, это начало класса, а если говорить точнее, конструктор.</p> <pre class="brush: php noskimlinks noskimwords">        class ratings {                        private $data_file = "./ratings.data.txt";            private $widget_id;            private $data = array();                       function __construct($wid) {                        $this-&gt;widget_id = $wid;                    $all = file_get_contents($this-&gt;data_file);                        if($all) {                $this-&gt;data = unserialize($all);            }        }</pre> <blockquote class="pullquote pqRight"><p>Функиции serialize() и unserialize, это отличный способ легко сохранять<br> PHP данные на диск.</p></blockquote> <p>Много всего происходит здесь, на нескольких строках кода, поэтому я расскажу только о самых важных моментах.</p> <p><strong>Строка 3</strong>: Нам нужно подготовить текстовый файл, который мы будем использовать для хранения данных. Мы не используем базы данных для этого проекта, хотя это можно легко осуществить. Простого файла будет достаточно для выполнения наших задач.</p> <p><strong>Строка 7</strong>: Конструктор. Мы вызываем его, когда мы создали наш объект и сохраняем ID виджета.</p> <p><strong>Строка 11</strong>: Пытаемся загрузить текстовый файл. Если файл не существует, ничего страшного, но на некоторых системах вам нужно будет создать его заранее и предоставить разрешения для чтения и записи в PHP.</p> <p><strong>Строка 14</strong>: Важная строка. Она получает данные из текстового файла - если такой есть - и выполняет функцию unserializes(). Этот файл содержит сложный PHP-массив, который преобразуется в обычный текст, с помощью функции serialize(), позволит нам его сохранить и прочитать как массив позже.</p> <hr><h2> <span>Шаг 6.</span> Метод get_ratings().</h2> <p>Этот метод вызывается как собственный, или из метода vote(). Он находит данные для ID виджета и возвращает его на запрашиваемую страницу, в формате JSON.</p> <pre class="brush: php noskimlinks noskimwords">    public function get_ratings() {        if($this-&gt;data[$this-&gt;widget_id]) {            echo json_encode($this-&gt;data[$this-&gt;widget_id]);        }        else {            $data["widget_id"] = $this-&gt;widget_id;            $data["number_votes"] = 0;            $data["total_points"] = 0;            $data["dec_avg"] = 0;            $data["whole_avg"] = 0;            echo json_encode($data);        }     }</pre> <p>Это только выглядит сложно, на самом деле это довольно просто. Первое, что мы сделаем, это проверим, имеется ли у массива, хранящегося в $this-&gt;data, ключ, соответствующий ID нашего виджета. Если это так, мы просто возвращаем эту информацию, поскольку это данные виджета, которые запрашиваются на странице.</p> <p>Мы не будем ничего делать с этими данными, потому что они уже в массиве. $this-&gt;data - это просто массив содержащий массивы. Мы кодируем массив, который нам нужен с помощью json_encode() и отправляем его обратно в браузер.</p> <p>Если нет данных для виджета, который мы запросили, мы создаём запись с нулевыми значениями и отправляем её обратно в браузер.</p> <h2> <span>Шаг 7.  Метод Vote()</span></h2> <p>Далее, нам нужно создать метод для обработки входящих голосов. Когда метод завершается, он должен вызвать get_ratings(), чтобы отправить обновленные данные обратно в браузер.</p> <h3>Начало метода</h3> <pre class="brush: php noskimlinks noskimwords">        public function vote() {            # Get the value of the vote            preg_match("/star_([1-5]{1})/", $_POST["clicked_on"], $match);            $vote = $match[1];</pre> <p>Первое, что мы делаем, это получаем результат голосования. Вспомните, что где-то в "clicked_on" было имя класса в формате star_#. "star_4", например. Чтобы получить это значение, мы используем регулярное выражение и получаем значение для $match[1].</p> <h3>Середина метода</h3> <pre class="brush: php noskimlinks noskimwords">                $ID = $this-&gt;widget_id;            # Update the record if it exists            if($this-&gt;data[$ID]) {                $this-&gt;data[$ID]["number_votes"] += 1;                $this-&gt;data[$ID]["total_points"] += $vote;            }            # Create a new one if it does not            else {                $this-&gt;data[$ID]["number_votes"] = 1;                $this-&gt;data[$ID]["total_points"] = $vote;            }</pre> <p>Здесь мы сохраняем $this-&gt;widget_id в $ID для ясности - иначе, следующий код будет непонятным.</p> <p>Мы проверяем, существует ли информация для ID, и, если и если это так, мы прибавляем голос к общему числу и добавляем баллы полученного голоса. Это запускает обработку всех голосов; так что, если один человек дает пять звезд и еще один, три, всего будет восемь очков.</p> <p>Если запись не существует, мы создаем таковую, с одним голосом, и добавляем баллы из полученного голосования.</p> <h3>Завершение</h3> <pre class="brush: php noskimlinks noskimwords">              $this-&gt;data[$ID]["dec_avg"] = round( $this-&gt;data[$ID]["total_points"] / $this-&gt;data[$ID]["number_votes"], 1 );            $this-&gt;data[$ID]["whole_avg"] = round( $this-&gt;data[$ID]["dec_avg"] );                              file_put_contents($this-&gt;data_file, serialize($this-&gt;data));            $this-&gt;get_ratings();        }</pre> <p>Как только мы обновили итоги голосования и баллы, мы должны вычислить среднее, выраженные как целое число, с одной десятой после запятой. Чтобы избежать необходимости делать подсчёты дважды, мы сначала вычислим среднее для одной десятой на первой строке, а затем округлим, то что получится до целого числа, на второй строке.</p> <p>В четвертой строке мы сохраним измененные данные обратно на диск после его обработки функцией serialize(). После того, как данные сохранены, мы вызываем $this-&gt;get_ratings(), чтобы отправить новые, обновленные данные в браузер.</p> <hr><h2>Заключение</h2> <p>Простоты ради скажу, что это не 100% готовое решение. Чтобы усовершенствовать проект, мы должны сохранять файлы cookie или записывать IP-адрес, чтобы убедиться в том, что пользователи голосовали только один раз. Также возможна ситуация в которой два одновременных нажатия пользователем должны быть сохранены как один голос. Однако, это отличное начало и проект прекрасно подойдёт для учёта голосов на вашем сайте в большинстве случаев. Появились идеи? Спасибо за чтение!</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="HTML &amp; CSS" href="https://norma-studio.github.io/article5/220825724-sozdanie-5-i-zvyozdochnoj-rejtingovoj-sistemy-s-pomoschyu-jquery-ajax-i-php" class="tm-article-body__tags-item-link">HTML &amp; CSS</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
42542</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
397</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
