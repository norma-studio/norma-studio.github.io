
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content=" Core Data вокруг нас в течение многих лет.  Он используется в тысячах приложений миллионами людей, как на iOS, так и на OS X. Core Data поддерживается Apple и очень хорошо документирован.  Это зрелый фреймворк, который доказывает свою эффективность снова и снова. ...">
<meta property="og:description" content=" Core Data вокруг нас в течение многих лет.  Он используется в тысячах приложений миллионами людей, как на iOS, так и на OS X. Core Data поддерживается Apple и очень хорошо документирован.  Это зрелый фреймворк, который доказывает свою эффективность снова и снова. ...">
<meta name="twitter:description" content=" Core Data вокруг нас в течение многих лет.  Он используется в тысячах приложений миллионами людей, как на iOS, так и на OS X. Core Data поддерживается Apple и очень хорошо документирован.  Это зрелый фреймворк, который доказывает свою эффективность снова и снова. ...">
<meta property="aiturec:description" content=" Core Data вокруг нас в течение многих лет.  Он используется в тысячах приложений миллионами людей, как на iOS, так и на OS X. Core Data поддерживается Apple и очень хорошо документирован.  Это зрелый фреймворк, который доказывает свою эффективность снова и снова. ...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-setup.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-setup.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-setup.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-setup.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-setup.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html" title="Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io" title="Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/63456435436.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html" class="tm-user-info__username" title="
М. Старостенко" aria-label="
М. Старостенко">
М. Старостенко</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Core Data-и Swift: стек технологий-Core Data ...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Core Data" href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-" class="tm-article-snippet__hubs-item-link"><span>Core Data</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-setup.jpg">
    <meta itemprop="headline name" content="Core Data-и Swift: стек технологий-Core Data ... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content=" Core Data вокруг нас в течение многих лет.  Он используется в тысячах приложений миллионами людей, как на iOS, так и на OS X. Core Data поддерживается Apple и очень хорошо документирован.  Это зрелый фреймворк, который доказывает свою эффективность снова и снова. ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody"> Core Data вокруг нас в течение многих лет.  Он используется в тысячах приложений миллионами людей, как на iOS, так и на OS X. Core Data поддерживается Apple и очень хорошо документирован.  Это зрелый фреймворк, который доказывает свою эффективность снова и снова. ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<h2> Введение </h2><p> Core Data вокруг нас в течение многих лет.  Он используется в тысячах приложений миллионами людей, как на iOS, так и на OS X. Core Data поддерживается Apple и <span>очень хорошо документирован</span>.  Это зрелый фреймворк, который доказывает свою эффективность снова и снова. </p><p> Несмотря на то, что Core Data опирается в большей степени на Runtime Objective-C и искусно интегрирован с Core Foundation, вы можете его легко использовать в своих Swift-проектах.  В результате, это простой в использовании фреймворк для управления объектным графом, элегантный в использовании и крайне эффективный в плане потребления памяти. </p><h2>  <span class="sectionnum">1.</span> Необходимый минимум </h2><p> Core Data не сложен сам по себе, но если вы новичок в разработке под iOS или OS X, то я рекомендую вам сначала ознакомиться с <span>серией статей, посвященных iOS-разработке</span>.  Вы освоите основы iOS-программирования и, в конце серии [статей], вы будете иметь достаточно знаний, чтобы взяться за более сложные темы, такие как Core Data. <br></p><p> Как я уже сказал, Core Data не так сложна и трудна для использования, как думают большинство разработчиков.  Однако, я усвоил, что прочный фундамент критически важен для быстрого старта с Core Data.  Вам нужно иметь правильное понимание Core Data API, чтобы избежать его некорректного применения и убедится, что вы не столкнетесь с проблемами используя этот фреймворк. </p><p> Каждый компонент Core Data имеет конкретное предназначение и функциональность.  Если вы попытаетесь использовать Core Data не так, как он был задуман, то, в конечном итоге, вы неизбежно окажетесь в бедственном положении. </p><p> То, что я расскажу в этой серии про Core Data применимо в отношении iOS 7+ и OS X 10.10+, но основное внимание будет уделяться iOS.  В этой серии [статей] я буду работать с Xcode 7.1 и Swift 2.1.  Если вы предпочитаете Objective-C, то я рекомендую прочитать <span>мою предыдущую серию статей про Core Data</span>. </p><h2>  <span class="sectionnum">2.</span> Кривая обучения </h2><p> Core Data может показаться сложным на первый взгляд, но после того, как вы поймете каким образом разные кусочки мозаики складываются в единое целое, его API становится интуитивно понятным и лаконичным.  Именно по этой причине у большинства разработчиков возникают проблемы с этим фреймворком.  Они пытаются использовать Core Data, не увидев картину в целом, они не знают как различные кусочки мозаики собрать воедино и как они связаны друг с другом. </p><p> В этой статье я познакомлю вас со <b>стеком технологий Core Data</b>.  Поняв однажды ключевые моменты Core Data, вы почувствуете себя увереннее и даже оцените и полюбите хорошо продуманное API этого фреймворка. </p><p> В отличие от таких фреймворков как UIKit, который можно использовать без его исчерпывающего знания, Core Data требует правильного понимания всех его конструктивных элементов.  Очень важно выделить некоторое время для знакомства с этим фреймворком, что мы и сделаем в этом руководстве. </p><h2>  <span class="sectionnum">3.</span> Что такое Core Data? </h2><p> Зачастую новички ошибочно считают, что Core Data работает как база данных.  Если есть одна вещь, которую, я надеюсь, вы запомните из этой серии статей, то это то, что Core Data не является базой данных, и вам не следует ждать, что он будет работать аналогичным образом. </p><p> Что же тогда Core Data, если не база данных?  Core Data - это уровень модели вашего приложения в самом широком смысле слова.  Это <b>Модель</b> в шаблоне <b>Модель-Представление-Контроллер</b>, который пронизывает iOS SDK. </p><p> Core Data - это не база данных вашего приложения, также это не API для сохранения данных в базе данных.  Core Data — это фреймворк, который управляет графом объектов.  Это так просто.  Core Data <i>может</i> сохранять данные графа объектов путем записи их на диск, но это не является его основной целью. </p><h2> 4. Стек технологий Core Data <br></h2><p> Как я упоминал ранее, стек технологий является сердцем Core Data.  Это коллекция объектов, которые являются как-бы чехлом Core Data.  Ключевыми объектами стека являются: <b>managed object model </b>(управляемая объектная модель), <b>persistent store coordinator</b> (координатор постоянного хранилища) и одного или нескольких <b>managed object contexts</b> (контекстов управляемого объекта).  Давайте кратко рассмотрим каждый компонент. </p><h3><code class="inline"> NSManagedObjectModel </code></h3><p> Управляемая объектная модель (managed object model)  олицетворяет модель данных приложения.  Несмотря на то, что Core Data не является базой данных, вы можете сравнить управляемую объектную модель (managed object model) со схемой базы данных, то есть, она содержит информацию о моделях или сущностях графа объекта, какие атрибуты они имеют, и как они связаны друг с другом. </p><p> Объект <code class="inline">NSManagedObjectModel</code> узнает о модели данных путем загрузки одного или нескольких файлов модели данных во время инициализации.  Мы посмотрим как это работает чуть позже. </p><h3>  <code class="inline">NSPersistentStoreCoordinator</code> <br></h3><p> Как и говорит его название, объект <code class="inline">NSPersistentStoreCoordinator</code> сохраняет данные на диск и гарантирует, что постоянное хранилище(-а) и модель данных являются совместимыми.  Это посредник между постоянным хранилищем(-ами) и контекстом(-ами) управляемого объекта, также он заботится о загрузке и кэшировании данных.  Это действительно так.  Core Data имеет встроенный механизм кэширования. </p><p> Координатор постоянного хранилища - это дирижер оркестра Core Data.  Несмотря на свою важную роль в стеке технологий Core Data, вы будете редко взаимодействовать с ним напрямую. </p><h3><code class="inline"> NSManagedObjectContext </code></h3><p> Объект <code class="inline">NSManagedObjectContext</code> управляет коллекцией объектов модели, экземплярами класса <code class="inline">NSManagedObject</code>.  Приложение может иметь несколько контекстов управляемого объекта.  Каждый контекст управляемого объекта опирается на координатор постоянного хранилища. </p><p> Можно себе представить, что контекст управляемого объекта - это верстак, на котором вы работаете с объектами модели.  Вы загружаете их, манипулируете ими и сохраняете их на этот верстак.  Загрузка и сохранение происходят при посредничестве координатора постоянного хранилища.  Вы можете иметь несколько верстаков, что полезно, если ваше приложение является многопоточным, например. </p><p> Хотя управляемая объектная модель и координатор постоянного хранилища могут совместно использоваться несколькими потоками, контекст управляемого объекта никогда не должен быть доступен из другого потока, отличного от того, в котором он был создан.  Мы будем обсуждать многопоточность более подробно в следующих статьях этой серии. </p><h2>  <span class="sectionnum">5.</span> Изучение стека технологий Core Data </h2><h3> Шаг 1: Настройка проекта </h3><p> Давайте рассмотрим стек технологий Core Data более подробно на примере.  Создайте новый проект в Xcode 7, выбрав <b>New &gt; Project...</b> из меню <b>File</b>.  Выберете шаблон <b>Single View Application</b> в разделе <b>iOS &gt; Application</b> (слева). </p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-setup.jpg" alt="Core Data и Swift: стек технологий Core Data ..." title="Core Data и Swift: стек технологий Core Data ..." width="50" height="50"></figure><p> Назовите проект <b>Core Data</b>, выберите <strong>Language</strong> (используемый язык) - <strong>Swift</strong>, <b>Devices</b> (целевые устройства) - <b>iPhone</b> и установите флажок с надписью <b>Use Core Data </b>(использовать Core Data).  Скажите Xcode, где вы хотите хранить файлы проекта и нажмите кнопку <b>Create</b> (создать). <br></p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-project-configuration.jpg" alt="Core Data и Swift: стек технологий Core Data ..." title="Core Data и Swift: стек технологий Core Data ..." width="50" height="50"></figure><h3> Шаг 2: Обзор </h3><p> По умолчанию, Apple вставляет код, связанный с Core Data в  классе делегата приложения, класс <code class="inline">AppDelegate</code> в нашем примере.  Откройте <strong>AppDelegate.swift</strong> и давайте рассмотрим реализацию класса <code class="inline">AppDelegate</code>. </p><p> В самом верху <strong>AppDelegate.swift</strong> вы должны увидеть оператор import для фреймворка Core Data. </p><pre class="brush: javascript noskimlinks noskimwords">import UIKitimport CoreData</pre><p> Кроме того, класс <code class="inline">AppDelegate</code> содержит четыре <strong>lazy</strong> (ленивых) хранимых свойства: </p><ul><li>  <code class="inline">applicationDocumentsDirectory</code> типа <code class="inline">NSURL</code>  </li> <li>  <code class="inline">managedObjectModel</code> типа <code class="inline">NSManagedObjectModel</code>  </li> <li>  <code class="inline">managedObjectContext</code> типа <code class="inline">NSManagedObjectContext</code>  </li> <li>  <code class="inline">persistentStoreCoordinator</code> типа <code class="inline">NSPersistentStoreCoordinator</code>  </li> </ul><p> Первое свойство, <code class="inline">applicationDocumentsDirectory</code>, является не более чем вспомогательным методом для доступа к каталогу <strong>Documents</strong> (Документы) приложения.  Как вы видите, реализация довольно проста.  Класс <code class="inline">NSFileManager</code> используется для получения расположения каталога <strong>Documents</strong> (Документы) приложения. </p><pre class="brush: javascript noskimlinks noskimwords">lazy var applicationDocumentsDirectory: NSURL = {    let urls = NSFileManager.defaultManager().URLsForDirectory(.DocumentDirectory, inDomains: .UserDomainMask)    return urls[urls.count-1]}()</pre><p> Остальные три lazy (ленивых) хранимых свойства более интересны и непосредственно связанны с Core Data.  Сначала мы рассмотрим свойство <code class="inline">managedObjectContext</code>. </p>        <h3> Шаг 3: Контекст управляемого объекта </h3><p> Этот класс вы будете использовать наиболее часто, помимо <code class="inline">NSManagedObject</code>, при взаимодействии с Core Data в качестве <code class="inline">NSManagedObjectContext</code>. </p><pre class="brush: javascript noskimlinks noskimwords">lazy var managedObjectContext: NSManagedObjectContext = {    let coordinator = self.persistentStoreCoordinator    var managedObjectContext = NSManagedObjectContext(concurrencyType: .MainQueueConcurrencyType)    managedObjectContext.persistentStoreCoordinator = coordinator    return managedObjectContext}()</pre><p> Обратите внимание, что создание экземпляра объекта <code class="inline">NSManagedObjectContext</code>  сконфигурировано посредством замыкания.  В замыкании, мы сначала получаем ссылку на координатор постоянного хранилища.  Затем мы создаем экземпляр <code class="inline">NSManagedObjectContext</code>, передавая <code class="inline">.MainQueueConcurrencyType</code> в качестве первого аргумента.  Вы узнаете больше о типах параллелизма в следующих статьях этой серии.  Передавая <code class="inline">.MainQueueConcurrencyType</code>, мы указываем, что контекст управляемого объекта будет делать свою работу, используя очередь главного потока. </p><p> Прежде чем вернуть контекст управляемого объекта, мы установим ему свойство <code class="inline">persistentStoreCoordinator</code>.  Без координатора постоянного хранилища контекст управляемого объекта бесполезен.  Это было не слишком сложно.  Да? </p><p> Таким образом, контекст управляемого объекта управляет коллекцией объектов модели, экземплярами класса <code class="inline">NSManagedObject</code> и хранит ссылку на координатор постоянного хранилища.  Имейте это в виду при чтении остальной части этой статьи. </p><h3> Шаг 4: Координатор постоянного хранилища </h3><p> Как мы только что видели, свойство <code class="inline">persistentStoreCoordinator</code> доступно в ходе конфигурирования контекста управляемого объекта.  Взгляните на реализации свойства <code class="inline">persistentStoreCoordinator</code>, но не позволяйте ему запугать вас.  На самом деле это не так сложно. </p><pre class="brush: javascript noskimlinks noskimwords">lazy var persistentStoreCoordinator: NSPersistentStoreCoordinator = {    let coordinator = NSPersistentStoreCoordinator(managedObjectModel: self.managedObjectModel)    let url = self.applicationDocumentsDirectory.URLByAppendingPathComponent("SingleViewCoreData.sqlite")    var failureReason = "There was an error creating or loading the application"s saved data."    do {        try coordinator.addPersistentStoreWithType(NSSQLiteStoreType, configuration: nil, URL: url, options: nil)    } catch {        var dict = [String: AnyObject]()        dict[NSLocalizedDescriptionKey] = "Failed to initialize the application"s saved data"        dict[NSLocalizedFailureReasonErrorKey] = failureReason        dict[NSUnderlyingErrorKey] = error as NSError        let wrappedError = NSError(domain: "YOUR_ERROR_DOMAIN", code: 9999, userInfo: dict)        NSLog("Unresolved error \(wrappedError), \(wrappedError.userInfo)")        abort()    }        return coordinator}()</pre><p> Как правило, вам захочется хранить граф объектов Core Data на диске и реализация свойства <code class="inline">persistentStoreCoordinator</code> от Apple использует для этого базу данных SQLite.  Это общий сценарий для приложений, использующих Core Data. </p><p> В замыкании свойства <code class="inline">persistentStoreCoordinator</code> мы начинаем создавать экземпляр класса <code class="inline">NSPersistentStoreCoordinator</code>, передав в качестве аргумента управляемую объектную модель.  Мы рассмотрим свойство <code class="inline">managedObjectModel</code> через минуту. </p><p> Как вы видите, создание объекта <code class="inline">NSPersistentStoreCoordinator</code> происходит довольно просто.  Однако, координатор постоянного хранилища малополезен, если он не имеет какого-нибудь постоянного хранилища, которым может управлять.  В оставшейся части замыкания мы попытаться загрузить постоянное хранилище и добавить его к координатору постоянного хранилища. </p>                <p> Начнем с определения расположения хранилища на диске, используя свойство <code class="inline">applicationDocumentsDirectory</code>, которое мы уже видели ранее.  Результат, в виде объекта <code class="inline">NSURL</code> передается в метод <code class="inline">addPersistentStoreWithType(_:configuration:URL:options:)</code> класса <code class="inline">NSPersistentStoreCoordinator</code>.  Как и указывает имя метода, он добавляет постоянное хранилище к координатору постоянного хранилища.  Этот метод принимает четыре аргумента. </p><p> Во-первых укажем тип хранилища, <code class="inline">NSSQLiteStoreType</code> в этом примере.  Core Data также поддерживает бинарные (двоичные) хранилища (<code class="inline">NSBinaryStoreType</code>) и хранилище типа in-memory (<code class="inline">NSInMemoryStoreType</code>). </p><p> Второй аргумент сообщает Core Data какую конфигурацию использовать для постоянного хранения.  Мы передали <code class="inline">nil</code>, тем самым сообщив  Core Data, что следует использовать конфигурацию по умолчанию.  Третий аргумент - это расположение хранилища, он содержится в <code class="inline">url</code>. </p><p> Четвертый аргумент - словарь дополнительных опций, которые позволяют нам видоизменять поведение постоянного хранилища.  Позже мы пересмотрим этот аспект (в следующих статьях этой серии), а пока просто передадим <code class="inline">nil</code>. </p><p> Так как <code class="inline">addPersistentStoreWithType(_:configuration:URL:options:)</code> может привести к исключению, его вызов мы заворачиваем в оператор <code class="inline">do-catch</code>.  При отсутствии ошибок данный метод вернет объект <code class="inline">NSPersistentStore</code>.  Мы не сохраняем ссылку на постоянное хранилище, потому что, однажды добавив его к координатору постоянного хранилища, мы больше не будем взаимодействовать с ним. </p><p> Если при добавлении постоянного хранилища произошел сбой, что означает наличие проблемы с постоянным хранилищем приложения, то мы должны принять необходимые шаги для решения этой проблемы.  Когда и почему это происходит - тема следующих статей этой серии. </p><p> В операторе <code class="inline">catch</code> мы регистрируем все ошибки в консоли и вызываем метод <code class="inline">abort</code>.  Вы никогда не должны вызывать <code class="inline">abort</code> в рабочей среде, потому что это приведет к аварийному завершению приложения.  Мы реализуем менее грубое решение позже, в этой серии статей. <br></p><h3> Шаг 5: Управляемая объектная модель </h3><p> Третий и последний кусочек мозаики - это управляемая объектная модель.  Давайте взглянем на реализацию свойства <code class="inline">managedObjectModel</code>. </p><pre class="brush: javascript noskimlinks noskimwords">lazy var managedObjectModel: NSManagedObjectModel = {    let modelURL = NSBundle.mainBundle().URLForResource("Core_Data", withExtension: "momd")!    return NSManagedObjectModel(contentsOfURL: modelURL)!}()</pre><p> Эта реализация очень проста.  Мы сохраняем расположение модели приложения в <code class="inline">modelURL</code> и используем его при создании экземпляра модели управляемого объекта. </p><p> Так как инициализатор, <code class="inline">init(contentsOfURL:)</code>, возвращает optional-значение, мы принудительно "разворачиваем" (извлекаем) его перед возвратом результата.  Разве это не опасно?  И да и нет.  Не рекомендуется принудительно "разворачивать" optional-значения.  Однако, неспособность инициализировать управляемую объектную модель означает, что приложение не может найти модель данных в пакете (bundle) приложения.  Если это случилось, то что-то пошло не так, причем это что-то находится за пределами контроля приложения. </p><p> В этом месте, вы, наверно, задаете себе вопрос, на какую модель указывает <code class="inline">modelURL</code> и что это за файл с расширением <strong>.momd</strong>.  Чтобы ответить на эти вопросы, мы должны выяснить, что еще Xcode создал для нас при настройке проекта. </p><p> В <b>Навигаторе проекта (Project Navigator)</b>, слева, вы должны видеть файл с именем <b>Core_Data.xcdatamodeld</b>.  Это модель данных приложения, которая компилируется в <strong>.momd</strong>-файл.  Это именно тот <strong>.momd</strong>-файл, который использует управляемую объектную модель для создания модели данных приложения. </p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-core-data-model.jpg" alt="Core Data и Swift: стек технологий Core Data ..." title="Core Data и Swift: стек технологий Core Data ..." width="50" height="50"></figure><p> Это позволяет иметь несколько файлов модели данных.  Класс <code class="inline">NSManagedObjectModel</code> вполне способен объединить множество моделей данных в одну, что является одной из наиболее мощных и продвинутых функций Core Data. </p><p> Также Core Data поддерживает версионирование модели данных, в том числе при миграции.  Это гарантирует, что данные, хранящиеся в постоянном хранилище(-ах) останутся целыми.  Версионирование и миграция будут рассмотрены в следующих статьях этой серии. </p><p> На данный момент, файл модели данных в вашем проекте пуст, что означает, что ваша модель данных не содержит никаких сущностей.  Мы исправим это в следующем статье, которая будет посвящена исключительно модели данных. </p><h2>  <span class="sectionnum">6.</span> Собирая все вместе </h2><p> Прежде чем мы закончим эту статью, я бы хотел показать вам схему, которая иллюстрирует три компонента стека Core Data. </p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/41/posts/25065/image/figure-03.jpg" alt="Core Data и Swift: стек технологий Core Data ..." title="Core Data и Swift: стек технологий Core Data ..." width="50" height="50"></figure><p> Схема, представленная выше — это визуальное представление того, что мы только что изучали на примере проекта.  Объект <code class="inline">NSPersistentStoreCoordinator</code> - это мозг стека Core Data в приложении.  Он общается с одним или более постоянных хранилищ и гарантирует сохранение, загрузку и кэширование данных. </p><p> Координатор постоянного хранилища знает о модели данных (схеме графа объектов, если вам так нравится) через объект <code class="inline">NSManagedObjectModel</code>.  Управляемая объектная модель создает модель данных приложения из одного или нескольких <strong>.momd</strong>-файлов, двоичного (бинарного) представления модели данных. </p><p> Последнее, но не менее важное, приложение обращается к графу объектов посредством одного или нескольких экземпляров класса <code class="inline">NSManagedObjectContext</code>.  Контекст управляемого объекта знает о модели данных посредством координатора постоянного хранилища, но он не знает и не хранит ссылку на управляемую объектную модель.  Необходимость в такой ссылке отсутствует. </p><p> Контекст управляемого объекта запрашивает данные у координатора и говорит ему, когда необходимо их сохранить.  Все это делает для вас Core Data, вашему приложению довольно редко нужно будет общаться напрямую с координатором постоянного хранилища. </p><h2> Заключение </h2><p> В этой статье мы рассмотрели ключевые составляющие стека технологий Core Data: координатор постоянного хранилища, управляемая объектная модель и контекст управляемого объекта.  Убедитесь, что вы понимаете роль каждого компонента и, что более важно, как они работают вместе, создавая магию Core Data. </p><p> В следующем выпуске этой серии мы более подробно поговорим о моделе данных.  Мы рассмотрим редактор модели данных в Xcode и создадим несколько сущностей, атрибутов и взаимосвязей. </p> 

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Core Data" href="https://norma-studio.github.io/article5/220825325-core-data-i-swift-stek-tehnologij-core-data-" class="tm-article-body__tags-item-link">Core Data</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
35872</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
534</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
