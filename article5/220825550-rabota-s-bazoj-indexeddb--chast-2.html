
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Приветствую вас во втором руководстве серии, посвященной IndexedDB. Я настоятельно рекомендую вам ознакомиться с первым, поскольку буду считать, что вы уже знакомы со всеми рассмотренными мною ранее понятиями. В этом руководстве мы завершим рассмотрение аспектов парадигмы CRUD (* Create, Update, Read, Delete – создать, прочесть, обновить, удалить),...">
<meta property="og:description" content="Приветствую вас во втором руководстве серии, посвященной IndexedDB. Я настоятельно рекомендую вам ознакомиться с первым, поскольку буду считать, что вы уже знакомы со всеми рассмотренными мною ранее понятиями. В этом руководстве мы завершим рассмотрение аспектов парадигмы CRUD (* Create, Update, Read, Delete – создать, прочесть, обновить, удалить),...">
<meta name="twitter:description" content="Приветствую вас во втором руководстве серии, посвященной IndexedDB. Я настоятельно рекомендую вам ознакомиться с первым, поскольку буду считать, что вы уже знакомы со всеми рассмотренными мною ранее понятиями. В этом руководстве мы завершим рассмотрение аспектов парадигмы CRUD (* Create, Update, Read, Delete – создать, прочесть, обновить, удалить),...">
<meta property="aiturec:description" content="Приветствую вас во втором руководстве серии, посвященной IndexedDB. Я настоятельно рекомендую вам ознакомиться с первым, поскольку буду считать, что вы уже знакомы со всеми рассмотренными мною ранее понятиями. В этом руководстве мы завершим рассмотрение аспектов парадигмы CRUD (* Create, Update, Read, Delete – создать, прочесть, обновить, удалить),...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot1.png">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot1.png">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot1.png">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot1.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot1.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html" title="Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io" title="Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533jghfdd.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html" class="tm-user-info__username" title="
Д. Слесарев" aria-label="
Д. Слесарев">
Д. Слесарев</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Работа с базой IndexedDB - Часть 2...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2" class="tm-article-snippet__hubs-item-link"><span>Web Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot1.png">
    <meta itemprop="headline name" content="Работа с базой IndexedDB - Часть 2... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Приветствую вас во втором руководстве серии, посвященной IndexedDB. Я настоятельно рекомендую вам ознакомиться с первым, поскольку буду считать, что вы уже знакомы со всеми рассмотренными мною ранее понятиями. В этом руководстве мы завершим рассмотрение аспектов парадигмы CRUD (* Create, Update, Read, Delete – создать, прочесть, обновить, удалить),...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Приветствую вас во втором руководстве серии, посвященной IndexedDB. Я настоятельно рекомендую вам ознакомиться с первым, поскольку буду считать, что вы уже знакомы со всеми рассмотренными мною ранее понятиями. В этом руководстве мы завершим рассмотрение аспектов парадигмы CRUD (* Create, Update, Read, Delete – создать, прочесть, обновить, удалить),...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>Приветствую вас во втором руководстве серии, посвященной IndexedDB. Я <em>настоятельно </em>рекомендую вам ознакомиться с <span>первым</span>, поскольку буду считать, что вы уже знакомы со всеми рассмотренными мною ранее понятиями. В этом руководстве мы завершим рассмотрение аспектов парадигмы CRUD (* Create, Update, Read, Delete – создать, прочесть, обновить, удалить), которые еще не обсудили, и затем создадим приложение из реального мира разработки, которое будем использовать для демонстрации остальных концепций в последнем руководстве.</p> <p><!--more--></p> <hr><h2>Обновление записей</h2> <p>Давайте начнем с обсуждения того, как обновить запись при помощи IndexedDB. Если помните, добавить данные в базу довольно просто:</p> <pre class="brush: js noskimlinks noskimwords">//Define a personvar person = {    name:name,    email:email,    created:new Date()}//Perform the addvar request = store.add(person);</pre> <p>Обновить данные не менее просто. Если мы предположим, что вы определили свойство под названием <code>id </code>в качестве ключа для вашего хранилища объектов, то можете просто воспользоваться методом <code>put</code> вместо <code>add</code>.</p> <pre class="brush: js noskimlinks noskimwords">var person = {    name:name,    email:email,    created:new Date(),    id:someId}//Perform the updatevar request = store.put(person);</pre> <p>Как и в случае с методом <code>add</code>, при использовании метода put  вы можете назначать методы для асинхронной обработки результатов операции. </p> <hr><h2>Удаление записей</h2> <p>Удаление записей осуществляется при помощи метода delete. (Как неожиданно.) Вы просто передаете уникальный идентификатор записи, которую хотите удалить. Ниже показан простой пример:</p> <pre class="brush: js noskimlinks noskimwords">var t = db.transaction(["people"], "readwrite");var request = t.objectStore("people").delete(thisId);</pre> <p>И как и при работе с другими методами IndexedDB, вы можете добавить ваши обработчики для асинхронной обработки результатов операции.</p> <p>Что ж, как я упомянул, все это выглядит не очень захватывающе, что, вероятно, и хорошо. Вам нужно, чтобы ваши API были простыми, скучными и без неожиданностей. Теперь давайте воспользуемся тем, что уже изучили, и создадим приложение из реального мира разработки.</p> <hr><h2>Приложение для ведения записей</h2> <p>Хорошо, наконец у нас имеются все (ладно, большинство) частей, необходимых для создания приложение из реального мира разработки. Поскольку мы еще этого не сделали (<em>гм</em>), мы разработаем простое приложение для ведения записей. Давайте рассмотрим несколько скриншотов и затем разберем код, необходимый для реализации описанного в них функционала. При запуске приложения происходит инициализация IndexedDB для приложения и отображение пустой таблицы. Изначально, все что вы можете выполнить в приложении, – добавить новую запись. (Вероятно, мы могли бы сделать интерфейс более удобным для пользователя.)</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot1.png" alt="Работа с базой IndexedDB - Часть 2..." title="Работа с базой IndexedDB - Часть 2..." width="50" height="50"><br></figure><p>После нажатия кнопки <strong>Add Note</strong> появляется форма:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot2.png" alt="Работа с базой IndexedDB - Часть 2..." title="Работа с базой IndexedDB - Часть 2..." width="50" height="50"><br></figure><p>После добавления некоторых данных формы вы можете затем сохранить запись.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot3.png" alt="Работа с базой IndexedDB - Часть 2..." title="Работа с базой IndexedDB - Часть 2..." width="50" height="50"><br></figure><p>Как вы видите, у вас имеется возможность отредактировать и удалить записи. Наконец, если вы нажмете по самой записи, то сможете ознакомиться с ее содержимым:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/10/shot4.png" alt="Работа с базой IndexedDB - Часть 2..." title="Работа с базой IndexedDB - Часть 2..." width="50" height="50"><br></figure><p>Что ж, это не совсем относится к высшему пилотажу, однако является готовым рабочим примером использования спецификации IndexedDB. Добавленные записи будут продолжать существовать. Вы можете закрыть ваш браузер, перезапустить компьютер, поразмышлять несколько лет над вашей жизнью и посочинять стихи, и когда вы откроете ваш браузер снова, то ваши данные по-прежнему будут там. Теперь давайте взглянем на код:</p> <div class="tip-shortcode"> <p>Сначала – отказ от ответственности. Рассматриваемое приложение было бы отличным кандидатом, для реализации которого стоило бы воспользоваться одним из многих фреймворков JavaScript. Уверен, что те из вас, кто используют Backbone или Angular, уже могут представить, как бы реализовали наше приложение. Однако, я принял смелое решение – <em>не</em> пользоваться фреймворком. Я переживал и за тех, кто, возможно, использует другой фреймворк, так и за тех, кто не использует их вообще. Я хотел бы, чтобы мы сфокусировались здесь только на вопросах, связанных с IndexedDB. Я уверен, что найдутся люди, не согласные с этим решением, однако, давайте обсудим это в разделе для комментариев. </p> </div> <p>Наш первый образец – HTML-файл. У нас он только один, и большая часть его содержимого – стандартный код для Bootstrap (* веб-фреймворк для создания дизайна веб-сайтов и веб-приложений).</p> <pre class="brush: html noskimlinks noskimwords">&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;  &lt;head&gt;    &lt;meta charset="utf-8"&gt;    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;    &lt;title&gt;Note Database&lt;/title&gt;    &lt;link href="bootstrap/css/bootstrap.css" rel="stylesheet"&gt;    &lt;link href="css/app.css" rel="stylesheet"&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div class="navbar navbar-inverse navbar-fixed-top"&gt;      &lt;div class="container"&gt;        &lt;div class="navbar-header"&gt;          &lt;a class="navbar-brand" href="#"&gt;Note Database&lt;/a&gt;        &lt;/div&gt;      &lt;/div&gt;    &lt;/div&gt;    &lt;div class="container"&gt;        &lt;div id="noteList"&gt;&lt;/div&gt;        &lt;div class="pull-right"&gt;&lt;button id="addNoteButton" class="btn btn-success"&gt;Add Note&lt;/button&gt;&lt;/div&gt;        &lt;div id="noteDetail"&gt;&lt;/div&gt;        &lt;div id="noteForm"&gt;            &lt;h2&gt;Edit Note&lt;/h2&gt;            &lt;form role="form" class="form-horizontal"&gt;            &lt;input type="hidden" id="key"&gt;            &lt;div class="form-group"&gt;                &lt;label for="title" class="col-lg-2 control-label"&gt;Title&lt;/label&gt;                &lt;div class="col-lg-10"&gt;                &lt;input type="text" id="title" required class="form-control"&gt;                &lt;/div&gt;            &lt;/div&gt;            &lt;div class="form-group"&gt;                &lt;label for="body" class="col-lg-2 control-label"&gt;Body&lt;/label&gt;                   &lt;div class="col-lg-10"&gt;                &lt;textarea id="body" required class="form-control"&gt;&lt;/textarea&gt;                &lt;/div&gt;            &lt;/div&gt;            &lt;div class="form-group"&gt;                &lt;div class="col-lg-offset-2 col-lg-10"&gt;                    &lt;button id="saveNoteButton" class="btn btn-default"&gt;Save Note&lt;/button&gt;                &lt;/div&gt;            &lt;/div&gt;            &lt;/form&gt;        &lt;/div&gt;    &lt;/div&gt;    &lt;script src="js/jquery-2.0.0.min.js"&gt;&lt;/script&gt;    &lt;script src="bootstrap/js/bootstrap.min.js"&gt;&lt;/script&gt;    &lt;script src="js/app.js"&gt;&lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</pre> <p>Как упоминалось выше, значительная часть этого кода – стандартный код для Bootstrap. Интересующие нас части – элементы div с идентификаторами <code>noteList</code>, <code>noteDetail </code>и <code>noteForm</code>. Вы, вероятно, можете догадаться, что это те элементы div, которые мы будем обновлять после действий со стороны пользователя.</p> <h3>Пишем код главного файла приложения</h3> <p>Теперь давайте взглянем на <code>app.js</code>, главный файл, в котором содержится логика (* последовательность операций, выполняемых программно или аппаратно) нашего приложения.</p> <pre class="brush: js noskimlinks noskimwords">/* global console,$,document,window,alert */var db;function dtFormat(input) {    if(!input) return "";    var res = (input.getMonth()+1) + "/" + input.getDate() + "/" + input.getFullYear() + " ";    var hour = input.getHours();    var ampm = "AM";    if(hour === 12) ampm = "PM";    if(hour &gt; 12){        hour-=12;        ampm = "PM";    }    var minute = input.getMinutes()+1;    if(minute &lt; 10) minute = "0" + minute;    res += hour + ":" + minute + " " + ampm;    return res;}</pre> <p>Вы можете проигнорировать первую функцию, поскольку это просто вспомогательная функция для преобразования формата дат. Давайте перескочим к блоку кода, который добавляется в методе jQuery ready, зарегистрированный для объекта document. </p> <h3>Проверка поддержки IndexedDB браузером</h3> <pre class="brush: js noskimlinks noskimwords">$(document).ready(function() {    if(!("indexedDB" in window)) {        alert("IndexedDB support required for this demo!");        return;    }    var $noteDetail = $("#noteDetail");    var $noteForm = $("#noteForm");    var openRequest = window.indexedDB.open("nettuts_notes_1",1);    openRequest.onerror = function(e) {        console.log("Error opening db");        console.dir(e);    };    openRequest.onupgradeneeded = function(e) {        var thisDb = e.target.result;        var objectStore;        //Create Note OS        if(!thisDb.objectStoreNames.contains("note")) {            console.log("I need to make the note objectstore");            objectStore = thisDb.createObjectStore("note", { keyPath: "id", autoIncrement:true });          }    };    openRequest.onsuccess = function(e) {        db = e.target.result;        db.onerror = function(event) {          // Generic error handler for all errors targeted at this database"s          // requests!          alert("Database error: " + event.target.errorCode);          console.dir(event.target);        };        displayNotes();    };</pre> <p>Первое, что нам необходимо выполнить, – проверить поддержку IndexedDB браузером. Если браузер пользователя не поддерживает ее, то мы выводим сообщение пользователю и прерываем выполнение функции. Вероятно, было бы лучше, если бы мы перенаправили пользователей на страницу с подробными объяснениями причины, по которой они не могут использовать приложение. (И если честно, мы могли бы также добавить в наше приложение возможность использования в качестве запасного варианта WebSQL. Но опять-таки, в этом руководстве я буду упрощать.)</p> <p>После получения пары селекторов jQuery, которые мы будем использовать в коде нашего приложения, мы открываем соединение с базой данных IndexedDB. Код для работы с базой данных довольно прост. Вы видите, что мы создали одно хранилище объектов под названием <code>note</code> в обработчике <code>onupgradeneeded</code>. После того как код вышеуказанного обработчика выполнен, в обработчике <code>onsuccess</code> будет запущена функция <code>displayNotes</code>. </p> <h3>Функция <code>displayNotes</code></h3> <pre class="brush: js noskimlinks noskimwords">    function displayNotes() {        var transaction = db.transaction(["note"], "readonly");          var content="&lt;table class="table table-bordered table-striped"&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Updated&lt;/th&gt;&lt;th&gt;&amp;amp;nbsp;&lt;/td&gt;&lt;/thead&gt;&lt;tbody&gt;";        transaction.oncomplete = function(event) {            $("#noteList").html(content);        };        var handleResult = function(event) {            var cursor = event.target.result;            if (cursor) {              content += "&lt;tr data-key=\""+cursor.key+"\"&gt;&lt;td class=\"notetitle\"&gt;"+cursor.value.title+"&lt;/td&gt;";            content += "&lt;td&gt;"+dtFormat(cursor.value.updated)+"&lt;/td&gt;";            content += "&lt;td&gt;&lt;a class=\"btn btn-primary edit\"&gt;Edit&lt;/a&gt; &lt;a class=\"btn btn-danger delete\"&gt;Delete&lt;/a&gt;&lt;/td&gt;";            content +="&lt;/tr&gt;";            cursor.continue();            }            else {              content += "&lt;/tbody&gt;&lt;/table&gt;";          }          };        var objectStore = transaction.objectStore("note");        objectStore.openCursor().onsuccess = handleResult;    }</pre> <p>Функция <code>displayNotes</code> выполняет то, что вы и ожидаете, – получает все данные и отображает их. Мы обсудили, как получить все данные в предыдущем руководстве, однако я хочу обратить здесь ваше внимание на один отличительный момент. Обратите внимание, что у нас имеется новый обработчик событий, <code>oncomplete</code>, который мы подвязали к самой транзакции (* групповая операция). Ранее вы использовали обработчики только внутри методов для выполнения действий, <em>внутри </em>транзакции, однако при помощи IndexedDB мы также можем использовать их и на верхнем уровне. Это становится особенно полезным в случаях вроде нашего. У нас имеется огромная строка, наша HTML-таблица, которую создали при итерации по нашим данным. Мы можем воспользоваться обработчиком транзакции <code>oncomplete</code>, чтобы обернуть порцию данных для отображения и отобразить ее при помощи единственного вызова jQuery. </p> <h3>Функции для удаления, редактирования и добавления записей</h3> <pre class="brush: js noskimlinks noskimwords">    $("#noteList").on("click", "a.delete", function(e) {        var thisId = $(this).parent().parent().data("key");        var t = db.transaction(["note"], "readwrite");        var request = t.objectStore("note").delete(thisId);        t.oncomplete = function(event) {            displayNotes();            $noteDetail.hide();            $noteForm.hide();        };        return false;    });    $("#noteList").on("click", "a.edit", function(e) {        var thisId = $(this).parent().parent().data("key");        var request = db.transaction(["note"], "readwrite")                          .objectStore("note")                          .get(thisId);          request.onsuccess = function(event) {              var note = request.result;            $("#key").val(note.id);            $("#title").val(note.title);            $("#body").val(note.body);            $noteDetail.hide();            $noteForm.show();        };        return false;    });    $("#noteList").on("click", "td", function() {        var thisId = $(this).parent().data("key");        var transaction = db.transaction(["note"]);          var objectStore = transaction.objectStore("note");          var request = objectStore.get(thisId);        request.onsuccess = function(event) {              var note = request.result;            $noteDetail.html("&lt;h2&gt;"+note.title+"&lt;/h2&gt;&lt;p&gt;"+note.body+"&lt;/p&gt;").show();            $noteForm.hide();        };      });    $("#addNoteButton").on("click", function(e) {        $("#title").val("");        $("#body").val("");        $("#key").val("");        $noteDetail.hide();        $noteForm.show();           });</pre> <p>Наши следующие два метода (<code>delete </code>и <code>edit</code>) реализуются согласно тому же принципу. Поскольку в этом коде нет новых вызовов IndexedDB, то мы не будем на них обращать внимание. Большей частью «мяса» здесь являеются простые манипуляции с DOM (* Document Object Model – объектная модель документа) для выполнения определенных действий. Обработчик события click для кнопки, при помощи которой добавляются записи, как раз для этого и служит.</p> <h3>Функция <code>Save</code></h3> <pre class="brush: js noskimlinks noskimwords">    $("#saveNoteButton").on("click",function() {        var title = $("#title").val();        var body = $("#body").val();        var key = $("#key").val();        var t = db.transaction(["note"], "readwrite");        if(key === "") {            t.objectStore("note")                            .add({title:title,body:body,updated:new Date()});        } else {            t.objectStore("note")                            .put({title:title,body:body,updated:new Date(),id:Number(key)});        }        t.oncomplete = function(event) {            $("#key").val("");            $("#title").val("");            $("#body").val("");            displayNotes();            $noteForm.hide();                   };        return false;    });});</pre> <p>Следующий лакомый кусочек – функция <code>save</code>. В нее необходимо добавить немного логики, чтобы определить, происходит ли обновление или добавление данных, однако даже это довольно просто. И на этом все! Теперь у нас имеется готовое приложение, использующее IndexedDB. Вы можете поэкспериментировать с этой демоверсией, скачав прикрепленные файлы с исходный кодом. </p> <hr><h2>В заключение</h2> <p>На этом вторая часть серии подошла к концу! В третьем руководстве мы продолжим работать с этим приложением и начнем добавлять дополнительные возможности, включая возможность поиска данных и возможности, реализуемые при помощи массива.</p> 

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825550-rabota-s-bazoj-indexeddb--chast-2" class="tm-article-body__tags-item-link">Web Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
40628</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
350</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
