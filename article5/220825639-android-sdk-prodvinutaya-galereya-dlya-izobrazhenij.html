
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="С помощью Android-Intents и-Gallery View, можно разрешить пользователю выбирать изображения на их устройстве. В этом уроке мы объединим выбор изображений с-Gallery View, который мы немного-улучшим-создав интерактивную функцию для показа выбранных пользователем изображений. Если вы создавали хотя бы одно приложение для Android, вы вполне справитесь ...">
<meta property="og:description" content="С помощью Android-Intents и-Gallery View, можно разрешить пользователю выбирать изображения на их устройстве. В этом уроке мы объединим выбор изображений с-Gallery View, который мы немного-улучшим-создав интерактивную функцию для показа выбранных пользователем изображений. Если вы создавали хотя бы одно приложение для Android, вы вполне справитесь ...">
<meta name="twitter:description" content="С помощью Android-Intents и-Gallery View, можно разрешить пользователю выбирать изображения на их устройстве. В этом уроке мы объединим выбор изображений с-Gallery View, который мы немного-улучшим-создав интерактивную функцию для показа выбранных пользователем изображений. Если вы создавали хотя бы одно приложение для Android, вы вполне справитесь ...">
<meta property="aiturec:description" content="С помощью Android-Intents и-Gallery View, можно разрешить пользователю выбирать изображения на их устройстве. В этом уроке мы объединим выбор изображений с-Gallery View, который мы немного-улучшим-создав интерактивную функцию для показа выбранных пользователем изображений. Если вы создавали хотя бы одно приложение для Android, вы вполне справитесь ...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/picselect_init.png">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/picselect_init.png">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/picselect_init.png">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/picselect_init.png">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/picselect_init.png">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html" title="Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io" title="Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/e_09402063.jpg" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html" class="tm-user-info__username" title="
А. Карпов" aria-label="
А. Карпов">
А. Карпов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Android SDK: Продвинутая галерея для изображений...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij" class="tm-article-snippet__hubs-item-link"><span>Android SDK</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/picselect_init.png">
    <meta itemprop="headline name" content="Android SDK: Продвинутая галерея для изображений... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="С помощью Android-Intents и-Gallery View, можно разрешить пользователю выбирать изображения на их устройстве. В этом уроке мы объединим выбор изображений с-Gallery View, который мы немного-улучшим-создав интерактивную функцию для показа выбранных пользователем изображений. Если вы создавали хотя бы одно приложение для Android, вы вполне справитесь ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">С помощью Android-Intents и-Gallery View, можно разрешить пользователю выбирать изображения на их устройстве. В этом уроке мы объединим выбор изображений с-Gallery View, который мы немного-улучшим-создав интерактивную функцию для показа выбранных пользователем изображений. Если вы создавали хотя бы одно приложение для Android, вы вполне справитесь ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>С помощью Android Intents и Gallery View, можно разрешить пользователю выбирать изображения на их устройстве. В этом уроке мы объединим выбор изображений с Gallery View, который мы немного улучшим создав интерактивную функцию для показа выбранных пользователем изображений. Если вы создавали хотя бы одно приложение для Android, вы вполне справитесь со всеми этапами урока.</p> <p>Приложение, которое мы создадим в этом уроке будет отображать прокручиваемую ленту изображений, с помощью Android Gallery View. Пользователь сможет импортировать изображения нажав на объект в галерее, которые будут взяты из галереи по-умолчанию или с помощью файлового менеджера. Когда изображение выбрано, мы обработаем его до того как показать, поэтому мы не задействуем лишние ресурсы памяти. При нажатии на эскиз, приложение покажет выбранное изображение в увеличенном виде.</p> <h2>Шаг 1: Создание проекта Android</h2> <p>Запустите новый проект в Eclipse. В main Activity классе вашего приложения добавьте в начале следующие операторы импорта, это нужно сделать до объявления класса:</p> <pre class="brush: java noskimlinks noskimwords">import android.app.Activity;import android.content.Context;import android.content.Intent;import android.content.res.TypedArray;import android.database.Cursor;import android.graphics.Bitmap;import android.graphics.BitmapFactory;import android.net.Uri;import android.os.Bundle;import android.provider.MediaStore;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.AdapterView.OnItemClickListener;import android.widget.AdapterView.OnItemLongClickListener;import android.widget.BaseAdapter;import android.widget.Gallery;import android.widget.ImageView;</pre> <p>Объявление класса должно быть примерно такое, но с вашим названием Activity:</p> <pre class="brush: java noskimlinks noskimwords">public class PicSelectActivity extends Activity {</pre> <p>Внутри класса, до метода «onCreate», который Eclipse должен автоматически включить, добавьте следующие переменные:</p> <pre class="brush: java noskimlinks noskimwords">//variable for selection intentprivate final int PICKER = 1;//variable to store the currently selected imageprivate int currentPic = 0;//gallery objectprivate Gallery picGallery;//image view for larger displayprivate ImageView picView;</pre> <p>Первая переменная - константа, которая используется для идентификации изображения, после того как пользователь его выбрал. Когда пользователь нажимает на эскиз и переходит к выбору изображения, мы будем использовать переменную «currentPic» чтобы отслеживать какие эскиз выбран. Две другие переменные необходимы для элементов пользовательского интерфейса, которые указаны в классе.</p> <p>В файле манифеста, единственное дополнение, которые вы должны сделать, указать элемент main Activity для вашего приложения:</p> <pre class="brush: xml noskimlinks noskimwords">android:configChanges="orientation|keyboardHidden"</pre> <p>Это позволит приложению сохранять изображения при смене ориентации устройства. Теперь давайте настроим текстовые строки, которые мы будем использовать в пользовательском интерфейсе. Откройте файл «res/values/strings.xml». Eclipse должен был уже добавить имя вашего приложения, которое вы можете изменить, если захотите. Добавьте следующие строки:</p> <pre class="brush: xml noskimlinks noskimwords">&lt;string name="picture"&gt;Picture&lt;/string&gt;&lt;string name="select_intro"&gt;Long-press a thumbnail to add an image&lt;/string&gt;&lt;string name="show_intro"&gt;Press a thumbnail to display at larger size&lt;/string&gt;</pre> <p>Это все будет использовано в интерфейсе. Теперь вернемся к нашему классу Activity.</p> <h2>Шаг 2: Дизайн приложения</h2> <p>Прежде чем мы напишем функционал на Java, давайте оформим элементы приложения. Откройте «res/layout/main.xml» файл. Мы будем использовать Linear Layout, поэтому добавьте следующие строки в файл XML:</p> <pre class="brush: xml noskimlinks noskimwords">&lt;LinearLayout xmlns:android="https://schemas.android.com/apk/res/android"    android:layout_width="fill_parent"    android:layout_height="fill_parent"    android:orientation="vertical" &gt;   &lt;/LinearLayout&gt;</pre> <p>Мы добавим ещё больше элементов в наш Linear Layout. Начнём с Text View как первого элемента в Linear Layout:</p> <pre class="brush: xml noskimlinks noskimwords">&lt;TextView android:layout_width="fill_parent"  android:layout_height="wrap_content"android:padding="5dp"android:text="@string/select_intro"android:gravity="center"android:textStyle="bold" /&gt;</pre> <p>Обратите внимание, что мы ссылаемся на строку которую определили в файле XML. Далее добавьте элемент галереи следующим образом:</p> <pre class="brush: xml noskimlinks noskimwords">&lt;Galleryandroid:id="@+id/gallery"android:layout_width="fill_parent"android:layout_height="wrap_content" /&gt;</pre> <p>Мы используем атрибут ID, поэтому мы сможем обратиться к объекту в Java коде. Затем добавим еще один Text View:</p> <pre class="brush: xml noskimlinks noskimwords">&lt;TextView android:layout_width="fill_parent"android:layout_height="wrap_content"android:gravity="center"android:padding="5dp"android:textStyle="italic"android:text="@string/show_intro" /&gt;</pre> <p>Опять, мы используем строку, которую уже определили. Наконец, последним пунктом в нашем Linear Layout будет Image View, который будет показывать увеличенное изображение галереи:</p> <pre class="brush: xml noskimlinks noskimwords">&lt;ImageView android:id="@+id/picture"android:layout_width="fill_parent"android:layout_height="fill_parent"android:contentDescription="@string/picture" /&gt;</pre> <p>Мы должны будем сослаться на этот View в Java коде, поэтому мы используем атрибут ID. Также, мы используем строку в качестве описания содержимого. Теперь нам нужно определить стиль для галереи. Создайте новый файл в каталоге "res/values", и назовите его "attrs.xml". Напишите следующий код:</p> <pre class="brush: xml noskimlinks noskimwords">&lt;resources&gt;&lt;declare-styleable name="PicGallery"&gt;&lt;attr name="android:galleryItemBackground" /&gt;&lt;/declare-styleable&gt;&lt;/resources&gt;</pre> <p>Мы собираемся использовать некоторые из ресурсов платформы Android для оформления элементов нашей галереи и будем ссылаться к ним в Java коде.</p> <p>Теперь вернемся к нашему Activity классу. Внутри метода "onCreate" существующий код должен выглядеть следующим образом:</p> <pre class="brush: java noskimlinks noskimwords">super.onCreate(savedInstanceState);setContentView(R.layout.main);</pre> <p>После этого, добавьте ссылки на два элемента пользовательского интерфейса:</p> <pre class="brush: java noskimlinks noskimwords">//get the large image viewpicView = (ImageView) findViewById(R.id.picture);        //get the gallery viewpicGallery = (Gallery) findViewById(R.id.gallery);</pre> <p>Теперь мы готовы создать галерею и обработать взаимодействия с пользователем.</p> <h2>Шаг 3: Создаём Base Adapter</h2> <p>Чтобы создать Gallery View, мы собираемся создать класс, который расширяет Base Adapter. В вашем классе Activity после метода «onCreate», создайте новый подкласс следующим образом:</p> <pre class="brush: java noskimlinks noskimwords">public class PicAdapter extends BaseAdapter {}</pre> <p>Здесь мы задействуем несколько методов, которые понадобятся для Base Adapter и позже добавим несколько методов в приложение. Для начала добавим в класс несколько переменных:</p> <pre class="brush: java noskimlinks noskimwords">//use the default gallery background imageint defaultItemBackground;        //gallery contextprivate Context galleryContext;//array to store bitmaps to displayprivate Bitmap[] imageBitmaps;//placeholder bitmap for empty spaces in galleryBitmap placeholder;</pre> <p>Первая переменная представляет фоновый цвет элемента Android Gallery, на которую мы указываем в нашем "attrs.xml" файле. Context указывает на пользовательский интерфейс при добавлении элементов. Массив Bitmap хранит изображения, которые мы будем отображать в Gallery View. Чтобы начать с чего-то, мы будем использовать изображение "заглушку", в качестве элементов галереи, которые пользователь ещё не выбрал.</p> <p>Пойдём дальше и и создадим метод конструктора для нашего нового класса PicAdapter, после переменных:</p> <pre class="brush: java noskimlinks noskimwords">public PicAdapter(Context c) {//instantiate contextgalleryContext = c;//create bitmap arrayimageBitmaps  = new Bitmap[10];            //decode the placeholder imageplaceholder = BitmapFactory.decodeResource(getResources(), R.drawable.ic_launcher);//more processing}</pre> <p>Мы добавим больше кода в метод конструктора позже. Сначала мы создадим переменные массивы Context и Bitmap - мы собираемся показать галерею с 10 объектами в ней, но вы можете изменить эту величину, если хотите. Для демонстрации мы используем стандартную иконку проекта в Eclipse, в качестве "заглушки" изображения, но вы конечно же можете создать свою. Если вы хотите использовать ваше изображение, сохраните его в папках drawable и измените значение строки "decodeResource" в соответствии с новым именем.</p> <p>Теперь мы можем назначить "заглушку" изображения для каждой позиции в массиве, так что все эскизы галереи первоначально будут отображать её - находясь еще внутри метода-конструктора:</p> <pre class="brush: java noskimlinks noskimwords">//set placeholder as all thumbnail images in the gallery initiallyfor(int i=0; i&lt;imageBitmaps.length; i++)imageBitmaps[i]=placeholder;</pre> <p>Чтобы завершить метод конструктора, мы установим фоновое изображение для элемента галереи:</p> <pre class="brush: java noskimlinks noskimwords">//get the styling attributes - use default Andorid system resourcesTypedArray styleAttrs = galleryContext.obtainStyledAttributes(R.styleable.PicGallery);//get the background resourcedefaultItemBackground = styleAttrs.getResourceId(R.styleable.PicGallery_android_galleryItemBackground, 0);//recycle attributesstyleAttrs.recycle();</pre> <p>Здесь мы указываем на содержание нашего "attrs.xml" файла.</p> <p>Теперь нам нужно задействовать несколько стандартных методов, расширяя класс Base Adapter. Для начала подключим метод "getCount", после метода конструктора:</p> <pre class="brush: java noskimlinks noskimwords">//return number of data items i.e. bitmap imagespublic int getCount() {return imageBitmaps.length;}</pre> <p>Этот метод возвращает количество объектов в галерее. После этого метода добавьте стандартный метод "getItem":</p> <pre class="brush: java noskimlinks noskimwords">//return item at specified positionpublic Object getItem(int position) {return position;}</pre> <p>Далее добавим метод "getItemId":</p> <pre class="brush: java noskimlinks noskimwords">//return item ID at specified positionpublic long getItemId(int position) {return position;}</pre> <p>Вам не нужно слишком беспокоиться о содержании этих методов, поскольку они являются стандартными. Теперь мы добавим немного более сложный метод, необходимый для класса:</p> <pre class="brush: java noskimlinks noskimwords">//get view specifies layout and display options for each thumbnail in the gallerypublic View getView(int position, View convertView, ViewGroup parent) {//create the viewImageView imageView = new ImageView(galleryContext);//specify the bitmap at this position in the arrayimageView.setImageBitmap(imageBitmaps[position]);//set layout optionsimageView.setLayoutParams(new Gallery.LayoutParams(300, 200));//scale type within view areaimageView.setScaleType(ImageView.ScaleType.FIT_CENTER);//set default gallery item backgroundimageView.setBackgroundResource(defaultItemBackground);//return the viewreturn imageView;}</pre> <p>В методе "getView" мы определяем, что мы хотим показать в каждом элементе галереи. Наш массив Bitmap будет содержать изображения, в каждой позиции с индексом массива Bitmap, соответствующий его позиции в галерее. Также как при создании View, мы устанавливаем Bitmap для отображения, вместе с некоторыми свойствами. Также мы установим фоновый цвет элемента, который мы упоминали ранее. При желании вы можете изменить размер эскизов. Каждый эскиз будет отображаться отцентрированным, если его размер меньше, чем объект View - вы можете выбрать другую опцию, к примеру, растянуть изображение, чтобы соответствовать размеру поля, изменив параметр "ScaleType".</p> <p>Теперь вернёмся к началу класса main Activity вашего приложения. Добавим новую переменную, представляющую объект нового класса, который вы только что создали:</p> <pre class="brush: java noskimlinks noskimwords">//adapter for gallery viewprivate PicAdapter imgAdapt;</pre> <p>Теперь в методе "onCreate" после кода, который вы добавили, задействуйте переменную Base Adapter и установите его в качестве адаптера для галереи:</p> <pre class="brush: java noskimlinks noskimwords">//create a new adapterimgAdapt = new PicAdapter(this);//set the gallery adapterpicGallery.setAdapter(imgAdapt);</pre> <p>При первоначальном запуске приложения, всё должно выглядеть примерно так:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/picselect_init.png" alt="Android SDK: Продвинутая галерея для изображений..." title="Android SDK: Продвинутая галерея для изображений..." width="50" height="50"></figure><p>Теперь мы готовы обрабатывать взаимодействия с пользователем.</p> <h2>Шаг 4: Разрешаем пользователю выбрать изображения</h2> <p>Чтобы выбрать изображения для галереи, пользователь должен нажать на эскиз. В методе "onCreate" после существующего кода, добавьте следующий обработчик события для каждого элемента в Gallery View:</p> <pre class="brush: java noskimlinks noskimwords">//set long click listener for each gallery thumbnail itempicGallery.setOnItemLongClickListener(new OnItemLongClickListener() {//handle long clickspublic boolean onItemLongClick(AdapterView&lt;?&gt; parent, View v, int position, long id) {//take user to choose an image}});</pre> <p>Мы создаем новый обработчик "OnItemLongClickListener" с методом "onItemLongClick" внутри него. Добавьте следующий код внутри метода:</p> <pre class="brush: java noskimlinks noskimwords">//update the currently selected position so that we assign the imported bitmap to correct itemcurrentPic = position;//take the user to their chosen image selection app (gallery or file manager)Intent pickIntent = new Intent();pickIntent.setType("image/*");pickIntent.setAction(Intent.ACTION_GET_CONTENT);//we will handle the returned data in onActivityResultstartActivityForResult(Intent.createChooser(pickIntent, "Select Picture"), PICKER);return true;</pre> <p>Найдите минутку и взгляните на то, что получилось. Сначала, мы записываем выбранный элемент, теперь мы знаем, какой элемент в галерее выбран. Затем код сообщает приложению, что необходимо дать пользователю выбрать приложение для выбора изображения, это может быть Галерея Android или файловый менеджер. Указав "ACTION_GET_CONTENT", мы даём задание приложению вернуть результат выбора пользователя. Поскольку мы запускаем событие выбора с помощью "startActivityForResult", мы сможем обработать возвращаемые изображения в Activity метода "onActivityResult".</p> <p>То, что произойдёт, когда событие выбора изображения запущено будет зависеть от того какие приложения установил пользователь. На моем устройстве я могу выбрать из двух приложений:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/app_choice.png" alt="Android SDK: Продвинутая галерея для изображений..." title="Android SDK: Продвинутая галерея для изображений..." width="50" height="50"></figure><p>Файл изображения который я выберу в любом из этих приложений будет возвращён в приложение.</p> <h2>Шаг 5: Управление полученными изображениями</h2> <p>Когда пользователь выбирает изображение из галереи или файлового менеджера приложения, данные будут возвращены в метод "onActivityResult". Добавьте метод к классу Activity, используя следующую структуру:</p> <pre class="brush: java noskimlinks noskimwords">protected void onActivityResult(int requestCode, int resultCode, Intent data) {}/java]Inside the method, add the following:[java]if (resultCode == RESULT_OK) {//check if we are returning from picture selectionif (requestCode == PICKER) {            //import the image            }}//superclass methodsuper.onActivityResult(requestCode, resultCode, data);</pre> <p>Здесь мы проверяем, что мы получили корректные данные и что данные вернулись после события выбора. Мы вызовем метод суперкласса в конце метода. Внутри второго оператора "if" мы добавим весь код который нужен для импорта выбранного изображения, начиная с URI изображения:</p> <pre class="brush: java noskimlinks noskimwords">//the returned picture URIUri pickedUri = data.getData();</pre> <p>Нам нужно немного больше чтобы импортировать изображение. Начнём с объявления нескольких переменных:</p> <pre class="brush: java noskimlinks noskimwords">//declare the bitmapBitmap pic = null;//declare the path stringString imgPath = "";</pre> <p>Теперь, давайте, попытаемся получить путь изображения:</p> <pre class="brush: java noskimlinks noskimwords">//retrieve the string using media dataString[] medData = { MediaStore.Images.Media.DATA };//query the dataCursor picCursor = managedQuery(pickedUri, medData, null, null, null);if(picCursor!=null){//get the path stringint index = picCursor.getColumnIndexOrThrow(MediaStore.Images.Media.DATA);picCursor.moveToFirst();imgPath = picCursor.getString(index);}elseimgPath = pickedUri.getPath();</pre> <p>Теперь мы получим данные изображения, затем отправим запрос используя курсор, передадим URI изображения выбранного пользователем. Условия "if" и "else" обрабатывают выбор изображения пользователем через стандартную галерею или с помощью файлового менеджера. Конечным результатом кода будет путь к выбранному изображению.</p> <h2>Шаг 6: Отображение обработанных изображений для снижения нагрузки на использование памяти</h2> <p>Вместо того, чтобы просто показать выбранные пользователем изображения, мы должны свести к минимуму количество памяти которое будет использовать наше приложение. В большинстве случаев изображения на устройстве будут гораздо больше, чем мы можем отобразить в приложении. По этой причине нам нужно обработать изображения перед его отображением в приложении. Находясь внутри второго оператора "if" в "onActivityResult" добавьте следующее:</p> <pre class="brush: java noskimlinks noskimwords">//if we have a new URI attempt to decode the image bitmapif(pickedUri!=null) {}</pre> <p>Внутри этого выражения мы обработаем и импортируем изображение. Начнём с определения необходимой ширины и высоты для изображений, это будет самый большой размер для отображения изображения:</p> <pre class="brush: java noskimlinks noskimwords">//set the width and height we want to use as maximum displayint targetWidth = 600;int targetHeight = 400;</pre> <p>Теперь нам нужно настроить объект Bitmap чтобы декодировать изображение:</p> <pre class="brush: java noskimlinks noskimwords">//create bitmap options to calculate and use sample sizeBitmapFactory.Options bmpOptions = new BitmapFactory.Options();</pre> <p>Сначала узнаем больше о размере изображения:</p> <pre class="brush: java noskimlinks noskimwords">//first decode image dimensions only - not the image bitmap itselfbmpOptions.inJustDecodeBounds = true;BitmapFactory.decodeFile(imgPath, bmpOptions);//image width and height before samplingint currHeight = bmpOptions.outHeight;int currWidth = bmpOptions.outWidth;</pre> <p>Теперь передадим настройки Bitmap для обработки размеров изображения, но не самого изображения. Мы будем использовать эту информацию для определения подходящего размера для импорта изображения, и начнём с задействования переменной которую сохраним:</p> <pre class="brush: java noskimlinks noskimwords">//variable to store new sample sizeint sampleSize = 1;</pre> <p>Теперь вычислим размер образца, и если необходимый размер меньше, чем размер изображения по-умолчанию:</p> <pre class="brush: java noskimlinks noskimwords">//calculate the sample size if the existing size is larger than target sizeif (currHeight&gt;targetHeight || currWidth&gt;targetWidth) {//use either width or heightif (currWidth&gt;currHeight)sampleSize = Math.round((float)currHeight/(float)targetHeight);else sampleSize = Math.round((float)currWidth/(float)targetWidth);}</pre> <p>Теперь мы можем установить размер образца Bitmap:</p> <pre class="brush: java noskimlinks noskimwords">//use the new sample sizebmpOptions.inSampleSize = sampleSize;</pre> <p>Теперь нам нужно настроить параметры Bitmap для того, чтобы декодировать само содержимое файла, а не только его размеры:</p> <pre class="brush: java noskimlinks noskimwords">//now decode the bitmap using sample optionsbmpOptions.inJustDecodeBounds = false;</pre> <p>Наконец мы можем обработать Bitmap используя наши настройки:</p> <pre class="brush: java noskimlinks noskimwords">//get the file as a bitmappic = BitmapFactory.decodeFile(imgPath, bmpOptions);</pre> <p>Теперь переменная "pic" содержит Bitmap изображения, которое мы будем использовать в приложении.</p> <h2>Шаг 7: Добавляем выбранные изображения в галерею</h2> <p>Теперь у нас есть выбранное пользователем изображение, и мы можем добавить его в массив Gallery. Для этого нам нужно добавить метод в класс Base Adapter. Внутри класса "PicAdapter" добавьте следующий метод после "getView":</p> <pre class="brush: java noskimlinks noskimwords">//helper method to add a bitmap to the gallery when the user chooses onepublic void addPic(Bitmap newPic){//set at currently selected indeximageBitmaps[currentPic] = newPic;}</pre> <p>Теперь вернёмся к "onActivityResult", и после строки, в которой мы обработали файл изображения и сохранили результат в переменной "pic", добавьте следующее:</p> <pre class="brush: java noskimlinks noskimwords">//pass bitmap to ImageAdapter to add to arrayimgAdapt.addPic(pic);//redraw the gallery thumbnails to reflect the new additionpicGallery.setAdapter(imgAdapt);</pre> <p>Сначала мы вызовем новый метод, чтобы добавить новое изображение в массив Gallery, а затем мы установим Adapter так, что новое изображение мгновенно появится в Gallery View.</p> <h2>Шаг 8: Показываем большое изображение</h2> <p>Наконец, мы покажем одно изображение большего размера. Изображение будет показано в larger Image View в момент импорта в приложение и затем когда пользователь выбирает его в галерее. Для начала, настроим показ изображения большего размера, когда пользователь импортирует его. В методе "onActivityResult", после строк в которой мы вызывали "setAdapter", добавьте следующее:</p> <pre class="brush: java noskimlinks noskimwords">//display the newly selected image at larger sizepicView.setImageBitmap(pic);//scale optionspicView.setScaleType(ImageView.ScaleType.FIT_CENTER);</pre> <p>У нас есть переменная, содержащая увеличенное изображение, поэтому можно просто объединить их вместе с параметрами обработки. Теперь давайте обработаем показ увеличенного изображения, когда пользователь нажимает на эскиз. В классе "PicAdapter" добавьте еще один метод после "addPic":</p> <pre class="brush: java noskimlinks noskimwords">//return bitmap at specified position for larger displaypublic Bitmap getPic(int posn){//return bitmap at posn indexreturn imageBitmaps[posn];}</pre> <p>Этот метод просто возвращает изображение в указанную позицию. Теперь перейдём к Activity методу "onCreate". После того как вы добавили обработчик нажатия, добавьте обработчик для каждого объекта Gallery View. </p> <pre class="brush: java noskimlinks noskimwords">//set the click listener for each item in the thumbnail gallerypicGallery.setOnItemClickListener(new OnItemClickListener() {//handle clickspublic void onItemClick(AdapterView&lt;?&gt; parent, View v, int position, long id) {//set the larger image view to display the chosen bitmap calling method of adapter classpicView.setImageBitmap(imgAdapt.getPic(position));}});</pre> <p>Метод "onItemClick" будет срабатывать каждый раз когда пользователь будет нажимать на эскиз в галерее. Теперь мы вызываем новый метод "getPic", который добавили в класс "PicAdapter" чтобы получить Bitmap выбранной позиции, и устанавливаем в качестве Image View Bitmap для его отображения в увеличенном размере.</p> <h2>Заключение</h2> <p>Итак, мы создали наше приложение галерею. Протестируйте его на вашем устройстве, импортируйте изображения нажимая на эскизы и при нажатии на каждый эскиз, в свою очередь, просматривайте увеличенное изображение. Когда пользователь выбирает несколько изображений, приложение должно выглядеть примерно следующим образом:</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=480/mobile/uploads/legacy/Android-SDK_GalleryView/gallery_complete.png" alt="Android SDK: Продвинутая галерея для изображений..." title="Android SDK: Продвинутая галерея для изображений..." width="50" height="50"></figure><p>Конечно, вы можете улучшить приложение в соответствии с вашими потребностями, например внести дополнительные действия для изображения. Исходный код можно скачать по ссылке, поэтому вы сможете проверить, всё ли у вас правильно.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Android SDK" href="https://norma-studio.github.io/article5/220825639-android-sdk-prodvinutaya-galereya-dlya-izobrazhenij" class="tm-article-body__tags-item-link">Android SDK</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
44467</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
587</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
