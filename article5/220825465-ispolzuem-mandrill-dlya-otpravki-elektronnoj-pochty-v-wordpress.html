
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="На большинстве сайтов WordPress отправка электронной почты - это не то, о чем вы часто думаете. Функциональность по умолчанию просто прекрасна: электронная почта отправляется непосредственно с вашего веб-хоста с использованием функции PHP mail, и большую часть времени она-просто отлично-достигает получателя. ...">
<meta property="og:description" content="На большинстве сайтов WordPress отправка электронной почты - это не то, о чем вы часто думаете. Функциональность по умолчанию просто прекрасна: электронная почта отправляется непосредственно с вашего веб-хоста с использованием функции PHP mail, и большую часть времени она-просто отлично-достигает получателя. ...">
<meta name="twitter:description" content="На большинстве сайтов WordPress отправка электронной почты - это не то, о чем вы часто думаете. Функциональность по умолчанию просто прекрасна: электронная почта отправляется непосредственно с вашего веб-хоста с использованием функции PHP mail, и большую часть времени она-просто отлично-достигает получателя. ...">
<meta property="aiturec:description" content="На большинстве сайтов WordPress отправка электронной почты - это не то, о чем вы часто думаете. Функциональность по умолчанию просто прекрасна: электронная почта отправляется непосредственно с вашего веб-хоста с использованием функции PHP mail, и большую часть времени она-просто отлично-достигает получателя. ...">
<meta property="og:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-15.jpg">
<meta property="aiturec:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-15.jpg">
<meta name="twitter:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-15.jpg">
<meta property="vk:image" content="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-15.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-15.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html" title="Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io" title="Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/63456435436.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html" class="tm-user-info__username" title="
М. Старостенко" aria-label="
М. Старостенко">
М. Старостенко</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Используем Mandrill для отправки электронной почты в WordPress
...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress" class="tm-article-snippet__hubs-item-link"><span>WordPress</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress.html" />
    <link itemprop="image" href="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-15.jpg">
    <meta itemprop="headline name" content="Используем Mandrill для отправки электронной почты в WordPress
... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="На большинстве сайтов WordPress отправка электронной почты - это не то, о чем вы часто думаете. Функциональность по умолчанию просто прекрасна: электронная почта отправляется непосредственно с вашего веб-хоста с использованием функции PHP mail, и большую часть времени она-просто отлично-достигает получателя. ...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">На большинстве сайтов WordPress отправка электронной почты - это не то, о чем вы часто думаете. Функциональность по умолчанию просто прекрасна: электронная почта отправляется непосредственно с вашего веб-хоста с использованием функции PHP mail, и большую часть времени она-просто отлично-достигает получателя. ...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



 <p>На большинстве сайтов WordPress отправка электронной почты - это не то, о чем вы часто думаете. Функциональность по умолчанию просто прекрасна: электронная почта отправляется непосредственно с вашего веб-хоста с использованием функции PHP mail, и большую часть времени она просто отлично достигает получателя. </p><p>Тем не менее, есть некоторые проекты, такие как сайты электронной коммерции или подписки, где этого недостаточно: когда электронная почта является важной частью вашего бизнеса, вам необходимо убедиться, что сообщения доставляются как можно более надежно и быстро. Если вы также можете отслеживать открытия писем или клики, то это еще лучше. <br></p><p>В таких случаях вам необходимо изучить транзакционные почтовые службы, такие как <span>Mandrill</span> и <span>Postmark</span>. В этом уроке мы сосредоточимся на Mandrill: услуга отправки электронной почты, разработанная компанией популярной службы рассылки <span>MailChimp</span>. Mandrill является быстрым и надежным, и, самое главное, он может бесплатно получать до 12 000 сообщений каждый месяц, а это значит, что небольшие веб-сайты и бизнесы (почти) никогда не будут оплачивать обслуживание.</p><p>В этом уроке я покажу вам, как подключить Mandrill к WordPress, чтобы он выполнял всю отправку электронной почты для нас. Затем мы сделаем еще один шаг интеграции и заменим стандартное новое приветственное сообщение пользователя приятным HTML-сообщением, отправленным с использованием API Mandrill. </p><p>Требования к API Mandrill следующие:</p><ul><li>PHP 5.2.x или выше</li> <li>Расширение PHP cURL</li> </ul><p>Давайте начнем.</p><h2><b>Создание плагина WordPress</b></h2><p>При разработке новой функциональности WordPress первый вопрос, который задают часто приходит на ум, - это то, что вы строите, должно быть плагином или частью темы. С точки зрения кода, оба подхода очень похожи. Вот почему, чтобы ответить на этот вопрос, нам нужно подумать о применении: поскольку электронная почта - это то, что не зависит от темы блога, и тот же код может использоваться на любом сайте и любой теме, эта функция, по-видимому, лучше всего будет реализована в плагине.</p><p>Чтобы начать работу, давайте создадим плагин и введем некоторые основные функции.</p><p>Если вы не хотите писать плагин во время чтения учебника, <i>вы можете загрузить весь плагин в качестве учебного приложения и пройти через учебник, следуя плагину</i>.</p><h3><b>Шаг 1. Создание плагина.</b></h3><p>Сначала создайте каталог для плагина и назовите его <code class="inline">mandrill_emailer</code>.</p><p>В этом каталоге создайте два файла PHP: <code class="inline">index.php</code> для функций плагина и <code class="inline">mandrill_settings.php</code>, чтобы сохранить страницу настроек для плагина.</p><p>В <code class="inline">index.php</code> добавьте базовое объявление плагина и строку, чтобы включить страницу настроек в плагин. Исходный файл для страницы настроек, <code class="inline">mandrill_settings.php</code>, все еще может быть пустым.</p><pre class="brush: php noskimlinks noskimwords">&lt;?php/** * Plugin Name: Mandrill Emailer * Description: Routes all outgoing email through Mandrill. * Author: Jarkko Laine * Version: 1.0*/require_once "mandrill_settings.php";?&gt;</pre><h3><b>Шаг 2. Загрузите и включите API Mandrill.</b></h3><p>На первом этапе интеграции Mandrill вам фактически не понадобится API. Итак, если все, что вам нужно - это использовать Mandrill в качестве почтового сервера и не заботится об HTML-содержимом и шаблонах, вы можете пропустить этот шаг и перейти прямо к следующему разделу. <br></p><p>Однако, если вы планируете пройти весь путь и использовать API для отправки приятных сообщений электронной почты, теперь самое время установить API. </p><p>Вы можете загрузить API Mandrill со <span>страницы загрузки</span> либо в виде zip-файла, либо с помощью менеджера зависимостей PHP, <span>Composer</span>. Zip-файл прост, поэтому, если вы не знакомы с Composer, просто запустите пакет, распакуйте его, а затем скопируйте его содержимое (файл <code class="inline">Mandrill.php</code> и подкаталог <code class="inline">Mandrill</code>) в каталог плагина. </p><p>Теперь, когда вы разместили библиотеку API Mandrill внутри базы кода плагина, вам все равно нужно включить ее в проект. Чтобы сделать это, добавьте новую строку в <code class="inline">index.php</code> прямо над строкой, которая импортирует страницу настроек Mandrill:</p><pre class="brush: php noskimlinks noskimwords">require_once "Mandrill.php";require_once "mandrill_settings.php";</pre><p>API Mandrill теперь включен в проект, и у нас есть базовый плагин. Давайте активируем его в настройках WordPress, если хотите (он еще ничего не делает).</p><h3><b>Шаг 3: Создание страницы настроек</b></h3><p>Прежде чем вникать в функции электронной почты, давайте сделаем последний шаг настройки и добавим некоторый контент в <code class="inline">mandrill_settings.php</code>.</p><p>Вот список опций, которые я определил как полезные для нашего плагина на этом этапе:</p><table><thead><tr><th>Название опции</th> <th>Описание</th> </tr></thead><tbody><tr><td><code class="inline">mandrill_emailer_use_mandrill</code></td> <td>Общий флажок для включения и отключения функций Mandrill.<br></td> </tr><tr><td> <code class="inline">mandrill_emailer_username</code><br></td> <td>Имя пользователя Mandrill</td> </tr><tr><td> <code class="inline">mandrill_emailer_api_key</code><br></td> <td>Ваш ключ API Mandrill</td> </tr><tr><td> <code class="inline">mandrill_emailer_from_name</code><br></td> <td>Имя, которое будет использоваться в качестве отправителя (заголовок <i>From</i>) в сообщениях электронной почты, отправленных через Mandrill<br></td> </tr><tr><td> <code class="inline">mandrill_emailer_from_email</code><br></td> <td>Адрес электронной почты для использования в качестве отправителя (заголовок <i>From</i>) в сообщениях электронной почты, отправленных через Mandrill.</td> </tr></tbody></table><p>В дополнение к этим общим настройкам нам понадобятся имена шаблонов Mandrill, используемых для отправки HTML-сообщений. Мы вернемся к ним через некоторое время, когда мы поговорим о электронной почте HTML.</p><p>Поскольку этот учебник посвящен отправке электронной почты, а не настройкам, я кратко пройдусь по коду страницы настроек. Вы можете более подробно ознакомиться с тем, как страница была построена, изучая файл <code class="inline">mandrill_settings.php</code> в прилагаемой загрузке. Для хорошего руководства по созданию страниц настроек ознакомьтесь с полным руководством к <span>серии API-интерфейсов WordPress</span>, написанным Томом МакФарлином. </p><p>Создайте функцию для инициализации страницы параметров и зарегистрируйте ее как действие с помощью хука действия <code class="inline">action_menu</code> :</p><pre class="brush: php noskimlinks noskimwords">add_action( "admin_menu", "mandrill_emailer_settings_init" );/** * The action function for initializing the settings page. */function mandrill_emailer_settings_init() {    add_options_page( __( "Mandrill Emailer Settings", "mandrill_emailer" ),         __( "Mandrill Emailer", "mandrill_emailer" ),        "manage_options",         "mandrill-emailer",        "mandrill_emailer_settings_page"    );    // Settings sections:    // - General     // - Templates    add_settings_section(        "mandrill_emailer_setting_section_general",        __( "General Settings", "mandrill_emailer" ),        "mandrill_emailer_settings_section_callback_general",        "mandrill-emailer"    );    add_settings_section(        "mandrill_emailer_setting_section_templates",        __( "Templates", "mandrill_emailer" ),        "mandrill_emailer_settings_section_callback_templates",        "mandrill-emailer"    );    // Settings fields      add_settings_field(        "mandrill_emailer_use_mandrill",        __( "Use Mandrill for email", "mandrill_emailer" ),        "mandrill_emailer_setting_callback_use_mandrill",        "mandrill-emailer",        "mandrill_emailer_setting_section_general"    );     register_setting( "mandrill-emailer", "mandrill_emailer_use_mandrill" );    add_settings_field(        "mandrill_emailer_username",        __( "Mandrill user name", "mandrill_emailer" ),        "mandrill_emailer_setting_callback_username",        "mandrill-emailer",        "mandrill_emailer_setting_section_general"    );     register_setting( "mandrill-emailer", "mandrill_emailer_username" );    add_settings_field(        "mandrill_emailer_api_key",        __( "Mandrill API key", "mandrill_emailer" ),        "mandrill_emailer_setting_callback_api_key",        "mandrill-emailer",        "mandrill_emailer_setting_section_general"    );     register_setting( "mandrill-emailer", "mandrill_emailer_api_key" );    add_settings_field(        "mandrill_emailer_from_name",        __( "Mandrill "From" name", "mandrill_emailer" ),        "mandrill_emailer_setting_callback_from_name",        "mandrill-emailer",        "mandrill_emailer_setting_section_general"    );     register_setting( "mandrill-emailer", "mandrill_emailer_from_name" );    add_settings_field(        "mandrill_emailer_from_email",        __( "Mandrill "From" email", "mandrill_emailer" ),        "mandrill_emailer_setting_callback_from_email",        "mandrill-emailer",        "mandrill_emailer_setting_section_general"    );    register_setting( "mandrill-emailer", "mandrill_emailer_from_email" );    add_settings_field(        "mandrill_emailer_new_user_template",        __( "New user welcome", "mandrill_emailer" ),        "mandrill_emailer_setting_callback_new_user_template",        "mandrill-emailer",        "mandrill_emailer_setting_section_templates"    );    register_setting( "mandrill-emailer", "mandrill_emailer_new_user_template" );}</pre><p>Давайте рассмотрим ключевые моменты функции:</p><p>Во-первых, на <i>строках 7-12</i> мы создаем страницу настроек, делая ее по умолчанию как подменю на странице параметров WordPress. <code class="inline">mandrill_emailer_settings_page</code> - это имя функции обратного вызова, которая будет выполнять рендеринг для страницы настроек:</p><pre class="brush: php noskimlinks noskimwords">function mandrill_emailer_settings_page() {?&gt;    &lt;div class="wrap"&gt;        &lt;div id="icon-themes" class="icon32"&gt;&lt;/div&gt;        &lt;h2&gt;Mandrill Emailer Settings&lt;/h2&gt;        &lt;?php settings_errors(); ?&gt;         &lt;!-- Create the form that will be used to render our options --&gt;        &lt;form method="post" action="options.php"&gt;            &lt;?php settings_fields( "mandrill-emailer" ); ?&gt;            &lt;?php do_settings_sections( "mandrill-emailer" ); ?&gt;            &lt;?php submit_button(); ?&gt;        &lt;/form&gt;    &lt;/div&gt;&lt;?php}</pre><p>Во-вторых, по-прежнему в <code class="inline">mandrill_emailer_settings_init</code>, в <i>строках 18-30</i>, мы создаем два раздела настроек, один для общих настроек Mandrill, таких как ключ API и имя пользователя, и один для имен шаблонов, которые будут использоваться при отправке электронной почты HTML. Здесь также оба раздела настроек нуждаются в функции обратного вызова для их рендеринга:</p><pre class="brush: php noskimlinks noskimwords">function mandrill_emailer_settings_section_callback_general() {    echo "&lt;p&gt;Mandrill API configuration.&lt;/p&gt;";}function mandrill_emailer_settings_section_callback_templates() {    echo "&lt;p&gt;Copy template names from Mandrill template definition page.&lt;/p&gt;";}</pre><p>Наконец, остальная часть <code class="inline">mandrill_emailer_settings_init</code> предназначена для создания и регистрации полей реальных настроек.</p><p>В качестве примера, вот определение для настройки <i>ключа Mandrill API</i>:</p><pre class="brush: php noskimlinks noskimwords"> add_settings_field(    "mandrill_emailer_api_key",    __("Mandrill API key", "mandrill_emailer"),    "mandrill_emailer_setting_callback_api_key",    "mandrill-emailer",    "mandrill_emailer_setting_section_general"); register_setting( "mandrill-emailer", "mandrill_emailer_api_key" );</pre><p>И функция обратного вызова, которая отображает поле ввода для параметра:</p><pre class="brush: php noskimlinks noskimwords">function mandrill_emailer_setting_callback_api_key() {    echo "&lt;input name="mandrill_emailer_api_key" id="mandrill_emailer_api_key" "       . "class="regular-text" type="text" value="" . get_option( "mandrill_emailer_api_key" ) . "" /&gt;";}</pre><p>Проверьте оставшиеся настройки кода плагина (вложения). И, наконец, когда все они будут готовы, вот как будет выглядеть страница настроек:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-15.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>Теперь, с готовым плагином и его страницей настроек, мы можем, наконец, приступить к работе над Mandrill и отправкой электронной почты.</p><p>Начнем с того, что все исходящие письма пойдут через Mandrill. </p><h2><b>Использование SMTP для маршрутизации всей исходящей электронной почты через Mandrill</b></h2><p>Если все, о чем мы беспокоимся, это доставка и отслеживание, мы можем удалить немного кода: нам просто нужно направить исходящую электронную почту, чтобы она прошла через почтовый сервер Mandrill. На самом деле, как я уже упоминал выше, нам даже не понадобится API (нам нужны две из приведенных выше настроек: ключ API и имя пользователя. Имя От кого и адрес электронной почты являются необязательными, но их приятно иметь).</p><p><b>SMTP</b> (сокращение от <i>Simple Mail Transfer Protocol</i>) является стандартным почтовым протоколом для отправки электронной почты, который используется с самого начала электронной почты (сначала определенный в 1982 году!). Таким образом, отправка почты с Mandrill с использованием протокола SMTP на самом деле похожа на отправку почты через обычного поставщика услуг электронной почты. </p><p>Вот как вы можете это сделать в WordPress.</p><h3><b>Шаг 1. Создание действия для настройки инициализации PHPMailer.</b></h3><p>В WordPress вся отправка электронной почты выполняется через функцию wp_mail (вы можете найти ее определение в pluggable.php). Функция выполняет все виды проверки параметров и форматирования электронной почты, а затем передает сообщение классу <span>PHPMailer</span>, который, наконец, и отправляет сообщение. По умолчанию PHPMailer настроен на отправку электронной почты с помощью функции PHP <code class="inline">mail</code>.</p><p>Но мы не ограничиваемся использованием конфигурации по умолчанию: WordPress предоставляет хук действия, <code class="inline">phpmailer_init</code>, который мы можем использовать для настройки PHPMailer любым способом. В этом случае мы хотим использовать протокол SMTP и сервер Mandrill (<code class="inline">smtp.mandrillapp.com</code>, порт 587):</p><pre class="brush: php noskimlinks noskimwords">/**  * SMTP configuration to pass all emails (even non-templated ones)  * through Mandrill. */add_action( "phpmailer_init", "mandrill_emailer_phpmailer_init" );function mandrill_emailer_phpmailer_init( $phpmailer ) {$phpmailer-&gt;isSMTP();    $phpmailer-&gt;SMTPAuth = true;    $phpmailer-&gt;SMTPSecure = "tls";    $phpmailer-&gt;Host = "smtp.mandrillapp.com";    $phpmailer-&gt;Port = "587";     // Credentials for SMTP authentication    $phpmailer-&gt;Username = get_option("mandrill_emailer_username");    $phpmailer-&gt;Password = get_option("mandrill_emailer_api_key");     // From email and name    $from_name = get_option("mandrill_emailer_from_name");    if ( ! isset( $from_name ) ) {        $from_name = "WordPress";    }    $from_email = get_option("mandrill_emailer_from_email");    if ( ! isset( $from_email ) ) {        // Get the site domain and get rid of www.        $sitename = strtolower( $_SERVER["SERVER_NAME"] );        if ( "www." == substr( $sitename, 0, 4 )  ) {            $sitename = substr( $sitename, 4 );        }                $from_email = "wordpress@" . $sitename;    }    $phpmailer-&gt;From = $from_email;    $phpmailer-&gt;FromName = $from_name;    }</pre><p>В <i>строках 8-13</i> мы настраиваем PHPMailer для использования аутентифицированной версии SMTP-протокола и указываем URL-адрес сервера Mandrill и порт.</p><p>В <i>строчках 16-17</i> мы извлекаем имя пользователя и пароль из параметров WordPress и передаем их в PHPMailer<br></p><p>Наконец, мы устанавливаем заголовки <code class="inline">From</code> с использованием настроек, которые мы создали ранее. Если в настройках не сохранено значение, имя и адрес From генерируются так же, как и в функции <code class="inline">wp_mail</code> по умолчанию, используя URL-адрес сайта.</p><h3><b>Шаг 2. Поиск и сохранение учетных данных API</b></h3><p>Теперь мы создали действие, чтобы настроить PHPMailer на использование Mandrill вместо функции <code class="inline">mail</code> PHP, но прежде чем он сможет функционировать, нам нужно дать ему правильные имя пользователя и пароль.</p><p>Для этого <span>войдите в Mandrill</span> (или создайте учетную запись, если у вас ее еще нет). После входа в систему, нажмите <i>SMTP &amp; API Credentials</i> в верхнем правом раскрывающемся меню:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/uploads/users/343/posts/21396/image/mandrill-wp-2.jpg" class="lazy07" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>На странице <i>SMTP и API Credentials</i> создайте новый ключ API. </p><p>Для этого начните с нажатия кнопки <i>+ Новый ключ API</i>. На ее месте появится меню для создания нового ключа API.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/uploads/users/343/posts/21396/image/mandrill-wp-3.jpg" class="lazy07" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>В появившемся меню введите описание для ключа API и нажмите «<i>Создать ключ API</i>». Если вы используете API на нескольких сайтах или приложениях, рекомендуется создать отдельный ключ API для каждого из них, чтобы, если один из них был взломан, вы можете просто отключить этот ключ API, не затрагивая другие сайты.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=573/uploads/users/343/posts/21396/image/mandrill-wp-4.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>Ключ API добавляется в список ключей API. Скопируйте только что созданный ключ API и сохраните его в параметрах WordPress, используя страницу настроек <i>Mandrill Emailer</i>, которую мы создали ранее. Адрес электронной почты, который вы используете для входа в свою учетную запись Mandrill, является вашим именем пользователя.</p><p>С сохраненными настройками, я уверен, что вы захотите проверить, действительно ли электронная почта была доставлена через Mandrill, а не вашим веб-сервером. Чтобы сделать это, зайдите в блог WordPress как зарегистрированный пользователь и оставьте комментарий. Затем проверьте свой почтовый ящик для входящих сообщений, чтобы узнать, откуда пришли электронные письма с комментариями:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=506/uploads/users/343/posts/21396/image/mandrill-wp-5.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>Как показано на снимке экрана выше, по крайней мере, если вы используете Gmail, вы увидите, что <code class="inline">mandrillapp.com</code> упоминается как фактический отправитель сообщения, обозначенный словом «через» сразу после информации, которую вы предоставили в качестве имени <code class="inline">From</code> и электронной почты в настройках.</p><p>Тест подтверждает это: сообщения электронной почты теперь отправляются Mandrill.</p><p>Здорово, но мы все равно можем сделать лучше ... Пришло время посмотреть на шаблоны!</p><h2> <span class="sectionnum">4.</span> Создавайте красивые электронные письма с помощью HTML-шаблонов</h2><p>Теперь, когда мы заставили WordPress отправлять все наши письма через SMTP-сервер Mandrill, пришло время сделать еще один шаг интеграции и использовать API Mandrill для отправки электронной почты HTML.</p><p>Шаблоны - удобный способ отделить дизайн письма от кода, который используется для его отправки. В нашем случае это означает, что мы можем разработать HTML-шаблон, который подходит для темы сайта и брендинга, и хранить его в другом месте вне базы плагинов для упрощения использования и поддержки. В более крупном проекте, возможно, дизайнер будет работать над HTML, в то время как программист пишет код. </p><p>Теперь мы предпримем одно из действий электронной почты по умолчанию в потоке WordPress - <i>приветствие нового пользователя</i> и заменим его собственным электронным сообщением HTML, отправленным через Mandrill.</p><h3>Шаг 1. Создание электронной почты HTML.</h3><p>Начнем с разработки HTML-сообщения. Я пройду через эти шаги довольно быстро, но если вы хотите больше узнать о дизайне электронных писем, вы можете ознакомиться с замечательными <span>учебниками</span> и <span>курсами</span>, которые можно найти здесь, в Tuts +.</p><p>Вот простой эскиз, который я сделал, чтобы планировать, как следует формировать приветственное сообщение. Сообщение начнется с логотипа, за которым следует короткий текст приветствия и информация об учетной записи. Внизу будет ссылка на сайт:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=400/uploads/users/343/posts/21396/image/mandrill-wp-7.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>Используя эскиз в качестве ориентира, мы теперь создадим базовый шаблон HTML. </p><p>Как вы видите в приведенном ниже коде, при написании HTML для электронных писем вам нужно отказаться от многих лучших практик и написать HTML, как будто это было в 1995 году: просто продолжайте использовать таблицы, встройте свой CSS и делайте все ужасные вещи, которые вы уже давно не делаете. </p><p>Если вы это не сделаете, то некоторые получатели почты не смогут увидеть красивый дизайн, который вы создали для них ...</p><pre class="brush: html noskimlinks noskimwords">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;&lt;head&gt;    &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"/&gt;    &lt;title&gt;Message Title&lt;/title&gt;&lt;/head&gt;&lt;body style="margin:0; padding:0; font-family:Helvetica,sans-serif; font-size:13pt; line-height:150%;"&gt;    &lt;table border="0" cellpadding="0" cellspacing="0" width="100%"&gt;    &lt;tr&gt;        &lt;td&gt;            &lt;table align="center" border="0" cellpadding="0" cellspacing="0" width="600"&gt;            &lt;tr&gt;                &lt;td style="text-align:center; padding:20px 0px 0px 0px; border-top:10px solid #FA6900;"&gt;                    &lt;img src="https://s3.amazonaws.com/jl-tutsplus/logo.png" width="113" height="116" alt="Logo"/&gt;                &lt;/td&gt;            &lt;/tr&gt;            &lt;/table&gt;        &lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;td&gt;            &lt;table align="center" border="0" cellpadding="0" cellspacing="0" width="600"                 style="border-collapse:collapse; border:0px; background-color:#ffffff;"&gt;            &lt;tr&gt;                &lt;td style="padding: 20px 0 30px 0;"&gt;                    &lt;table align="center" border="0" cellpadding="0" cellspacing="0" width="520"                         style="border-collapse: collapse;"&gt;                    &lt;tr&gt;                        &lt;td style="font-size: 14px; padding: 0px 0px 10px 0px;"&gt;                            &lt;p style="text-align:center; margin-bottom: 25px;"&gt;                                &lt;b style="font-size:24px;"&gt;Welcome, John!&lt;/b&gt;                            &lt;/p&gt;                            &lt;p&gt;                                It"s great to have you with us!                                 Here"s your account information.                                 Click on the link below to sign in and edit your account.                            &lt;/p&gt;                        &lt;/td&gt;                    &lt;/tr&gt;                    &lt;tr&gt;                        &lt;td style="text-align: center;"&gt;                            &lt;table width="400" border="0" style="border-collapse: collapse; margin: auto;"&gt;                            &lt;tr&gt;                                &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;User name:&lt;/th&gt;                                &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;john_doe&lt;/td&gt;                            &lt;/tr&gt;                            &lt;tr&gt;                                &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;Password:&lt;/th&gt;                                &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;abc123&lt;/td&gt;                            &lt;/tr&gt;                            &lt;tr&gt;                                &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;First name:&lt;/th&gt;                                &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;John&lt;/td&gt;                            &lt;/tr&gt;                            &lt;tr&gt;                                &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;Last name:&lt;/th&gt;                                &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;Doe&lt;/td&gt;                            &lt;/tr&gt;                            &lt;tr&gt;                                &lt;th style="text-align: right; padding: 10px;"&gt;E-mail address:&lt;/th&gt;                                &lt;td style="text-align: left; padding: 10px;"&gt;johndoe@email.com&lt;/td&gt;                            &lt;/tr&gt;                            &lt;/table&gt;                            &lt;p&gt;                                &amp;nbsp;                            &lt;/p&gt;                        &lt;/td&gt;                    &lt;/tr&gt;                    &lt;tr&gt;                        &lt;td&gt;                            &lt;a href="#login" style="display: block; width: 100px; text-align: center; background-color: #69D2E7; color: #ffffff; text-decoration: none; padding: 15px 30px; border-radius: 5px; margin: auto;"&gt;Sign In&lt;/a&gt;                        &lt;/td&gt;                    &lt;/tr&gt;                    &lt;/table&gt;                &lt;/td&gt;            &lt;/tr&gt;            &lt;/table&gt;    &lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;td&gt;            &lt;table align="center" border="0" cellpadding="0" cellspacing="0" width="600"&gt;    &lt;tr&gt;                &lt;td style="text-align: center; padding: 20px; border-bottom: 30px solid #E0E4CC;"&gt;&amp;nbsp;&lt;/td&gt;    &lt;/tr&gt;            &lt;/table&gt;        &lt;/td&gt;    &lt;/tr&gt;    &lt;/table&gt;&lt;/body&gt;&lt;/html&gt;</pre><p>Здесь много HTML, но ничего необычного - в основном только вложенные таблицы и некоторые строки, созданные с помощью встроенного CSS.</p><p>При открытии в веб-браузере наш HTML-шаблон выглядит довольно красиво. Но у нас все еще есть чем заняться: вся информация, представленная в шаблоне, жестко запрограммирована и должна быть заменена переменными.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-8.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><h3>Шаг 2: Поместите переменные в шаблон<br></h3><p>С разработанным шаблоном HTML наша следующая задача - отметить разделы, которые будут меняться от одного сообщения к другому:</p><ul><li>Имя</li> <li>Фамилия</li> <li>Имя пользователя</li> <li>Адрес электронной почты</li> <li>Ссылка для входа</li> </ul><p>В шаблонах Mandrill вы можете пометить содержимое переменной двумя способами (оба они также используются в шаблонах MailChimp, поэтому, если вы когда-либо разрабатывали шаблон для рассылки, вы уже это видели):</p><table><thead><tr><th>Формат</th> <th>Как это работает?</th> </tr></thead><tbody><tr><td><code class="inline">*|VARIABLE|*</code></td> <td>Используя эту нотацию, вы можете вставлять переменные в любом месте шаблона. Полезно для встроенного текста в строки текста. Это также единственный способ включить переменные в текстовое сообщение.</td> </tr><tr><td> <code class="inline">mc:edit="VARIABLE"</code><br></td> <td>Эта нотация может использоваться в HTML-элементах для определения того, что содержимое элемента будет заменено значением, переданным в <code class="inline">VARIABLE</code>.<br><br>Полезно, когда вам нужно изменить более длинные блоки контента, даже переходя в некоторый HTML.</td> </tr></tbody></table><p>Теперь давайте рассмотрим фрагменты в HTML, которые мы хотим изменить на переменные.</p><p>Во-первых, заголовок. Здесь мы хотим использовать имя пользователя, который только что зарегистрировался. Создайте «переменную слияния» и назовите ее <code class="inline">FIRST_NAME</code>:</p><pre class="brush: html noskimlinks noskimwords">&lt;p style="text-align:center; margin-bottom: 25px;"&gt;    &lt;b style="font-size:24px;"&gt;Welcome, *|FIRST_NAME|*&lt;/b&gt;&lt;/p&gt;</pre><p>Текст приветствия - это то, что лучше всего хранить в шаблоне, чтобы упростить его обновление, поэтому следующее место для переменных находится в таблице, содержащей информацию об учетной записи. </p><p>Поместите переменные <code class="inline">USER_NAME</code>, <code class="inline">PASSWORD</code>, <code class="inline">FIRST_NAME</code>, <code class="inline">LAST_NAME</code> и <code class="inline">EMAIL</code>:</p><pre class="brush: html noskimlinks noskimwords">&lt;table width="400" border="0" style="border-collapse: collapse; margin: auto;"&gt;    &lt;tr&gt;        &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;User name:&lt;/th&gt;        &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;*|USER_NAME|*&lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;Password:&lt;/th&gt;        &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;*|PASSWORD|*&lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;First name:&lt;/th&gt;        &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;*|FIRST_NAME|*&lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;th style="text-align: right; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;Last name:&lt;/th&gt;        &lt;td style="text-align: left; border-bottom: 1px solid #A7DBD8; padding: 10px;"&gt;*|LAST_NAME|*&lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;th style="text-align: right; padding: 10px;"&gt;E-mail address:&lt;/th&gt;        &lt;td style="text-align: left; padding: 10px;"&gt;*|EMAIL|*&lt;/td&gt;    &lt;/tr&gt;&lt;/table&gt;</pre><p>Наконец, включите ссылку для входа на сайт (<code class="inline">LOGIN_URL</code>):</p><pre class="brush: html noskimlinks noskimwords">&lt;a href="*|LOGIN_URL|*" style="display: block; width: 100px; text-align: center; background-color: #69D2E7; color: #ffffff; text-decoration: none; padding: 15px 30px; border-radius: 5px; margin: auto;"&gt;Sign In&lt;/a&gt;</pre><p><b></b>Вот и все. Шаблон готов к использованию.</p><h3>Шаг 4. Загрузите шаблон в Mandrill</h3><p>Теперь, когда мы создали наш HTML-шаблон, давайте загрузим его в Mandrill, чтобы мы могли отправить его новым пользователям.</p><p>Чтобы создать новый шаблон в Mandrill, начните с выбора элемента «Шаблоны» в раскрывающемся меню «Исходящий»: </p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/uploads/users/343/posts/21396/image/mandrill-wp9.jpg" class="lazy07" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>На следующей странице вам будет предложено указать ваш шаблон. Окончательный идентификатор шаблона будет построен с использованием этого имени и не может быть изменен, поэтому подумайте о том, как вы хотите назвать шаблон. Я называю свой «<i>Tutsplus New User Welcome</i>», который потом превратится в идентификатор <code class="inline">tutsplus-new-user-welcome</code>.</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-10.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>Нажмите «<i>Начать кодирование</i>». </p><p>Теперь вы можете ввести свой HTML-код. Скопируйте и вставьте HTML-шаблон в большое текстовое поле справа:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-11.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><p>Сохраните шаблон, используя кнопку «<b>Сохранить черновик</b>».</p><div> <h3>Шаг 5: Включите текстовую версию<br></h3> <p>Хотя большинство почтовых клиентов нормально обрабатывают HTML письма, все еще есть некоторые клиенты, которые хотят читать свои электронные письма только простым текстом. Чтобы убедиться, что даже эти пользователи корректно получили наши сообщения, нам нужно помнить о создании простой текстовой версии шаблона. </p> <p>Для этого используйте вкладку «<b>Текст</b>» на странице редактирования шаблона в Mandrill:</p> <p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cms-assets.tutsplus.com/uploads/users/343/posts/21396/image/mandrill-wp-12.jpg" class="lazy07" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"><br></p> <p>Помимо того факта, что вы не можете использовать HTML в текстовой версии, все почти так же, как и раньше. Используя те же теги шаблонов, что и выше, давайте создадим шаблон для простого текста:</p> <pre class="brush: plain noskimlinks noskimwords">Welcome, *|FIRST_NAME|*!It"s great to have you with us! Here"s your accountinformation. Click on the link below to sign in andedit your account.User name: *|USER_NAME|*Password: *|PASSWORD|*First name: *|FIRST_NAME|*Last name: *|LAST_NAME|*E-mail address: *|EMAIL|*Sign in:*|LOGIN_URL|*</pre> <div><br></div> <p>Сохраните шаблон и сделайте его доступным для плагина, нажав «<b>Опубликовать</b>». Скопируйте идентификатор шаблона и сохраните его в настройках плагина.</p> <p>И теперь все готово для отправки сообщения. Пришло время написать код.</p> <h2>Заставляем WordPress Отправлять HTML-сообщение</h2> </div><p>Теперь, когда мы создали наш HTML-шаблон и загрузили его в Mandrill, пришло время его использовать. Для этого сначала создадим функцию для вызова API, а затем заменим функцию уведомления пользователя WordPress, чтобы использовать новую функцию.<br></p><h3>Шаг 1. Создание функции отправки электронной почты с использованием API-интерфейса Mandrill.<br></h3><p>Начнем с создания функции, которая отправит сообщение электронной почты через API Mandrill с использованием HTML-шаблона.</p><pre class="brush: php noskimlinks noskimwords">/** * Function for sending templated email messages through Mandrill API. * * @param string    $toThe recipient"s e-mail address * @param string$to_nameThe recipient"s name * @param string$templateThe name of the HTML template to use * @param string$subjectThe subject of the e-mail message * @param array$dataThe data for the template fields */function mandrill_send_mail( $to, $to_name, $template, $subject, $data ) {    try {        // Init Mandrill API        $mandrill = new Mandrill( get_option( "mandrill_emailer_api_key" ) );        // From email and name        $from_name = get_option( "mandrill_emailer_from_name" );        if ( ! isset( $from_name ) ) {            $from_name = "WordPress";        }        $from_email = get_option( "mandrill_emailer_from_email" );        if ( ! isset( $from_email ) ) {            // Get the site domain and get rid of www.            $sitename = strtolower( $_SERVER["SERVER_NAME"] );            if ( substr( $sitename, 0, 4 ) == "www." ) {                $sitename = substr( $sitename, 4 );            }            $from_email = "wordpress@" . $sitename;        }        // Message recipient and contents         $mandrill_to = array( array( "email" =&gt; $to, "name" =&gt; $to_name, "type" =&gt; "to" ) );        $message = array(            "subject" =&gt; $subject,            "from_email" =&gt; apply_filters( "wp_mail_from", $from_email ),            "from_name" =&gt; apply_filters( "wp_mail_from_name", $from_name ),            "to" =&gt; $mandrill_to,            // Pass the same parameters for merge vars and template params            // to make them available in both variable passing methods            "global_merge_vars" =&gt; $data                );        $result = $mandrill-&gt;messages-&gt;sendTemplate( $template, $data, $message );        return true;    } catch( Mandrill_Error $e ) {        echo "A mandrill error occurred: " . get_class( $e ) . " - " . $e-&gt;getMessage();        return false;    }}</pre><p>А теперь давайте рассмотрим вышеописанный код.</p><p>Во-первых, в <i>строке 13</i> мы инициализируем API Mandrill. Ключ API извлекается из параметров WordPress.</p><p>В <i>строках 15-30</i> вы найдете ту же функциональность для настройки информации отправителя, которую мы уже реализовали в настройке электронной почты SMTP. (Это было бы хорошим местом для некоторого рефакторинга, перемещая парсинг <code class="inline">from_name</code> и <code class="inline">from_name</code> в свои собственные функции ...).</p><p>Оттуда мы переходим к созданию массива получателей электронной почты (<i>строка 33</i>). Если вы отправляете более одному получателю, вы можете добавить их в массив следующим образом:</p><pre class="brush: php noskimlinks noskimwords">$mandrill_to = array(    array("email" =&gt; $to, "name" =&gt; $to_name, "type" =&gt; "to"),    array("email" =&gt; $to_2, "name" =&gt; $to_name_2, "type" =&gt; "to"),        // etc...);  </pre><p>Затем, когда данные теперь отформатированы правильно (<i>строки 35-44</i>), мы собираем параметры в массив, который мы назвали <code class="inline">$message</code>. Большая часть массива не требует пояснений, но последний параметр требует некоторого объяснения. </p><p>Это одно из двух мест, где мы передаем наши данные в шаблон. Как вы помните из шаблона, который мы создали выше, шаблон Mandrill может содержать два типа полей для размещения данных. Чтобы упростить работу дизайнера, мы отправляем один и тот же набор переменных для обеих параметров, сначала здесь, как <code class="inline">global_merge_vars</code>, а затем снова в <i>строке 46</i> в качестве второго параметра функции отправки электронной почты <code class="inline">sendTemplate</code>. </p><p>Это простой пример использования метода <code class="inline">sendTemplate</code> API, и все, что нам нужно для функциональности, созданной в этом учебнике. С остальными доступными параметрами ознакомьтесь с <span>документацией по API</span>. Одним из наиболее интересных является <code class="inline">merge_vars</code> (который позволяет отправлять конкретные параметры получателя - полезно при отправке электронной почты нескольким пользователям одновременно).</p><h3>Шаг 2: Замените функцию уведомлений<br></h3><p>Одна из приятных (и не слишком известных) функций в WordPress с точки зрения разработчиков плагинов заключается в том, что каждая функция, определенная в <code class="inline">pluggable.php</code>, может быть заменена в плагине. Если функция определена в плагине, эта версия функции будет использоваться вместо одной из ядра WordPress.<br></p><p>Это мощная возможность, и вам нужно быть осторожным с ней (если многие плагины начнут сразу так делать, это может привести к нежелательным побочным эффектам), но это также то, что нам нужно для того, что мы сейчас делаем.</p><p>Уведомления электронной почты при добавлении нового пользователя отправляются в функцию <code class="inline">wp_new_user_notification</code>. Итак, вот та, которую нам нужно заменить нашей собственной функцией, если мы хотим отправить наше собственное приветственное сообщение через Mandrill.</p><p>Для этого в <code class="inline">index.php</code> добавьте следующую функцию:</p><pre class="brush: php noskimlinks noskimwords">/** * Email login credentials to a newly registered user. * * A new user registration notification is also sent to admin email. * * @since 2.0.0 * * @param int    $user_id        User ID. * @param string $plaintext_pass Optional. The user"s plaintext password. Default empty.      */function wp_new_user_notification( $user_id, $plaintext_pass = "" ) {    $user = get_userdata( $user_id );    // The blogname option is escaped with esc_html on the way into     // the database in sanitize_option we want to reverse this for the plain     // text arena of emails.    $blogname = wp_specialchars_decode( get_option( "blogname" ), ENT_QUOTES );    // To keep things simple, we still send the admin notification     // through wp_mail just as in the default version    $message  = sprintf( __( "New user registration on your site %s:" ), $blogname ) . "\r\n\r\n";    $message .= sprintf( __( "Username: %s" ), $user-&gt;user_login ) . "\r\n\r\n";    $message .= sprintf( __( "E-mail: %s" ), $user-&gt;user_email ) . "\r\n";    @wp_mail( get_option( "admin_email" ), sprintf( __( "[%s] New User Registration" ), $blogname ), $message );    // Send welcome e-mail to new user    $email_params = array(        array( "name" =&gt; "BLOGNAME", "content" =&gt; $blogname ),        array( "name" =&gt; "USER_NAME", "content" =&gt; $user-&gt;user_login ),        array( "name" =&gt; "EMAIL", "content" =&gt; $user-&gt;user_email ),        array( "name" =&gt; "FIRST_NAME", "content" =&gt; $user-&gt;first_name ),        array( "name" =&gt; "LAST_NAME", "content" =&gt; $user-&gt;last_name ),        array( "name" =&gt; "PASSWORD", "content" =&gt; $plaintext_pass ),        array( "name" =&gt; "LOGIN_URL", "content" =&gt; wp_login_url() ),    );    $template = get_option( "mandrill_emailer_new_user_template" );    $subject = sprintf( __( "[%s] Your username and password" ), $blogname );    $to_name = $user-&gt;first_name . " " . $user-&gt;last_name;    mandrill_send_mail( $user-&gt;user_email, $to_name, $template, $subject, $email_params );}</pre><p>Первая часть функции точно такая же, как и оригинал от <code class="inline">pluggable.php</code> (<i>строки 12-25</i>). Этот блок кода отправляет администратору уведомление о новом пользователе.</p><p>После этого все становится интереснее. </p><p>Теперь вместо отправки сообщения через <code class="inline">wp_mail</code>, как мы это делаем, при отправке уведомления администратора, чтобы отправить приветственное сообщение, мы используем <code class="inline">mandrill_send_mail</code> и шаблон, который мы только что создали.</p><p>Наиболее интересной частью этой функции является раздел на <i>строках 28-36</i>, где мы инициализируем параметры, предназначенные для использования в шаблоне HTML. Параметры передаются как массив, содержащий массивы, каждый массив представляет одну переменную:</p><pre class="brush: php noskimlinks noskimwords">array( "name" =&gt; "BLOGNAME", "content" =&gt; $blog_name )</pre><p>Как вы видите выше, определение переменной хранится как массив, состоящий из двух элементов: имя переменной (<code class="inline">name</code>) и текст, который заменит его в шаблоне (<code class="inline">content</code>).</p><h3>Шаг 3: Тест</h3><p>Теперь весь функционал готов, поэтому давайте попробуем: в администраторе WordPress с помощью меню <b>«Пользователи»&gt; «Добавить нового»</b> создайте нового пользователя. Обязательно выберите адрес электронной почты, к которому у вас есть доступ, чтобы вы получили приветственное письмо и смогли его проверить. </p><p>Создайте нового пользователя и дождитесь приветствия на своей электронной почте. Оно должно быстро появиться и выглядеть следующим образом:</p><figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=600/uploads/users/343/posts/21396/image/mandrill-wp-14.jpg" alt="Используем Mandrill для отправки электронной почты в WordPress..." title="Используем Mandrill для отправки электронной почты в WordPress..." width="50" height="50"></figure><h2>Что дальше?</h2><p>Теперь мы успешно создали плагин WordPress, который маршрутизирует всю исходящую электронную почту через Mandrill и создали шаблон электронной почты HTML, чтобы отправить приятное и удобное приветственное сообщение новым пользователям, которые зарегистрировались на сайте.</p><p>Следующим естественным шагом в расширении плагина будет добавление похожих шаблонов ко всем другим сообщениям WordPress. Сначала для уведомления администратора о новом пользователе, которое мы все еще оставили нетронутым, а затем три других функции обмена сообщениями в <code class="inline">pluggable.php</code>: <code class="inline">wp_notify_postauthor</code>, <code class="inline">wp_notify_moderator</code> и <code class="inline">wp_password_change_notification</code>.</p><p>Еще одна идея для дальнейшего развития заключалась бы в улучшении обработки ошибок плагина: хотя вы всегда можете использовать страницу администрирования Mandrill для отслеживания доставки и выяснить, не удалось ли некоторым вашим исходящим сообщениям связаться с пользователем (например, если он ошибся при вводе своего адреса), Mandrill также предоставляет <span>набор веб-хуков</span>, которые вы можете использовать, чтобы Mandrill уведомил ваш сайт WordPress об этих событиях. Внедрение веб-хука выходит за рамки этого руководства, но это хороший способ получить больше информации о том, что происходит с вашей электронной почтой после ее отправки.</p><p>Наконец, вы также можете использовать функции очереди электронной почты в Mandrill (платная функция), чтобы создать нечто вроде автоответчика, чтобы напомнить пользователю о вашем сайте, например, через неделю после регистрации. </p><p>Удачи в отправке писем!<br></p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="WordPress" href="https://norma-studio.github.io/article5/220825465-ispolzuem-mandrill-dlya-otpravki-elektronnoj-pochty-v-wordpress" class="tm-article-body__tags-item-link">WordPress</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
43028</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
543</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
