
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="Node.js и Websockets - идеальная комбинация для написания очень быстрых приложений, которые могут отправлять данные большому числу клиентов. Итак, почему бы нам не начать изучать эти две темы, создав сервис чата! Мы увидим, как устанавливать пакеты Node.js, обслуживать статическую страницу для клиента с помощью базового веб-сервера и настраивать So...">
<meta property="og:description" content="Node.js и Websockets - идеальная комбинация для написания очень быстрых приложений, которые могут отправлять данные большому числу клиентов. Итак, почему бы нам не начать изучать эти две темы, создав сервис чата! Мы увидим, как устанавливать пакеты Node.js, обслуживать статическую страницу для клиента с помощью базового веб-сервера и настраивать So...">
<meta name="twitter:description" content="Node.js и Websockets - идеальная комбинация для написания очень быстрых приложений, которые могут отправлять данные большому числу клиентов. Итак, почему бы нам не начать изучать эти две темы, создав сервис чата! Мы увидим, как устанавливать пакеты Node.js, обслуживать статическую страницу для клиента с помощью базового веб-сервера и настраивать So...">
<meta property="aiturec:description" content="Node.js и Websockets - идеальная комбинация для написания очень быстрых приложений, которые могут отправлять данные большому числу клиентов. Итак, почему бы нам не начать изучать эти две темы, создав сервис чата! Мы увидим, как устанавливать пакеты Node.js, обслуживать статическую страницу для клиента с помощью базового веб-сервера и настраивать So...">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/1.jpg">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/1.jpg">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/1.jpg">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/1.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/1.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html" title="Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io" title="Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/64533jfgfsfxcv.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html" class="tm-user-info__username" title="
О. Гуськов" aria-label="
О. Гуськов">
О. Гуськов</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Использование Node.js и веб-сокетов для создания сервиса чата...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata" class="tm-article-snippet__hubs-item-link"><span>Web Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/1.jpg">
    <meta itemprop="headline name" content="Использование Node.js и веб-сокетов для создания сервиса чата... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="Node.js и Websockets - идеальная комбинация для написания очень быстрых приложений, которые могут отправлять данные большому числу клиентов. Итак, почему бы нам не начать изучать эти две темы, создав сервис чата! Мы увидим, как устанавливать пакеты Node.js, обслуживать статическую страницу для клиента с помощью базового веб-сервера и настраивать So...">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">Node.js и Websockets - идеальная комбинация для написания очень быстрых приложений, которые могут отправлять данные большому числу клиентов. Итак, почему бы нам не начать изучать эти две темы, создав сервис чата! Мы увидим, как устанавливать пакеты Node.js, обслуживать статическую страницу для клиента с помощью базового веб-сервера и настраивать So...</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p><span>Node.js</span> и Websockets - идеальная комбинация для написания очень быстрых приложений, которые могут отправлять данные большому числу клиентов. Итак, почему бы нам не начать изучать эти две темы, создав сервис чата! Мы увидим, как устанавливать пакеты Node.js, обслуживать статическую страницу для клиента с помощью базового веб-сервера и настраивать <span>Socket.io</span> для связи с клиентом.</p><p><!--more--></p> <hr><h2>Почему стоит выбирать Node.js и Socket.io?</h2> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/1.jpg" alt="Использование Node.js и веб-сокетов для создания сервиса чата..." title="Использование Node.js и веб-сокетов для создания сервиса чата..." width="50" height="50"><br></figure><p>Так зачем использовать эту комбо?</p> <p>Существует множество платформ, которые могут запускать чат-приложение, но, выбирая Node.js, нам не нужно изучать совершенно другой язык, это простой JavaScript, только серверный.</p> <p> Node.js - это платформа, построенная на основе времени выполнения JavaScript в JavaScript, что упрощает создание приложений на JavaScript, которые запускаются на сервере. Node.js использует управляемую событиями, неблокирующую модель ввода-вывода, что делает ее идеальной для создания приложений реального времени.</p> <p>Все больше приложений Node.js пишутся в режиме реального времени. Известный пример - <span>BrowserQuest</span> из Mozilla, MMORPG, полностью написанный в Node.js, исходный код которого <span>выпущен на Github</span>.</p> <p>Node.js поставляется со встроенным менеджером пакетов: <span>npm</span>. Мы будем использовать его для установки пакетов, которые помогут ускорить процесс разработки приложений.</p> <p>Мы будем использовать три пакета для этого руководства: Jade, Express и Socket.io.</p> <h3>Socket.io: плагин для веб-узлов Node.js</h3> <p>Главная особенность нашего приложения - связь в реальном времени между клиентом и сервером.</p> <p>HTML5 представляет Websockets, но он далеко не поддерживается всеми пользователями, поэтому нам нужно решение для резервного копирования.</p> <p>Socket.io - это наше решение для резервного копирования: оно будет проверять совместимость с Websocket, и если он не поддерживается, он будет использовать Adobe Flash, AJAX или iFrame.</p> <p>Наконец, он поддерживает очень большой набор браузеров:</p> <ul><li>Internet Explorer 5.5+</li> <li>Safari 3+</li> <li>Google Chrome 4+</li> <li>Firefox 3+</li> <li>Opera 10.61+</li> <li>iPhone Safari</li> <li>iPad Safari</li> <li>Android WebKit</li> <li>WebOs WebKit</li> </ul><p>Он также предлагает очень простые функции для связи между сервером и клиентом с обеих сторон.</p> <p>Начнем с установки трех пакетов, которые нам понадобятся.</p> <hr><h2>Установка наших зависимостей</h2> <p>Npm позволяет нам устанавливать пакеты очень быстро, используя одну строку, поэтому сначала перейдите в свой каталог и загрузите необходимые пакеты npm:</p> <pre class="brush: bash noskimlinks noskimwords">npm install express jade socket.io</pre> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/2.jpg" alt="Использование Node.js и веб-сокетов для создания сервиса чата..." title="Использование Node.js и веб-сокетов для создания сервиса чата..." width="50" height="50"><br></figure><p>Теперь мы можем начать строить наш серверный контроллер для обслуживания главной страницы.</p> <p>Мы собираемся сохранить весь серверный код в файл <code>«server.js»</code>, который будет выполнен Node.js.</p> <hr><h2>Обслуживание одной статической страницы</h2> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/7.jpg" alt="Использование Node.js и веб-сокетов для создания сервиса чата..." title="Использование Node.js и веб-сокетов для создания сервиса чата..." width="50" height="50"><br></figure><p>Для обслуживания нашей статической страницы мы будем использовать <span>Express</span>, пакет, который упрощает весь процесс отправки на серверной странице.</p> <p>Итак, давайте включим этот пакет в наш проект и запустим сервер:</p> <pre class="brush: js noskimlinks noskimwords">var express = require("express"), app = express.createServer();</pre> <p>Затем нам нужно настроить Express для обслуживания страницы из репертуарных представлений с помощью механизма шаблонов Jade, который мы установили ранее.</p> <p>Экспресс использует файл макета по умолчанию, но нам это не нужно, потому что мы будем обслуживать только одну страницу, поэтому вместо этого мы отключим его.</p> <p>Express также может предоставлять статический контент клиенту, как классический веб-сервер, поэтому мы отправим <code>«public»</code> папку, в которой будут представлены все наши JavaScript, CSS и файлы изображений.</p> <pre class="brush: js noskimlinks noskimwords">app.set("views", __dirname + "/views");app.set("view engine", "jade");app.set("view options", { layout: false });app.configure(function() {  app.use(express.static(__dirname + "/public"));});</pre> <p>Затем создадим две папки внутри нашей папки проекта с именами «<code>public</code>» и «<code>views</code>».</p> <p>Теперь нам просто нужно настроить Express для работы с файлом <code>«home.jade»</code>, который мы создадим за мгновение, а затем установите Express для прослушивания определенного порта.</p> <p>Я буду использовать порт 3000, но вы можете использовать все, что захотите.</p> <pre class="brush: js noskimlinks noskimwords">app.get("/", function(req, res){  res.render("home.jade");});app.listen(3000);</pre> <hr><h2>Создание страницы шаблона Jade</h2> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/3.jpg" alt="Использование Node.js и веб-сокетов для создания сервиса чата..." title="Использование Node.js и веб-сокетов для создания сервиса чата..." width="50" height="50"><br></figure><p>Node.js использует шаблоны для обслуживания веб-страниц. Полезно отправлять динамические страницы и создавать их быстрее.</p> <p>В этом уроке мы будем использовать <span>Jade</span>. Его синтаксис очень понятный и поддерживает все, что нам нужно.</p> <blockquote> <p> « Jade - высокопроизводительный шаблонизатор, сильно влияющий на Haml и реализованный с помощью JavaScript для Node».</p> </blockquote> <p>Теперь я не собираюсь подробно останавливаться на Jade, если вам нужна дополнительная помощь, вы можете найти очень хорошо <span>написанную документацию в репозитории Github</span>.</p> <h3>Конфигурация jade</h3> <p>Ранее мы установили Jade, но мы должны включить его в наш файл <code>server.js</code>, как мы это делали для Express.</p> <p>По соглашению, мы включаем наши библиотеки в верхней части нашего файла, чтобы использовать их позже, без необходимости проверять, включены ли они. Поэтому разместите следующий код в верхней части вашего файла <code>«server.js»</code>:</p> <pre class="brush: js noskimlinks noskimwords">var jade = require("jade");</pre> <p>И это завершает нашу конфигурацию jade. Express уже настроен для использования Jade с нашими файлами отображений, чтобы отправить ответ HTML, нам просто нужно создать этот файл.</p> <h3>Создание нашей домашней страницы</h3> <p>Если мы запустим наш сервер, он будет сломан, потому что мы запрашиваем наше приложение для отправки страницы, которая еще не существует.</p> <p>Мы не собираемся создавать полнофункциональную страницу, просто что-то основное, у чего есть заголовок, контейнер для сообщений, текстовая область, кнопка отправки и счетчик пользователей.</p> <p>Идите вперед и создайте страницу <code>«home.jade»</code> внутри папки «<code>views</code>» со следующим кодом:</p> <pre class="brush: plain noskimlinks noskimwords">doctype 5htmlheadtitle Chatscript(src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js")script(src="/socket.io/socket.io.js")script(src="script.js")bodydiv.containerheaderh1 A Chat application with Node.js and Socket.ioinput(type="text")#pseudoInputbutton#pseudoSet Set Pseudodiv#chatEntriesdiv#chatControlsinput(type="text")#messageInputbutton#submit Send</pre> <blockquote class="pullquote pqRight"> <p> «Jade - все дело в отступе»</p> </blockquote> <p>Язык Jade - это отступы. Как вы можете видеть, нам не нужно закрывать наши контейнеры, достаточно отступов, чтобы детей родительского контейнера было достаточно.</p> <p>Мы также используем точку <code>"."</code> и знак фунта <code>«#»</code>, чтобы указать класс или идентификатор элемента, как в файле CSS.</p> <p>Мы также связываем три сценария в верхней части файла. Первый из них - jQuery из Google CDN, у нас есть сценарий Socket.io, который автоматически загружается пакетом, и, наконец, файл <code>«script.js»</code>, который сохранит все наши пользовательские функции JS.</p> <hr><h2>Конфигурация сервера Socket.io</h2> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/6.jpg" alt="Использование Node.js и веб-сокетов для создания сервиса чата..." title="Использование Node.js и веб-сокетов для создания сервиса чата..." width="50" height="50"><br></figure><p> Socket.io основан на событиях, как и Node. Он нацелен на то, чтобы сделать приложения в реальном времени возможными в каждом браузере и мобильном устройстве, размывая линии между этими различными транспортными механизмами.</p> <p>Как и другие модули, мы должны включить его в наш файл <code>server.js</code>. Мы также подключим наш экспресс-сервер для прослушивания соединений с одного и того же адреса и порта.</p> <pre class="brush: js noskimlinks noskimwords">var io = require("socket.io").listen(app);</pre> <p>Первым событием, которое мы будем использовать, является событие соединения. Оно запускается, когда клиент пытается подключиться к серверу; Socket.io создает новый сокет, который мы будем использовать для приема или отправки сообщений клиенту.</p> <p>Начнем с инициализации соединения:</p> <pre class="brush: js noskimlinks noskimwords">io.sockets.on("connection", function (socket) {//our other events...});</pre> <p>Эта функция принимает два аргумента, первая - это событие, а вторая - функция обратного вызова с объектом сокета.</p> <p>Используя такой код, мы можем создавать новые события на клиенте и на сервере с помощью Socket.io. Мы установим событие «<code>pseudo</code>» и событие «<code>message</code>».</p> <p>Для этого это просто, мы просто используем тот же синтаксис, но на этот раз с нашим объектом <code>socket</code>, а не с <code>«io.sockets»</code> (с «s») объектом. Это позволяет нам напрямую общаться с одним клиентом.</p> <p>Поэтому внутри нашей функции соединения добавим код «псевдо».</p> <pre class="brush: js noskimlinks noskimwords">socket.on("setPseudo", function (data) {socket.set("pseudo", data);});</pre> <p>Функция обратного вызова принимает один аргумент, это данные от клиента, и в нашем случае содержит <code>pseudo</code>. С помощью функции «set» мы назначаем переменную в сокет. Первый аргумент - это имя этой переменной, а второе - значение.</p> <p>Затем нам нужно добавить код для события «<code>message</code>». Он получит псевдоним пользователя, передаст массив всем клиентам, который содержит полученное сообщение, а также пользователю pseudo и занесет это в нашу консоль.</p> <pre class="brush: js noskimlinks noskimwords">socket.on("message", function (message) {socket.get("pseudo", function (error, name) {var data = { "message" : message, pseudo : name };socket.broadcast.emit("message", data);console.log("user " + name + " send this : " + message);})});</pre> <p>Это завершает нашу конфигурацию на стороне сервера. Если вы хотите, вы можете использовать другие события, чтобы добавить новые функции в чат.</p> <p>Самое приятное в Socket.io заключается в том, что нам не нужно беспокоиться об обработке отключений клиентов. Когда клиент отключается, Socket.io больше не будет получать ответы на сообщения «heartbeat» и дезактивирует сеанс, связанный с клиентом. Если это было просто временное отключение, клиент снова подключится и продолжит сеанс.</p> <hr><h2>Конфигурация клиентской стороны Socket.io</h2> <p>Теперь, когда наш сервер настроен для управления сообщениями, нам нужен клиент для их отправки.</p> <p>Клиентская сторона Socket.io почти такая же, как на стороне сервера. Клиент также работает с настраиваемыми событиями, и мы создадим те же, что и на сервере.</p> <p>Итак, сначала создайте файл <code>«script.js»</code> внутри папки <code>public</code>. Мы сохраним все наши функции внутри нее.</p> <p>Сначала нам нужно запустить соединение socket.io между клиентом и сервером. Оно будет храниться в переменной, которую мы будем использовать позже для отправки или получения данных. Когда соединение не передано никакими аргументами, оно автоматически подключится к серверу, который будет обслуживать страницу.</p> <pre class="brush: js noskimlinks noskimwords">var socket = io.connect();</pre> <p>Далее, давайте создадим некоторые вспомогательные функции, которые нам понадобятся позже. Первая - это простая функция для добавления сообщения на экран  пользователя pseudo.</p> <pre class="brush: js noskimlinks noskimwords">function addMessage(msg, pseudo) {$("#chatEntries").append("&lt;div class="message"&gt;&lt;p&gt;" + pseudo + " : " + msg + "&lt;/p&gt;&lt;/div&gt;");}</pre> <p>Этот помощник использует функцию <span>append</span> из jQuery для добавления <code>div</code> в конец <code>div#chatEntries</code>.</p> <p>Теперь мы собираемся написать функцию, которую мы можем вызвать, когда хотим отправить новое сообщение.</p> <pre class="brush: js noskimlinks noskimwords">function sentMessage() {if ($("#messageInput").val() != "") {socket.emit("message", $("#messageInput").val());addMessage($("#messageInput").val(), "Me", new Date().toISOString(), true);$("#messageInput").val("");}}</pre> <p>Во-первых, мы проверяем, что наша текстовая область не пуста, затем мы отправляем пакет с именем «<code>message</code>» на сервер, который содержит текст сообщения, мы печатаем его на экране с помощью нашей функции «<code>addMessage</code>», и, наконец, мы удаляем весь текст из текстового поля.</p> <p>Теперь, когда клиент открывает страницу, нам нужно сначала задать псевдоним пользователя. Эта функция отправит pseudo на сервер и <span>покажет</span> текстовое поле и кнопку отправки.</p> <pre class="brush: js noskimlinks noskimwords">function setPseudo() {if ($("#pseudoInput").val() != ""){socket.emit("setPseudo", $("#pseudoInput").val());$("#chatControls").show();$("#pseudoInput").hide();$("#pseudoSet").hide();}}</pre> <p>Кроме того, мы <span>скрываем</span> pseudo элементы управления, когда они отправляются на сервер.</p> <p>Теперь, как и на серверной стороне, нам нужно убедиться, что мы можем получать входящие сообщения, и на этот раз мы напечатаем их на экране. Мы будем использовать тот же синтаксис, но на этот раз мы вызываем функцию «<code>addMessage</code>».</p> <pre class="brush: js noskimlinks noskimwords">socket.on("message", function(data) {addMessage(data["message"], data["pseudo"]);});</pre> <p>Как и при нашей конфигурации сервера, пакет, который отправляется клиенту, представляет собой массив, содержащий сообщение и псевдо. Поэтому мы просто вызываем нашу функцию «<code>addMessage</code>», проходящую в сообщении и псевдо, которую мы извлекаем из полученного пакета данных.</p> <p>Теперь нам просто нужно добавить функцию инициализации, которая запускается после полной загрузки страницы.</p> <pre class="brush: js noskimlinks noskimwords">$(function() {$("#chatControls").hide();$("#pseudoSet").click(function() {setPseudo()});$("#submit").click(function() {sentMessage();});});</pre> <p>Во-первых, мы скрываем элементы управления чатом до того, как будет установлено pseudo, а затем мы установим слушателя для прослушивания кликов по двум кнопкам отправки. Первый - для псевдо, а второй - для сообщений.</p> <p>И это завершает наш клиентский скрипт.</p> <hr><h2>Заключение</h2> <p>Теперь у нас есть рабочий чат. Чтобы запустить его, просто запустите следующую команду:</p> <pre class="brush: bash noskimlinks noskimwords">node server.js</pre> <p>В своем терминале вы должны получить сообщение от Socket.io, говорящее, что сервер запущен. Чтобы увидеть свою страницу, перейдите к <code>127.0.0.1:3000</code> (или в зависимости от того, какой вы ранее выбрали).</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/4.png" alt="Использование Node.js и веб-сокетов для создания сервиса чата..." title="Использование Node.js и веб-сокетов для создания сервиса чата..." width="50" height="50"><br></figure><p>Дизайн очень простой, но вы можете легко добавить свои стили, звуки, или <span>Bootstrap</span>.</p> <p>Как вы можете видеть, сценарии сервера и клиента довольно похожи: в этом сила Node.js. Вы можете создать приложение без необходимости писать код дважды.</p> <p>Наконец, вы, возможно, заметили, что в нашем файле <code>server.js</code> всего 25 строк кода, чтобы создать функциональное приложение для чата с потрясающей производительностью. Он очень короткий, но он также работает очень хорошо.</p> <p>Теперь, если вам интересно, я создал приложение для чатов, с красивым дизайном, а также некоторые дополнительные функции. Оно размещено на <span>Nodester</span>, а исходный код - на <span>Github</span>.</p> <p>Вот его превью.</p> <figure><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=600/net/uploads/2013/09/5.jpg" alt="Использование Node.js и веб-сокетов для создания сервиса чата..." title="Использование Node.js и веб-сокетов для создания сервиса чата..." width="50" height="50"><br></figure><p>Спасибо за чтение.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825557-ispolzovanie-nodejs-i-veb-soketov-dlya-sozdaniya-servisa-chata" class="tm-article-body__tags-item-link">Web Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
31763</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
434</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
