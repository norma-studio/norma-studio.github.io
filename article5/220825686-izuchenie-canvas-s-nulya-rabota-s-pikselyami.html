
<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:title" content="Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io">
<meta name="twitter:title" content="Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io">
<meta name="aiturec:title" content="Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io">
<meta name="description" content="В предыдущем руководстве вы всесторонне изучили работу с трансформациями, тенями и градиентами. Сегодня я покажу вам, как работать с пикселями в Сanvas: от простого получения значений компонентов цвета до того редактирования изображений на «холсте», которое выполняем в редакторе изображений....">
<meta property="og:description" content="В предыдущем руководстве вы всесторонне изучили работу с трансформациями, тенями и градиентами. Сегодня я покажу вам, как работать с пикселями в Сanvas: от простого получения значений компонентов цвета до того редактирования изображений на «холсте», которое выполняем в редакторе изображений....">
<meta name="twitter:description" content="В предыдущем руководстве вы всесторонне изучили работу с трансформациями, тенями и градиентами. Сегодня я покажу вам, как работать с пикселями в Сanvas: от простого получения значений компонентов цвета до того редактирования изображений на «холсте», которое выполняем в редакторе изображений....">
<meta property="aiturec:description" content="В предыдущем руководстве вы всесторонне изучили работу с трансформациями, тенями и градиентами. Сегодня я покажу вам, как работать с пикселями в Сanvas: от простого получения значений компонентов цвета до того редактирования изображений на «холсте», которое выполняем в редакторе изображений....">
<meta property="og:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/1.jpg">
<meta property="aiturec:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/1.jpg">
<meta name="twitter:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/1.jpg">
<meta property="vk:image" content="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/1.jpg">
<meta property="og:type" content="article">
<link image_src="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/1.jpg">
<meta property="og:locale" content="ru_RU"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="robots" content="all">
<meta name="author" content="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html">
<meta name="copyright" lang="ru" content="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html">
<link rel="canonical" href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html">
<meta property="og:url" content="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html">
<meta name="twitter:site" content="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html">
<meta name="twitter:creator" content="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html">

<meta name="apple-mobile-web-app-status-bar-style" content="#303b44"><meta name="msapplication-TileColor" content="#629FBC">
<link rel="shortcut icon" type="image/ico" sizes="64x64" href="https://norma-studio.github.io//norma-logo-64.png">
<link rel="shortcut icon" href="https://norma-studio.github.io//favicon.ico" type="image/x-icon">
<style>body{opacity: 0;}</style>
<meta name="yandex-verification" content="da91da9b0b6d5dba"><meta name="google-site-verification" content="_BCz7bv6IKv32EI5NSdb9dPwP4PnhlsToVoSOpbZlZI"></head><body>
<div id="app"><div class="tm-layout__wrapper"><div></div>
<header id="extop" class="tm-header"><div class="tm-page-width"><div class="tm-header__container">

<span class="tm-header__logo-wrap"><a aria-label="norma-studio.github.io" href="https://norma-studio.github.io/" class="tm-header__logo tm-header__logo_ru" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге norma-studio.github.io">norma-studio.github.io</a></span><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title><svg id="arrow-down" viewBox="0 0 24 24"><path d="m6.47 9.47c.293-.293.768-.293 1.061 0l4.47 4.47 4.47-4.47c.293-.293.768-.293 1.061 0s.293.768 0 1.061l-5 5c-.293.293-.768.293-1.061 0l-5-5c-.293-.293-.293-.768 0-1.061z"></path></svg></svg></button></div></div><a aria-label="Написать нам" href="https://wa.me/79603570433?text=https://norma-studio.github.io/_Добрый_день" class="tm-header__become-author-btn" title="Подборка эксклюзивных материалов о создании и продвижении сайтов, дизайне сайтов и интернет-маркетинге. Как создать и продвигать сайт, как выбрать дизайн сайта и интернет-стратегию, как защитить свои права в интернете, как продать контент для сайтов? Все ответы в блоге envatomarket.ru.">Написать нам</a><div class="tm-feature tm-header__feature tm-feature_variant-inline"></div></div></div></header>

<div class="tm-layout">
<main class="tm-layout__container"><div class="tm-page"><div class="tm-page-width"><div class="tm-page__wrapper">
<div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down">
<div class="tm-page-article__body data-container" style="background-color: #f0f0f0;" id="data-container">


<article class="tm-page-article__content tm-page-article__content_inner" style="background-color: #fff;">
<!-- article-header -->
<div class="tm-page-article__head-wrapper"><div class="tm-article-snippet tm-page-article__snippet">

<div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a aria-label="author-image" href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html" title="Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io" title="Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io" height="24" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/i3/636534636.webp" width="24" class="tm-entity-image__pic lazy07"></div></a><span class="tm-user-info__user">
<a href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html" class="tm-user-info__username" title="
С. Новичков" aria-label="
С. Новичков">
С. Новичков</a>
</span></span><span class="tm-article-snippet__datetime-published"><time datetime="2023-12-09T15:24:38.000Z" title="22023-12-09, 19:24"> 09.12.2023</time></span></div></div>
<h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1" itemprop="name"><span><span>Изучение Canvas с нуля: работа с пикселями...</span></span></h1>
<div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami" class="tm-article-snippet__hubs-item-link"><span>Code</span></a></span><span class="tm-article-snippet__hubs-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami" class="tm-article-snippet__hubs-item-link"><span>Web Development</span></a></span><br></div></div>

<div itemscope itemtype="https://schema.org/Article" style="display:none;">
    <link itemprop="mainEntityOfPage" href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami.html" />
    <link itemprop="image" href="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/1.jpg">
    <meta itemprop="headline name" content="Изучение Canvas с нуля: работа с пикселями... | envatomarket.ru | norma-studio.github.io">
    <meta itemprop="description" content="В предыдущем руководстве вы всесторонне изучили работу с трансформациями, тенями и градиентами. Сегодня я покажу вам, как работать с пикселями в Сanvas: от простого получения значений компонентов цвета до того редактирования изображений на «холсте», которое выполняем в редакторе изображений....">
    <meta itemprop="author" content="norma-studio.github.io">
    <meta itemprop="datePublished" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <meta itemprop="dateModified" datetime="2023-12-09T15:24:38.000Z" content="09.12.2023">
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <img class="lazy07" itemprop="url image" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://envatomarket.ru/apple-touch-icon-120.ico" alt="Шаблоны сайтов | Лендинги" title="Шаблоны сайтов | Лендинги" style="display:none;"/>
        </div>
        <meta itemprop="name" content="https://norma-studio.github.io/">
        <meta itemprop="telephone" content="">
        <meta itemprop="address" content="Россия">
    </div>
    <p>Интро</p>
    <span itemprop="articleBody">В предыдущем руководстве вы всесторонне изучили работу с трансформациями, тенями и градиентами. Сегодня я покажу вам, как работать с пикселями в Сanvas: от простого получения значений компонентов цвета до того редактирования изображений на «холсте», которое выполняем в редакторе изображений....</span>
</div>


<!-- article-body -->

<div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2">



<p>В предыдущем руководстве вы всесторонне изучили работу с трансформациями, тенями и градиентами. Сегодня я покажу вам, как работать с пикселями в Сanvas: от простого получения значений компонентов цвета до того редактирования изображений на «холсте», которое выполняем в редакторе изображений.</p><p>Это несомненно одна из наиболее мощных встроенных возможностей Canvas, и я вам гарантирую, что сразу после ее освоения у вас появится целый ряд потрясающих идей.</p> <p><!--more--></p> <hr><h2>Подготавливаем страницу</h2> <p>Вы будете использовать тот же самый шаблон HTML, что и в предыдущем руководстве, поэтому откройте свой любимый редактор и скопируйте следующий код:</p> <pre class="brush: html noskimlinks noskimwords">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;Canvas from scratch&lt;/title&gt;        &lt;meta charset="utf-8"&gt;        &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"&gt;&lt;/script&gt;        &lt;script&gt;            $(document).ready(function() {                var canvas = document.getElementById("myCanvas");                var ctx = canvas.getContext("2d");            });        &lt;/script&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;canvas id="myCanvas" width="500" height="500"&gt;            &lt;!-- Insert fallback content here --&gt;        &lt;/canvas&gt;    &lt;/body&gt;&lt;/html&gt;</pre> <p>Это всего лишь базовая HTML-страница с элементом <code>canvas </code>и некоторым кодом JavaScript, который выполняется после загрузки модели DOM (* Document Object Model – Объектная модель документа. Тут и далее примеч. пер.). Ничего фантастического тут нет.</p> <hr><h2>Размещаем изображение на «холсте»</h2> <p>Вы можете манипулировать значениями пикселей чего-угодно, что прорисовано на «холсте», однако для достижения целей этого руководства мы будем использовать изображения. Это так отчасти из-за того, что мне важно показать вам, как загружать изображения в canvas, а также потому, что способность выполнять манипуляции с изображениями (например редактирование изображений) – это большой плюс рассматриваемой технологии.</p> <p>Перед тем, как я покажу вам, как получать значения пикселей, давайте разместим изображение на «холсте». Вы запросто можете использовать любое изображение, однако для достижения целей этого руководства я буду использовать одно из моих собственных с Flickr.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/1.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>При желании можете использовать это изображение, которое доступно <span>для скачивания в различных размерах</span>.</p> <p>Загрузка изображения на «холст» выполняется в два этапа. Первый – загрузка изображения в элемент HTML <code>image</code>, что можно осуществить при помощи HTML или создания нового элемента DOM непосредственно в коде JavaScript. В нашем примере мы создадим новый элемент DOM – это чрезвычайно просто:</p> <pre class="brush: js noskimlinks noskimwords">var image = new Image();image.src = "sample.jpg";$(image).load(function() {});</pre> <p>Здесь мы всего лишь создаем новый элемент DOM типа  <code>Image</code> и задаем его в качестве значения переменной. Далее мы используем эту переменную для загрузки вашего изображения, задавая в качестве значения атрибута <code>src </code>изображения необходимый путь к файлу (* чтобы  началась загрузка изображения, элемент не нужно добавлять к документу – оно начинает загружаться, как только задано значение свойства src). Стоит отметить, что при помощи этой техники мы бы могли загрузить изображение с удаленного компьютера, однако при этом позже у нас возникли бы некоторые проблемы, так что мы остановимся на использовании изображения с локального компьютера. Второй этап – прослушивание события <code>load</code>, которое будет сгенерировано, как только изображение загружено и готово к использованию.</p> <p>Сразу после загрузки изображения мы можем разместить его на «холсте» одним махом. Для этого нам всего лишь необходимо передать переменную <code>image</code>, которую только что создали, в качестве аргумента метода <code>drawImage </code>2-мерного контекста отображения. Разместите этот код в обработчике события загрузки для <code>image</code> следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">$(image).load(function() {    ctx.drawImage(image, 0, 0);});</pre> <p>В данном случае метод <code>drawImage </code>принимает три аргумента: элемент с изображением и значения координат <em>x</em> и <em>y</em> для задания позиции изображения на «холсте». За счет этого кода изображение будет отображено в полном размере (ширина составляет 500px в нашем примере) и в указанной позиции:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/2.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>Однако на самом деле<code> drawImage</code> может принимать еще два аргумента, за счет которых задаются значения ширины и высоты отображаемого изображения, следующим образом:￼</p> <pre class="brush: js noskimlinks noskimwords">ctx.drawImage(image, 0, 0, 250, 166);</pre> <p>За счет этого кода изображение было бы отображено в половину своего изначального размера (ширина составляет 250px в нашем примере):</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/3.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>Вы можете пойти еще дальше и воспользоваться всеми девятью аргументами метода <code>drawImage</code> для прорисовывания только небольшой части изначального изображения вот так:￼</p> <pre class="brush: js noskimlinks noskimwords">ctx.drawImage(image, 0, 0, 200, 200, 0, 0, 500, 500);</pre> <p>За счет этого кода будет выбран квадрат со значением стороны 200px вверху слева изображения и прорисован на «холсте» в квадрате со значением стороны 500px:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/4.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>В псевдокоде (* язык, напоминающий императивный язык программирования и используемый в качестве нотации для описания алгоритмов и/или структуры программы) все девять аргументов <code>drawImage</code> можно описать следующим образом (s – для обозначения источника (source) и d – для обозначения места назначения (destination)):</p> <pre class="brush: js noskimlinks noskimwords">ctx.drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh);</pre> <p>Результат приведен на следующей иллюстрации:</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/5.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>Все просто, не так ли? По правде говоря, понимание любого аспекта работы Сanvas не вызывает трудностей, как только вы его проанализируете и рассмотрите каждый момент по отдельности.</p> <hr><h2>Получаем значения компонентов цвета пикселей</h2> <p>Теперь, когда у вас имеется изображение на «холсте», пришло время получить значения компонентов цвета пикселей, благодаря чему вы сможете ими манипулировать.Однако давайте сейчас забудем о манипулировании и сосредоточимся исключительно на получении значений компонентов цвета пикселей, поскольку для понимания этой концепции необходимо некоторое время.</p> <h3>Вопросы безопасности</h3> <p>Если вы хотите получить значения компонентов цвета пикселей при помощи canvas, то должны быть в курсе об имеющихся ограничениях, связанных с безопасностью. Согласно им вы можете получать данные только изображений, загруженных с того же <em>домена</em>, что и JavaScript. Из-за этого вы не можете получать изображения с удаленного сервера с дальнейшим анализом значений компонентов цвета его пикселей, хотя имеется что-то вроде <span>обходного пути этого ограничения</span>. К сожалению, не во всех браузерах код JavaScript и изображения, загружаемые локально из файловой системы (то есть без использования доменного имени), рассматриваются в качестве файлов, получаемых с одного и того же домена, так что у вас могут возникнуть ошибки, связанные с нарушением безопасности. Чтобы избежать этого вам необходимо либо запускать оставшуюся часть кода руководства при помощи серверного программного обеспечения на вашем локальном компьютере (вроде MAMP, WAMP или XAMPP) или удаленного веб-сервера и получать файлы при помощи доменного имени (например example.com).</p> <p>Разобравшись с этим, давайте продолжим и получим некоторые значения компонентов цвета пикселей!</p> <h3>Способ получения значений компонентов цвета пикселей странноватый</h3> <p>Как я уже упомянул в начале данного раздела, для понимания способа получения значений компонентов цвета пикселя «холста» необходимо некоторое время.  Это так из-за способа, согласно которому пиксели сохраняются в Сanvas; они вовсе не хранятся как цельные пиксели. Вместо этого каждый пиксель разбивается на четыре отдельных компонента (красный, зеленый, синий и альфа (* в компьютерной графике - четвёртый компонент цвета, используемый для контроля смешивания цветов с фоном или нижележащим объектом. При этом его значение 1,0 означает полную непрозрачность, а 0,0 - полную прозрачность объекта)), и эти значения сохраняются в одномерном массиве со всеми значениями компонентов цвета для других пикселей. Поэтому вы не можете просто запросить данные из определенного пикселя, по крайней мере по умолчанию. Давайте поясню.</p> <p>Для получения значений компонентов цвета пикселей вам необходимо вызвать метод<code> getImageData</code> 2-мерного контекста отображения следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">var imageData = ctx.getImageData(x, y, width, height);</pre> <p>Этот метод принимает четыре аргумента, при помощи которых задается прямоугольная область «холста», значения пикселей которой вы хотите получить: координаты <em>x </em>и <em>y </em>начала отсчета, за которыми следуют значения <em>ширины </em>и <em>высоты</em>. Этот метод возвращает массив <code>CanvasPixelArray</code>, в котором содержатся все значения компонентов цвета пикселей заданной области. Первое, на что следует обратить внимание при работе с <code>CanvasPixelArray</code>, – это то, что для каждого пикселя задается четыре значения компонентов цвета, так что индексом первого компонента цвета каждого пикселя массива будет кратное 4 число (0 для первого значения первого пикселя, 4 для первого значения второго пикселя и т.д.):</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/6.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>Интересно (или раздражает, в зависимости от того, как вы смотрите на массив) то, что тут не используется концепция позиции координат (x, y), из-за чего получить значения компонентов цвета для определенного пикселя немного тяжелее, чем получить определенное значение двухмерного массива (например используя pixelArray[0][3] для получения значения пикселя в координате (1, 4)). Вместо этого вы должны использовать небольшую формулу, которая в действительности очень проста для понимания, если правильно объяснена:</p> <pre class="brush: js noskimlinks noskimwords">var redValueForPixel = ((y - 1) * (width * 4)) + ((x - 1) * 4);</pre> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/7.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>Можете разобраться, что тут происходит? Давайте проанализируем формулу и представим, что мы хотим получить значения компонентов цвета для внутреннего пикселя в таблице пикселей 3x3 – пиксель в координате (2, 2).</p> <p>Если вы посмотрите на предыдущие два изображения, то увидите, что значения компонентов цвета для этого пикселя начинаются с индекса 16, и для реализации этого в коде вам необходимо выполнить два шага: первый – вычислить индекс необходимого пикселя (координату <em>y</em>) в начале ряда, и затем добавить к этому индексу количество значений компонентов цвета между пикселем и началом ряда (координата <em>х</em>). Прозвучало немного запутанно, но проявите терпение.</p> <p>Первая часть формулы проста: вы уже знаете, что на один пиксель приходится четыре значения цвета, а также что ширина таблицы составляет 3 пикселя. Для вычисления индекса пикселя в ряду <em>у</em> (2) вы подставляете эти значения в первую часть формулы, которая при этом будет выглядеть следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">((2 - 1) * (3 * 4))</pre> <p>В результате вы получаете значение индекса 12, которое соответствует индексу первого пикселя второго ряда в предыдущем изображении. Пока все должно быть понятно.</p> <p>Следующий шаг – определение числа значений компонентов цвета, которые находятся перед необходимым вам пикселем. Для этого вы просто перемножаете число пикселей, находящихся перед необходимым вам пикселем, на четыре. Все просто. В нашем примере вторая часть формулы выглядела бы следующим образом:</p> <pre class="brush: js noskimlinks noskimwords">((2 - 1) * 4)</pre> <p>Можете посчитать и получите 4, что в сумме с предыдущим значением дает значение индекса 16. Круто, да?</p> <p>Я бы особо не переживал о полном ее понимании, просто знайте, что эта потрясающая небольшая формула существует и позволяет вам легко получить индекс значения красной компоненты цвета для любого пикселя. Для получения индекса значений остальных компонентов цвета пикселя (зеленый, синий или альфа) вы просто добавляете 1, 2 или 3 к вычисленному индексу соответственно.</p> <h3>Начинаем применять полученные знания</h3> <p>Теперь, когда вы знаете, как получить значения компонентов цвета любого необходимого вам пикселя, давайте применим эти знания и получим эти значения из изображения для изменения цвета фона веб-сайта. Подобная как бы техника хорошо бы подошла для реализации цветоподборщика (* диалоговое окно для выбора нового текущего цвета спрайтов, рисунков и закрашиваемых областей, а также для определения пользовательской цветовой палитры) веб-приложения для редактирования изображений.</p> <p>Код для нашего примера довольно ясный, так что давайте напишем его весь сразу:</p> <pre class="brush: js noskimlinks noskimwords">var image = new Image();image.src = "sample.jpg";$(image).load(function() {    ctx.drawImage(image, 0, 0);});$(canvas).click(function(e) {    var canvasOffset = $(canvas).offset();    var canvasX = Math.floor(e.pageX-canvasOffset.left);    var canvasY = Math.floor(e.pageY-canvasOffset.top);    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);    var pixels = imageData.data;    var pixelRedIndex = ((canvasY - 1) * (imageData.width * 4)) + ((canvasX - 1) * 4);    var pixelcolor = "rgba("+pixels[pixelRedIndex]+", "+pixels[pixelRedIndex+1]+", "+pixels[pixelRedIndex+2]+", "+pixels[pixelRedIndex+3]+")";    $("body").css("backgroundColor", pixelcolor);});</pre> <p>Вы узнаете первые несколько строк из предыдущих примеров. Новый код располагается в обработчике события click для <code>canvas</code>, который реализуется при помощи небольшого количества кода jQuery, чтобы сообщить вам, когда произошло нажатие по «холсту».</p> <p>Внутри обработчика мы хотим определить пиксель, по которому было выполнено нажатие на «холсте». Для этого нам необходимо для начала вычислить смещение в пикселях верхней левой координаты «холста» относительно верхнего левого угла окна браузера; для этого можно воспользоваться методом <code>offset</code> jQuery. Далее мы можем определить пиксель, по которому было выполнено нажатие на «холсте», путем вычитания значения смещения из значений координат, содержащихся в объекте для события click (<code>pageX</code> и<code> pageY</code>). Вам несомненно стоит потратить немного времени на освоение информации о событии click JavaScript для углубления своих познаний о нем. </p> <p>В следующих четырех строках происходит получение <code>CanvasPixelArray</code> для «холста» (<code>getImageData</code>), его сохранение в переменной, нахождение индекса значения красной компоненты цвета пикселя, по которому было выполнено нажатие, путем его вычисления при помощи ранее виденной вами формулы, и затем сохранение значений компонентов цвета пикселя в виде строки <code>rgba</code> CSS. Наконец, последний этап – установление в качестве значений компонентов цвета фона элемента <code>body</code> значений компонентов цвета пикселя, по которому было выполнено нажатие.</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/8.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <p>И после этого все готово. Протестируйте результат самостоятельно; нажмите по изображению на «холсте» и пронаблюдайте, как изменяется цвет фона веб-сайта. Если не работает, то убедитесь, что вы запустили демоверсию на сервере с доменным именем, как описано в разделе, посвященном вопросам безопасности.</p> <p>Мы многое рассмотрели, и теперь вы умеете быстро и легко получать значения компонентов цвета любого пикселя на «холсте». Упоминал ли я, что вы также можете изменять значения компонентов цвета пикселей на «холсте». Нет? Ой! Тогда давайте теперь рассмотрим этот прием; с его помощью создаются очень крутые эффекты.</p> <hr><h2>Добавляем к изображениям эффекты</h2> <p>Теперь, когда вы умеете получать значения цвета пикселей «холста», их изменение не должно составить особого труда. По сути, изменение этих значений цвета сводится к изменению значений в CanvasPixelArray и их дальнейшему прорисовыванию обратно на «холст». Давайте рассмотрим, как это осуществить.</p> <p>Для начала подготовьте код, как в предыдущем разделе. В этом коде происходит загрузка изображения, его прорисовка на «холст» и получение данных его пикселей:</p> <pre class="brush: js noskimlinks noskimwords">var image = new Image();image.src = "sample.jpg";$(image).load(function() {    ctx.drawImage(image, 0, 0);    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);    var pixels = imageData.data;    var numPixels = imageData.width * imageData.height;});</pre> <p>Пока все должно быть понятно. Далее необходимо перебрать каждый пиксель «холста» и изменить значения компонентов его цвета. В нашем примере вы переставите значения компонентов цветов путем вычитания текущего значения компонента цвета (от 0 до 255) из 255:</p> <pre class="brush: js noskimlinks noskimwords">for (var i = 0; i &lt; numPixels; i++) {    pixels[i*4] = 255-pixels[i*4]; // Red    pixels[i*4+1] = 255-pixels[i*4+1]; // Green    pixels[i*4+2] = 255-pixels[i*4+2]; // Blue};</pre> <p>Тут не происходит ничего фантастического; вы просто перемножаете номер пикселя (<em>i</em>) на 4 для получения индекса значения красного компонента цвета для текущего пикселя в<code> CanvasPixelArray</code>. За счет добавления 1 или 2 к этому числу вы можете получить и изменить значения зеленого и синего компонентов цвета соответственно.</p> <p>И, наконец, все, что вам теперь осталось, так это очистить «холст» (чтобы избавиться от изначального изображения) и затем воспользоваться методом <code>putImageData</code> 2-мерного контекста отображения для прорисовывания сохраненного <code>CanvasPixelArray</code> на «холст»:</p> <pre class="brush: js noskimlinks noskimwords">ctx.clearRect(0, 0, canvas.width, canvas.height);ctx.putImageData(imageData, 0, 0);</pre> <p>И на этом, собственно, все; перезагрузите ваш браузер и взгляните. Круто, правда ведь?</p> <div class="tutorial_image"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" class="lazy07" data-src="https://cdn.tutsplus.com/cdn-cgi/image/width=550/net/uploads/legacy/998_canvas/9.jpg" alt="Изучение Canvas с нуля: работа с пикселями..." title="Изучение Canvas с нуля: работа с пикселями..." width="50" height="50"></div> <hr><h2>Подведение итогов</h2> <p>Мы рассмотрели лишь некоторые аспекты работы с пикселями, однако я надеюсь, что в этом руководстве вы почерпнули достаточно информации для получения вдохновения. Я настоятельно рекомендую вам копнуть в этом вопросе поглубже и посмотреть, что еще вы можете делать с пикселями. Почему? Потому что все техники по работе с пикселями можно также применить к видео HTML5 и изображениям. Теперь вы поняли, какие возможности открываются перед вами за счет умения манипулировать пикселями.</p> <p>В следующем руководстве, последнем в этой серии, мы будем рассматривать другие аспекты Canvas. Вы узнаете, как анимировать фигуры на «холсте», после чего у вас будет база, необходимая для создания мультипликаций, анимаций и игр. Это, бесспорно, мой любимый вариант использования Canvas.</p>

</div></div>

<div class="tm-article-body__tags"><div class="tm-article-body__tags-links tm-article-body__tags-links2"><span class="tm-article-body__tags-title">Теги:</span><span class="tm-article-body__tags-item"><a aria-label="Code" href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami" class="tm-article-body__tags-item-link">Code</a></span><span class="tm-article-body__tags-item"><a aria-label="Web Development" href="https://norma-studio.github.io/article5/220825686-izuchenie-canvas-s-nulya-rabota-s-pikselyami" class="tm-article-body__tags-item-link">Web Development</a></span></div></div></div></article>

<div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="v-portal" style="display:none;"></div></div><span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title><svg id="counter-views" viewBox="0 0 56 32"><path d="M28 0c18.368 0 28 13.81 28 16s-9.632 16-28 16c-18.368 0-28-13.81-28-16s9.632-16 28-16zm0 28.309c6.874 0 12.446-5.511 12.446-12.309s-5.572-12.309-12.446-12.309-12.446 5.511-12.446 12.309 5.572 12.309 12.446 12.309zM28 16c.084-1.721 5.596-3.019 4.284-4.352-2.429-2.468-6.317-2.521-8.684-.117s-2.314 6.354.116 8.821c2.429 2.468 6.317 2.521 8.683.117 1.089-1.106-4.47-3.008-4.399-4.469z"></path></svg></svg><span class="tm-icon-counter__value">
41532</span></span><button aria-label="Добавить в закладки" title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item" onclick="return addBookmark(this);"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title><svg id="counter-favorite" viewBox="0 0 12 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V15C0 15.3603 0.193793 15.6927 0.507301 15.8702C0.82081 16.0477 1.20556 16.0429 1.5145 15.8575L6 13.1662L10.4855 15.8575C10.7944 16.0429 11.1792 16.0477 11.4927 15.8702C11.8062 15.6927 12 15.3603 12 15V1C12 0.447715 11.5523 0 11 0H1Z"></path></svg></svg></span><span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
733</span></button><div title="Поделиться" class="tm-sharing tm-data-icons__item">
<button aria-label="sharing" type="button" class="tm-sharing__button sharer button btn5242" data-sharer="vk" data-url="none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button></div><div class="v-portal" style="display:none;"></div></div></div>
</div>

<div class="tm-page-article__additional-blocks wr55"></div>
<!-- pagination -->
 </div></div>
<!-- sidebar -->
<div class="tm-page__sidebar"><div id="572480" class="tm-layout-sidebar">

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top wr54" style="margin-top: 0px;">
<section class="tm-block tm-block_spacing-bottom wr12a"></section>
<section class="tm-block tm-block_spacing-bottom wr12">

</section>
</div></div></div></div></div></div></main></div><div id="exbottom" class="tm-footer wr56"></div></div><div class="vue-portal-target"></div></div>
<link rel="stylesheet" href="../style.css">
<script src="../jquery-3.7.0.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9PLTD9XQE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-Y9PLTD9XQE");</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(63258550, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/63258550" style="position:absolute; left:-9999px;" alt="" /></div></noscript></body></html>
